function Swipe(container,options){"use strict";var noop=function(){};var offloadFn=function(fn){setTimeout(fn||noop,0)};var browser={addEventListener:!!window.addEventListener,touch:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,transitions:function(temp){var props=["transitionProperty","WebkitTransition","MozTransition","OTransition","msTransition"];for(var i in props)if(temp.style[props[i]]!==undefined)return true;return false}(document.createElement("swipe"))};if(!container)return;var element=container.children[0];var slides,slidePos,width,length;options=options||{};var index=parseInt(options.startSlide,10)||0;var speed=options.speed||300;options.continuous=options.continuous!==undefined?options.continuous:true;function setup(){slides=element.children;length=slides.length;if(slides.length<2)options.continuous=false;if(browser.transitions&&options.continuous&&slides.length<3){element.appendChild(slides[0].cloneNode(true));element.appendChild(element.children[1].cloneNode(true));slides=element.children}slidePos=new Array(slides.length);width=container.getBoundingClientRect().width||container.offsetWidth;element.style.width=slides.length*width+"px";var pos=slides.length;while(pos--){var slide=slides[pos];slide.style.width=width+"px";slide.setAttribute("data-index",pos);if(browser.transitions){slide.style.left=pos*-width+"px";move(pos,index>pos?-width:index<pos?width:0,0)}}if(options.continuous&&browser.transitions){move(circle(index-1),-width,0);move(circle(index+1),width,0)}if(!browser.transitions)element.style.left=index*-width+"px";container.style.visibility="visible"}function prev(){if(options.continuous)slide(index-1);else if(index)slide(index-1)}function next(){if(options.continuous)slide(index+1);else if(index<slides.length-1)slide(index+1)}function circle(index){return(slides.length+index%slides.length)%slides.length}function slide(to,slideSpeed){if(index==to)return;if(browser.transitions){var direction=Math.abs(index-to)/(index-to);if(options.continuous){var natural_direction=direction;direction=-slidePos[circle(to)]/width;if(direction!==natural_direction)to=-direction*slides.length+to}var diff=Math.abs(index-to)-1;while(diff--)move(circle((to>index?to:index)-diff-1),width*direction,0);to=circle(to);move(index,width*direction,slideSpeed||speed);move(to,0,slideSpeed||speed);if(options.continuous)move(circle(to-direction),-(width*direction),0)}else{to=circle(to);animate(index*-width,to*-width,slideSpeed||speed)}index=to;offloadFn(options.callback&&options.callback(index,slides[index]))}function move(index,dist,speed){translate(index,dist,speed);slidePos[index]=dist}function translate(index,dist,speed){var slide=slides[index];var style=slide&&slide.style;if(!style)return;style.webkitTransitionDuration=style.MozTransitionDuration=style.msTransitionDuration=style.OTransitionDuration=style.transitionDuration=speed+"ms";style.webkitTransform="translate("+dist+"px,0)"+"translateZ(0)";style.msTransform=style.MozTransform=style.OTransform="translateX("+dist+"px)"}function animate(from,to,speed){if(!speed){element.style.left=to+"px";return}var start=+new Date;var timer=setInterval(function(){var timeElap=+new Date-start;if(timeElap>speed){element.style.left=to+"px";if(delay)begin();options.transitionEnd&&options.transitionEnd.call(event,index,slides[index]);clearInterval(timer);return}element.style.left=(to-from)*(Math.floor(timeElap/speed*100)/100)+from+"px"},4)}var delay=options.auto||0;var interval;function begin(){interval=setTimeout(next,delay)}function stop(){delay=0;clearTimeout(interval)}var start={};var delta={};var isScrolling;var events={handleEvent:function(event){switch(event.type){case"touchstart":this.start(event);break;case"touchmove":this.move(event);break;case"touchend":offloadFn(this.end(event));break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":offloadFn(this.transitionEnd(event));break;case"resize":offloadFn(setup.call());break}if(options.stopPropagation)event.stopPropagation()},start:function(event){var touches=event.touches[0];start={x:touches.pageX,y:touches.pageY,time:+new Date};isScrolling=undefined;delta={};element.addEventListener("touchmove",this,false);element.addEventListener("touchend",this,false)},move:function(event){if(event.touches.length>1||event.scale&&event.scale!==1)return;if(options.disableScroll)event.preventDefault();var touches=event.touches[0];delta={x:touches.pageX-start.x,y:touches.pageY-start.y};if(typeof isScrolling=="undefined"){isScrolling=!!(isScrolling||Math.abs(delta.x)<Math.abs(delta.y))}if(!isScrolling){event.preventDefault();stop();if(options.continuous){translate(circle(index-1),delta.x+slidePos[circle(index-1)],0);translate(index,delta.x+slidePos[index],0);translate(circle(index+1),delta.x+slidePos[circle(index+1)],0)}else{delta.x=delta.x/(!index&&delta.x>0||index==slides.length-1&&delta.x<0?Math.abs(delta.x)/width+1:1);translate(index-1,delta.x+slidePos[index-1],0);translate(index,delta.x+slidePos[index],0);translate(index+1,delta.x+slidePos[index+1],0)}}},end:function(event){var duration=+new Date-start.time;var isValidSlide=Number(duration)<250&&Math.abs(delta.x)>20||Math.abs(delta.x)>width/2;var isPastBounds=!index&&delta.x>0||index==slides.length-1&&delta.x<0;if(options.continuous)isPastBounds=false;var direction=delta.x<0;if(!isScrolling){if(isValidSlide&&!isPastBounds){if(direction){if(options.continuous){move(circle(index-1),-width,0);move(circle(index+2),width,0)}else{move(index-1,-width,0)}move(index,slidePos[index]-width,speed);move(circle(index+1),slidePos[circle(index+1)]-width,speed);index=circle(index+1)}else{if(options.continuous){move(circle(index+1),width,0);move(circle(index-2),-width,0)}else{move(index+1,width,0)}move(index,slidePos[index]+width,speed);move(circle(index-1),slidePos[circle(index-1)]+width,speed);index=circle(index-1)}options.callback&&options.callback(index,slides[index])}else{if(options.continuous){move(circle(index-1),-width,speed);move(index,0,speed);move(circle(index+1),width,speed)}else{move(index-1,-width,speed);move(index,0,speed);move(index+1,width,speed)}}}element.removeEventListener("touchmove",events,false);element.removeEventListener("touchend",events,false)},transitionEnd:function(event){if(parseInt(event.target.getAttribute("data-index"),10)==index){if(delay)begin();options.transitionEnd&&options.transitionEnd.call(event,index,slides[index])}}};setup();if(delay)begin();if(browser.addEventListener){if(browser.touch)element.addEventListener("touchstart",events,false);if(browser.transitions){element.addEventListener("webkitTransitionEnd",events,false);element.addEventListener("msTransitionEnd",events,false);element.addEventListener("oTransitionEnd",events,false);element.addEventListener("otransitionend",events,false);element.addEventListener("transitionend",events,false)}window.addEventListener("resize",events,false)}else{window.onresize=function(){setup()}}return{setup:function(){setup()},slide:function(to,speed){stop();slide(to,speed)},prev:function(){stop();prev()},next:function(){stop();next()},getPos:function(){return index},getNumSlides:function(){return length},kill:function(){stop();element.style.width="auto";element.style.left=0;var pos=slides.length;while(pos--){var slide=slides[pos];slide.style.width="100%";slide.style.left=0;if(browser.transitions)translate(pos,0,0)}if(browser.addEventListener){element.removeEventListener("touchstart",events,false);element.removeEventListener("webkitTransitionEnd",events,false);element.removeEventListener("msTransitionEnd",events,false);element.removeEventListener("oTransitionEnd",events,false);element.removeEventListener("otransitionend",events,false);element.removeEventListener("transitionend",events,false);window.removeEventListener("resize",events,false)}else{window.onresize=null}}}}if(window.jQuery||window.Zepto){(function($){$.fn.Swipe=function(params){return this.each(function(){$(this).data("Swipe",new Swipe($(this)[0],params))})}})(window.jQuery||window.Zepto)}
(function(){function r(a,c,d){if(a===c)return 0!==a||1/a==1/c;if(null==a||null==c)return a===c;a._chain&&(a=a._wrapped);c._chain&&(c=c._wrapped);if(a.isEqual&&b.isFunction(a.isEqual))return a.isEqual(c);if(c.isEqual&&b.isFunction(c.isEqual))return c.isEqual(a);var e=l.call(a);if(e!=l.call(c))return!1;switch(e){case"[object String]":return a==""+c;case"[object Number]":return a!=+a?c!=+c:0==a?1/a==1/c:a==+c;case"[object Date]":case"[object Boolean]":return+a==+c;case"[object RegExp]":return a.source==c.source&&a.global==c.global&&a.multiline==c.multiline&&a.ignoreCase==c.ignoreCase}if("object"!=typeof a||"object"!=typeof c)return!1;for(var f=d.length;f--;)if(d[f]==a)return!0;d.push(a);var f=0,g=!0;if("[object Array]"==e){if(f=a.length,g=f==c.length)for(;f--&&(g=f in a==f in c&&r(a[f],c[f],d)););}else{if("constructor"in a!="constructor"in c||a.constructor!=c.constructor)return!1;for(var h in a)if(b.has(a,h)&&(f++,!(g=b.has(c,h)&&r(a[h],c[h],d))))break;if(g){for(h in c)if(b.has(c,h)&&!f--)break;g=!f}}d.pop();return g}var s=this,I=s._,o={},k=Array.prototype,p=Object.prototype,i=k.slice,J=k.unshift,l=p.toString,K=p.hasOwnProperty,y=k.forEach,z=k.map,A=k.reduce,B=k.reduceRight,C=k.filter,D=k.every,E=k.some,q=k.indexOf,F=k.lastIndexOf,p=Array.isArray,L=Object.keys,t=Function.prototype.bind,b=function(a){return new m(a)};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=b),exports._=b):s._=b;b.VERSION="1.3.3";var j=b.each=b.forEach=function(a,c,d){if(a!=null)if(y&&a.forEach===y)a.forEach(c,d);else if(a.length===+a.length)for(var e=0,f=a.length;e<f;e++){if(e in a&&c.call(d,a[e],e,a)===o)break}else for(e in a)if(b.has(a,e)&&c.call(d,a[e],e,a)===o)break};b.map=b.collect=function(a,c,b){var e=[];if(a==null)return e;if(z&&a.map===z)return a.map(c,b);j(a,function(a,g,h){e[e.length]=c.call(b,a,g,h)});if(a.length===+a.length)e.length=a.length;return e};b.reduce=b.foldl=b.inject=function(a,c,d,e){var f=arguments.length>2;a==null&&(a=[]);if(A&&a.reduce===A){e&&(c=b.bind(c,e));return f?a.reduce(c,d):a.reduce(c)}j(a,function(a,b,i){if(f)d=c.call(e,d,a,b,i);else{d=a;f=true}});if(!f)throw new TypeError("Reduce of empty array with no initial value");return d};b.reduceRight=b.foldr=function(a,c,d,e){var f=arguments.length>2;a==null&&(a=[]);if(B&&a.reduceRight===B){e&&(c=b.bind(c,e));return f?a.reduceRight(c,d):a.reduceRight(c)}var g=b.toArray(a).reverse();e&&!f&&(c=b.bind(c,e));return f?b.reduce(g,c,d,e):b.reduce(g,c)};b.find=b.detect=function(a,c,b){var e;G(a,function(a,g,h){if(c.call(b,a,g,h)){e=a;return true}});return e};b.filter=b.select=function(a,c,b){var e=[];if(a==null)return e;if(C&&a.filter===C)return a.filter(c,b);j(a,function(a,g,h){c.call(b,a,g,h)&&(e[e.length]=a)});return e};b.reject=function(a,c,b){var e=[];if(a==null)return e;j(a,function(a,g,h){c.call(b,a,g,h)||(e[e.length]=a)});return e};b.every=b.all=function(a,c,b){var e=true;if(a==null)return e;if(D&&a.every===D)return a.every(c,b);j(a,function(a,g,h){if(!(e=e&&c.call(b,a,g,h)))return o});return!!e};var G=b.some=b.any=function(a,c,d){c||(c=b.identity);var e=false;if(a==null)return e;if(E&&a.some===E)return a.some(c,d);j(a,function(a,b,h){if(e||(e=c.call(d,a,b,h)))return o});return!!e};b.include=b.contains=function(a,c){var b=false;if(a==null)return b;if(q&&a.indexOf===q)return a.indexOf(c)!=-1;return b=G(a,function(a){return a===c})};b.invoke=function(a,c){var d=i.call(arguments,2);return b.map(a,function(a){return(b.isFunction(c)?c||a:a[c]).apply(a,d)})};b.pluck=function(a,c){return b.map(a,function(a){return a[c]})};b.max=function(a,c,d){if(!c&&b.isArray(a)&&a[0]===+a[0])return Math.max.apply(Math,a);if(!c&&b.isEmpty(a))return-Infinity;var e={computed:-Infinity};j(a,function(a,b,h){b=c?c.call(d,a,b,h):a;b>=e.computed&&(e={value:a,computed:b})});return e.value};b.min=function(a,c,d){if(!c&&b.isArray(a)&&a[0]===+a[0])return Math.min.apply(Math,a);if(!c&&b.isEmpty(a))return Infinity;var e={computed:Infinity};j(a,function(a,b,h){b=c?c.call(d,a,b,h):a;b<e.computed&&(e={value:a,computed:b})});return e.value};b.shuffle=function(a){var b=[],d;j(a,function(a,f){d=Math.floor(Math.random()*(f+1));b[f]=b[d];b[d]=a});return b};b.sortBy=function(a,c,d){var e=b.isFunction(c)?c:function(a){return a[c]};return b.pluck(b.map(a,function(a,b,c){return{value:a,criteria:e.call(d,a,b,c)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c===void 0?1:d===void 0?-1:c<d?-1:c>d?1:0}),"value")};b.groupBy=function(a,c){var d={},e=b.isFunction(c)?c:function(a){return a[c]};j(a,function(a,b){var c=e(a,b);(d[c]||(d[c]=[])).push(a)});return d};b.sortedIndex=function(a,c,d){d||(d=b.identity);for(var e=0,f=a.length;e<f;){var g=e+f>>1;d(a[g])<d(c)?e=g+1:f=g}return e};b.toArray=function(a){return!a?[]:b.isArray(a)||b.isArguments(a)?i.call(a):a.toArray&&b.isFunction(a.toArray)?a.toArray():b.values(a)};b.size=function(a){return b.isArray(a)?a.length:b.keys(a).length};b.first=b.head=b.take=function(a,b,d){return b!=null&&!d?i.call(a,0,b):a[0]};b.initial=function(a,b,d){return i.call(a,0,a.length-(b==null||d?1:b))};b.last=function(a,b,d){return b!=null&&!d?i.call(a,Math.max(a.length-b,0)):a[a.length-1]};b.rest=b.tail=function(a,b,d){return i.call(a,b==null||d?1:b)};b.compact=function(a){return b.filter(a,function(a){return!!a})};b.flatten=function(a,c){return b.reduce(a,function(a,e){if(b.isArray(e))return a.concat(c?e:b.flatten(e));a[a.length]=e;return a},[])};b.without=function(a){return b.difference(a,i.call(arguments,1))};b.uniq=b.unique=function(a,c,d){var d=d?b.map(a,d):a,e=[];a.length<3&&(c=true);b.reduce(d,function(d,g,h){if(c?b.last(d)!==g||!d.length:!b.include(d,g)){d.push(g);e.push(a[h])}return d},[]);return e};b.union=function(){return b.uniq(b.flatten(arguments,true))};b.intersection=b.intersect=function(a){var c=i.call(arguments,1);return b.filter(b.uniq(a),function(a){return b.every(c,function(c){return b.indexOf(c,a)>=0})})};b.difference=function(a){var c=b.flatten(i.call(arguments,1),true);return b.filter(a,function(a){return!b.include(c,a)})};b.zip=function(){for(var a=i.call(arguments),c=b.max(b.pluck(a,"length")),d=Array(c),e=0;e<c;e++)d[e]=b.pluck(a,""+e);return d};b.indexOf=function(a,c,d){if(a==null)return-1;var e;if(d){d=b.sortedIndex(a,c);return a[d]===c?d:-1}if(q&&a.indexOf===q)return a.indexOf(c);d=0;for(e=a.length;d<e;d++)if(d in a&&a[d]===c)return d;return-1};b.lastIndexOf=function(a,b){if(a==null)return-1;if(F&&a.lastIndexOf===F)return a.lastIndexOf(b);for(var d=a.length;d--;)if(d in a&&a[d]===b)return d;return-1};b.range=function(a,b,d){if(arguments.length<=1){b=a||0;a=0}for(var d=arguments[2]||1,e=Math.max(Math.ceil((b-a)/d),0),f=0,g=Array(e);f<e;){g[f++]=a;a=a+d}return g};var H=function(){};b.bind=function(a,c){var d,e;if(a.bind===t&&t)return t.apply(a,i.call(arguments,1));if(!b.isFunction(a))throw new TypeError;e=i.call(arguments,2);return d=function(){if(!(this instanceof d))return a.apply(c,e.concat(i.call(arguments)));H.prototype=a.prototype;var b=new H,g=a.apply(b,e.concat(i.call(arguments)));return Object(g)===g?g:b}};b.bindAll=function(a){var c=i.call(arguments,1);c.length==0&&(c=b.functions(a));j(c,function(c){a[c]=b.bind(a[c],a)});return a};b.memoize=function(a,c){var d={};c||(c=b.identity);return function(){var e=c.apply(this,arguments);return b.has(d,e)?d[e]:d[e]=a.apply(this,arguments)}};b.delay=function(a,b){var d=i.call(arguments,2);return setTimeout(function(){return a.apply(null,d)},b)};b.defer=function(a){return b.delay.apply(b,[a,1].concat(i.call(arguments,1)))};b.throttle=function(a,c){var d,e,f,g,h,i,j=b.debounce(function(){h=g=false},c);return function(){d=this;e=arguments;f||(f=setTimeout(function(){f=null;h&&a.apply(d,e);j()},c));g?h=true:i=a.apply(d,e);j();g=true;return i}};b.debounce=function(a,b,d){var e;return function(){var f=this,g=arguments;d&&!e&&a.apply(f,g);clearTimeout(e);e=setTimeout(function(){e=null;d||a.apply(f,g)},b)}};b.once=function(a){var b=false,d;return function(){if(b)return d;b=true;return d=a.apply(this,arguments)}};b.wrap=function(a,b){return function(){var d=[a].concat(i.call(arguments,0));return b.apply(this,d)}};b.compose=function(){var a=arguments;return function(){for(var b=arguments,d=a.length-1;d>=0;d--)b=[a[d].apply(this,b)];return b[0]}};b.after=function(a,b){return a<=0?b():function(){if(--a<1)return b.apply(this,arguments)}};b.keys=L||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var c=[],d;for(d in a)b.has(a,d)&&(c[c.length]=d);return c};b.values=function(a){return b.map(a,b.identity)};b.functions=b.methods=function(a){var c=[],d;for(d in a)b.isFunction(a[d])&&c.push(d);return c.sort()};b.extend=function(a){j(i.call(arguments,1),function(b){for(var d in b)a[d]=b[d]});return a};b.pick=function(a){var c={};j(b.flatten(i.call(arguments,1)),function(b){b in a&&(c[b]=a[b])});return c};b.defaults=function(a){j(i.call(arguments,1),function(b){for(var d in b)a[d]==null&&(a[d]=b[d])});return a};b.clone=function(a){return!b.isObject(a)?a:b.isArray(a)?a.slice():b.extend({},a)};b.tap=function(a,b){b(a);return a};b.isEqual=function(a,b){return r(a,b,[])};b.isEmpty=function(a){if(a==null)return true;if(b.isArray(a)||b.isString(a))return a.length===0;for(var c in a)if(b.has(a,c))return false;return true};b.isElement=function(a){return!!(a&&a.nodeType==1)};b.isArray=p||function(a){return l.call(a)=="[object Array]"};b.isObject=function(a){return a===Object(a)};b.isArguments=function(a){return l.call(a)=="[object Arguments]"};b.isArguments(arguments)||(b.isArguments=function(a){return!(!a||!b.has(a,"callee"))});b.isFunction=function(a){return l.call(a)=="[object Function]"};b.isString=function(a){return l.call(a)=="[object String]"};b.isNumber=function(a){return l.call(a)=="[object Number]"};b.isFinite=function(a){return b.isNumber(a)&&isFinite(a)};b.isNaN=function(a){return a!==a};b.isBoolean=function(a){return a===true||a===false||l.call(a)=="[object Boolean]"};b.isDate=function(a){return l.call(a)=="[object Date]"};b.isRegExp=function(a){return l.call(a)=="[object RegExp]"};b.isNull=function(a){return a===null};b.isUndefined=function(a){return a===void 0};b.has=function(a,b){return K.call(a,b)};b.noConflict=function(){s._=I;return this};b.identity=function(a){return a};b.times=function(a,b,d){for(var e=0;e<a;e++)b.call(d,e)};b.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};b.result=function(a,c){if(a==null)return null;var d=a[c];return b.isFunction(d)?d.call(a):d};b.mixin=function(a){j(b.functions(a),function(c){M(c,b[c]=a[c])})};var N=0;b.uniqueId=function(a){var b=N++;return a?a+b:b};b.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var u=/.^/,n={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"},v;for(v in n)n[n[v]]=v;var O=/\\|'|\r|\n|\t|\u2028|\u2029/g,P=/\\(\\|'|r|n|t|u2028|u2029)/g,w=function(a){return a.replace(P,function(a,b){return n[b]})};b.template=function(a,c,d){d=b.defaults(d||{},b.templateSettings);a="__p+='"+a.replace(O,function(a){return"\\"+n[a]}).replace(d.escape||u,function(a,b){return"'+\n_.escape("+w(b)+")+\n'"}).replace(d.interpolate||u,function(a,b){return"'+\n("+w(b)+")+\n'"}).replace(d.evaluate||u,function(a,b){return"';\n"+w(b)+"\n;__p+='"})+"';\n";d.variable||(a="with(obj||{}){\n"+a+"}\n");var a="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+a+"return __p;\n",e=new Function(d.variable||"obj","_",a);if(c)return e(c,b);c=function(a){return e.call(this,a,b)};c.source="function("+(d.variable||"obj")+"){\n"+a+"}";return c};b.chain=function(a){return b(a).chain()};var m=function(a){this._wrapped=a};b.prototype=m.prototype;var x=function(a,c){return c?b(a).chain():a},M=function(a,c){m.prototype[a]=function(){var a=i.call(arguments);J.call(a,this._wrapped);return x(c.apply(b,a),this._chain)}};b.mixin(b);j("pop,push,reverse,shift,sort,splice,unshift".split(","),function(a){var b=k[a];m.prototype[a]=function(){var d=this._wrapped;b.apply(d,arguments);var e=d.length;(a=="shift"||a=="splice")&&e===0&&delete d[0];return x(d,this._chain)}});j(["concat","join","slice"],function(a){var b=k[a];m.prototype[a]=function(){return x(b.apply(this._wrapped,arguments),this._chain)}});m.prototype.chain=function(){this._chain=true;return this};m.prototype.value=function(){return this._wrapped}}).call(this);
(function(){var l=this,y=l.Backbone,z=Array.prototype.slice,A=Array.prototype.splice,g;g="undefined"!==typeof exports?exports:l.Backbone={};g.VERSION="0.9.2";var f=l._;!f&&"undefined"!==typeof require&&(f=require("underscore"));var i=l.jQuery||l.Zepto||l.ender;g.setDomLibrary=function(a){i=a};g.noConflict=function(){l.Backbone=y;return this};g.emulateHTTP=!1;g.emulateJSON=!1;var p=/\s+/,k=g.Events={on:function(a,b,c){var d,e,f,g,j;if(!b)return this;a=a.split(p);for(d=this._callbacks||(this._callbacks={});e=a.shift();)f=(j=d[e])?j.tail:{},f.next=g={},f.context=c,f.callback=b,d[e]={tail:g,next:j?j.next:f};return this},off:function(a,b,c){var d,e,h,g,j,q;if(e=this._callbacks){if(!a&&!b&&!c)return delete this._callbacks,this;for(a=a?a.split(p):f.keys(e);d=a.shift();)if(h=e[d],delete e[d],h&&(b||c))for(g=h.tail;(h=h.next)!==g;)if(j=h.callback,q=h.context,b&&j!==b||c&&q!==c)this.on(d,j,q);return this}},trigger:function(a){var b,c,d,e,f,g;if(!(d=this._callbacks))return this;f=d.all;a=a.split(p);for(g=z.call(arguments,1);b=a.shift();){if(c=d[b])for(e=c.tail;(c=c.next)!==e;)c.callback.apply(c.context||this,g);if(c=f){e=c.tail;for(b=[b].concat(g);(c=c.next)!==e;)c.callback.apply(c.context||this,b)}}return this}};k.bind=k.on;k.unbind=k.off;var o=g.Model=function(a,b){var c;a||(a={});b&&b.parse&&(a=this.parse(a));if(c=n(this,"defaults"))a=f.extend({},c,a);b&&b.collection&&(this.collection=b.collection);this.attributes={};this._escapedAttributes={};this.cid=f.uniqueId("c");this.changed={};this._silent={};this._pending={};this.set(a,{silent:!0});this.changed={};this._silent={};this._pending={};this._previousAttributes=f.clone(this.attributes);this.initialize.apply(this,arguments)};f.extend(o.prototype,k,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(){return f.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var b;if(b=this._escapedAttributes[a])return b;b=this.get(a);return this._escapedAttributes[a]=f.escape(null==b?"":""+b)},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e;f.isObject(a)||null==a?(d=a,c=b):(d={},d[a]=b);c||(c={});if(!d)return this;d instanceof o&&(d=d.attributes);if(c.unset)for(e in d)d[e]=void 0;if(!this._validate(d,c))return!1;this.idAttribute in d&&(this.id=d[this.idAttribute]);var b=c.changes={},h=this.attributes,g=this._escapedAttributes,j=this._previousAttributes||{};for(e in d){a=d[e];if(!f.isEqual(h[e],a)||c.unset&&f.has(h,e))delete g[e],(c.silent?this._silent:b)[e]=!0;c.unset?delete h[e]:h[e]=a;!f.isEqual(j[e],a)||f.has(h,e)!=f.has(j,e)?(this.changed[e]=a,c.silent||(this._pending[e]=!0)):(delete this.changed[e],delete this._pending[e])}c.silent||this.change(c);return this},unset:function(a,b){(b||(b={})).unset=!0;return this.set(a,null,b)},clear:function(a){(a||(a={})).unset=!0;return this.set(f.clone(this.attributes),a)},fetch:function(a){var a=a?f.clone(a):{},b=this,c=a.success;a.success=function(d,e,f){if(!b.set(b.parse(d,f),a))return!1;c&&c(b,d)};a.error=g.wrapError(a.error,b,a);return(this.sync||g.sync).call(this,"read",this,a)},save:function(a,b,c){var d,e;f.isObject(a)||null==a?(d=a,c=b):(d={},d[a]=b);c=c?f.clone(c):{};if(c.wait){if(!this._validate(d,c))return!1;e=f.clone(this.attributes)}a=f.extend({},c,{silent:!0});if(d&&!this.set(d,c.wait?a:c))return!1;var h=this,i=c.success;c.success=function(a,b,e){b=h.parse(a,e);if(c.wait){delete c.wait;b=f.extend(d||{},b)}if(!h.set(b,c))return false;i?i(h,a):h.trigger("sync",h,a,c)};c.error=g.wrapError(c.error,h,c);b=this.isNew()?"create":"update";b=(this.sync||g.sync).call(this,b,this,c);c.wait&&this.set(e,a);return b},destroy:function(a){var a=a?f.clone(a):{},b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(this.isNew())return d(),!1;a.success=function(e){a.wait&&d();c?c(b,e):b.trigger("sync",b,e,a)};a.error=g.wrapError(a.error,b,a);var e=(this.sync||g.sync).call(this,"delete",this,a);a.wait||d();return e},url:function(){var a=n(this,"urlRoot")||n(this.collection,"url")||t();return this.isNew()?a:a+("/"==a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(a){a||(a={});var b=this._changing;this._changing=!0;for(var c in this._silent)this._pending[c]=!0;var d=f.extend({},a.changes,this._silent);this._silent={};for(c in d)this.trigger("change:"+c,this,this.get(c),a);if(b)return this;for(;!f.isEmpty(this._pending);){this._pending={};this.trigger("change",this,a);for(c in this.changed)!this._pending[c]&&!this._silent[c]&&delete this.changed[c];this._previousAttributes=f.clone(this.attributes)}this._changing=!1;return this},hasChanged:function(a){return!arguments.length?!f.isEmpty(this.changed):f.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?f.clone(this.changed):!1;var b,c=!1,d=this._previousAttributes,e;for(e in a)if(!f.isEqual(d[e],b=a[e]))(c||(c={}))[e]=b;return c},previous:function(a){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return f.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(a,b){if(b.silent||!this.validate)return!0;var a=f.extend({},this.attributes,a),c=this.validate(a,b);if(!c)return!0;b&&b.error?b.error(this,c,b):this.trigger("error",this,c,b);return!1}});var r=g.Collection=function(a,b){b||(b={});b.model&&(this.model=b.model);b.comparator&&(this.comparator=b.comparator);this._reset();this.initialize.apply(this,arguments);a&&this.reset(a,{silent:!0,parse:b.parse})};f.extend(r.prototype,k,{model:o,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},add:function(a,b){var c,d,e,g,i,j={},k={},l=[];b||(b={});a=f.isArray(a)?a.slice():[a];c=0;for(d=a.length;c<d;c++){if(!(e=a[c]=this._prepareModel(a[c],b)))throw Error("Can't add an invalid model to a collection");g=e.cid;i=e.id;j[g]||this._byCid[g]||null!=i&&(k[i]||this._byId[i])?l.push(c):j[g]=k[i]=e}for(c=l.length;c--;)a.splice(l[c],1);c=0;for(d=a.length;c<d;c++)(e=a[c]).on("all",this._onModelEvent,this),this._byCid[e.cid]=e,null!=e.id&&(this._byId[e.id]=e);this.length+=d;A.apply(this.models,[null!=b.at?b.at:this.models.length,0].concat(a));this.comparator&&this.sort({silent:!0});if(b.silent)return this;c=0;for(d=this.models.length;c<d;c++)if(j[(e=this.models[c]).cid])b.index=c,e.trigger("add",e,this,b);return this},remove:function(a,b){var c,d,e,g;b||(b={});a=f.isArray(a)?a.slice():[a];c=0;for(d=a.length;c<d;c++)if(g=this.getByCid(a[c])||this.get(a[c]))delete this._byId[g.id],delete this._byCid[g.cid],e=this.indexOf(g),this.models.splice(e,1),this.length--,b.silent||(b.index=e,g.trigger("remove",g,this,b)),this._removeReference(g);return this},push:function(a,b){a=this._prepareModel(a,b);this.add(a,b);return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){a=this._prepareModel(a,b);this.add(a,f.extend({at:0},b));return a},shift:function(a){var b=this.at(0);this.remove(b,a);return b},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},where:function(a){return f.isEmpty(a)?[]:this.filter(function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},sort:function(a){a||(a={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");var b=f.bind(this.comparator,this);1==this.comparator.length?this.models=this.sortBy(b):this.models.sort(b);a.silent||this.trigger("reset",this,a);return this},pluck:function(a){return f.map(this.models,function(b){return b.get(a)})},reset:function(a,b){a||(a=[]);b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);this._reset();this.add(a,f.extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return this},fetch:function(a){a=a?f.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;a.success=function(d,e,f){b[a.add?"add":"reset"](b.parse(d,f),a);c&&c(b,d)};a.error=g.wrapError(a.error,b,a);return(this.sync||g.sync).call(this,"read",this,a)},create:function(a,b){var c=this,b=b?f.clone(b):{},a=this._prepareModel(a,b);if(!a)return!1;b.wait||c.add(a,b);var d=b.success;b.success=function(e,f){b.wait&&c.add(e,b);d?d(e,f):e.trigger("sync",a,f,b)};a.save(null,b);return a},parse:function(a){return a},chain:function(){return f(this.models).chain()},_reset:function(){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(a,b){b||(b={});a instanceof o?a.collection||(a.collection=this):(b.collection=this,a=new this.model(a,b),a._validate(a.attributes,b)||(a=!1));return a},_removeReference:function(a){this==a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"==a||"remove"==a)&&c!=this||("destroy"==a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,arguments))}});f.each("forEach,each,map,reduce,reduceRight,find,detect,filter,select,reject,every,all,some,any,include,contains,invoke,max,min,sortBy,sortedIndex,toArray,size,first,initial,rest,last,without,indexOf,shuffle,lastIndexOf,isEmpty,groupBy".split(","),function(a){r.prototype[a]=function(){return f[a].apply(f,[this.models].concat(f.toArray(arguments)))}});var u=g.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},B=/:\w+/g,C=/\*\w+/g,D=/[-[\]{}()+?.,\\^$|#\s]/g;f.extend(u.prototype,k,{initialize:function(){},route:function(a,b,c){g.history||(g.history=new m);f.isRegExp(a)||(a=this._routeToRegExp(a));c||(c=this[b]);g.history.route(a,f.bind(function(d){d=this._extractParameters(a,d);c&&c.apply(this,d);this.trigger.apply(this,["route:"+b].concat(d));g.history.trigger("route",this,b,d)},this));return this},navigate:function(a,b){g.history.navigate(a,b)},_bindRoutes:function(){if(this.routes){var a=[],b;for(b in this.routes)a.unshift([b,this.routes[b]]);b=0;for(var c=a.length;b<c;b++)this.route(a[b][0],a[b][1],this[a[b][1]])}},_routeToRegExp:function(a){a=a.replace(D,"\\$&").replace(B,"([^/]+)").replace(C,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});var m=g.History=function(){this.handlers=[];f.bindAll(this,"checkUrl")},s=/^[#\/]/,E=/msie [\w.]+/;m.started=!1;f.extend(m.prototype,k,{interval:50,getHash:function(a){return(a=(a?a.location:window.location).href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||b){var a=window.location.pathname,c=window.location.search;c&&(a+=c)}else a=this.getHash();a.indexOf(this.options.root)||(a=a.substr(this.options.root.length));return a.replace(s,"")},start:function(a){if(m.started)throw Error("Backbone.history has already been started");m.started=!0;this.options=f.extend({},{root:"/"},this.options,a);this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);var a=this.getFragment(),b=document.documentMode;if(b=E.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b))this.iframe=i('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a);this._hasPushState?i(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!b?i(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=a;a=window.location;b=a.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&b&&a.hash&&(this.fragment=this.getHash().replace(s,""),window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){i(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);m.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();a==this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a==this.fragment)return!1;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return f.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,b){if(!m.started)return!1;if(!b||!0===b)b={trigger:b};var c=(a||"").replace(s,"");this.fragment!=c&&(this._hasPushState?(0!=c.indexOf(this.options.root)&&(c=this.options.root+c),this.fragment=c,window.history[b.replace?"replaceState":"pushState"]({},document.title,c)):this._wantsHashChange?(this.fragment=c,this._updateHash(window.location,c,b.replace),this.iframe&&c!=this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,c,b.replace))):window.location.assign(this.options.root+a),b.trigger&&this.loadUrl(a))},_updateHash:function(a,b,c){c?a.replace(a.toString().replace(/(javascript:|#).*$/,"")+"#"+b):a.hash=b}});var v=g.View=function(a){this.cid=f.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},F=/^(\S+)\s*(.*)$/,w="model,collection,el,id,attributes,className,tagName".split(",");f.extend(v.prototype,k,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(a,b,c){a=document.createElement(a);b&&i(a).attr(b);c&&i(a).html(c);return a},setElement:function(a,b){this.$el&&this.undelegateEvents();this.$el=a instanceof i?a:i(a);this.el=this.$el[0];!1!==b&&this.delegateEvents();return this},delegateEvents:function(a){if(a||(a=n(this,"events"))){this.undelegateEvents();for(var b in a){var c=a[b];f.isFunction(c)||(c=this[a[b]]);if(!c)throw Error('Method "'+a[b]+'" does not exist');var d=b.match(F),e=d[1],d=d[2],c=f.bind(c,this),e=e+(".delegateEvents"+this.cid);""===d?this.$el.bind(e,c):this.$el.delegate(d,e,c)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(a){this.options&&(a=f.extend({},this.options,a));for(var b=0,c=w.length;b<c;b++){var d=w[b];a[d]&&(this[d]=a[d])}this.options=a},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var a=n(this,"attributes")||{};this.id&&(a.id=this.id);this.className&&(a["class"]=this.className);this.setElement(this.make(this.tagName,a),!1)}}});o.extend=r.extend=u.extend=v.extend=function(a,b){var c=G(this,a,b);c.extend=this.extend;return c};var H={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};g.sync=function(a,b,c){var d=H[a];c||(c={});var e={type:d,dataType:"json"};c.url||(e.url=n(b,"url")||t());if(!c.data&&b&&("create"==a||"update"==a))e.contentType="application/json",e.data=JSON.stringify(b.toJSON());g.emulateJSON&&(e.contentType="application/x-www-form-urlencoded",e.data=e.data?{model:e.data}:{});if(g.emulateHTTP&&("PUT"===d||"DELETE"===d))g.emulateJSON&&(e.data._method=d),e.type="POST",e.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",d)};"GET"!==e.type&&!g.emulateJSON&&(e.processData=!1);return i.ajax(f.extend(e,c))};g.wrapError=function(a,b,c){return function(d,e){e=d===b?e:d;a?a(b,e,c):b.trigger("error",b,e,c)}};var x=function(){},G=function(a,b,c){var d;d=b&&b.hasOwnProperty("constructor")?b.constructor:function(){a.apply(this,arguments)};f.extend(d,a);x.prototype=a.prototype;d.prototype=new x;b&&f.extend(d.prototype,b);c&&f.extend(d,c);d.prototype.constructor=d;d.__super__=a.prototype;return d},n=function(a,b){return!a||!a[b]?null:f.isFunction(a[b])?a[b]():a[b]},t=function(){throw Error('A "url" property or function must be specified')}}).call(this);
var Kinetic={};Kinetic.GlobalObject={stages:[],idCounter:0,tempNodes:[],animations:[],animIdCounter:0,animRunning:false,maxDragTimeInterval:20,frame:{time:0,timeDiff:0,lastTime:0},drag:{moving:false,node:undefined,offset:{x:0,y:0},lastDrawTime:0},extend:function(obj1,obj2){for(var key in obj2.prototype){if(obj2.prototype.hasOwnProperty(key)&&obj1.prototype[key]===undefined){obj1.prototype[key]=obj2.prototype[key]}}},addSetters:function(constructor,arr){for(var n=0;n<arr.length;n++){var attr=arr[n];this._addSetter(constructor,attr)}},addGetters:function(constructor,arr){for(var n=0;n<arr.length;n++){var attr=arr[n];this._addGetter(constructor,attr)}},_pullNodes:function(stage){var tempNodes=this.tempNodes;for(var n=0;n<tempNodes.length;n++){var node=tempNodes[n];if(node.getStage()!==undefined&&node.getStage()._id===stage._id){stage._addId(node);stage._addName(node);this.tempNodes.splice(n,1);n-=1}}},_addAnimation:function(anim){anim.id=this.animIdCounter++;this.animations.push(anim)},_removeAnimation:function(anim){var id=anim.id;var animations=this.animations;for(var n=0;n<animations.length;n++){if(animations[n].id===id){this.animations.splice(n,1);return false}}},_runFrames:function(){var nodes={};for(var n=0;n<this.animations.length;n++){var anim=this.animations[n];if(anim.node&&anim.node._id!==undefined){nodes[anim.node._id]=anim.node}anim.func(this.frame)}for(var key in nodes){nodes[key].draw()}},_updateFrameObject:function(){var date=new Date;var time=date.getTime();if(this.frame.lastTime===0){this.frame.lastTime=time}else{this.frame.timeDiff=time-this.frame.lastTime;this.frame.lastTime=time;this.frame.time+=this.frame.timeDiff}},_animationLoop:function(){if(this.animations.length>0){this._updateFrameObject();this._runFrames();var that=this;window.requestAnimFrame(function(){that._animationLoop()})}else{this.animRunning=false;this.frame.lastTime=0}},_handleAnimation:function(){var that=this;if(!this.animRunning){this.animRunning=true;that._animationLoop()}else{this.frame.lastTime=0}},_isElement:function(obj){return!!(obj&&obj.nodeType==1)},_isFunction:function(obj){return!!(obj&&obj.constructor&&obj.call&&obj.apply)},_isArray:function(obj){return Object.prototype.toString.call(obj)=="[object Array]"},_isObject:function(obj){return obj!==undefined&&obj.constructor==Object},_isNumber:function(obj){return Object.prototype.toString.call(obj)=="[object Number]"},_hasMethods:function(obj){var names=[];for(var key in obj){if(this._isFunction(obj[key]))names.push(key)}return names.length>0},_getXY:function(arg){if(this._isNumber(arg)){return{x:arg,y:arg}}else if(this._isArray(arg)){if(arg.length===1){var val=arg[0];if(this._isNumber(val)){return{x:val,y:val}}else if(this._isArray(val)){return{x:val[0],y:val[1]}}else if(this._isObject(val)){return val}}else if(arg.length>=2){return{x:arg[0],y:arg[1]}}}else if(this._isObject(arg)){return arg}return{x:0,y:0}},_getSize:function(arg){if(this._isNumber(arg)){return{width:arg,height:arg}}else if(this._isArray(arg)){if(arg.length===1){var val=arg[0];if(this._isNumber(val)){return{width:val,height:val}}else if(this._isArray(val)){if(val.length>=4){return{width:val[2],height:val[3]}}else if(val.length>=2){return{width:val[0],height:val[1]}}}else if(this._isObject(val)){return val}}else if(arg.length>=4){return{width:arg[2],height:arg[3]}}else if(arg.length>=2){return{width:arg[0],height:arg[1]}}}else if(this._isObject(arg)){return arg}return{width:0,height:0}},_getPoints:function(arg){if(arg===undefined){return[]}if(this._isObject(arg[0])){return arg}else{var arr=[];for(var n=0;n<arg.length;n+=2){arr.push({x:arg[n],y:arg[n+1]})}return arr}},_addSetter:function(constructor,attr){var that=this;var method="set"+attr.charAt(0).toUpperCase()+attr.slice(1);constructor.prototype[method]=function(arg){var obj={};obj[attr]=arg;this.setAttrs(obj)}},_addGetter:function(constructor,attr){var that=this;var method="get"+attr.charAt(0).toUpperCase()+attr.slice(1);constructor.prototype[method]=function(arg){return this.attrs[attr]}}};window.requestAnimFrame=function(callback){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)}}();Kinetic.Node=function(config){this.defaultNodeAttrs={visible:true,listening:true,name:undefined,alpha:1,x:0,y:0,scale:{x:1,y:1},rotation:0,offset:{x:0,y:0},dragConstraint:"none",dragBounds:{},draggable:false};this.setDefaultAttrs(this.defaultNodeAttrs);this.eventListeners={};this.setAttrs(config);this.on("draggableChange.kinetic",function(){if(this.attrs.draggable){this._listenDrag()}else{this._dragCleanup();var stage=this.getStage();var go=Kinetic.GlobalObject;if(stage&&go.drag.node&&go.drag.node._id===this._id){stage._endDrag()}}});this.simulate("draggableChange")};Kinetic.Node.prototype={on:function(typesStr,handler){var types=typesStr.split(" ");for(var n=0;n<types.length;n++){var type=types[n];var event=type;var parts=event.split(".");var baseEvent=parts[0];var name=parts.length>1?parts[1]:"";if(!this.eventListeners[baseEvent]){this.eventListeners[baseEvent]=[]}this.eventListeners[baseEvent].push({name:name,handler:handler})}},off:function(typesStr){var types=typesStr.split(" ");for(var n=0;n<types.length;n++){var type=types[n];var event=type;var parts=event.split(".");var baseEvent=parts[0];if(this.eventListeners[baseEvent]&&parts.length>1){var name=parts[1];for(var i=0;i<this.eventListeners[baseEvent].length;i++){if(this.eventListeners[baseEvent][i].name===name){this.eventListeners[baseEvent].splice(i,1);if(this.eventListeners[baseEvent].length===0){delete this.eventListeners[baseEvent];break}i--}}}else{delete this.eventListeners[baseEvent]}}},getAttrs:function(){return this.attrs},setDefaultAttrs:function(config){if(this.attrs===undefined){this.attrs={}}if(config){for(var key in config){if(this.attrs[key]===undefined){this.attrs[key]=config[key]}}}},setAttrs:function(config){var go=Kinetic.GlobalObject;var that=this;var pos;if(config!==undefined){var setAttrs=function(obj,c,level){for(var key in c){var val=c[key];if(obj[key]===undefined){obj[key]={}}if(go._isObject(val)&&!go._isArray(val)&&!go._isElement(val)&&!go._hasMethods(val)){if(!Kinetic.GlobalObject._isObject(obj[key])){obj[key]={}}setAttrs(obj[key],val,level+1)}else{switch(key){case"rotationDeg":that._setAttr(obj,"rotation",c[key]*Math.PI/180);key="rotation";break;case"offset":pos=go._getXY(val);that._setAttr(obj[key],"x",pos.x);that._setAttr(obj[key],"y",pos.y);break;case"scale":pos=go._getXY(val);that._setAttr(obj[key],"x",pos.x);that._setAttr(obj[key],"y",pos.y);break;case"points":that._setAttr(obj,key,go._getPoints(val));break;case"crop":pos=go._getXY(val);var size=go._getSize(val);that._setAttr(obj[key],"x",pos.x);that._setAttr(obj[key],"y",pos.y);that._setAttr(obj[key],"width",size.width);that._setAttr(obj[key],"height",size.height);break;default:that._setAttr(obj,key,val);break}if(level===0){that._fireChangeEvent(key)}}}};setAttrs(this.attrs,config,0)}},isVisible:function(){if(this.getParent()&&!this.getParent().isVisible()){return false}return this.attrs.visible},show:function(){this.setAttrs({visible:true})},hide:function(){this.setAttrs({visible:false})},getZIndex:function(){return this.index},getAbsoluteZIndex:function(){var level=this.getLevel();var stage=this.getStage();var that=this;var index=0;function addChildren(children){var nodes=[];for(var n=0;n<children.length;n++){var child=children[n];index++;if(child.nodeType!=="Shape"){nodes=nodes.concat(child.getChildren())}if(child._id===that._id){n=children.length}}if(nodes.length>0&&nodes[0].getLevel()<=level){addChildren(nodes)}}if(that.nodeType!=="Stage"){addChildren(that.getStage().getChildren())}return index},getLevel:function(){var level=0;var parent=this.parent;while(parent){level++;parent=parent.parent}return level},setScale:function(){this.setAttrs({scale:Array.prototype.slice.call(arguments)})},setPosition:function(){var pos=Kinetic.GlobalObject._getXY(Array.prototype.slice.call(arguments));this.setAttrs(pos)},getPosition:function(){return{x:this.attrs.x,y:this.attrs.y}},getAbsolutePosition:function(){return this.getAbsoluteTransform().getTranslation()},setAbsolutePosition:function(){var pos=Kinetic.GlobalObject._getXY(Array.prototype.slice.call(arguments));var rot=this.attrs.rotation;var scale={x:this.attrs.scale.x,y:this.attrs.scale.y};var offset={x:this.attrs.offset.x,y:this.attrs.offset.y};this.attrs.rotation=0;this.attrs.scale={x:1,y:1};var it=this.getAbsoluteTransform();it.invert();it.translate(pos.x,pos.y);pos={x:this.attrs.x+it.getTranslation().x,y:this.attrs.y+it.getTranslation().y};this.setPosition(pos.x,pos.y);this.rotate(rot);this.attrs.scale={x:scale.x,y:scale.y}},move:function(){var pos=Kinetic.GlobalObject._getXY(Array.prototype.slice.call(arguments));var x=this.getX();var y=this.getY();if(pos.x!==undefined){x+=pos.x}if(pos.y!==undefined){y+=pos.y}this.setAttrs({x:x,y:y})},setRotationDeg:function(deg){this.setRotation(deg*Math.PI/180)},getRotationDeg:function(){return this.attrs.rotation*180/Math.PI},rotate:function(theta){this.setAttrs({rotation:this.getRotation()+theta})},rotateDeg:function(deg){this.setAttrs({rotation:this.getRotation()+deg*Math.PI/180})},moveToTop:function(){var index=this.index;this.parent.children.splice(index,1);this.parent.children.push(this);this.parent._setChildrenIndices()},moveUp:function(){var index=this.index;this.parent.children.splice(index,1);this.parent.children.splice(index+1,0,this);this.parent._setChildrenIndices()},moveDown:function(){var index=this.index;if(index>0){this.parent.children.splice(index,1);this.parent.children.splice(index-1,0,this);this.parent._setChildrenIndices()}},moveToBottom:function(){var index=this.index;this.parent.children.splice(index,1);this.parent.children.unshift(this);this.parent._setChildrenIndices()},setZIndex:function(zIndex){var index=this.index;this.parent.children.splice(index,1);this.parent.children.splice(zIndex,0,this);this.parent._setChildrenIndices()},getAbsoluteAlpha:function(){var absAlpha=1;var node=this;while(node.nodeType!=="Stage"){absAlpha*=node.attrs.alpha;node=node.parent}return absAlpha},isDragging:function(){var go=Kinetic.GlobalObject;return go.drag.node!==undefined&&go.drag.node._id===this._id&&go.drag.moving},moveTo:function(newContainer){var parent=this.parent;parent.children.splice(this.index,1);parent._setChildrenIndices();newContainer.children.push(this);this.index=newContainer.children.length-1;this.parent=newContainer;newContainer._setChildrenIndices()},getParent:function(){return this.parent},getLayer:function(){if(this.nodeType==="Layer"){return this}else{return this.getParent().getLayer()}},getStage:function(){if(this.nodeType==="Stage"){return this}else{if(this.getParent()===undefined){return undefined}else{return this.getParent().getStage()}}},simulate:function(eventType){this._handleEvent(eventType,{})},setOffset:function(){this.setAttrs({offset:Array.prototype.slice.call(arguments)})},transitionTo:function(config){var go=Kinetic.GlobalObject;if(this.transAnim!==undefined){go._removeAnimation(this.transAnim);this.transAnim=undefined}var node=this.nodeType==="Stage"?this:this.getLayer();var that=this;var trans=new Kinetic.Transition(this,config);var anim={func:function(){trans._onEnterFrame()},node:node};this.transAnim=anim;go._addAnimation(anim);trans.onFinished=function(){go._removeAnimation(anim);that.transAnim=undefined;if(config.callback!==undefined){config.callback()}anim.node.draw()};trans.start();go._handleAnimation();return trans},getAbsoluteTransform:function(){var am=new Kinetic.Transform;var family=[];var parent=this.parent;family.unshift(this);while(parent){family.unshift(parent);parent=parent.parent}for(var n=0;n<family.length;n++){var node=family[n];var m=node.getTransform();am.multiply(m)}return am},getTransform:function(){var m=new Kinetic.Transform;if(this.attrs.x!==0||this.attrs.y!==0){m.translate(this.attrs.x,this.attrs.y)}if(this.attrs.rotation!==0){m.rotate(this.attrs.rotation)}if(this.attrs.scale.x!==1||this.attrs.scale.y!==1){m.scale(this.attrs.scale.x,this.attrs.scale.y)}return m},_fireChangeEvent:function(attr){this._handleEvent(attr+"Change",{})},_setAttr:function(obj,attr,val){if(val!==undefined){obj[attr]=val}},_listenDrag:function(){this._dragCleanup();var go=Kinetic.GlobalObject;var that=this;this.on("mousedown.kinetic_initdrag touchstart.kinetic_initdrag",function(evt){that._initDrag()})},_initDrag:function(){var go=Kinetic.GlobalObject;var stage=this.getStage();var pos=stage.getUserPosition();if(pos){var m=this.getTransform().getTranslation();var am=this.getAbsoluteTransform().getTranslation();go.drag.node=this;go.drag.offset.x=pos.x-this.getAbsoluteTransform().getTranslation().x;go.drag.offset.y=pos.y-this.getAbsoluteTransform().getTranslation().y}},_dragCleanup:function(){this.off("mousedown.kinetic_initdrag");this.off("touchstart.kinetic_initdrag")},_handleEvent:function(eventType,evt){if(this.nodeType==="Shape"){evt.shape=this}var stage=this.getStage();var mouseoverNode=stage?stage.mouseoverShape:null;var mouseoutNode=stage?stage.mouseoutShape:null;var el=this.eventListeners;var okayToRun=true;if(eventType==="mouseover"&&mouseoutNode&&mouseoutNode._id===this._id){okayToRun=false}else if(eventType==="mouseout"&&mouseoverNode&&mouseoverNode._id===this._id){okayToRun=false}if(el[eventType]&&okayToRun){var events=el[eventType];for(var i=0;i<events.length;i++){events[i].handler.apply(this,[evt])}}var mouseoverParent=mouseoverNode?mouseoverNode.parent:undefined;var mouseoutParent=mouseoutNode?mouseoutNode.parent:undefined;if(!evt.cancelBubble&&this.parent&&this.parent.nodeType!=="Stage"){this._handleEvent.call(this.parent,eventType,evt)}}};Kinetic.GlobalObject.addSetters(Kinetic.Node,["x","y","detectionType","rotation","alpha","name","id","draggable","dragConstraint","dragBounds","listening"]);Kinetic.GlobalObject.addGetters(Kinetic.Node,["scale","x","y","detectionType","rotation","alpha","name","id","draggable","offset","dragConstraint","dragBounds","listening"]);Kinetic.Container=function(){this.children=[]};Kinetic.Container.prototype={getChildren:function(){return this.children},removeChildren:function(){while(this.children.length>0){this.remove(this.children[0])}},add:function(child){var go;child._id=Kinetic.GlobalObject.idCounter++;child.index=this.children.length;child.parent=this;this.children.push(child);var stage=child.getStage();if(stage===undefined){go=Kinetic.GlobalObject;go.tempNodes.push(child)}else{stage._addId(child);stage._addName(child);go=Kinetic.GlobalObject;go._pullNodes(stage)}if(this._add!==undefined){this._add(child)}return this},remove:function(child){if(child&&child.index!==undefined&&this.children[child.index]._id==child._id){var stage=this.getStage();if(stage!==undefined){stage._removeId(child);stage._removeName(child)}var go=Kinetic.GlobalObject;for(var n=0;n<go.tempNodes.length;n++){var node=go.tempNodes[n];if(node._id===child._id){go.tempNodes.splice(n,1);break}}this.children.splice(child.index,1);this._setChildrenIndices();if(child.children){for(n=0;n<child.children.length;n++){child.remove(child.children[n])}}if(this._remove!==undefined){this._remove(child)}}return this},get:function(selector){var stage=this.getStage();var arr;var key=selector.slice(1);if(selector.charAt(0)==="#"){arr=stage.ids[key]!==undefined?[stage.ids[key]]:[]}else if(selector.charAt(0)==="."){arr=stage.names[key]!==undefined?stage.names[key]:[]}else if(selector==="Shape"||selector==="Group"||selector==="Layer"){return this._getNodes(selector)}else{return false}var retArr=[];for(var n=0;n<arr.length;n++){var node=arr[n];if(this.isAncestorOf(node)){retArr.push(node)}}return retArr},isAncestorOf:function(node){if(this.nodeType==="Stage"){return true}var parent=node.getParent();while(parent){if(parent._id===this._id){return true}parent=parent.getParent()}return false},_getNodes:function(sel){var arr=[];function traverse(cont){var children=cont.getChildren();for(var n=0;n<children.length;n++){var child=children[n];if(child.nodeType===sel){arr.push(child)}else if(child.nodeType!=="Shape"){traverse(child)}}}traverse(this);return arr},_drawChildren:function(){var stage=this.getStage();var children=this.children;for(var n=0;n<children.length;n++){var child=children[n];if(child.nodeType==="Shape"){if(child.isVisible()&&stage.isVisible()){child._draw(child.getLayer())}}else{child.draw()}}},_setChildrenIndices:function(){if(this.nodeType==="Stage"){var canvases=this.content.children;var bufferCanvas=canvases[0];var backstageCanvas=canvases[1];this.content.innerHTML="";this.content.appendChild(bufferCanvas);this.content.appendChild(backstageCanvas)}for(var n=0;n<this.children.length;n++){this.children[n].index=n;if(this.nodeType==="Stage"){this.content.appendChild(this.children[n].canvas)}}}};Kinetic.Stage=function(config){this.setDefaultAttrs({width:400,height:200,throttle:80});if(typeof config.container==="string"){config.container=document.getElementById(config.container)}Kinetic.Container.apply(this,[]);Kinetic.Node.apply(this,[config]);this._setStageDefaultProperties();this._id=Kinetic.GlobalObject.idCounter++;this._buildDOM();this._bindContentEvents();this.on("widthChange.kinetic",function(){this._resizeDOM()});this.on("heightChange.kinetic",function(){this._resizeDOM()});var go=Kinetic.GlobalObject;go.stages.push(this);this._addId(this);this._addName(this)};Kinetic.Stage.prototype={onFrame:function(func){var go=Kinetic.GlobalObject;this.anim={func:func}},start:function(){if(!this.animRunning){var go=Kinetic.GlobalObject;go._addAnimation(this.anim);go._handleAnimation();this.animRunning=true}},stop:function(){var go=Kinetic.GlobalObject;go._removeAnimation(this.anim);this.animRunning=false},draw:function(){this._drawChildren()},setSize:function(){var size=Kinetic.GlobalObject._getSize(Array.prototype.slice.call(arguments));this.setAttrs(size)},getSize:function(){return{width:this.attrs.width,height:this.attrs.height}},clear:function(){var layers=this.children;for(var n=0;n<layers.length;n++){layers[n].clear()}},toDataURL:function(callback,mimeType,quality){var bufferLayer=this.bufferLayer;var bufferContext=bufferLayer.getContext();var layers=this.children;var that=this;function addLayer(n){var dataURL=layers[n].getCanvas().toDataURL();var imageObj=new Image;imageObj.onload=function(){bufferContext.drawImage(this,0,0);n++;if(n<layers.length){addLayer(n)}else{try{callback(bufferLayer.getCanvas().toDataURL(mimeType,quality))}catch(exception){callback(bufferLayer.getCanvas().toDataURL())}}};imageObj.src=dataURL}bufferLayer.clear();addLayer(0)},toJSON:function(){var go=Kinetic.GlobalObject;function addNode(node){var obj={};var cleanAttrs=node.attrs;for(var key in cleanAttrs){var val=cleanAttrs[key];if(go._isFunction(val)||go._isElement(val)||go._hasMethods(val)){cleanAttrs[key]=undefined}}obj.attrs=cleanAttrs;obj.nodeType=node.nodeType;obj.shapeType=node.shapeType;if(node.nodeType!=="Shape"){obj.children=[];var children=node.getChildren();for(var n=0;n<children.length;n++){var child=children[n];obj.children.push(addNode(child))}}return obj}return window.JSON.stringify(addNode(this))},reset:function(){this.removeChildren();this._setStageDefaultProperties();this.setAttrs(this.defaultNodeAttrs)},load:function(json){this.reset();function loadNode(node,obj){var children=obj.children;if(children!==undefined){for(var n=0;n<children.length;n++){var child=children[n];var type;if(child.nodeType==="Shape"){if(child.shapeType===undefined){type="Shape"}else{type=child.shapeType}}else{type=child.nodeType}var no=new Kinetic[type](child.attrs);node.add(no);loadNode(no,child)}}}var obj=window.JSON.parse(json);this.attrs=obj.attrs;loadNode(this,obj);this.draw()},getMousePosition:function(evt){return this.mousePos},getTouchPosition:function(evt){return this.touchPos},getUserPosition:function(evt){return this.getTouchPosition()||this.getMousePosition()},getContainer:function(){return this.attrs.container},getContent:function(){return this.content},getStage:function(){return this},getIntersections:function(){var pos=Kinetic.GlobalObject._getXY(Array.prototype.slice.call(arguments));var arr=[];var shapes=this.get("Shape");for(var n=0;n<shapes.length;n++){var shape=shapes[n];if(shape.intersects(pos)){arr.push(shape)}}return arr},getDOM:function(){return this.content},_resizeDOM:function(){var width=this.attrs.width;var height=this.attrs.height;this.content.style.width=width+"px";this.content.style.height=height+"px";this.bufferLayer.getCanvas().width=width;this.bufferLayer.getCanvas().height=height;this.pathLayer.getCanvas().width=width;this.pathLayer.getCanvas().height=height;var layers=this.children;for(var n=0;n<layers.length;n++){var layer=layers[n];layer.getCanvas().width=width;layer.getCanvas().height=height;layer.draw()}},_remove:function(layer){try{this.content.removeChild(layer.canvas)}catch(e){}},_add:function(layer){layer.canvas.width=this.attrs.width;layer.canvas.height=this.attrs.height;layer.draw();this.content.appendChild(layer.canvas);layer.lastDrawTime=0},_detectEvent:function(shape,evt){var isDragging=Kinetic.GlobalObject.drag.moving;var go=Kinetic.GlobalObject;var pos=this.getUserPosition();var el=shape.eventListeners;var that=this;if(this.targetShape&&shape._id===this.targetShape._id){this.targetFound=true}if(shape.isVisible()&&pos!==undefined&&shape.intersects(pos)){if(!isDragging&&this.mouseDown){this.mouseDown=false;this.clickStart=true;shape._handleEvent("mousedown",evt);return true}else if(this.mouseUp){this.mouseUp=false;shape._handleEvent("mouseup",evt);if(this.clickStart){if(!go.drag.moving||!go.drag.node){shape._handleEvent("click",evt);if(this.inDoubleClickWindow){shape._handleEvent("dblclick",evt)}this.inDoubleClickWindow=true;setTimeout(function(){that.inDoubleClickWindow=false},this.dblClickWindow)}}return true}else if(!isDragging&&this.touchStart&&!this.touchMove){this.touchStart=false;this.tapStart=true;shape._handleEvent("touchstart",evt);return true}else if(this.touchEnd){this.touchEnd=false;shape._handleEvent("touchend",evt);if(this.tapStart){if(!go.drag.moving||!go.drag.node){shape._handleEvent("tap",evt);if(this.inDoubleClickWindow){shape._handleEvent("dbltap",evt)}this.inDoubleClickWindow=true;setTimeout(function(){that.inDoubleClickWindow=false},this.dblClickWindow)}}return true}else if(!isDragging&&this.touchMove){shape._handleEvent("touchmove",evt);return true}else if(!isDragging&&this._isNewTarget(shape,evt)){if(this.mouseoutShape){this.mouseoverShape=shape;this.mouseoutShape._handleEvent("mouseout",evt);this.mouseoverShape=undefined}shape._handleEvent("mouseover",evt);this._setTarget(shape);return true}else if(!isDragging&&this.mouseMove){shape._handleEvent("mousemove",evt);return true}}else if(!isDragging&&this.targetShape&&this.targetShape._id===shape._id){this._setTarget(undefined);this.mouseoutShape=shape;return true}return false},_setTarget:function(shape){this.targetShape=shape;this.targetFound=true},_isNewTarget:function(shape,evt){if(!this.targetShape||!this.targetFound&&shape._id!==this.targetShape._id){if(this.targetShape){var oldEl=this.targetShape.eventListeners;if(oldEl){this.mouseoutShape=this.targetShape}}return true}else{return false}},_traverseChildren:function(obj,evt){var children=obj.children;var exit;for(var i=children.length-1;i>=0;i--){var child=children[i];if(child.getListening()){if(child.nodeType==="Shape"){exit=this._detectEvent(child,evt);if(exit){return true}}else{exit=this._traverseChildren(child,evt);if(exit){return true}}}}return false},_handleStageEvent:function(evt){var date=new Date;var time=date.getTime();this.lastEventTime=time;var go=Kinetic.GlobalObject;if(!evt){evt=window.event}this._setMousePosition(evt);this._setTouchPosition(evt);this.pathLayer.clear();this.targetFound=false;var shapeDetected=false;for(var n=this.children.length-1;n>=0;n--){var layer=this.children[n];if(layer.isVisible()&&n>=0&&layer.getListening()){if(this._traverseChildren(layer,evt)){shapeDetected=true;break}}}if(!shapeDetected&&this.mouseoutShape){this.mouseoutShape._handleEvent("mouseout",evt);this.mouseoutShape=undefined}},_bindContentEvents:function(){var go=Kinetic.GlobalObject;var that=this;var events=["mousedown","mousemove","mouseup","mouseover","mouseout","touchstart","touchmove","touchend"];for(var n=0;n<events.length;n++){var pubEvent=events[n];(function(){var event=pubEvent;that.content.addEventListener(event,function(evt){that["_"+event](evt)},false)})()}},_mouseover:function(evt){this._handleStageEvent(evt)},_mouseout:function(evt){var targetShape=this.targetShape;if(targetShape){targetShape._handleEvent("mouseout",evt);this.targetShape=undefined}this.mousePos=undefined;this._endDrag(evt)},_mousemove:function(evt){var throttle=this.attrs.throttle;var date=new Date;var time=date.getTime();var timeDiff=time-this.lastEventTime;var tt=1e3/throttle;if(timeDiff>=tt||throttle>200){this.mouseDown=false;this.mouseUp=false;this.mouseMove=true;this._handleStageEvent(evt)}this._startDrag(evt)},_mousedown:function(evt){this.mouseDown=true;this.mouseUp=false;this.mouseMove=false;this._handleStageEvent(evt);if(this.attrs.draggable){this._initDrag()}},_mouseup:function(evt){this.mouseDown=false;this.mouseUp=true;this.mouseMove=false;this._handleStageEvent(evt);this.clickStart=false;this._endDrag(evt)},_touchstart:function(evt){evt.preventDefault();this.touchStart=true;this.touchEnd=false;this.touchMove=false;this._handleStageEvent(evt);if(this.attrs.draggable){this._initDrag()}},_touchend:function(evt){this.touchStart=false;this.touchEnd=true;this.touchMove=false;this._handleStageEvent(evt);this.tapStart=false;this._endDrag(evt)},_touchmove:function(evt){var that=this;var throttle=this.attrs.throttle;var date=new Date;var time=date.getTime();var timeDiff=time-this.lastEventTime;var tt=1e3/throttle;if(timeDiff>=tt||throttle>200){evt.preventDefault();that.touchEnd=false;that.touchMove=true;that._handleStageEvent(evt)}this._startDrag(evt)},_setMousePosition:function(evt){var mouseX=evt.offsetX||evt.clientX-this._getContentPosition().left+window.pageXOffset;var mouseY=evt.offsetY||evt.clientY-this._getContentPosition().top+window.pageYOffset;this.mousePos={x:mouseX,y:mouseY}},_setTouchPosition:function(evt){if(evt.touches!==undefined&&evt.touches.length===1){var touch=evt.touches[0];var touchX=touch.clientX-this._getContentPosition().left+window.pageXOffset;var touchY=touch.clientY-this._getContentPosition().top+window.pageYOffset;this.touchPos={x:touchX,y:touchY}}},_getContentPosition:function(){var obj=this.content;var top=0;var left=0;while(obj&&obj.tagName!=="BODY"){top+=obj.offsetTop-obj.scrollTop;left+=obj.offsetLeft-obj.scrollLeft;obj=obj.offsetParent}return{top:top,left:left}},_modifyPathContext:function(context){context.stroke=function(){};context.fill=function(){};context.fillRect=function(x,y,width,height){context.rect(x,y,width,height)};context.strokeRect=function(x,y,width,height){context.rect(x,y,width,height)};context.drawImage=function(){};context.fillText=function(){};context.strokeText=function(){}},_endDrag:function(evt){var go=Kinetic.GlobalObject;if(go.drag.node){if(go.drag.moving){go.drag.moving=false;go.drag.node._handleEvent("dragend",evt)}}go.drag.node=undefined},_startDrag:function(evt){var that=this;var go=Kinetic.GlobalObject;var node=go.drag.node;if(node){var pos=that.getUserPosition();var dc=node.attrs.dragConstraint;var db=node.attrs.dragBounds;var lastNodePos={x:node.attrs.x,y:node.attrs.y};var newNodePos={x:pos.x-go.drag.offset.x,y:pos.y-go.drag.offset.y};if(db.left!==undefined&&newNodePos.x<db.left){newNodePos.x=db.left}if(db.right!==undefined&&newNodePos.x>db.right){newNodePos.x=db.right}if(db.top!==undefined&&newNodePos.y<db.top){newNodePos.y=db.top}if(db.bottom!==undefined&&newNodePos.y>db.bottom){newNodePos.y=db.bottom}node.setAbsolutePosition(newNodePos);if(dc==="horizontal"){node.attrs.y=lastNodePos.y}else if(dc==="vertical"){node.attrs.x=lastNodePos.x}if(go.drag.node.nodeType==="Stage"){go.drag.node.draw()}else{go.drag.node.getLayer().draw()}if(!go.drag.moving){go.drag.moving=true;go.drag.node._handleEvent("dragstart",evt)}go.drag.node._handleEvent("dragmove",evt)}},_buildDOM:function(){this.content=document.createElement("div");this.content.style.position="relative";this.content.style.display="inline-block";this.content.className="kineticjs-content";this.attrs.container.appendChild(this.content);this.bufferLayer=new Kinetic.Layer({name:"bufferLayer"});this.pathLayer=new Kinetic.Layer({name:"pathLayer"});this.bufferLayer.parent=this;this.pathLayer.parent=this;this._modifyPathContext(this.pathLayer.context);this.bufferLayer.getCanvas().style.display="none";this.pathLayer.getCanvas().style.display="none";this.bufferLayer.canvas.className="kineticjs-buffer-layer";this.content.appendChild(this.bufferLayer.canvas);this.pathLayer.canvas.className="kineticjs-path-layer";this.content.appendChild(this.pathLayer.canvas);this.setSize(this.attrs.width,this.attrs.height);this._resizeDOM()},_addId:function(node){if(node.attrs.id!==undefined){this.ids[node.attrs.id]=node}},_removeId:function(node){if(node.attrs.id!==undefined){this.ids[node.attrs.id]=undefined}},_addName:function(node){var name=node.attrs.name;if(name!==undefined){if(this.names[name]===undefined){this.names[name]=[]}this.names[name].push(node)}},_removeName:function(node){if(node.attrs.name!==undefined){var nodes=this.names[node.attrs.name];if(nodes!==undefined){for(var n=0;n<nodes.length;n++){var no=nodes[n];if(no._id===node._id){nodes.splice(n,1)}}if(nodes.length===0){delete this.names[node.attrs.name]}}}},_onContent:function(typesStr,handler){var types=typesStr.split(" ");for(var n=0;n<types.length;n++){var baseEvent=types[n];this.content.addEventListener(baseEvent,handler,false)}},_setStageDefaultProperties:function(){this.nodeType="Stage";this.lastEventTime=0;this.dblClickWindow=400;this.targetShape=undefined;this.targetFound=false;this.mouseoverShape=undefined;this.mouseoutShape=undefined;this.mousePos=undefined;this.mouseDown=false;this.mouseUp=false;this.mouseMove=false;this.clickStart=false;this.touchPos=undefined;this.touchStart=false;this.touchEnd=false;this.touchMove=false;this.tapStart=false;this.ids={};this.names={};this.anim=undefined;this.animRunning=false}};Kinetic.GlobalObject.extend(Kinetic.Stage,Kinetic.Container);Kinetic.GlobalObject.extend(Kinetic.Stage,Kinetic.Node);Kinetic.GlobalObject.addSetters(Kinetic.Stage,["width","height","throttle"]);Kinetic.GlobalObject.addGetters(Kinetic.Stage,["width","height","throttle"]);Kinetic.Layer=function(config){this.setDefaultAttrs({throttle:80});this.nodeType="Layer";this.lastDrawTime=0;this.beforeDrawFunc=undefined;this.afterDrawFunc=undefined;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.style.position="absolute";Kinetic.Container.apply(this,[]);Kinetic.Node.apply(this,[config])};Kinetic.Layer.prototype={draw:function(){var throttle=this.attrs.throttle;var date=new Date;var time=date.getTime();var timeDiff=time-this.lastDrawTime;var tt=1e3/throttle;if(timeDiff>=tt||throttle>200){this._draw();if(this.drawTimeout!==undefined){clearTimeout(this.drawTimeout);this.drawTimeout=undefined}}else if(this.drawTimeout===undefined){var that=this;this.drawTimeout=setTimeout(function(){that.draw()},17)}},setThrottle:function(throttle){this.attrs.throttle=throttle},getThrottle:function(){return this.attrs.throttle},beforeDraw:function(func){this.beforeDrawFunc=func},afterDraw:function(func){this.afterDrawFunc=func},clear:function(){var context=this.getContext();var canvas=this.getCanvas();context.clearRect(0,0,canvas.width,canvas.height)},getCanvas:function(){return this.canvas},getContext:function(){return this.context},_draw:function(){var date=new Date;var time=date.getTime();this.lastDrawTime=time;if(this.beforeDrawFunc!==undefined){this.beforeDrawFunc.call(this)}this.clear();
if(this.isVisible()){if(this.attrs.drawFunc!==undefined){this.attrs.drawFunc.call(this)}this._drawChildren()}if(this.afterDrawFunc!==undefined){this.afterDrawFunc.call(this)}}};Kinetic.GlobalObject.extend(Kinetic.Layer,Kinetic.Container);Kinetic.GlobalObject.extend(Kinetic.Layer,Kinetic.Node);Kinetic.Group=function(config){this.nodeType="Group";Kinetic.Container.apply(this,[]);Kinetic.Node.apply(this,[config])};Kinetic.Group.prototype={draw:function(){if(this.attrs.visible){this._drawChildren()}}};Kinetic.GlobalObject.extend(Kinetic.Group,Kinetic.Container);Kinetic.GlobalObject.extend(Kinetic.Group,Kinetic.Node);Kinetic.Shape=function(config){this.setDefaultAttrs({fill:undefined,stroke:undefined,strokeWidth:undefined,lineJoin:undefined,detectionType:"path",shadow:{blur:10,alpha:1,offset:{x:0,y:0}}});this.data=[];this.nodeType="Shape";this.appliedShadow=false;Kinetic.Node.apply(this,[config])};Kinetic.Shape.prototype={getContext:function(){if(this.tempLayer===undefined){return null}else{return this.tempLayer.getContext()}},getCanvas:function(){return this.tempLayer.getCanvas()},stroke:function(){var appliedShadow=false;var context=this.getContext();context.save();if(!!this.attrs.stroke||!!this.attrs.strokeWidth){if(!this.appliedShadow){appliedShadow=this._applyShadow()}var stroke=!!this.attrs.stroke?this.attrs.stroke:"black";var strokeWidth=!!this.attrs.strokeWidth?this.attrs.strokeWidth:2;context.lineWidth=strokeWidth;context.strokeStyle=stroke;context.stroke()}context.restore();if(appliedShadow){this.stroke()}},fill:function(){var appliedShadow=false;var context=this.getContext();context.save();var fill=this.attrs.fill;var grd,colorStops,n;if(!!fill){if(!this.appliedShadow){appliedShadow=this._applyShadow()}var s=fill.start;var e=fill.end;var f=null;if(typeof fill=="string"){f=this.attrs.fill;context.fillStyle=f;context.fill()}else if(fill.image!==undefined){var repeat=fill.repeat===undefined?"repeat":fill.repeat;f=context.createPattern(fill.image,repeat);context.save();if(fill.scale!==undefined){context.scale(fill.scale.x,fill.scale.y)}if(fill.offset!==undefined){context.translate(fill.offset.x,fill.offset.y)}context.fillStyle=f;context.fill();context.restore()}else if(s.radius===undefined&&e.radius===undefined){context=this.getContext();grd=context.createLinearGradient(s.x,s.y,e.x,e.y);colorStops=fill.colorStops;for(n=0;n<colorStops.length;n+=2){grd.addColorStop(colorStops[n],colorStops[n+1])}f=grd;context.fillStyle=f;context.fill()}else if(s.radius!==undefined&&e.radius!==undefined){context=this.getContext();grd=context.createRadialGradient(s.x,s.y,s.radius,e.x,e.y,e.radius);colorStops=fill.colorStops;for(n=0;n<colorStops.length;n+=2){grd.addColorStop(colorStops[n],colorStops[n+1])}f=grd;context.fillStyle=f;context.fill()}else{f="black";context.fillStyle=f;context.fill()}}context.restore();if(appliedShadow){this.fill()}},fillText:function(text,x,y){var appliedShadow=false;var context=this.getContext();context.save();if(this.attrs.textFill!==undefined){if(!this.appliedShadow){appliedShadow=this._applyShadow()}context.fillStyle=this.attrs.textFill;context.fillText(text,x,y)}context.restore();if(appliedShadow){this.fillText(text,x,y)}},strokeText:function(text,x,y){var appliedShadow=false;var context=this.getContext();context.save();if(this.attrs.textStroke!==undefined||this.attrs.textStrokeWidth!==undefined){if(!this.appliedShadow){appliedShadow=this._applyShadow()}if(this.attrs.textStroke===undefined){this.attrs.textStroke="black"}else if(this.attrs.textStrokeWidth===undefined){this.attrs.textStrokeWidth=2}context.lineWidth=this.attrs.textStrokeWidth;context.strokeStyle=this.attrs.textStroke;context.strokeText(text,x,y)}context.restore();if(appliedShadow){this.strokeText(text,x,y)}},drawImage:function(){var appliedShadow=false;var context=this.getContext();context.save();var a=Array.prototype.slice.call(arguments);if(a.length===5||a.length===9){if(!this.appliedShadow){appliedShadow=this._applyShadow()}switch(a.length){case 5:context.drawImage(a[0],a[1],a[2],a[3],a[4]);break;case 9:context.drawImage(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]);break}}context.restore();if(appliedShadow){this.drawImage.apply(this,a)}},applyLineJoin:function(){var context=this.getContext();if(this.attrs.lineJoin!==undefined){context.lineJoin=this.attrs.lineJoin}},_applyShadow:function(){var context=this.getContext();var s=this.attrs.shadow;if(s!==undefined){var aa=this.getAbsoluteAlpha();var sa=this.attrs.shadow.alpha;if(sa!==undefined&&s.color!==undefined){context.globalAlpha=sa*aa;context.shadowColor=s.color;context.shadowBlur=s.blur;context.shadowOffsetX=s.offset.x;context.shadowOffsetY=s.offset.y;this.appliedShadow=true;return true}}return false},saveData:function(){var stage=this.getStage();var w=stage.attrs.width;var h=stage.attrs.height;var bufferLayer=stage.bufferLayer;var bufferLayerContext=bufferLayer.getContext();bufferLayer.clear();this._draw(bufferLayer);var imageData=bufferLayerContext.getImageData(0,0,w,h);this.data=imageData.data},clearData:function(){this.data=[]},intersects:function(){var pos=Kinetic.GlobalObject._getXY(Array.prototype.slice.call(arguments));var stage=this.getStage();if(this.attrs.detectionType==="path"){var pathLayer=stage.pathLayer;var pathLayerContext=pathLayer.getContext();this._draw(pathLayer);return pathLayerContext.isPointInPath(pos.x,pos.y)}else{var w=stage.attrs.width;var alpha=this.data[(w*pos.y+pos.x)*4+3];return alpha!==undefined&&alpha!==0}},_draw:function(layer){if(layer!==undefined&&this.attrs.drawFunc!==undefined){var stage=layer.getStage();var context=layer.getContext();var family=[];var parent=this.parent;family.unshift(this);while(parent){family.unshift(parent);parent=parent.parent}context.save();for(var n=0;n<family.length;n++){var node=family[n];var t=node.getTransform();if(node.attrs.offset.x!==0||node.attrs.offset.y!==0){t.translate(-1*node.attrs.offset.x,-1*node.attrs.offset.y)}var m=t.getMatrix();context.transform(m[0],m[1],m[2],m[3],m[4],m[5])}this.tempLayer=layer;if(this.getAbsoluteAlpha()!==1){context.globalAlpha=this.getAbsoluteAlpha()}this.applyLineJoin();this.appliedShadow=false;this.attrs.drawFunc.call(this);context.restore()}}};Kinetic.GlobalObject.extend(Kinetic.Shape,Kinetic.Node);Kinetic.GlobalObject.addSetters(Kinetic.Shape,["fill","stroke","lineJoin","strokeWidth","shadow","drawFunc"]);Kinetic.GlobalObject.addGetters(Kinetic.Shape,["fill","stroke","lineJoin","strokeWidth","shadow","drawFunc"]);Kinetic.Rect=function(config){this.setDefaultAttrs({width:0,height:0,cornerRadius:0});this.shapeType="Rect";config.drawFunc=function(){var context=this.getContext();context.beginPath();if(this.attrs.cornerRadius===0){context.rect(0,0,this.attrs.width,this.attrs.height)}else{context.moveTo(this.attrs.cornerRadius,0);context.lineTo(this.attrs.width-this.attrs.cornerRadius,0);context.arc(this.attrs.width-this.attrs.cornerRadius,this.attrs.cornerRadius,this.attrs.cornerRadius,Math.PI*3/2,0,false);context.lineTo(this.attrs.width,this.attrs.height-this.attrs.cornerRadius);context.arc(this.attrs.width-this.attrs.cornerRadius,this.attrs.height-this.attrs.cornerRadius,this.attrs.cornerRadius,0,Math.PI/2,false);context.lineTo(this.attrs.cornerRadius,this.attrs.height);context.arc(this.attrs.cornerRadius,this.attrs.height-this.attrs.cornerRadius,this.attrs.cornerRadius,Math.PI/2,Math.PI,false);context.lineTo(0,this.attrs.cornerRadius);context.arc(this.attrs.cornerRadius,this.attrs.cornerRadius,this.attrs.cornerRadius,Math.PI,Math.PI*3/2,false)}context.closePath();this.fill();this.stroke()};Kinetic.Shape.apply(this,[config])};Kinetic.Rect.prototype={setSize:function(){var size=Kinetic.GlobalObject._getSize(Array.prototype.slice.call(arguments));this.setAttrs(size)},getSize:function(){return{width:this.attrs.width,height:this.attrs.height}}};Kinetic.GlobalObject.extend(Kinetic.Rect,Kinetic.Shape);Kinetic.GlobalObject.addSetters(Kinetic.Rect,["width","height","cornerRadius"]);Kinetic.GlobalObject.addGetters(Kinetic.Rect,["width","height","cornerRadius"]);Kinetic.Ellipse=function(config){this.setDefaultAttrs({radius:{x:0,y:0}});this.shapeType="Ellipse";config.drawFunc=function(){var canvas=this.getCanvas();var context=this.getContext();var r=this.getRadius();context.beginPath();context.save();if(r.x!==r.y){context.scale(1,r.y/r.x)}context.arc(0,0,r.x,0,Math.PI*2,true);context.restore();context.closePath();this.fill();this.stroke()};Kinetic.Shape.apply(this,[config]);this._convertRadius();var that=this;this.on("radiusChange",function(){that._convertRadius()})};Kinetic.Circle=Kinetic.Ellipse;Kinetic.Ellipse.prototype={setRadius:function(){this.setAttrs({radius:Array.prototype.slice.call(arguments)})},_convertRadius:function(){var go=Kinetic.GlobalObject;var radius=this.getRadius();if(go._isObject(radius)){return false}var pos=go._getXY(radius);this.setAttrs({radius:pos})}};Kinetic.GlobalObject.extend(Kinetic.Ellipse,Kinetic.Shape);Kinetic.GlobalObject.addGetters(Kinetic.Ellipse,["radius"]);Kinetic.Image=function(config){this.setDefaultAttrs({crop:{x:0,y:0,width:undefined,height:undefined}});this.shapeType="Image";config.drawFunc=function(){if(this.attrs.image!==undefined){var width=this.attrs.width!==undefined?this.attrs.width:this.attrs.image.width;var height=this.attrs.height!==undefined?this.attrs.height:this.attrs.image.height;var cropX=this.attrs.crop.x;var cropY=this.attrs.crop.y;var cropWidth=this.attrs.crop.width;var cropHeight=this.attrs.crop.height;var canvas=this.getCanvas();var context=this.getContext();context.beginPath();context.rect(0,0,width,height);context.closePath();this.fill();this.stroke();if(cropWidth!==undefined&&cropHeight!==undefined){this.drawImage(this.attrs.image,cropX,cropY,cropWidth,cropHeight,0,0,width,height)}else{this.drawImage(this.attrs.image,0,0,width,height)}}};Kinetic.Shape.apply(this,[config])};Kinetic.Image.prototype={setSize:function(){var size=Kinetic.GlobalObject._getSize(Array.prototype.slice.call(arguments));this.setAttrs(size)},getSize:function(){return{width:this.attrs.width,height:this.attrs.height}},setCrop:function(){this.setAttrs({crop:Array.prototype.slice.call(arguments)})}};Kinetic.GlobalObject.extend(Kinetic.Image,Kinetic.Shape);Kinetic.GlobalObject.addSetters(Kinetic.Image,["height","width","image"]);Kinetic.GlobalObject.addGetters(Kinetic.Image,["crop","height","width","image"]);Kinetic.Sprite=function(config){this.setDefaultAttrs({index:0,frameRate:17});config.drawFunc=function(){if(this.attrs.image!==undefined){var context=this.getContext();var anim=this.attrs.animation;var index=this.attrs.index;var f=this.attrs.animations[anim][index];context.beginPath();context.rect(0,0,f.width,f.height);context.closePath();this.drawImage(this.attrs.image,f.x,f.y,f.width,f.height,0,0,f.width,f.height)}};Kinetic.Shape.apply(this,[config]);var that=this;this.on("animationChange",function(){that.setIndex(0)})};Kinetic.Sprite.prototype={start:function(){var that=this;var layer=this.getLayer();this.interval=setInterval(function(){that._updateIndex();layer.draw();if(that.afterFrameFunc&&that.attrs.index===that.afterFrameIndex){that.afterFrameFunc()}},1e3/this.attrs.frameRate)},stop:function(){clearInterval(this.interval)},afterFrame:function(index,func){this.afterFrameIndex=index;this.afterFrameFunc=func},_updateIndex:function(){var i=this.attrs.index;var a=this.attrs.animation;if(i<this.attrs.animations[a].length-1){this.attrs.index++}else{this.attrs.index=0}}};Kinetic.GlobalObject.extend(Kinetic.Sprite,Kinetic.Shape);Kinetic.GlobalObject.addSetters(Kinetic.Sprite,["animation","animations","index"]);Kinetic.GlobalObject.addGetters(Kinetic.Sprite,["animation","animations","index"]);Kinetic.Polygon=function(config){this.setDefaultAttrs({points:[]});this.shapeType="Polygon";config.drawFunc=function(){var context=this.getContext();context.beginPath();context.moveTo(this.attrs.points[0].x,this.attrs.points[0].y);for(var n=1;n<this.attrs.points.length;n++){context.lineTo(this.attrs.points[n].x,this.attrs.points[n].y)}context.closePath();this.fill();this.stroke()};Kinetic.Shape.apply(this,[config])};Kinetic.GlobalObject.extend(Kinetic.Polygon,Kinetic.Shape);Kinetic.GlobalObject.addSetters(Kinetic.Polygon,["points"]);Kinetic.GlobalObject.addGetters(Kinetic.Polygon,["points"]);Kinetic.RegularPolygon=function(config){this.setDefaultAttrs({radius:0,sides:0});this.shapeType="RegularPolygon";config.drawFunc=function(){var context=this.getContext();context.beginPath();context.moveTo(0,0-this.attrs.radius);for(var n=1;n<this.attrs.sides;n++){var x=this.attrs.radius*Math.sin(n*2*Math.PI/this.attrs.sides);var y=-1*this.attrs.radius*Math.cos(n*2*Math.PI/this.attrs.sides);context.lineTo(x,y)}context.closePath();this.fill();this.stroke()};Kinetic.Shape.apply(this,[config])};Kinetic.GlobalObject.extend(Kinetic.RegularPolygon,Kinetic.Shape);Kinetic.GlobalObject.addSetters(Kinetic.Rect,["radius","sides"]);Kinetic.GlobalObject.addGetters(Kinetic.Rect,["radius","sides"]);Kinetic.Star=function(config){this.setDefaultAttrs({numPoints:0,innerRadius:0,outerRadius:0});this.shapeType="Star";config.drawFunc=function(){var context=this.getContext();context.beginPath();context.moveTo(0,0-this.attrs.outerRadius);for(var n=1;n<this.attrs.numPoints*2;n++){var radius=n%2===0?this.attrs.outerRadius:this.attrs.innerRadius;var x=radius*Math.sin(n*Math.PI/this.attrs.numPoints);var y=-1*radius*Math.cos(n*Math.PI/this.attrs.numPoints);context.lineTo(x,y)}context.closePath();this.fill();this.stroke()};Kinetic.Shape.apply(this,[config])};Kinetic.GlobalObject.extend(Kinetic.Star,Kinetic.Shape);Kinetic.GlobalObject.addSetters(Kinetic.Star,["numPoints","innerRadius","outerRadius"]);Kinetic.GlobalObject.addGetters(Kinetic.Star,["numPoints","innerRadius","outerRadius"]);Kinetic.Text=function(config){this.setDefaultAttrs({fontFamily:"Calibri",text:"",fontSize:12,align:"left",verticalAlign:"top",padding:0,fontStyle:"normal",width:"auto",detectionType:"pixel"});this.shapeType="Text";config.drawFunc=function(){var context=this.getContext();context.font=this.attrs.fontStyle+" "+this.attrs.fontSize+"pt "+this.attrs.fontFamily;context.textBaseline="middle";var textHeight=this.getTextHeight();var textWidth=this.attrs.width==="auto"?this.getTextWidth():this.attrs.width;var p=this.attrs.padding;var x=0;var y=0;var that=this;switch(this.attrs.align){case"center":x=textWidth/-2-p;break;case"right":x=-1*textWidth-p;break}switch(this.attrs.verticalAlign){case"middle":y=textHeight/-2-p;break;case"bottom":y=-1*textHeight-p;break}context.save();context.beginPath();context.rect(x,y,textWidth+p*2,textHeight+p*2);context.closePath();this.fill();this.stroke();context.restore();var tx=p+x;var ty=textHeight/2+p+y;context.save();if(this.attrs.width!=="auto"){context.beginPath();context.rect(x,y,textWidth+p,textHeight+p*2);context.closePath();context.clip()}this.fillText(this.attrs.text,tx,ty);this.strokeText(this.attrs.text,tx,ty);context.restore()};Kinetic.Shape.apply(this,[config])};Kinetic.Text.prototype={getTextWidth:function(){return this.getTextSize().width},getTextHeight:function(){return this.getTextSize().height},getTextSize:function(){var context=this.getContext();if(!context){var dummyCanvas=document.createElement("canvas");context=dummyCanvas.getContext("2d")}context.save();context.font=this.attrs.fontStyle+" "+this.attrs.fontSize+"pt "+this.attrs.fontFamily;var metrics=context.measureText(this.attrs.text);context.restore();return{width:metrics.width,height:parseInt(this.attrs.fontSize,10)}}};Kinetic.GlobalObject.extend(Kinetic.Text,Kinetic.Shape);Kinetic.GlobalObject.addSetters(Kinetic.Text,["fontFamily","fontSize","fontStyle","textFill","textStroke","textStrokeWidth","padding","align","verticalAlign","text","width"]);Kinetic.GlobalObject.addGetters(Kinetic.Text,["fontFamily","fontSize","fontStyle","textFill","textStroke","textStrokeWidth","padding","align","verticalAlign","text","width"]);Kinetic.Line=function(config){this.setDefaultAttrs({points:[],lineCap:"butt",dashArray:[],detectionType:"pixel"});this.shapeType="Line";config.drawFunc=function(){var context=this.getContext();var lastPos={};context.beginPath();context.moveTo(this.attrs.points[0].x,this.attrs.points[0].y);for(var n=1;n<this.attrs.points.length;n++){var x=this.attrs.points[n].x;var y=this.attrs.points[n].y;if(this.attrs.dashArray.length>0){var lastX=this.attrs.points[n-1].x;var lastY=this.attrs.points[n-1].y;this._dashedLine(lastX,lastY,x,y,this.attrs.dashArray)}else{context.lineTo(x,y)}}if(!!this.attrs.lineCap){context.lineCap=this.attrs.lineCap}this.stroke()};Kinetic.Shape.apply(this,[config])};Kinetic.Line.prototype={setPoints:function(points){this.setAttrs({points:points})},_dashedLine:function(x,y,x2,y2,dashArray){var context=this.getContext();var dashCount=dashArray.length;var dx=x2-x,dy=y2-y;var xSlope=dx>dy;var slope=xSlope?dy/dx:dx/dy;if(slope>9999){slope=9999}else if(slope<-9999){slope=-9999}var distRemaining=Math.sqrt(dx*dx+dy*dy);var dashIndex=0,draw=true;while(distRemaining>=.1&&dashIndex<1e4){var dashLength=dashArray[dashIndex++%dashCount];if(dashLength===0){dashLength=.001}if(dashLength>distRemaining){dashLength=distRemaining}var step=Math.sqrt(dashLength*dashLength/(1+slope*slope));if(xSlope){x+=dx<0&&dy<0?step*-1:step;y+=dx<0&&dy<0?slope*step*-1:slope*step}else{x+=dx<0&&dy<0?slope*step*-1:slope*step;y+=dx<0&&dy<0?step*-1:step}context[draw?"lineTo":"moveTo"](x,y);distRemaining-=dashLength;draw=!draw}context.moveTo(x2,y2)}};Kinetic.GlobalObject.extend(Kinetic.Line,Kinetic.Shape);Kinetic.GlobalObject.addSetters(Kinetic.Line,["dashArray","lineCap"]);Kinetic.GlobalObject.addGetters(Kinetic.Line,["dashArray","lineCap","points"]);Kinetic.Path=function(config){this.shapeType="Path";this.dataArray=[];var that=this;config.drawFunc=function(){var context=this.getContext();var ca=this.dataArray;context.beginPath();for(var n=0;n<ca.length;n++){var c=ca[n].command;var p=ca[n].points;switch(c){case"L":context.lineTo(p[0],p[1]);break;case"M":context.moveTo(p[0],p[1]);break;case"C":context.bezierCurveTo(p[0],p[1],p[2],p[3],p[4],p[5]);break;case"Q":context.quadraticCurveTo(p[0],p[1],p[2],p[3]);break;case"A":var cx=p[0],cy=p[1],rx=p[2],ry=p[3],theta=p[4],dTheta=p[5],psi=p[6],fs=p[7];var r=rx>ry?rx:ry;var scaleX=rx>ry?1:rx/ry;var scaleY=rx>ry?ry/rx:1;context.translate(cx,cy);context.rotate(psi);context.scale(scaleX,scaleY);context.arc(0,0,r,theta,theta+dTheta,1-fs);context.scale(1/scaleX,1/scaleY);context.rotate(-psi);context.translate(-cx,-cy);break;case"z":context.closePath();break}}this.fill();this.stroke()};Kinetic.Shape.apply(this,[config]);this.dataArray=this.getDataArray();this.on("dataChange",function(){that.dataArray=that.getDataArray()})};Kinetic.Path.prototype={getDataArray:function(){var cs=this.attrs.data;if(!this.attrs.data){return[]}var cc=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];cs=cs.replace(new RegExp(" ","g"),",");for(var n=0;n<cc.length;n++){cs=cs.replace(new RegExp(cc[n],"g"),"|"+cc[n])}var arr=cs.split("|");var ca=[];var cpx=0;var cpy=0;for(n=1;n<arr.length;n++){var str=arr[n];var c=str.charAt(0);str=str.slice(1);str=str.replace(new RegExp(",-","g"),"-");str=str.replace(new RegExp("-","g"),",-");var p=str.split(",");if(p.length>0&&p[0]===""){p.shift()}for(var i=0;i<p.length;i++){p[i]=parseFloat(p[i])}var ctlPtx,ctlPty,prevCmd,cmd,points;var rx,ry,psi,fa,fs,x1,y1;while(p.length>0){if(isNaN(p[0]))break;points=[];switch(c){case"l":cpx+=p.shift();cpy+=p.shift();cmd="L";points.push(cpx,cpy);break;case"L":cpx=p.shift();cpy=p.shift();points.push(cpx,cpy);break;case"m":cpx+=p.shift();cpy+=p.shift();cmd="M";points.push(cpx,cpy);c="l";break;case"M":cpx=p.shift();cpy=p.shift();cmd="M";points.push(cpx,cpy);c="L";break;case"h":cpx+=p.shift();cmd="L";points.push(cpx,cpy);break;case"H":cpx=p.shift();cmd="L";points.push(cpx,cpy);break;case"v":cpy+=p.shift();cmd="L";points.push(cpx,cpy);break;case"V":cpy=p.shift();cmd="L";points.push(cpx,cpy);break;case"C":points.push(p.shift(),p.shift(),p.shift(),p.shift());cpx=p.shift();cpy=p.shift();points.push(cpx,cpy);break;case"c":points.push(cpx+p.shift(),cpy+p.shift(),cpx+p.shift(),cpy+p.shift());cpx+=p.shift();cpy+=p.shift();cmd="C";points.push(cpx,cpy);break;case"S":ctlPtx=cpx,ctlPty=cpy;prevCmd=ca[ca.length-1];if(prevCmd.command==="C"){ctlPtx=cpx+(cpx-prevCmd.points[2]);ctlPty=cpy+(cpy-prevCmd.points[3])}points.push(ctlPtx,ctlPty,p.shift(),p.shift());cpx=p.shift();cpy=p.shift();cmd="C";points.push(cpx,cpy);break;case"s":ctlPtx=cpx;ctlPty=cpy;prevCmd=ca[ca.length-1];if(prevCmd.command==="C"){ctlPtx=cpx+(cpx-prevCmd.points[2]);ctlPty=cpy+(cpy-prevCmd.points[3])}points.push(ctlPtx,ctlPty,cpx+p.shift(),cpy+p.shift());cpx+=p.shift();cpy+=p.shift();cmd="C";points.push(cpx,cpy);break;case"Q":points.push(p.shift(),p.shift());cpx=p.shift();cpy=p.shift();points.push(cpx,cpy);break;case"q":points.push(cpx+p.shift(),cpy+p.shift());cpx+=p.shift();cpy+=p.shift();cmd="Q";points.push(cpx,cpy);break;case"T":ctlPtx=cpx;ctlPty=cpy;prevCmd=ca[ca.length-1];if(prevCmd.command==="Q"){ctlPtx=cpx+(cpx-prevCmd.points[0]);ctlPty=cpy+(cpy-prevCmd.points[1])}cpx=p.shift();cpy=p.shift();cmd="Q";points.push(ctlPtx,ctlPty,cpx,cpy);break;case"t":ctlPtx=cpx;ctlPty=cpy;prevCmd=ca[ca.length-1];if(prevCmd.command==="Q"){ctlPtx=cpx+(cpx-prevCmd.points[0]);ctlPty=cpy+(cpy-prevCmd.points[1])}cpx+=p.shift();cpy+=p.shift();cmd="Q";points.push(ctlPtx,ctlPty,cpx,cpy);break;case"A":rx=p.shift();ry=p.shift();psi=p.shift();fa=p.shift();fs=p.shift();x1=cpx;y1=cpy;cpx=p.shift(),cpy=p.shift();cmd="A";points=this._convertEndpointToCenterParameterization(x1,y1,cpx,cpy,fa,fs,rx,ry,psi);break;case"a":rx=p.shift();ry=p.shift();psi=p.shift();fa=p.shift();fs=p.shift();x1=cpx;y1=cpy;cpx+=p.shift(),cpy+=p.shift();cmd="A";points=this._convertEndpointToCenterParameterization(x1,y1,cpx,cpy,fa,fs,rx,ry,psi);break}ca.push({command:cmd||c,points:points})}if(c==="z"||c==="Z")ca.push({command:"z",points:[]})}return ca},_convertEndpointToCenterParameterization:function(x1,y1,x2,y2,fa,fs,rx,ry,psiDeg){var psi=psiDeg*(Math.PI/180);var xp=Math.cos(psi)*(x1-x2)/2+Math.sin(psi)*(y1-y2)/2;var yp=-1*Math.sin(psi)*(x1-x2)/2+Math.cos(psi)*(y1-y2)/2;var lambda=xp*xp/(rx*rx)+yp*yp/(ry*ry);if(lambda>1){rx*=Math.sqrt(lambda);ry*=Math.sqrt(lambda)}var f=Math.sqrt((rx*rx*(ry*ry)-rx*rx*(yp*yp)-ry*ry*(xp*xp))/(rx*rx*(yp*yp)+ry*ry*(xp*xp)));if(fa==fs)f*=-1;if(isNaN(f))f=0;var cxp=f*rx*yp/ry;var cyp=f*-ry*xp/rx;var cx=(x1+x2)/2+Math.cos(psi)*cxp-Math.sin(psi)*cyp;var cy=(y1+y2)/2+Math.sin(psi)*cxp+Math.cos(psi)*cyp;var vMag=function(v){return Math.sqrt(v[0]*v[0]+v[1]*v[1])};var vRatio=function(u,v){return(u[0]*v[0]+u[1]*v[1])/(vMag(u)*vMag(v))};var vAngle=function(u,v){return(u[0]*v[1]<u[1]*v[0]?-1:1)*Math.acos(vRatio(u,v))};var theta=vAngle([1,0],[(xp-cxp)/rx,(yp-cyp)/ry]);var u=[(xp-cxp)/rx,(yp-cyp)/ry];var v=[(-1*xp-cxp)/rx,(-1*yp-cyp)/ry];var dTheta=vAngle(u,v);if(vRatio(u,v)<=-1)dTheta=Math.PI;if(vRatio(u,v)>=1)dTheta=0;if(fs===0&&dTheta>0)dTheta=dTheta-2*Math.PI;if(fs==1&&dTheta<0)dTheta=dTheta+2*Math.PI;return[cx,cy,rx,ry,theta,dTheta,psi,fs]}};Kinetic.GlobalObject.extend(Kinetic.Path,Kinetic.Shape);Kinetic.GlobalObject.addSetters(Kinetic.Path,["data"]);Kinetic.GlobalObject.addGetters(Kinetic.Path,["data"]);Kinetic.Transform=function(){this.m=[1,0,0,1,0,0]};Kinetic.Transform.prototype={translate:function(x,y){this.m[4]+=this.m[0]*x+this.m[2]*y;this.m[5]+=this.m[1]*x+this.m[3]*y},scale:function(sx,sy){this.m[0]*=sx;this.m[1]*=sx;this.m[2]*=sy;this.m[3]*=sy},rotate:function(rad){var c=Math.cos(rad);var s=Math.sin(rad);var m11=this.m[0]*c+this.m[2]*s;var m12=this.m[1]*c+this.m[3]*s;var m21=this.m[0]*-s+this.m[2]*c;var m22=this.m[1]*-s+this.m[3]*c;this.m[0]=m11;this.m[1]=m12;this.m[2]=m21;this.m[3]=m22},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},multiply:function(matrix){var m11=this.m[0]*matrix.m[0]+this.m[2]*matrix.m[1];var m12=this.m[1]*matrix.m[0]+this.m[3]*matrix.m[1];var m21=this.m[0]*matrix.m[2]+this.m[2]*matrix.m[3];var m22=this.m[1]*matrix.m[2]+this.m[3]*matrix.m[3];var dx=this.m[0]*matrix.m[4]+this.m[2]*matrix.m[5]+this.m[4];var dy=this.m[1]*matrix.m[4]+this.m[3]*matrix.m[5]+this.m[5];this.m[0]=m11;this.m[1]=m12;this.m[2]=m21;this.m[3]=m22;this.m[4]=dx;this.m[5]=dy},invert:function(){var d=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]);var m0=this.m[3]*d;var m1=-this.m[1]*d;var m2=-this.m[2]*d;var m3=this.m[0]*d;var m4=d*(this.m[2]*this.m[5]-this.m[3]*this.m[4]);var m5=d*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=m0;this.m[1]=m1;this.m[2]=m2;this.m[3]=m3;this.m[4]=m4;this.m[5]=m5},getMatrix:function(){return this.m}};Kinetic.Transition=function(node,config){this.node=node;this.config=config;this.tweens=[];var that=this;function addTween(c,attrs){for(var key in c){if(key!=="duration"&&key!=="easing"&&key!=="callback"){if(Kinetic.GlobalObject._isObject(c[key])){addTween(c[key],attrs[key])}else{that._add(that._getTween(attrs,key,c[key]))}}}}addTween(config,node.attrs);var finishedTweens=0;for(var n=0;n<this.tweens.length;n++){var tween=this.tweens[n];tween.onFinished=function(){finishedTweens++;if(finishedTweens>=that.tweens.length){that.onFinished()}}}};Kinetic.Transition.prototype={start:function(){for(var n=0;n<this.tweens.length;n++){this.tweens[n].start()}},stop:function(){for(var n=0;n<this.tweens.length;n++){this.tweens[n].stop()}},resume:function(){for(var n=0;n<this.tweens.length;n++){this.tweens[n].resume()}},_onEnterFrame:function(){for(var n=0;n<this.tweens.length;n++){this.tweens[n].onEnterFrame()}},_add:function(tween){this.tweens.push(tween)},_getTween:function(key,prop,val){var config=this.config;var node=this.node;var easing=config.easing;if(easing===undefined){easing="linear"}var tween=new Kinetic.Tween(node,function(i){key[prop]=i},Kinetic.Tweens[easing],key[prop],val,config.duration);return tween}};Kinetic.Tween=function(obj,propFunc,func,begin,finish,duration){this._listeners=[];this.addListener(this);this.obj=obj;this.propFunc=propFunc;this.begin=begin;this._pos=begin;this.setDuration(duration);this.isPlaying=false;this._change=0;this.prevTime=0;this.prevPos=0;this.looping=false;this._time=0;this._position=0;this._startTime=0;this._finish=0;this.name="";this.func=func;this.setFinish(finish)};Kinetic.Tween.prototype={setTime:function(t){this.prevTime=this._time;if(t>this.getDuration()){if(this.looping){this.rewind(t-this._duration);this.update();this.broadcastMessage("onLooped",{target:this,type:"onLooped"})}else{this._time=this._duration;this.update();this.stop();this.broadcastMessage("onFinished",{target:this,type:"onFinished"})}}else if(t<0){this.rewind();this.update()}else{this._time=t;this.update()}},getTime:function(){return this._time},setDuration:function(d){this._duration=d===null||d<=0?1e5:d},getDuration:function(){return this._duration},setPosition:function(p){this.prevPos=this._pos;this.propFunc(p);this._pos=p;this.broadcastMessage("onChanged",{target:this,type:"onChanged"})},getPosition:function(t){if(t===undefined){t=this._time}return this.func(t,this.begin,this._change,this._duration)},setFinish:function(f){this._change=f-this.begin},getFinish:function(){return this.begin+this._change},start:function(){this.rewind();this.startEnterFrame();this.broadcastMessage("onStarted",{target:this,type:"onStarted"})},rewind:function(t){this.stop();this._time=t===undefined?0:t;this.fixTime();this.update()},fforward:function(){this._time=this._duration;this.fixTime();this.update()},update:function(){this.setPosition(this.getPosition(this._time))},startEnterFrame:function(){this.stopEnterFrame();this.isPlaying=true;this.onEnterFrame()},onEnterFrame:function(){if(this.isPlaying){this.nextFrame()}},nextFrame:function(){this.setTime((this.getTimer()-this._startTime)/1e3)},stop:function(){this.stopEnterFrame();this.broadcastMessage("onStopped",{target:this,type:"onStopped"})},stopEnterFrame:function(){this.isPlaying=false},continueTo:function(finish,duration){this.begin=this._pos;this.setFinish(finish);if(this._duration!==undefined){this.setDuration(duration)}this.start()},resume:function(){this.fixTime();this.startEnterFrame();this.broadcastMessage("onResumed",{target:this,type:"onResumed"})},yoyo:function(){this.continueTo(this.begin,this._time)},addListener:function(o){this.removeListener(o);return this._listeners.push(o)},removeListener:function(o){var a=this._listeners;var i=a.length;while(i--){if(a[i]==o){a.splice(i,1);return true}}return false},broadcastMessage:function(){var arr=[];for(var i=0;i<arguments.length;i++){arr.push(arguments[i])}var e=arr.shift();var a=this._listeners;var l=a.length;for(i=0;i<l;i++){if(a[i][e]){a[i][e].apply(a[i],arr)}}},fixTime:function(){this._startTime=this.getTimer()-this._time*1e3},getTimer:function(){return(new Date).getTime()-this._time}};Kinetic.Tweens={"back-ease-in":function(t,b,c,d,a,p){var s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b},"back-ease-out":function(t,b,c,d,a,p){var s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},"back-ease-in-out":function(t,b,c,d,a,p){var s=1.70158;if((t/=d/2)<1){return c/2*(t*t*(((s*=1.525)+1)*t-s))+b}return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b},"elastic-ease-in":function(t,b,c,d,a,p){var s=0;if(t===0){return b}if((t/=d)==1){return b+c}if(!p){p=d*.3}if(!a||a<Math.abs(c)){a=c;s=p/4}else{s=p/(2*Math.PI)*Math.asin(c/a)}return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b},"elastic-ease-out":function(t,b,c,d,a,p){var s=0;if(t===0){return b}if((t/=d)==1){return b+c}if(!p){p=d*.3}if(!a||a<Math.abs(c)){a=c;s=p/4}else{s=p/(2*Math.PI)*Math.asin(c/a)}return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b},"elastic-ease-in-out":function(t,b,c,d,a,p){var s=0;if(t===0){return b}if((t/=d/2)==2){return b+c}if(!p){p=d*(.3*1.5)}if(!a||a<Math.abs(c)){a=c;s=p/4}else{s=p/(2*Math.PI)*Math.asin(c/a)}if(t<1){return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b}return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b},"bounce-ease-out":function(t,b,c,d){if((t/=d)<1/2.75){return c*(7.5625*t*t)+b}else if(t<2/2.75){return c*(7.5625*(t-=1.5/2.75)*t+.75)+b}else if(t<2.5/2.75){return c*(7.5625*(t-=2.25/2.75)*t+.9375)+b}else{return c*(7.5625*(t-=2.625/2.75)*t+.984375)+b}},"bounce-ease-in":function(t,b,c,d){return c-Kinetic.Tweens["bounce-ease-out"](d-t,0,c,d)+b},"bounce-ease-in-out":function(t,b,c,d){if(t<d/2){return Kinetic.Tweens["bounce-ease-in"](t*2,0,c,d)*.5+b}else{return Kinetic.Tweens["bounce-ease-out"](t*2-d,0,c,d)*.5+c*.5+b}},"ease-in":function(t,b,c,d){return c*(t/=d)*t+b},"ease-out":function(t,b,c,d){return-c*(t/=d)*(t-2)+b},"ease-in-out":function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b}return-c/2*(--t*(t-2)-1)+b},"strong-ease-in":function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},"strong-ease-out":function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},"strong-ease-in-out":function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t*t+b}return c/2*((t-=2)*t*t*t*t+2)+b},linear:function(t,b,c,d){return c*t/d+b}};
(function(window,document){"use strict";var keyboardAllowed=typeof Element!=="undefined"&&"ALLOW_KEYBOARD_INPUT"in Element,fn=function(){var val,valLength;var fnMap=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]];var i=0;var l=fnMap.length;var ret={};for(;i<l;i++){val=fnMap[i];if(val&&val[1]in document){for(i=0,valLength=val.length;i<valLength;i++){ret[fnMap[0][i]]=val[i]}return ret}}return false}(),screenfull={request:function(elem){var request=fn.requestFullscreen;elem=elem||document.documentElement;if(/5\.1[\.\d]* Safari/.test(navigator.userAgent)){elem[request]()}else{elem[request](keyboardAllowed&&Element.ALLOW_KEYBOARD_INPUT)}},exit:function(){document[fn.exitFullscreen]()},toggle:function(elem){if(this.isFullscreen){this.exit()}else{this.request(elem)}},onchange:function(){},onerror:function(){},raw:fn};if(!fn){window.screenfull=false;return}Object.defineProperties(screenfull,{isFullscreen:{get:function(){return!!document[fn.fullscreenElement]}},element:{enumerable:true,get:function(){return document[fn.fullscreenElement]}},enabled:{enumerable:true,get:function(){return!!document[fn.fullscreenEnabled]}}});document.addEventListener(fn.fullscreenchange,function(e){screenfull.onchange.call(screenfull,e)});document.addEventListener(fn.fullscreenerror,function(e){screenfull.onerror.call(screenfull,e)});window.screenfull=screenfull})(window,document);
var SWFUpload=function(settings){this.initSWFUpload(settings)};SWFUpload.prototype.initSWFUpload=function(userSettings){try{this.customSettings={};this.settings={};this.eventQueue=[];this.movieName="SWFUpload_"+SWFUpload.movieCount++;this.movieElement=null;SWFUpload.instances[this.movieName]=this;this.initSettings(userSettings);this.loadSupport();if(this.swfuploadPreload()){this.loadFlash()}this.displayDebugInfo()}catch(ex){delete SWFUpload.instances[this.movieName];throw ex}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.version="2.5.0 2010-01-15 Beta 2";SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290,RESIZE:-300};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};SWFUpload.UPLOAD_TYPE={NORMAL:-1,RESIZED:-2};SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120,JAVASCRIPT:-130,NONE:-130};SWFUpload.CURSOR={ARROW:-1,HAND:-2};SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"};SWFUpload.RESIZE_ENCODING={JPEG:-1,PNG:-2};SWFUpload.completeURL=function(url){try{var path="",indexSlash=-1;if(typeof url!=="string"||url.match(/^https?:\/\//i)||url.match(/^\//)||url===""){return url}indexSlash=window.location.pathname.lastIndexOf("/");if(indexSlash<=0){path="/"}else{path=window.location.pathname.substr(0,indexSlash)+"/"}return path+url}catch(ex){return url}};SWFUpload.onload=function(){};SWFUpload.prototype.initSettings=function(userSettings){this.ensureDefault=function(settingName,defaultValue){var setting=userSettings[settingName];if(setting!=undefined){this.settings[settingName]=setting}else{this.settings[settingName]=defaultValue}};this.ensureDefault("upload_url","");this.ensureDefault("preserve_relative_urls",false);this.ensureDefault("file_post_name","Filedata");this.ensureDefault("post_params",{});this.ensureDefault("use_query_string",false);this.ensureDefault("requeue_on_error",false);this.ensureDefault("http_success",[]);this.ensureDefault("assume_success_timeout",0);this.ensureDefault("file_types","*.*");this.ensureDefault("file_types_description","All Files");this.ensureDefault("file_size_limit",0);this.ensureDefault("file_upload_limit",0);this.ensureDefault("file_queue_limit",0);this.ensureDefault("flash_url","swfupload.swf");this.ensureDefault("flash9_url","swfupload_fp9.swf");this.ensureDefault("prevent_swf_caching",true);this.ensureDefault("button_image_url","");this.ensureDefault("button_width",1);this.ensureDefault("button_height",1);this.ensureDefault("button_text","");this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");this.ensureDefault("button_text_top_padding",0);this.ensureDefault("button_text_left_padding",0);this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);this.ensureDefault("button_disabled",false);this.ensureDefault("button_placeholder_id","");this.ensureDefault("button_placeholder",null);this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW);this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW);this.ensureDefault("debug",false);this.settings.debug_enabled=this.settings.debug;this.settings.return_upload_start_handler=this.returnUploadStart;this.ensureDefault("swfupload_preload_handler",null);this.ensureDefault("swfupload_load_failed_handler",null);this.ensureDefault("swfupload_loaded_handler",null);this.ensureDefault("file_dialog_start_handler",null);this.ensureDefault("file_queued_handler",null);this.ensureDefault("file_queue_error_handler",null);this.ensureDefault("file_dialog_complete_handler",null);this.ensureDefault("upload_resize_start_handler",null);this.ensureDefault("upload_start_handler",null);this.ensureDefault("upload_progress_handler",null);this.ensureDefault("upload_error_handler",null);this.ensureDefault("upload_success_handler",null);this.ensureDefault("upload_complete_handler",null);this.ensureDefault("mouse_click_handler",null);this.ensureDefault("mouse_out_handler",null);this.ensureDefault("mouse_over_handler",null);this.ensureDefault("debug_handler",this.debugMessage);this.ensureDefault("custom_settings",{});this.customSettings=this.settings.custom_settings;if(!!this.settings.prevent_swf_caching){this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+(new Date).getTime();this.settings.flash9_url=this.settings.flash9_url+(this.settings.flash9_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+(new Date).getTime()}if(!this.settings.preserve_relative_urls){this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url);this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url)}delete this.ensureDefault};SWFUpload.prototype.loadSupport=function(){this.support={loading:swfobject.hasFlashPlayerVersion("9.0.28"),imageResize:swfobject.hasFlashPlayerVersion("10.0.0")}};SWFUpload.prototype.loadFlash=function(){var targetElement,tempParent,wrapperType,flashHTML,els;if(!this.support.loading){this.queueEvent("swfupload_load_failed_handler",["Flash Player doesn't support SWFUpload"]);return}if(document.getElementById(this.movieName)!==null){this.support.loading=false;this.queueEvent("swfupload_load_failed_handler",["Element ID already in use"]);return}targetElement=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder;if(targetElement==undefined){this.support.loading=false;this.queueEvent("swfupload_load_failed_handler",["button place holder not found"]);return}wrapperType=(targetElement.currentStyle&&targetElement.currentStyle["display"]||window.getComputedStyle&&document.defaultView.getComputedStyle(targetElement,null).getPropertyValue("display"))!=="block"?"span":"div";tempParent=document.createElement(wrapperType);flashHTML=this.getFlashHTML();try{tempParent.innerHTML=flashHTML}catch(ex){this.support.loading=false;this.queueEvent("swfupload_load_failed_handler",["Exception loading Flash HTML into placeholder"]);return}els=tempParent.getElementsByTagName("object");if(!els||els.length>1||els.length===0){this.support.loading=false;this.queueEvent("swfupload_load_failed_handler",["Unable to find movie after adding to DOM"]);return}else if(els.length===1){this.movieElement=els[0]}targetElement.parentNode.replaceChild(tempParent.firstChild,targetElement);if(window[this.movieName]==undefined){window[this.movieName]=this.getMovieElement()}};SWFUpload.prototype.getFlashHTML=function(flashVersion){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.support.imageResize?this.settings.flash_url:this.settings.flash9_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.support.imageResize?this.settings.flash_url:this.settings.flash9_url,'" />','<param name="quality" value="high" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")};SWFUpload.prototype.getFlashVars=function(){var httpSuccessString,paramString;paramString=this.buildParamString();httpSuccessString=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(httpSuccessString),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(paramString),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")};SWFUpload.prototype.getMovieElement=function(){if(this.movieElement==undefined){this.movieElement=document.getElementById(this.movieName)}if(this.movieElement===null){throw"Could not find Flash element"}return this.movieElement};SWFUpload.prototype.buildParamString=function(){var name,postParams,paramStringPairs=[];postParams=this.settings.post_params;if(typeof postParams==="object"){for(name in postParams){if(postParams.hasOwnProperty(name)){paramStringPairs.push(encodeURIComponent(name.toString())+"="+encodeURIComponent(postParams[name].toString()))}}}return paramStringPairs.join("&amp;")};SWFUpload.prototype.destroy=function(){var movieElement;try{this.cancelUpload(null,false);movieElement=this.cleanUp();if(movieElement){try{movieElement.parentNode.removeChild(movieElement)}catch(ex){}}window[this.movieName]=null;SWFUpload.instances[this.movieName]=null;delete SWFUpload.instances[this.movieName];this.movieElement=null;this.settings=null;this.customSettings=null;this.eventQueue=null;this.movieName=null;return true}catch(ex2){return false}};SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","	","upload_url:               ",this.settings.upload_url,"\n","	","flash_url:                ",this.settings.flash_url,"\n","	","flash9_url:                ",this.settings.flash9_url,"\n","	","use_query_string:         ",this.settings.use_query_string.toString(),"\n","	","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","	","http_success:             ",this.settings.http_success.join(", "),"\n","	","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","	","file_post_name:           ",this.settings.file_post_name,"\n","	","post_params:              ",this.settings.post_params.toString(),"\n","	","file_types:               ",this.settings.file_types,"\n","	","file_types_description:   ",this.settings.file_types_description,"\n","	","file_size_limit:          ",this.settings.file_size_limit,"\n","	","file_upload_limit:        ",this.settings.file_upload_limit,"\n","	","file_queue_limit:         ",this.settings.file_queue_limit,"\n","	","debug:                    ",this.settings.debug.toString(),"\n","	","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","	","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","	","button_placeholder:       ",this.settings.button_placeholder?"Set":"Not Set","\n","	","button_image_url:         ",this.settings.button_image_url.toString(),"\n","	","button_width:             ",this.settings.button_width.toString(),"\n","	","button_height:            ",this.settings.button_height.toString(),"\n","	","button_text:              ",this.settings.button_text.toString(),"\n","	","button_text_style:        ",this.settings.button_text_style.toString(),"\n","	","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","	","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","	","button_action:            ",this.settings.button_action.toString(),"\n","	","button_cursor:            ",this.settings.button_cursor.toString(),"\n","	","button_disabled:          ",this.settings.button_disabled.toString(),"\n","	","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","	","swfupload_preload_handler assigned:  ",(typeof this.settings.swfupload_preload_handler==="function").toString(),"\n","	","swfupload_load_failed_handler assigned:  ",(typeof this.settings.swfupload_load_failed_handler==="function").toString(),"\n","	","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler==="function").toString(),"\n","	","mouse_click_handler assigned:       ",(typeof this.settings.mouse_click_handler==="function").toString(),"\n","	","mouse_over_handler assigned:        ",(typeof this.settings.mouse_over_handler==="function").toString(),"\n","	","mouse_out_handler assigned:         ",(typeof this.settings.mouse_out_handler==="function").toString(),"\n","	","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler==="function").toString(),"\n","	","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler==="function").toString(),"\n","	","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler==="function").toString(),"\n","	","upload_resize_start_handler assigned:      ",(typeof this.settings.upload_resize_start_handler==="function").toString(),"\n","	","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler==="function").toString(),"\n","	","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler==="function").toString(),"\n","	","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler==="function").toString(),"\n","	","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler==="function").toString(),"\n","	","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler==="function").toString(),"\n","	","debug_handler assigned:             ",(typeof this.settings.debug_handler==="function").toString(),"\n","Support:\n","	","Load:                     ",this.support.loading?"Yes":"No","\n","	","Image Resize:             ",this.support.imageResize?"Yes":"No","\n"].join(""))};SWFUpload.prototype.addSetting=function(name,value,default_value){if(value==undefined){return this.settings[name]=default_value}else{return this.settings[name]=value}};SWFUpload.prototype.getSetting=function(name){if(this.settings[name]!=undefined){return this.settings[name]}return""};SWFUpload.prototype.callFlash=function(functionName,argumentArray){var movieElement,returnValue,returnString;argumentArray=argumentArray||[];movieElement=this.getMovieElement();try{if(movieElement!=undefined){returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+"</invoke>");returnValue=eval(returnString)}else{this.debug("Can't call flash because the movie wasn't found.")}}catch(ex){this.debug("Exception calling flash function '"+functionName+"': "+ex.message)}if(returnValue!=undefined&&typeof returnValue.post==="object"){returnValue=this.unescapeFilePostParams(returnValue)}return returnValue};SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")};SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")};SWFUpload.prototype.startUpload=function(fileID){this.callFlash("StartUpload",[fileID])};SWFUpload.prototype.startResizedUpload=function(fileID,width,height,encoding,quality,allowEnlarging){this.callFlash("StartUpload",[fileID,{width:width,height:height,encoding:encoding,quality:quality,allowEnlarging:allowEnlarging}])};SWFUpload.prototype.cancelUpload=function(fileID,triggerErrorEvent){if(triggerErrorEvent!==false){triggerErrorEvent=true}this.callFlash("CancelUpload",[fileID,triggerErrorEvent])};SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")};SWFUpload.prototype.requeueUpload=function(indexOrFileID){return this.callFlash("RequeueUpload",[indexOrFileID])};SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")};SWFUpload.prototype.setStats=function(statsObject){this.callFlash("SetStats",[statsObject])};SWFUpload.prototype.getFile=function(fileID){if(typeof fileID==="number"){return this.callFlash("GetFileByIndex",[fileID])}else{return this.callFlash("GetFile",[fileID])}};SWFUpload.prototype.getQueueFile=function(fileID){if(typeof fileID==="number"){return this.callFlash("GetFileByQueueIndex",[fileID])}else{return this.callFlash("GetFile",[fileID])}};SWFUpload.prototype.addFileParam=function(fileID,name,value){return this.callFlash("AddFileParam",[fileID,name,value])};SWFUpload.prototype.removeFileParam=function(fileID,name){this.callFlash("RemoveFileParam",[fileID,name])};SWFUpload.prototype.setUploadURL=function(url){this.settings.upload_url=url.toString();this.callFlash("SetUploadURL",[url])};SWFUpload.prototype.setPostParams=function(paramsObject){this.settings.post_params=paramsObject;this.callFlash("SetPostParams",[paramsObject])};SWFUpload.prototype.addPostParam=function(name,value){this.settings.post_params[name]=value;this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.removePostParam=function(name){delete this.settings.post_params[name];this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.setFileTypes=function(types,description){this.settings.file_types=types;this.settings.file_types_description=description;this.callFlash("SetFileTypes",[types,description])};SWFUpload.prototype.setFileSizeLimit=function(fileSizeLimit){this.settings.file_size_limit=fileSizeLimit;this.callFlash("SetFileSizeLimit",[fileSizeLimit])};SWFUpload.prototype.setFileUploadLimit=function(fileUploadLimit){this.settings.file_upload_limit=fileUploadLimit;this.callFlash("SetFileUploadLimit",[fileUploadLimit])};SWFUpload.prototype.setFileQueueLimit=function(fileQueueLimit){this.settings.file_queue_limit=fileQueueLimit;this.callFlash("SetFileQueueLimit",[fileQueueLimit])};SWFUpload.prototype.setFilePostName=function(filePostName){this.settings.file_post_name=filePostName;this.callFlash("SetFilePostName",[filePostName])};SWFUpload.prototype.setUseQueryString=function(useQueryString){this.settings.use_query_string=useQueryString;this.callFlash("SetUseQueryString",[useQueryString])};SWFUpload.prototype.setRequeueOnError=function(requeueOnError){this.settings.requeue_on_error=requeueOnError;this.callFlash("SetRequeueOnError",[requeueOnError])};SWFUpload.prototype.setHTTPSuccess=function(http_status_codes){if(typeof http_status_codes==="string"){http_status_codes=http_status_codes.replace(" ","").split(",")}this.settings.http_success=http_status_codes;this.callFlash("SetHTTPSuccess",[http_status_codes])};SWFUpload.prototype.setAssumeSuccessTimeout=function(timeout_seconds){this.settings.assume_success_timeout=timeout_seconds;this.callFlash("SetAssumeSuccessTimeout",[timeout_seconds])};SWFUpload.prototype.setDebugEnabled=function(debugEnabled){this.settings.debug_enabled=debugEnabled;this.callFlash("SetDebugEnabled",[debugEnabled])};SWFUpload.prototype.setButtonImageURL=function(buttonImageURL){if(buttonImageURL==undefined){buttonImageURL=""}this.settings.button_image_url=buttonImageURL;this.callFlash("SetButtonImageURL",[buttonImageURL])};SWFUpload.prototype.setButtonDimensions=function(width,height){this.settings.button_width=width;this.settings.button_height=height;var movie=this.getMovieElement();if(movie!=undefined){movie.style.width=width+"px";movie.style.height=height+"px"}this.callFlash("SetButtonDimensions",[width,height])};SWFUpload.prototype.setButtonText=function(html){this.settings.button_text=html;this.callFlash("SetButtonText",[html])};SWFUpload.prototype.setButtonTextPadding=function(left,top){this.settings.button_text_top_padding=top;this.settings.button_text_left_padding=left;this.callFlash("SetButtonTextPadding",[left,top])};SWFUpload.prototype.setButtonTextStyle=function(css){this.settings.button_text_style=css;this.callFlash("SetButtonTextStyle",[css])};SWFUpload.prototype.setButtonDisabled=function(isDisabled){this.settings.button_disabled=isDisabled;this.callFlash("SetButtonDisabled",[isDisabled])};SWFUpload.prototype.setButtonAction=function(buttonAction){this.settings.button_action=buttonAction;this.callFlash("SetButtonAction",[buttonAction])};SWFUpload.prototype.setButtonCursor=function(cursor){this.settings.button_cursor=cursor;this.callFlash("SetButtonCursor",[cursor])};SWFUpload.prototype.queueEvent=function(handlerName,argumentArray){var self=this;if(argumentArray==undefined){argumentArray=[]}else if(!(argumentArray instanceof Array)){argumentArray=[argumentArray]}if(typeof this.settings[handlerName]==="function"){this.eventQueue.push(function(){this.settings[handlerName].apply(this,argumentArray)});setTimeout(function(){self.executeNextEvent()},0)}else if(this.settings[handlerName]!==null){throw"Event handler "+handlerName+" is unknown or is not a function"}};SWFUpload.prototype.executeNextEvent=function(){var f=this.eventQueue?this.eventQueue.shift():null;if(typeof f==="function"){f.apply(this)}};SWFUpload.prototype.unescapeFilePostParams=function(file){var reg=/[$]([0-9a-f]{4})/i,unescapedPost={},uk,k,match;if(file!=undefined){for(k in file.post){if(file.post.hasOwnProperty(k)){uk=k;while((match=reg.exec(uk))!==null){uk=uk.replace(match[0],String.fromCharCode(parseInt("0x"+match[1],16)))}unescapedPost[uk]=file.post[k]}}file.post=unescapedPost}return file};SWFUpload.prototype.swfuploadPreload=function(){var returnValue;if(typeof this.settings.swfupload_preload_handler==="function"){returnValue=this.settings.swfupload_preload_handler.call(this)}else if(this.settings.swfupload_preload_handler!=undefined){throw"upload_start_handler must be a function"}if(returnValue===undefined){returnValue=true}return!!returnValue};SWFUpload.prototype.flashReady=function(){var movieElement=this.cleanUp();if(!movieElement){this.debug("Flash called back ready but the flash movie can't be found.");return}this.queueEvent("swfupload_loaded_handler")};SWFUpload.prototype.cleanUp=function(){var key,movieElement=this.getMovieElement();try{if(movieElement&&typeof movieElement.CallFunction==="unknown"){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(key in movieElement){try{if(typeof movieElement[key]==="function"){movieElement[key]=null}}catch(ex){}}}}catch(ex1){}window["__flash__removeCallback"]=function(instance,name){try{if(instance){instance[name]=null}}catch(flashEx){}};return movieElement};SWFUpload.prototype.mouseClick=function(){this.queueEvent("mouse_click_handler")};SWFUpload.prototype.mouseOver=function(){this.queueEvent("mouse_over_handler")};SWFUpload.prototype.mouseOut=function(){this.queueEvent("mouse_out_handler")};SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")};SWFUpload.prototype.fileQueued=function(file){file=this.unescapeFilePostParams(file);this.queueEvent("file_queued_handler",file)};SWFUpload.prototype.fileQueueError=function(file,errorCode,message){file=this.unescapeFilePostParams(file);this.queueEvent("file_queue_error_handler",[file,errorCode,message])};SWFUpload.prototype.fileDialogComplete=function(numFilesSelected,numFilesQueued,numFilesInQueue){this.queueEvent("file_dialog_complete_handler",[numFilesSelected,numFilesQueued,numFilesInQueue])};SWFUpload.prototype.uploadResizeStart=function(file,resizeSettings){file=this.unescapeFilePostParams(file);this.queueEvent("upload_resize_start_handler",[file,resizeSettings.width,resizeSettings.height,resizeSettings.encoding,resizeSettings.quality])};SWFUpload.prototype.uploadStart=function(file){file=this.unescapeFilePostParams(file);this.queueEvent("return_upload_start_handler",file)};SWFUpload.prototype.returnUploadStart=function(file){var returnValue;if(typeof this.settings.upload_start_handler==="function"){file=this.unescapeFilePostParams(file);returnValue=this.settings.upload_start_handler.call(this,file)}else if(this.settings.upload_start_handler!=undefined){throw"upload_start_handler must be a function"}if(returnValue===undefined){returnValue=true}returnValue=!!returnValue;this.callFlash("ReturnUploadStart",[returnValue])};SWFUpload.prototype.uploadProgress=function(file,bytesComplete,bytesTotal){file=this.unescapeFilePostParams(file);this.queueEvent("upload_progress_handler",[file,bytesComplete,bytesTotal])};SWFUpload.prototype.uploadError=function(file,errorCode,message){file=this.unescapeFilePostParams(file);this.queueEvent("upload_error_handler",[file,errorCode,message])};SWFUpload.prototype.uploadSuccess=function(file,serverData,responseReceived){file=this.unescapeFilePostParams(file);this.queueEvent("upload_success_handler",[file,serverData,responseReceived])};SWFUpload.prototype.uploadComplete=function(file){file=this.unescapeFilePostParams(file);this.queueEvent("upload_complete_handler",file)};SWFUpload.prototype.debug=function(message){this.queueEvent("debug_handler",message)};SWFUpload.prototype.debugMessage=function(message){var exceptionMessage,exceptionValues,key;if(this.settings.debug){exceptionValues=[];if(typeof message==="object"&&typeof message.name==="string"&&typeof message.message==="string"){for(key in message){if(message.hasOwnProperty(key)){exceptionValues.push(key+": "+message[key])}}exceptionMessage=exceptionValues.join("\n")||"";exceptionValues=exceptionMessage.split("\n");exceptionMessage="EXCEPTION: "+exceptionValues.join("\nEXCEPTION: ");SWFUpload.Console.writeLine(exceptionMessage)}else{SWFUpload.Console.writeLine(message)}}};SWFUpload.Console={};SWFUpload.Console.writeLine=function(message){var console,documentForm;try{console=document.getElementById("SWFUpload_Console");if(!console){documentForm=document.createElement("form");document.getElementsByTagName("body")[0].appendChild(documentForm);console=document.createElement("textarea");console.id="SWFUpload_Console";console.style.fontFamily="monospace";console.setAttribute("wrap","off");console.wrap="off";console.style.overflow="auto";console.style.width="700px";console.style.height="350px";console.style.margin="5px";documentForm.appendChild(console)}console.value+=message+"\n";console.scrollTop=console.scrollHeight-console.clientHeight}catch(ex){alert("Exception: "+ex.name+" Message: "+ex.message)}};swfobject.addDomLoadEvent(function(){if(typeof SWFUpload.onload==="function"){SWFUpload.onload.call(window)}});
if(typeof SWFUpload==="function"){SWFUpload.prototype.initSettings=function(oldInitSettings){return function(userSettings){if(typeof oldInitSettings==="function"){oldInitSettings.call(this,userSettings)}this.refreshCookies(false)}}(SWFUpload.prototype.initSettings);SWFUpload.prototype.refreshCookies=function(sendToFlash){if(sendToFlash===undefined){sendToFlash=true}sendToFlash=!!sendToFlash;var postParams=this.settings.post_params;var i,cookieArray=document.cookie.split(";"),caLength=cookieArray.length,c,eqIndex,name,value;for(i=0;i<caLength;i++){c=cookieArray[i];while(c.charAt(0)===" "){c=c.substring(1,c.length)}eqIndex=c.indexOf("=");if(eqIndex>0){name=c.substring(0,eqIndex);value=c.substring(eqIndex+1);postParams[name]=value}}if(sendToFlash){this.setPostParams(postParams)}}}
if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};fNOP.prototype=this.prototype;fBound.prototype=new fNOP;return fBound}}
Object.keys=Object.keys||function(){var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),DontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],DontEnumsLength=DontEnums.length;return function(o){if(typeof o!="object"&&typeof o!="function"||o===null)throw new TypeError("Object.keys called on a non-object");var result=[];for(var name in o){if(hasOwnProperty.call(o,name))result.push(name)}if(hasDontEnumBug){for(var i=0;i<DontEnumsLength;i++){if(hasOwnProperty.call(o,DontEnums[i]))result.push(DontEnums[i])}}return result}}();
(function(){var oldSetOption=$.ui.resizable.prototype._setOption;$.ui.resizable.prototype._setOption=function(key,value){oldSetOption.apply(this,arguments);if(key==="aspectRatio"){this._aspectRatio=!!value}}})();
(function($,window){var aps=Array.prototype.slice,decode=decodeURIComponent,jq_param=$.param,jq_param_fragment,jq_deparam,jq_deparam_fragment,jq_bbq=$.bbq=$.bbq||{},jq_bbq_pushState,jq_bbq_getState,jq_elemUrlAttr,jq_event_special=$.event.special,str_hashchange="hashchange",str_querystring="querystring",str_fragment="fragment",str_elemUrlAttr="elemUrlAttr",str_location="location",str_href="href",str_src="src",re_trim_querystring=/^.*\?|#.*$/g,re_trim_fragment=/^.*\#/,re_no_escape,elemUrlAttr_cache={};function is_string(arg){return typeof arg==="string"}function curry(func){var args=aps.call(arguments,1);return function(){return func.apply(this,args.concat(aps.call(arguments)))}}function get_fragment(url){return url.replace(/^[^#]*#?(.*)$/,"$1")}function get_querystring(url){return url.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,"$1")}function jq_param_sub(is_fragment,get_func,url,params,merge_mode){var result,qs,matches,url_params,hash;if(params!==undefined){matches=url.match(is_fragment?/^([^#]*)\#?(.*)$/:/^([^#?]*)\??([^#]*)(#?.*)/);hash=matches[3]||"";if(merge_mode===2&&is_string(params)){qs=params.replace(is_fragment?re_trim_fragment:re_trim_querystring,"")}else{url_params=jq_deparam(matches[2]);params=is_string(params)?jq_deparam[is_fragment?str_fragment:str_querystring](params):params;qs=merge_mode===2?params:merge_mode===1?$.extend({},params,url_params):$.extend({},url_params,params);qs=jq_param(qs);if(is_fragment){qs=qs.replace(re_no_escape,decode)}}result=matches[1]+(is_fragment?"#":qs||!matches[1]?"?":"")+qs+hash}else{result=get_func(url!==undefined?url:window[str_location][str_href])}return result}jq_param[str_querystring]=curry(jq_param_sub,0,get_querystring);jq_param[str_fragment]=jq_param_fragment=curry(jq_param_sub,1,get_fragment);jq_param_fragment.noEscape=function(chars){chars=chars||"";var arr=$.map(chars.split(""),encodeURIComponent);re_no_escape=new RegExp(arr.join("|"),"g")};jq_param_fragment.noEscape(",/");$.deparam=jq_deparam=function(params,coerce){var obj={},coerce_types={"true":!0,"false":!1,"null":null};$.each(params.replace(/\+/g," ").split("&"),function(j,v){var param=v.split("="),key=decode(param[0]),val,cur=obj,i=0,keys=key.split("]["),keys_last=keys.length-1;if(/\[/.test(keys[0])&&/\]$/.test(keys[keys_last])){keys[keys_last]=keys[keys_last].replace(/\]$/,"");keys=keys.shift().split("[").concat(keys);keys_last=keys.length-1}else{keys_last=0}if(param.length===2){val=decode(param[1]);if(coerce){val=val&&!isNaN(val)?+val:val==="undefined"?undefined:coerce_types[val]!==undefined?coerce_types[val]:val}if(keys_last){for(;i<=keys_last;i++){key=keys[i]===""?cur.length:keys[i];cur=cur[key]=i<keys_last?cur[key]||(keys[i+1]&&isNaN(keys[i+1])?{}:[]):val}}else{if($.isArray(obj[key])){obj[key].push(val)}else if(obj[key]!==undefined){obj[key]=[obj[key],val]}else{obj[key]=val}}}else if(key){obj[key]=coerce?undefined:""}});return obj};function jq_deparam_sub(is_fragment,url_or_params,coerce){if(url_or_params===undefined||typeof url_or_params==="boolean"){coerce=url_or_params;url_or_params=jq_param[is_fragment?str_fragment:str_querystring]()}else{url_or_params=is_string(url_or_params)?url_or_params.replace(is_fragment?re_trim_fragment:re_trim_querystring,""):url_or_params}return jq_deparam(url_or_params,coerce)}jq_deparam[str_querystring]=curry(jq_deparam_sub,0);jq_deparam[str_fragment]=jq_deparam_fragment=curry(jq_deparam_sub,1);if(!$[str_elemUrlAttr]){$[str_elemUrlAttr]=function(obj){return $.extend(elemUrlAttr_cache,obj)}({a:str_href,base:str_href,iframe:str_src,img:str_src,input:str_src,form:"action",link:str_href,script:str_src})}jq_elemUrlAttr=$[str_elemUrlAttr];function jq_fn_sub(mode,force_attr,params,merge_mode){if(!is_string(params)&&typeof params!=="object"){merge_mode=params;params=force_attr;force_attr=undefined}return this.each(function(){var that=$(this),attr=force_attr||jq_elemUrlAttr()[(this.nodeName||"").toLowerCase()]||"",url=attr&&that.attr(attr)||"";that.attr(attr,jq_param[mode](url,params,merge_mode))})}$.fn[str_querystring]=curry(jq_fn_sub,str_querystring);$.fn[str_fragment]=curry(jq_fn_sub,str_fragment);jq_bbq.pushState=jq_bbq_pushState=function(params,merge_mode){if(is_string(params)&&/^#/.test(params)&&merge_mode===undefined){merge_mode=2}var has_args=params!==undefined,url=jq_param_fragment(window[str_location][str_href],has_args?params:{},has_args?merge_mode:2);window[str_location][str_href]=url+(/#/.test(url)?"":"#")};jq_bbq.getState=jq_bbq_getState=function(key,coerce){return key===undefined||typeof key==="boolean"?jq_deparam_fragment(key):jq_deparam_fragment(coerce)[key]};jq_bbq.removeState=function(arr){var state={};if(arr!==undefined){state=jq_bbq_getState();$.each($.isArray(arr)?arr:arguments,function(i,v){delete state[v]})}jq_bbq_pushState(state,2)};jq_event_special[str_hashchange]=$.extend(jq_event_special[str_hashchange],{add:function(handleObj){var old_handler;function new_handler(e){var hash=e[str_fragment]=jq_param_fragment();e.getState=function(key,coerce){return key===undefined||typeof key==="boolean"?jq_deparam(hash,key):jq_deparam(hash,coerce)[key]};old_handler.apply(this,arguments)}if($.isFunction(handleObj)){old_handler=handleObj;return new_handler}else{old_handler=handleObj.handler;handleObj.handler=new_handler}}})})(jQuery,this);(function($,window,undefined){"$:nomunge";var fake_onhashchange,jq_event_special=$.event.special,str_location="location",str_hashchange="hashchange",str_href="href",browser=$.browser,mode=document.documentMode,is_old_ie=browser.msie&&(mode===undefined||mode<8),supports_onhashchange="on"+str_hashchange in window&&!is_old_ie;function get_fragment(url){url=url||window[str_location][str_href];return url.replace(/^[^#]*#?(.*)$/,"$1")}$[str_hashchange+"Delay"]=100;jq_event_special[str_hashchange]=$.extend(jq_event_special[str_hashchange],{setup:function(){if(supports_onhashchange){return false}$(fake_onhashchange.start)},teardown:function(){if(supports_onhashchange){return false}$(fake_onhashchange.stop)}});fake_onhashchange=function(){var self={},timeout_id,iframe,set_history,get_history;function init(){set_history=get_history=function(val){return val};if(is_old_ie){iframe=$('<iframe src="javascript:0"/>').hide().insertAfter("body")[0].contentWindow;get_history=function(){return get_fragment(iframe.document[str_location][str_href])};set_history=function(hash,history_hash){if(hash!==history_hash){var doc=iframe.document;doc.open().close();doc[str_location].hash="#"+hash}};set_history(get_fragment())}}self.start=function(){if(timeout_id){return}var last_hash=get_fragment();set_history||init();(function loopy(){var hash=get_fragment(),history_hash=get_history(last_hash);if(hash!==last_hash){set_history(last_hash=hash,history_hash);$(window).trigger(str_hashchange)}else if(history_hash!==last_hash){window[str_location][str_href]=window[str_location][str_href].replace(/#.*/,"")+"#"+history_hash}timeout_id=setTimeout(loopy,$[str_hashchange+"Delay"])})()};self.stop=function(){if(!iframe){timeout_id&&clearTimeout(timeout_id);timeout_id=0}};return self}()})(jQuery,this);
(function(factory){if(typeof exports==="object"&&exports&&typeof module==="object"&&module&&module.exports===exports){factory(require("jquery"))}else if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else{factory(jQuery)}})(function($){var _baseDate=_generateBaseDate();var _ONE_DAY=86400;var _lang={am:"am",pm:"pm",AM:"AM",PM:"PM",decimal:".",mins:"mins",hr:"hr",hrs:"hrs"};var methods={init:function(options){return this.each(function(){var self=$(this);var attributeOptions=[];for(var key in $.fn.timepicker.defaults){if(self.data(key)){attributeOptions[key]=self.data(key)}}var settings=$.extend({},$.fn.timepicker.defaults,attributeOptions,options);if(settings.lang){_lang=$.extend(_lang,settings.lang)}settings=_parseSettings(settings);self.data("timepicker-settings",settings);self.addClass("ui-timepicker-input");if(settings.useSelect){_render(self)}else{self.prop("autocomplete","off");self.on("click.timepicker focus.timepicker",methods.show);self.on("change.timepicker",_formatValue);self.on("keydown.timepicker",_keydownhandler);self.on("keyup.timepicker",_keyuphandler);_formatValue.call(self.get(0))}})},show:function(e){var self=$(this);var settings=self.data("timepicker-settings");if(e){if(!settings.showOnFocus){return true}e.preventDefault()}if(settings.useSelect){self.data("timepicker-list").focus();return}if(_hideKeyboard(self)){self.blur()}var list=self.data("timepicker-list");if(self.prop("readonly")){return}if(!list||list.length===0||typeof settings.durationTime==="function"){_render(self);list=self.data("timepicker-list")}if(_isVisible(list)){return}methods.hide();list.show();var listOffset={};if(settings.orientation=="rtl"){listOffset.left=self.offset().left+self.outerWidth()-list.outerWidth()+parseInt(list.css("marginLeft").replace("px",""),10)}else{listOffset.left=self.offset().left+parseInt(list.css("marginLeft").replace("px",""),10)}if(self.offset().top+self.outerHeight(true)+list.outerHeight()>$(window).height()+$(window).scrollTop()){list.addClass("ui-timepicker-positioned-top");listOffset.top=self.offset().top-list.outerHeight()+parseInt(list.css("marginTop").replace("px",""),10)}else{list.removeClass("ui-timepicker-positioned-top");listOffset.top=self.offset().top+self.outerHeight()+parseInt(list.css("marginTop").replace("px",""),10)}list.offset(listOffset);var selected=list.find(".ui-timepicker-selected");if(!selected.length){if(_getTimeValue(self)){selected=_findRow(self,list,_time2int(_getTimeValue(self)))}else if(settings.scrollDefault){selected=_findRow(self,list,settings.scrollDefault)}}if(selected&&selected.length){var topOffset=list.scrollTop()+selected.position().top-selected.outerHeight();list.scrollTop(topOffset)}else{list.scrollTop(0)}$(document).on("touchstart.ui-timepicker mousedown.ui-timepicker",_closeHandler);if(settings.closeOnWindowScroll){$(document).on("scroll.ui-timepicker",_closeHandler)}self.trigger("showTimepicker");return this},hide:function(e){var self=$(this);var settings=self.data("timepicker-settings");if(settings&&settings.useSelect){self.blur()}$(".ui-timepicker-wrapper").each(function(){var list=$(this);if(!_isVisible(list)){return}var self=list.data("timepicker-input");var settings=self.data("timepicker-settings");if(settings&&settings.selectOnBlur){_selectValue(self)}list.hide();self.trigger("hideTimepicker")});return this},option:function(key,value){return this.each(function(){var self=$(this);var settings=self.data("timepicker-settings");var list=self.data("timepicker-list");if(typeof key=="object"){settings=$.extend(settings,key)}else if(typeof key=="string"&&typeof value!="undefined"){settings[key]=value}else if(typeof key=="string"){return settings[key]}settings=_parseSettings(settings);self.data("timepicker-settings",settings);if(list){list.remove();self.data("timepicker-list",false)}if(settings.useSelect){_render(self)}})},getSecondsFromMidnight:function(){return _time2int(_getTimeValue(this))},getTime:function(relative_date){var self=this;var time_string=_getTimeValue(self);if(!time_string){return null}if(!relative_date){relative_date=new Date}var offset=_time2int(time_string);var time=new Date(relative_date);time.setHours(offset/3600);time.setMinutes(offset%3600/60);time.setSeconds(offset%60);time.setMilliseconds(0);return time},setTime:function(value){var self=this;var settings=self.data("timepicker-settings");if(settings.forceRoundTime){var prettyTime=_roundAndFormatTime(value,settings)}else{var prettyTime=_int2time(_time2int(value),settings.timeFormat)}_setTimeValue(self,prettyTime);if(self.data("timepicker-list")){_setSelected(self,self.data("timepicker-list"))}return this},remove:function(){var self=this;if(!self.hasClass("ui-timepicker-input")){return}var settings=self.data("timepicker-settings");self.removeAttr("autocomplete","off");self.removeClass("ui-timepicker-input");self.removeData("timepicker-settings");self.off(".timepicker");if(self.data("timepicker-list")){self.data("timepicker-list").remove()}if(settings.useSelect){self.show()}self.removeData("timepicker-list");return this}};function _isVisible(elem){var el=elem[0];return el.offsetWidth>0&&el.offsetHeight>0}function _parseSettings(settings){if(settings.minTime){settings.minTime=_time2int(settings.minTime)}if(settings.maxTime){settings.maxTime=_time2int(settings.maxTime)}if(settings.durationTime&&typeof settings.durationTime!=="function"){settings.durationTime=_time2int(settings.durationTime)}if(settings.scrollDefault=="now"){settings.scrollDefault=_time2int(new Date)}else if(settings.scrollDefault){settings.scrollDefault=_time2int(settings.scrollDefault)}else if(settings.minTime){settings.scrollDefault=settings.minTime}if(settings.scrollDefault){settings.scrollDefault=_roundTime(settings.scrollDefault,settings)}if($.type(settings.timeFormat)==="string"&&settings.timeFormat.match(/[gh]/)){settings._twelveHourTime=true}if(settings.disableTimeRanges.length>0){for(var i in settings.disableTimeRanges){settings.disableTimeRanges[i]=[_time2int(settings.disableTimeRanges[i][0]),_time2int(settings.disableTimeRanges[i][1])]}settings.disableTimeRanges=settings.disableTimeRanges.sort(function(a,b){return a[0]-b[0]});for(var i=settings.disableTimeRanges.length-1;i>0;i--){if(settings.disableTimeRanges[i][0]<=settings.disableTimeRanges[i-1][1]){settings.disableTimeRanges[i-1]=[Math.min(settings.disableTimeRanges[i][0],settings.disableTimeRanges[i-1][0]),Math.max(settings.disableTimeRanges[i][1],settings.disableTimeRanges[i-1][1])];settings.disableTimeRanges.splice(i,1)}}}return settings}function _render(self){var settings=self.data("timepicker-settings");var list=self.data("timepicker-list");if(list&&list.length){list.remove();self.data("timepicker-list",false)}if(settings.useSelect){list=$("<select />",{"class":"ui-timepicker-select"});var wrapped_list=list}else{list=$("<ul />",{"class":"ui-timepicker-list"});var wrapped_list=$("<div />",{"class":"ui-timepicker-wrapper",tabindex:-1});wrapped_list.css({display:"none",position:"absolute"}).append(list)}if(settings.noneOption){if(settings.noneOption===true){settings.noneOption=settings.useSelect?"Time...":"None"}if($.isArray(settings.noneOption)){for(var i in settings.noneOption){if(parseInt(i,10)==i){var noneElement=_generateNoneElement(settings.noneOption[i],settings.useSelect);list.append(noneElement)}}}else{var noneElement=_generateNoneElement(settings.noneOption,settings.useSelect);list.append(noneElement)}}if(settings.className){wrapped_list.addClass(settings.className)}if((settings.minTime!==null||settings.durationTime!==null)&&settings.showDuration){wrapped_list.addClass("ui-timepicker-with-duration");wrapped_list.addClass("ui-timepicker-step-"+settings.step)}var durStart=settings.minTime;if(typeof settings.durationTime==="function"){durStart=_time2int(settings.durationTime())}else if(settings.durationTime!==null){durStart=settings.durationTime}var start=settings.minTime!==null?settings.minTime:0;var end=settings.maxTime!==null?settings.maxTime:start+_ONE_DAY-1;if(end<=start){end+=_ONE_DAY}if(end===_ONE_DAY-1&&$.type(settings.timeFormat)==="string"&&settings.timeFormat.indexOf("H")!==-1){end=_ONE_DAY}var dr=settings.disableTimeRanges;var drCur=0;var drLen=dr.length;for(var i=start;i<=end;i+=settings.step*60){var timeInt=i;var timeString=_int2time(timeInt,settings.timeFormat);if(settings.useSelect){var row=$("<option />",{value:timeString});row.text(timeString)}else{var row=$("<li />");row.data("time",timeInt<=86400?timeInt:timeInt%86400);row.text(timeString)}if((settings.minTime!==null||settings.durationTime!==null)&&settings.showDuration){var durationString=_int2duration(i-durStart,settings.step);if(settings.useSelect){row.text(row.text()+" ("+durationString+")")}else{var duration=$("<span />",{"class":"ui-timepicker-duration"});duration.text(" ("+durationString+")");row.append(duration)}}if(drCur<drLen){if(timeInt>=dr[drCur][1]){drCur+=1}if(dr[drCur]&&timeInt>=dr[drCur][0]&&timeInt<dr[drCur][1]){if(settings.useSelect){row.prop("disabled",true)}else{row.addClass("ui-timepicker-disabled")}}}list.append(row)}wrapped_list.data("timepicker-input",self);self.data("timepicker-list",wrapped_list);if(settings.useSelect){if(self.val()){list.val(_roundAndFormatTime(self.val(),settings))}list.on("focus",function(){$(this).data("timepicker-input").trigger("showTimepicker")});list.on("blur",function(){$(this).data("timepicker-input").trigger("hideTimepicker")});list.on("change",function(){_setTimeValue(self,$(this).val(),"select")});_setTimeValue(self,list.val());self.hide().after(list)}else{var appendTo=settings.appendTo;if(typeof appendTo==="string"){appendTo=$(appendTo)}else if(typeof appendTo==="function"){appendTo=appendTo(self)}appendTo.append(wrapped_list);_setSelected(self,list);list.on("mousedown","li",function(e){self.off("focus.timepicker");self.on("focus.timepicker-ie-hack",function(){self.off("focus.timepicker-ie-hack");self.on("focus.timepicker",methods.show)});if(!_hideKeyboard(self)){self[0].focus()}list.find("li").removeClass("ui-timepicker-selected");$(this).addClass("ui-timepicker-selected");if(_selectValue(self)){self.trigger("hideTimepicker");wrapped_list.hide()}})}}function _generateNoneElement(optionValue,useSelect){var label,className,value;if(typeof optionValue=="object"){label=optionValue.label;className=optionValue.className;value=optionValue.value}else if(typeof optionValue=="string"){label=optionValue}else{$.error("Invalid noneOption value")}if(useSelect){return $("<option />",{value:value,"class":className,text:label})}else{return $("<li />",{"class":className,text:label}).data("time",value)}}function _roundTime(seconds,settings){if(!$.isNumeric(seconds)){seconds=_time2int(seconds)}if(seconds===null){return null}else{var offset=seconds%(settings.step*60);if(offset>=settings.step*30){seconds+=settings.step*60-offset}else{seconds-=offset}return seconds}}function _roundAndFormatTime(seconds,settings){seconds=_roundTime(seconds,settings);if(seconds!==null){return _int2time(seconds,settings.timeFormat)}}function _generateBaseDate(){return new Date(1970,1,1,0,0,0)}function _closeHandler(e){var target=$(e.target);var input=target.closest(".ui-timepicker-input");if(input.length===0&&target.closest(".ui-timepicker-wrapper").length===0){methods.hide();$(document).unbind(".ui-timepicker")}}function _hideKeyboard(self){var settings=self.data("timepicker-settings");return(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&settings.disableTouchKeyboard}function _findRow(self,list,value){if(!value&&value!==0){return false}var settings=self.data("timepicker-settings");var out=false;var halfStep=settings.step*30;list.find("li").each(function(i,obj){var jObj=$(obj);if(typeof jObj.data("time")!="number"){return}var offset=jObj.data("time")-value;if(Math.abs(offset)<halfStep||offset==halfStep){out=jObj;return false}});return out}function _setSelected(self,list){list.find("li").removeClass("ui-timepicker-selected");var timeValue=_time2int(_getTimeValue(self),self.data("timepicker-settings"));if(timeValue===null){return}var selected=_findRow(self,list,timeValue);if(selected){var topDelta=selected.offset().top-list.offset().top;if(topDelta+selected.outerHeight()>list.outerHeight()||topDelta<0){list.scrollTop(list.scrollTop()+selected.position().top-selected.outerHeight())}selected.addClass("ui-timepicker-selected")}}function _formatValue(e,origin){if(this.value===""||origin=="timepicker"){return}var self=$(this);var list=self.data("timepicker-list");if(self.is(":focus")&&(!e||e.type!="change")){return}var seconds=_time2int(this.value);if(seconds===null){self.trigger("timeFormatError");return}var settings=self.data("timepicker-settings");var rangeError=false;if(settings.minTime!==null&&seconds<settings.minTime){rangeError=true}else if(settings.maxTime!==null&&seconds>settings.maxTime){rangeError=true}$.each(settings.disableTimeRanges,function(){if(seconds>=this[0]&&seconds<this[1]){rangeError=true;return false}});if(settings.forceRoundTime){var offset=seconds%(settings.step*60);if(offset>=settings.step*30){seconds+=settings.step*60-offset}else{seconds-=offset}}var prettyTime=_int2time(seconds,settings.timeFormat);if(rangeError){if(_setTimeValue(self,prettyTime,"error")){self.trigger("timeRangeError")}}else{_setTimeValue(self,prettyTime)}}function _getTimeValue(self){if(self.is("input")){return self.val()}else{return self.data("ui-timepicker-value")}}function _setTimeValue(self,value,source){if(self.is("input")){self.val(value);var settings=self.data("timepicker-settings");if(settings.useSelect&&source!="select"){self.data("timepicker-list").val(_roundAndFormatTime(value,settings))}}if(self.data("ui-timepicker-value")!=value){self.data("ui-timepicker-value",value);if(source=="select"){self.trigger("selectTime").trigger("changeTime").trigger("change","timepicker")}else if(source!="error"){self.trigger("changeTime")}return true}else{self.trigger("selectTime");return false}}function _keydownhandler(e){var self=$(this);var list=self.data("timepicker-list");if(!list||!_isVisible(list)){if(e.keyCode==40){methods.show.call(self.get(0));list=self.data("timepicker-list");if(!_hideKeyboard(self)){self.focus()}}else{return true}}switch(e.keyCode){case 13:if(_selectValue(self)){methods.hide.apply(this)}e.preventDefault();return false;case 38:var selected=list.find(".ui-timepicker-selected");if(!selected.length){list.find("li").each(function(i,obj){if($(obj).position().top>0){selected=$(obj);return false}});selected.addClass("ui-timepicker-selected")}else if(!selected.is(":first-child")){selected.removeClass("ui-timepicker-selected");selected.prev().addClass("ui-timepicker-selected");if(selected.prev().position().top<selected.outerHeight()){list.scrollTop(list.scrollTop()-selected.outerHeight())}}return false;case 40:selected=list.find(".ui-timepicker-selected");if(selected.length===0){list.find("li").each(function(i,obj){if($(obj).position().top>0){selected=$(obj);return false}});selected.addClass("ui-timepicker-selected")}else if(!selected.is(":last-child")){selected.removeClass("ui-timepicker-selected");selected.next().addClass("ui-timepicker-selected");if(selected.next().position().top+2*selected.outerHeight()>list.outerHeight()){list.scrollTop(list.scrollTop()+selected.outerHeight())}}return false;case 27:list.find("li").removeClass("ui-timepicker-selected");methods.hide();break;case 9:methods.hide();break;default:return true}}function _keyuphandler(e){var self=$(this);var list=self.data("timepicker-list");if(!list||!_isVisible(list)){return true}if(!self.data("timepicker-settings").typeaheadHighlight){list.find("li").removeClass("ui-timepicker-selected");return true}switch(e.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:_setSelected(self,list);break;default:return}}function _selectValue(self){var settings=self.data("timepicker-settings");var list=self.data("timepicker-list");var timeValue=null;var cursor=list.find(".ui-timepicker-selected");if(cursor.hasClass("ui-timepicker-disabled")){return false}if(cursor.length){timeValue=cursor.data("time")}if(timeValue!==null){if(typeof timeValue=="string"){self.val(timeValue);self.trigger("selectTime").trigger("changeTime").trigger("change","timepicker")}else{var timeString=_int2time(timeValue,settings.timeFormat);_setTimeValue(self,timeString,"select")}}return true}function _int2duration(seconds,step){seconds=Math.abs(seconds);var minutes=Math.round(seconds/60),duration=[],hours,mins;if(minutes<60){duration=[minutes,_lang.mins]}else{hours=Math.floor(minutes/60);mins=minutes%60;if(step==30&&mins==30){hours+=_lang.decimal+5}duration.push(hours);duration.push(hours==1?_lang.hr:_lang.hrs);if(step!=30&&mins){duration.push(mins);duration.push(_lang.mins)}}return duration.join(" ")}function _int2time(seconds,format){if(seconds===null){return}var time=new Date(_baseDate.valueOf()+seconds*1e3);if(isNaN(time.getTime())){return}if($.type(format)==="function"){return format(time)}var output="";var hour,code;for(var i=0;i<format.length;i++){code=format.charAt(i);switch(code){case"a":output+=time.getHours()>11?_lang.pm:_lang.am;break;case"A":output+=time.getHours()>11?_lang.pm.toUpperCase():_lang.am.toUpperCase();break;case"g":hour=time.getHours()%12;output+=hour===0?"12":hour;break;case"G":output+=time.getHours();break;case"h":hour=time.getHours()%12;if(hour!==0&&hour<10){hour="0"+hour}output+=hour===0?"12":hour;break;case"H":hour=time.getHours();if(seconds===_ONE_DAY)hour=24;output+=hour>9?hour:"0"+hour;break;case"i":var minutes=time.getMinutes();output+=minutes>9?minutes:"0"+minutes;break;case"s":seconds=time.getSeconds();output+=seconds>9?seconds:"0"+seconds;break;case"\\":i++;output+=format.charAt(i);break;default:output+=code}}return output}function _time2int(timeString,settings){if(timeString==="")return null;if(!timeString||timeString+0==timeString)return timeString;if(typeof timeString=="object"){return timeString.getHours()*3600+timeString.getMinutes()*60+timeString.getSeconds()}timeString=timeString.toLowerCase();if(timeString.slice(-1)=="a"||timeString.slice(-1)=="p"){timeString+="m"}var pattern=new RegExp("^([0-2]?[0-9])\\W?([0-5][0-9])?\\W?([0-5][0-9])?\\s*("+_lang.am+"|"+_lang.pm+")?$");var time=timeString.match(pattern);if(!time){return null}var hour=parseInt(time[1]*1,10);var ampm=time[4];var hours=hour;if(hour<=12&&ampm){if(hour==12){hours=time[4]==_lang.pm?12:0}else{hours=hour+(time[4]==_lang.pm?12:0)}}var minutes=time[2]*1||0;var seconds=time[3]*1||0;var timeInt=hours*3600+minutes*60+seconds;if(!ampm&&settings&&settings._twelveHourTime&&settings.scrollDefault){var delta=timeInt-settings.scrollDefault;if(delta<0&&delta>=_ONE_DAY/-2){timeInt=(timeInt+_ONE_DAY/2)%_ONE_DAY}}return timeInt}function _pad2(n){return("0"+n).slice(-2)}$.fn.timepicker=function(method){if(!this.length)return this;if(methods[method]){if(!this.hasClass("ui-timepicker-input")){return this}return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.timepicker")}};$.fn.timepicker.defaults={className:null,minTime:null,maxTime:null,durationTime:null,step:30,showDuration:false,showOnFocus:true,timeFormat:"g:ia",scrollDefault:null,selectOnBlur:false,disableTouchKeyboard:false,forceRoundTime:false,appendTo:"body",orientation:"ltr",disableTimeRanges:[],closeOnWindowScroll:false,typeaheadHighlight:true,noneOption:false}});
(function($){$.fn.menuAim=function(opts){this.each(function(){init.call(this,opts)});return this};function init(opts){var $menu=$(this),activeRow=null,mouseLocs=[],lastDelayLoc=null,timeoutId=null,options=$.extend({rowSelector:"> li",submenuSelector:"*",submenuDirection:"right",tolerance:75,enter:$.noop,exit:$.noop,activate:$.noop,deactivate:$.noop,exitMenu:$.noop},opts);var MOUSE_LOCS_TRACKED=3,DELAY=300;var mousemoveDocument=function(e){mouseLocs.push({x:e.pageX,y:e.pageY});if(mouseLocs.length>MOUSE_LOCS_TRACKED){mouseLocs.shift()}};var mouseleaveMenu=function(){if(timeoutId){clearTimeout(timeoutId)}if(options.exitMenu(this)){if(activeRow){options.deactivate(activeRow)}activeRow=null}};var mouseenterRow=function(){if(timeoutId){clearTimeout(timeoutId)}options.enter(this);possiblyActivate(this)},mouseleaveRow=function(){options.exit(this)};var clickRow=function(){activate(this)};var activate=function(row){if(row==activeRow){return}if(activeRow){options.deactivate(activeRow)}options.activate(row);activeRow=row};var possiblyActivate=function(row){var delay=activationDelay();if(delay){timeoutId=setTimeout(function(){possiblyActivate(row)},delay)}else{activate(row)}};var activationDelay=function(){if(!activeRow||!$(activeRow).is(options.submenuSelector)){return 0}var offset=$menu.offset(),upperLeft={x:offset.left,y:offset.top-options.tolerance},upperRight={x:offset.left+$menu.outerWidth(),y:upperLeft.y},lowerLeft={x:offset.left,y:offset.top+$menu.outerHeight()+options.tolerance},lowerRight={x:offset.left+$menu.outerWidth(),y:lowerLeft.y},loc=mouseLocs[mouseLocs.length-1],prevLoc=mouseLocs[0];if(!loc){return 0}if(!prevLoc){prevLoc=loc}if(prevLoc.x<offset.left||prevLoc.x>lowerRight.x||prevLoc.y<offset.top||prevLoc.y>lowerRight.y){return 0}if(lastDelayLoc&&loc.x==lastDelayLoc.x&&loc.y==lastDelayLoc.y){return 0}function slope(a,b){return(b.y-a.y)/(b.x-a.x)}var decreasingCorner=upperRight,increasingCorner=lowerRight;if(options.submenuDirection=="left"){decreasingCorner=lowerLeft;increasingCorner=upperLeft}else if(options.submenuDirection=="below"){decreasingCorner=lowerRight;increasingCorner=lowerLeft}else if(options.submenuDirection=="above"){decreasingCorner=upperLeft;increasingCorner=upperRight}var decreasingSlope=slope(loc,decreasingCorner),increasingSlope=slope(loc,increasingCorner),prevDecreasingSlope=slope(prevLoc,decreasingCorner),prevIncreasingSlope=slope(prevLoc,increasingCorner);if(decreasingSlope<prevDecreasingSlope&&increasingSlope>prevIncreasingSlope){lastDelayLoc=loc;return DELAY}lastDelayLoc=null;return 0};$menu.mouseleave(mouseleaveMenu).find(options.rowSelector).mouseenter(mouseenterRow).mouseleave(mouseleaveRow).click(clickRow);$(document).mousemove(mousemoveDocument)}})(jQuery);
(function($){$.tools=$.tools||{version:"@VERSION"};var tool;tool=$.tools.rangeinput={conf:{min:0,max:100,step:"any",steps:0,value:0,precision:undefined,vertical:0,keyboard:true,progress:false,speed:100,css:{input:"range",slider:"slider",progress:"progress",handle:"handle"}}};var doc,draggable;$.fn.drag=function(conf){conf=$.extend({x:true,y:true,drag:true},conf);doc=doc||$(document).on("mousedown mouseup",function(e){var el=$(e.target);if(e.type=="mousedown"&&el.data("drag")){var offset=el.position(),x0=e.pageX-offset.left,y0=e.pageY-offset.top,start=true;doc.on("mousemove.drag",function(e){var x=e.pageX-x0,y=e.pageY-y0,props={};if(conf.x){props.left=x}if(conf.y){props.top=y}if(start){el.trigger("dragStart");start=false}if(conf.drag){el.css(props)}el.trigger("drag",[y,x]);draggable=el});e.preventDefault()}else{try{if(draggable){draggable.trigger("dragEnd")}}finally{doc.off("mousemove.drag");draggable=null}}});return this.data("drag",true)};function round(value,precision){var n=Math.pow(10,precision);return Math.round(value*n)/n}function dim(el,key){var v=parseInt(el.css(key),10);if(v){return v}var s=el[0].currentStyle;return s&&s.width&&parseInt(s.width,10)}function hasEvent(el){var e=el.data("events");return e&&e.onSlide}function RangeInput(input,conf){var self=this,css=conf.css,root=$("<div><div/><a href='#'/></div>").data("rangeinput",self),vertical,value,origo,len,pos;input.before(root);var handle=root.addClass(css.slider).find("a").addClass(css.handle),progress=root.find("div").addClass(css.progress);$.each("min,max,step,value".split(","),function(i,key){var val=input.attr(key);if(parseFloat(val)){conf[key]=parseFloat(val,10)}});var range=conf.max-conf.min,step=conf.step=="any"?0:conf.step,precision=conf.precision;if(precision===undefined){precision=step.toString().split(".");precision=precision.length===2?precision[1].length:0}if(input.attr("type")=="range"){var def=input.clone().wrap("<div/>").parent().html(),clone=$(def.replace(/type/i,"type=text data-orig-type"));clone.val(conf.value);input.replaceWith(clone);input=clone}input.addClass(css.input);var fire=$(self).add(input),fireOnSlide=true;function slide(evt,x,val,isSetValue){if(val===undefined){val=x/len*range}else if(isSetValue){val-=conf.min}if(step){val=Math.round(val/step)*step}if(x===undefined||step){x=val*len/range}if(isNaN(val)){return self}x=Math.max(0,Math.min(x,len));val=x/len*range;if(isSetValue||!vertical){val+=conf.min}if(vertical){if(isSetValue){x=len-x}else{val=conf.max-val}}val=round(val,precision);var isClick=evt.type=="click";if(fireOnSlide&&value!==undefined&&!isClick){evt.type="onSlide";fire.trigger(evt,[val,x]);if(evt.isDefaultPrevented()){return self}}var speed=isClick?conf.speed:0,callback=isClick?function(){evt.type="change";fire.trigger(evt,[val])}:null;if(vertical){handle.animate({top:x},speed,callback);if(conf.progress){progress.animate({height:len-x+handle.height()/2},speed)}}else{handle.animate({left:x},speed,callback);if(conf.progress){progress.animate({width:x+handle.width()/2},speed)}}value=val;pos=x;input.val(val);return self}$.extend(self,{getValue:function(){return value},setValue:function(val,e){init();return slide(e||$.Event("api"),undefined,val,true)},getConf:function(){return conf},getProgress:function(){return progress},getHandle:function(){return handle},getInput:function(){return input},step:function(am,e){e=e||$.Event();var step=conf.step=="any"?1:conf.step;self.setValue(value+step*(am||1),e)},stepUp:function(am){return self.step(am||1)},stepDown:function(am){return self.step(-am||-1)}});$.each("onSlide,change".split(","),function(i,name){if($.isFunction(conf[name])){$(self).on(name,conf[name])}self[name]=function(fn){if(fn){$(self).on(name,fn)}return self}});handle.drag({drag:false}).on("dragStart",function(){init();fireOnSlide=hasEvent($(self))||hasEvent(input)}).on("drag",function(e,y,x){if(input.is(":disabled")){return false}slide(e,vertical?y:x)}).on("dragEnd",function(e){if(!e.isDefaultPrevented()){e.type="change";fire.trigger(e,[value])}}).click(function(e){return e.preventDefault()});root.click(function(e){if(input.is(":disabled")||e.target==handle[0]){return e.preventDefault()}init();var fix=vertical?handle.height()/2:handle.width()/2;slide(e,vertical?len-origo-fix+e.pageY:e.pageX-origo-fix)});if(conf.keyboard){input.keydown(function(e){if(input.attr("readonly")){return}var key=e.keyCode,up=$([75,76,38,33,39]).index(key)!=-1,down=$([74,72,40,34,37]).index(key)!=-1;if((up||down)&&!(e.shiftKey||e.altKey||e.ctrlKey)){if(up){self.step(key==33?10:1,e)}else if(down){self.step(key==34?-10:-1,e)}return e.preventDefault()}})}input.blur(function(e){var val=$(this).val();if(val!==value){self.setValue(val,e)}});$.extend(input[0],{stepUp:self.stepUp,stepDown:self.stepDown});function init(){vertical=conf.vertical||dim(root,"height")>dim(root,"width");if(vertical){len=dim(root,"height")-dim(handle,"height");origo=root.offset().top+len}else{len=dim(root,"width")-dim(handle,"width");origo=root.offset().left}}function begin(){init();self.setValue(conf.value!==undefined?conf.value:conf.min)}begin();if(!len){$(window).load(begin)}}$.expr[":"].range=function(el){var type=el.getAttribute("type");return type&&type=="range"||!!$(el).filter("input").data("rangeinput")};$.fn.rangeinput=function(conf){if(this.data("rangeinput")){return this}conf=$.extend(true,{},tool.conf,conf);var els;this.each(function(){var el=new RangeInput($(this),$.extend(true,{},conf));var input=el.getInput().data("rangeinput",el);els=els?els.add(input):input});return els?els:this}})(jQuery);
(function($){var history_handle_top,timer,body,jwindow=$(window),styling={jqueryui:{container:"ui-widget ui-widget-content ui-corner-all",notice:"ui-state-highlight",notice_icon:"ui-icon ui-icon-info",info:"",info_icon:"ui-icon ui-icon-info",success:"ui-state-default",success_icon:"ui-icon ui-icon-circle-check",error:"ui-state-error",error_icon:"ui-icon ui-icon-alert",closer:"ui-icon ui-icon-close",pin_up:"ui-icon ui-icon-pin-w",pin_down:"ui-icon ui-icon-pin-s",hi_menu:"ui-state-default ui-corner-bottom",hi_btn:"ui-state-default ui-corner-all",hi_btnhov:"ui-state-hover",hi_hnd:"ui-icon ui-icon-grip-dotted-horizontal"},bootstrap:{container:"alert",notice:"",notice_icon:"icon-exclamation-sign",info:"alert-info",info_icon:"icon-info-sign",success:"alert-success",success_icon:"icon-ok-sign",error:"alert-error",error_icon:"icon-warning-sign",closer:"icon-remove",pin_up:"icon-pause",pin_down:"icon-play",hi_menu:"well",hi_btn:"btn",hi_btnhov:"",hi_hnd:"icon-chevron-down"}};var do_when_ready=function(){body=$("body");jwindow=$(window);jwindow.bind("resize",function(){if(timer)clearTimeout(timer);timer=setTimeout($.pnotify_position_all,10)})};if(document.body)do_when_ready();else $(do_when_ready);$.extend({pnotify_remove_all:function(){var notices_data=jwindow.data("pnotify");if(notices_data&&notices_data.length){$.each(notices_data,function(){if(this.pnotify_remove)this.pnotify_remove()})}},pnotify_position_all:function(){if(timer)clearTimeout(timer);timer=null;var notices_data=jwindow.data("pnotify");if(!notices_data||!notices_data.length)return;$.each(notices_data,function(){var s=this.opts.stack;if(!s)return;s.nextpos1=s.firstpos1;s.nextpos2=s.firstpos2;s.addpos2=0;s.animation=true});$.each(notices_data,function(){this.pnotify_position()})},pnotify:function(options){var animating;var opts;if(typeof options!="object"){opts=$.extend({},$.pnotify.defaults);opts.text=options}else{opts=$.extend({},$.pnotify.defaults,options)}for(var i in opts){if(typeof i=="string"&&i.match(/^pnotify_/))opts[i.replace(/^pnotify_/,"")]=opts[i]}if(opts.before_init){if(opts.before_init(opts)===false)return null}var nonblock_last_elem;var nonblock_pass=function(e,e_name){pnotify.css("display","none");var element_below=document.elementFromPoint(e.clientX,e.clientY);pnotify.css("display","block");var jelement_below=$(element_below);var cursor_style=jelement_below.css("cursor");pnotify.css("cursor",cursor_style!="auto"?cursor_style:"default");if(!nonblock_last_elem||nonblock_last_elem.get(0)!=element_below){if(nonblock_last_elem){dom_event.call(nonblock_last_elem.get(0),"mouseleave",e.originalEvent);dom_event.call(nonblock_last_elem.get(0),"mouseout",e.originalEvent)}dom_event.call(element_below,"mouseenter",e.originalEvent);dom_event.call(element_below,"mouseover",e.originalEvent)}dom_event.call(element_below,e_name,e.originalEvent);nonblock_last_elem=jelement_below};var styles=styling[opts.styling];var pnotify=$("<div />",{"class":"ui-pnotify "+opts.addclass,css:{display:"none"},mouseenter:function(e){if(opts.nonblock)e.stopPropagation();if(opts.mouse_reset&&animating=="out"){pnotify.stop(true);animating="in";pnotify.css("height","auto").animate({width:opts.width,opacity:opts.nonblock?opts.nonblock_opacity:opts.opacity},"fast")}if(opts.nonblock){pnotify.animate({opacity:opts.nonblock_opacity},"fast")}if(opts.hide&&opts.mouse_reset)pnotify.pnotify_cancel_remove();if(opts.sticker&&!opts.nonblock)pnotify.sticker.trigger("pnotify_icon").css("visibility","visible");if(opts.closer&&!opts.nonblock)pnotify.closer.css("visibility","visible")},mouseleave:function(e){if(opts.nonblock)e.stopPropagation();nonblock_last_elem=null;pnotify.css("cursor","auto");if(opts.nonblock&&animating!="out")pnotify.animate({opacity:opts.opacity},"fast");if(opts.hide&&opts.mouse_reset)pnotify.pnotify_queue_remove();if(opts.sticker_hover)pnotify.sticker.css("visibility","hidden");if(opts.closer_hover)pnotify.closer.css("visibility","hidden");$.pnotify_position_all()},mouseover:function(e){if(opts.nonblock)e.stopPropagation()},mouseout:function(e){if(opts.nonblock)e.stopPropagation()},mousemove:function(e){if(opts.nonblock){e.stopPropagation();nonblock_pass(e,"onmousemove")}},mousedown:function(e){if(opts.nonblock){e.stopPropagation();e.preventDefault();nonblock_pass(e,"onmousedown")}},mouseup:function(e){if(opts.nonblock){e.stopPropagation();e.preventDefault();nonblock_pass(e,"onmouseup")}},click:function(e){if(opts.nonblock){e.stopPropagation();nonblock_pass(e,"onclick")}},dblclick:function(e){if(opts.nonblock){e.stopPropagation();nonblock_pass(e,"ondblclick")}}});pnotify.opts=opts;pnotify.container=$("<div />",{"class":styles.container+" ui-pnotify-container "+(opts.type=="error"?styles.error:opts.type=="info"?styles.info:opts.type=="success"?styles.success:styles.notice)}).appendTo(pnotify);if(opts.cornerclass!="")pnotify.container.removeClass("ui-corner-all").addClass(opts.cornerclass);if(opts.shadow)pnotify.container.addClass("ui-pnotify-shadow");pnotify.pnotify_version="1.2.0";pnotify.pnotify=function(options){var old_opts=opts;if(typeof options=="string")opts.text=options;else opts=$.extend({},opts,options);for(var i in opts){if(typeof i=="string"&&i.match(/^pnotify_/))opts[i.replace(/^pnotify_/,"")]=opts[i]}pnotify.opts=opts;if(opts.cornerclass!=old_opts.cornerclass)pnotify.container.removeClass("ui-corner-all").addClass(opts.cornerclass);if(opts.shadow!=old_opts.shadow){if(opts.shadow)pnotify.container.addClass("ui-pnotify-shadow");else pnotify.container.removeClass("ui-pnotify-shadow")}if(opts.addclass===false)pnotify.removeClass(old_opts.addclass);else if(opts.addclass!==old_opts.addclass)pnotify.removeClass(old_opts.addclass).addClass(opts.addclass);if(opts.title===false)pnotify.title_container.slideUp("fast");else if(opts.title!==old_opts.title){if(opts.title_escape)pnotify.title_container.text(opts.title).slideDown(200);else pnotify.title_container.html(opts.title).slideDown(200)}if(opts.text===false){pnotify.text_container.slideUp("fast")}else if(opts.text!==old_opts.text){if(opts.text_escape)pnotify.text_container.text(opts.text).slideDown(200);else pnotify.text_container.html(opts.insert_brs?String(opts.text).replace(/\n/g,"<br />"):opts.text).slideDown(200)}pnotify.pnotify_history=opts.history;pnotify.pnotify_hide=opts.hide;if(opts.type!=old_opts.type)pnotify.container.removeClass(styles.error+" "+styles.notice+" "+styles.success+" "+styles.info).addClass(opts.type=="error"?styles.error:opts.type=="info"?styles.info:opts.type=="success"?styles.success:styles.notice);if(opts.icon!==old_opts.icon||opts.icon===true&&opts.type!=old_opts.type){pnotify.container.find("div.ui-pnotify-icon").remove();if(opts.icon!==false){$("<div />",{"class":"ui-pnotify-icon"}).append($("<span />",{"class":opts.icon===true?opts.type=="error"?styles.error_icon:opts.type=="info"?styles.info_icon:opts.type=="success"?styles.success_icon:styles.notice_icon:opts.icon})).prependTo(pnotify.container)}}if(opts.width!==old_opts.width)pnotify.animate({width:opts.width});if(opts.min_height!==old_opts.min_height)pnotify.container.animate({minHeight:opts.min_height});if(opts.opacity!==old_opts.opacity)pnotify.fadeTo(opts.animate_speed,opts.opacity);if(!opts.closer||opts.nonblock)pnotify.closer.css("display","none");else pnotify.closer.css("display","block");if(!opts.sticker||opts.nonblock)pnotify.sticker.css("display","none");else pnotify.sticker.css("display","block");pnotify.sticker.trigger("pnotify_icon");if(opts.sticker_hover)pnotify.sticker.css("visibility","hidden");else if(!opts.nonblock)pnotify.sticker.css("visibility","visible");if(opts.closer_hover)pnotify.closer.css("visibility","hidden");else if(!opts.nonblock)pnotify.closer.css("visibility","visible");if(!opts.hide)pnotify.pnotify_cancel_remove();else if(!old_opts.hide)pnotify.pnotify_queue_remove();pnotify.pnotify_queue_position();return pnotify};pnotify.pnotify_position=function(dont_skip_hidden){var s=pnotify.opts.stack;if(!s)return;if(!s.nextpos1)s.nextpos1=s.firstpos1;if(!s.nextpos2)s.nextpos2=s.firstpos2;if(!s.addpos2)s.addpos2=0;var hidden=pnotify.css("display")=="none";if(!hidden||dont_skip_hidden){var curpos1,curpos2;var animate={};var csspos1;switch(s.dir1){case"down":csspos1="top";break;case"up":csspos1="bottom";break;case"left":csspos1="right";break;case"right":csspos1="left";break}curpos1=parseInt(pnotify.css(csspos1));if(isNaN(curpos1))curpos1=0;if(typeof s.firstpos1=="undefined"&&!hidden){s.firstpos1=curpos1;s.nextpos1=s.firstpos1}var csspos2;switch(s.dir2){case"down":csspos2="top";break;case"up":csspos2="bottom";break;case"left":csspos2="right";break;case"right":csspos2="left";break}curpos2=parseInt(pnotify.css(csspos2));if(isNaN(curpos2))curpos2=0;if(typeof s.firstpos2=="undefined"&&!hidden){s.firstpos2=curpos2;s.nextpos2=s.firstpos2}if(s.dir1=="down"&&s.nextpos1+pnotify.height()>jwindow.height()||s.dir1=="up"&&s.nextpos1+pnotify.height()>jwindow.height()||s.dir1=="left"&&s.nextpos1+pnotify.width()>jwindow.width()||s.dir1=="right"&&s.nextpos1+pnotify.width()>jwindow.width()){s.nextpos1=s.firstpos1;s.nextpos2+=s.addpos2+(typeof s.spacing2=="undefined"?25:s.spacing2);s.addpos2=0}if(s.animation&&s.nextpos2<curpos2){switch(s.dir2){case"down":animate.top=s.nextpos2+"px";break;case"up":animate.bottom=s.nextpos2+"px";break;case"left":animate.right=s.nextpos2+"px";break;case"right":animate.left=s.nextpos2+"px";break}}else pnotify.css(csspos2,s.nextpos2+"px");switch(s.dir2){case"down":case"up":if(pnotify.outerHeight(true)>s.addpos2)s.addpos2=pnotify.height();break;case"left":case"right":if(pnotify.outerWidth(true)>s.addpos2)s.addpos2=pnotify.width();break}if(s.nextpos1){if(s.animation&&(curpos1>s.nextpos1||animate.top||animate.bottom||animate.right||animate.left)){switch(s.dir1){case"down":animate.top=s.nextpos1+"px";break;case"up":animate.bottom=s.nextpos1+"px";break;case"left":animate.right=s.nextpos1+"px";break;case"right":animate.left=s.nextpos1+"px";break}}else pnotify.css(csspos1,s.nextpos1+"px")}if(animate.top||animate.bottom||animate.right||animate.left)pnotify.animate(animate,{duration:500,queue:false});switch(s.dir1){case"down":case"up":s.nextpos1+=pnotify.height()+(typeof s.spacing1=="undefined"?25:s.spacing1);break;case"left":case"right":s.nextpos1+=pnotify.width()+(typeof s.spacing1=="undefined"?25:s.spacing1);break}}};pnotify.pnotify_queue_position=function(milliseconds){if(timer)clearTimeout(timer);if(!milliseconds)milliseconds=10;timer=setTimeout($.pnotify_position_all,milliseconds)};pnotify.pnotify_display=function(){if(!pnotify.parent().length)pnotify.appendTo(body);if(opts.before_open){if(opts.before_open(pnotify)===false)return}if(opts.stack.push!="top")pnotify.pnotify_position(true);if(opts.animation=="fade"||opts.animation.effect_in=="fade"){pnotify.show().fadeTo(0,0).hide()}else{if(opts.opacity!=1)pnotify.show().fadeTo(0,opts.opacity).hide()}pnotify.animate_in(function(){if(opts.after_open)opts.after_open(pnotify);pnotify.pnotify_queue_position();if(opts.hide)pnotify.pnotify_queue_remove()})};pnotify.pnotify_remove=function(){if(pnotify.timer){window.clearTimeout(pnotify.timer);pnotify.timer=null}if(opts.before_close){if(opts.before_close(pnotify)===false)return}pnotify.animate_out(function(){if(opts.after_close){if(opts.after_close(pnotify)===false)return}pnotify.pnotify_queue_position();if(opts.remove)pnotify.detach()})};pnotify.animate_in=function(callback){animating="in";var animation;if(typeof opts.animation.effect_in!="undefined")animation=opts.animation.effect_in;else animation=opts.animation;if(animation=="none"){pnotify.show();callback()}else if(animation=="show")pnotify.show(opts.animate_speed,callback);else if(animation=="fade")pnotify.show().fadeTo(opts.animate_speed,opts.opacity,callback);else if(animation=="slide")pnotify.slideDown(opts.animate_speed,callback);else if(typeof animation=="function")animation("in",callback,pnotify);else pnotify.show(animation,typeof opts.animation.options_in=="object"?opts.animation.options_in:{},opts.animate_speed,callback)};pnotify.animate_out=function(callback){animating="out";var animation;if(typeof opts.animation.effect_out!="undefined")animation=opts.animation.effect_out;else animation=opts.animation;if(animation=="none"){pnotify.hide();callback()}else if(animation=="show")pnotify.hide(opts.animate_speed,callback);else if(animation=="fade")pnotify.fadeOut(opts.animate_speed,callback);else if(animation=="slide")pnotify.slideUp(opts.animate_speed,callback);else if(typeof animation=="function")animation("out",callback,pnotify);else pnotify.hide(animation,typeof opts.animation.options_out=="object"?opts.animation.options_out:{},opts.animate_speed,callback)};pnotify.pnotify_cancel_remove=function(){if(pnotify.timer)window.clearTimeout(pnotify.timer)};pnotify.pnotify_queue_remove=function(){pnotify.pnotify_cancel_remove();pnotify.timer=window.setTimeout(function(){pnotify.pnotify_remove()},isNaN(opts.delay)?0:opts.delay)};pnotify.closer=$("<div />",{"class":"ui-pnotify-closer",css:{cursor:"pointer",visibility:opts.closer_hover?"hidden":"visible"},click:function(){pnotify.pnotify_remove();pnotify.sticker.css("visibility","hidden");pnotify.closer.css("visibility","hidden")}}).append($("<span />",{"class":styles.closer})).appendTo(pnotify.container);if(!opts.closer||opts.nonblock)pnotify.closer.css("display","none");pnotify.sticker=$("<div />",{"class":"ui-pnotify-sticker",css:{cursor:"pointer",visibility:opts.sticker_hover?"hidden":"visible"},click:function(){opts.hide=!opts.hide;if(opts.hide)pnotify.pnotify_queue_remove();else pnotify.pnotify_cancel_remove();$(this).trigger("pnotify_icon")}}).bind("pnotify_icon",function(){$(this).children().removeClass(styles.pin_up+" "+styles.pin_down).addClass(opts.hide?styles.pin_up:styles.pin_down)}).append($("<span />",{"class":styles.pin_up})).appendTo(pnotify.container);if(!opts.sticker||opts.nonblock)pnotify.sticker.css("display","none");if(opts.icon!==false){$("<div />",{"class":"ui-pnotify-icon"}).append($("<span />",{"class":opts.icon===true?opts.type=="error"?styles.error_icon:opts.type=="info"?styles.info_icon:opts.type=="success"?styles.success_icon:styles.notice_icon:opts.icon})).prependTo(pnotify.container)}pnotify.title_container=$("<h4 />",{"class":"ui-pnotify-title"}).appendTo(pnotify.container);if(opts.title===false)pnotify.title_container.hide();else if(opts.title_escape)pnotify.title_container.text(opts.title);else pnotify.title_container.html(opts.title);pnotify.text_container=$("<div />",{"class":"ui-pnotify-text"}).appendTo(pnotify.container);if(opts.text===false)pnotify.text_container.hide();else if(opts.text_escape)pnotify.text_container.text(opts.text);else pnotify.text_container.html(opts.insert_brs?String(opts.text).replace(/\n/g,"<br />"):opts.text);if(typeof opts.width=="string")pnotify.css("width",opts.width);if(typeof opts.min_height=="string")pnotify.container.css("min-height",opts.min_height);pnotify.pnotify_history=opts.history;pnotify.pnotify_hide=opts.hide;var notices_data=jwindow.data("pnotify");if(notices_data==null||typeof notices_data!="object")notices_data=[];if(opts.stack.push=="top")notices_data=$.merge([pnotify],notices_data);else notices_data=$.merge(notices_data,[pnotify]);jwindow.data("pnotify",notices_data);if(opts.stack.push=="top")pnotify.pnotify_queue_position(1);if(opts.after_init)opts.after_init(pnotify);if(opts.history){var history_menu=jwindow.data("pnotify_history");if(typeof history_menu=="undefined"){history_menu=$("<div />",{"class":"ui-pnotify-history-container "+styles.hi_menu,mouseleave:function(){history_menu.animate({top:"-"+history_handle_top+"px"},{duration:100,queue:false})}}).append($("<div />",{"class":"ui-pnotify-history-header",text:"Redisplay"})).append($("<button />",{"class":"ui-pnotify-history-all "+styles.hi_btn,text:"All",mouseenter:function(){$(this).addClass(styles.hi_btnhov)},mouseleave:function(){$(this).removeClass(styles.hi_btnhov)},click:function(){$.each(notices_data,function(){if(this.pnotify_history){if(this.is(":visible")){if(this.pnotify_hide)this.pnotify_queue_remove()}else if(this.pnotify_display)this.pnotify_display()}});return false}})).append($("<button />",{"class":"ui-pnotify-history-last "+styles.hi_btn,text:"Last",mouseenter:function(){$(this).addClass(styles.hi_btnhov)},mouseleave:function(){$(this).removeClass(styles.hi_btnhov)},click:function(){var i=-1;var notice;do{if(i==-1)notice=notices_data.slice(i);else notice=notices_data.slice(i,i+1);if(!notice[0])break;i--}while(!notice[0].pnotify_history||notice[0].is(":visible"));if(!notice[0])return false;if(notice[0].pnotify_display)notice[0].pnotify_display();return false}})).appendTo(body);var handle=$("<span />",{"class":"ui-pnotify-history-pulldown "+styles.hi_hnd,mouseenter:function(){history_menu.animate({top:"0"},{duration:100,queue:false})}}).appendTo(history_menu);history_handle_top=handle.offset().top+2;history_menu.css({top:"-"+history_handle_top+"px"});jwindow.data("pnotify_history",history_menu)}}opts.stack.animation=false;pnotify.pnotify_display();return pnotify}});var re_on=/^on/,re_mouse_events=/^(dbl)?click$|^mouse(move|down|up|over|out|enter|leave)$|^contextmenu$/,re_ui_events=/^(focus|blur|select|change|reset)$|^key(press|down|up)$/,re_html_events=/^(scroll|resize|(un)?load|abort|error)$/;var dom_event=function(e,orig_e){var event_object;e=e.toLowerCase();if(document.createEvent&&this.dispatchEvent){e=e.replace(re_on,"");if(e.match(re_mouse_events)){$(this).offset();event_object=document.createEvent("MouseEvents");event_object.initMouseEvent(e,orig_e.bubbles,orig_e.cancelable,orig_e.view,orig_e.detail,orig_e.screenX,orig_e.screenY,orig_e.clientX,orig_e.clientY,orig_e.ctrlKey,orig_e.altKey,orig_e.shiftKey,orig_e.metaKey,orig_e.button,orig_e.relatedTarget)}else if(e.match(re_ui_events)){event_object=document.createEvent("UIEvents");event_object.initUIEvent(e,orig_e.bubbles,orig_e.cancelable,orig_e.view,orig_e.detail)}else if(e.match(re_html_events)){event_object=document.createEvent("HTMLEvents");event_object.initEvent(e,orig_e.bubbles,orig_e.cancelable)}if(!event_object)return;this.dispatchEvent(event_object)}else{if(!e.match(re_on))e="on"+e;event_object=document.createEventObject(orig_e);this.fireEvent(e,event_object)}};$.pnotify.defaults={title:false,title_escape:false,text:false,text_escape:false,styling:"bootstrap",addclass:"",cornerclass:"",nonblock:false,nonblock_opacity:.2,history:true,width:"300px",min_height:"16px",type:"notice",icon:true,animation:"fade",animate_speed:"slow",opacity:1,shadow:true,closer:true,closer_hover:true,sticker:true,sticker_hover:true,hide:true,delay:8e3,mouse_reset:true,remove:true,insert_brs:true,stack:{dir1:"down",dir2:"left",push:"bottom",spacing1:25,spacing2:25}}})(jQuery);
(function($,document,undefined){var pluses=/\+/g;function raw(s){return s}function decoded(s){return decodeURIComponent(s.replace(pluses," "))}var config=$.cookie=function(key,value,options){if(value!==undefined){options=$.extend({},config.defaults,options);if(value===null){options.expires=-1}if(typeof options.expires==="number"){var days=options.expires,t=options.expires=new Date;t.setDate(t.getDate()+days)}value=config.json?JSON.stringify(value):String(value);return document.cookie=[encodeURIComponent(key),"=",config.raw?value:encodeURIComponent(value),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}var decode=config.raw?raw:decoded;var cookies=document.cookie.split("; ");for(var i=0,parts;parts=cookies[i]&&cookies[i].split("=");i++){if(decode(parts.shift())===key){var cookie=decode(parts.join("="));return config.json?JSON.parse(cookie):cookie}}return null};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)!==null){$.cookie(key,null,options);return true}return false}})(jQuery,document);
jQuery.fn.toggleAttr=function(attr){return this.each(function(){var $this=$(this);$this.attr(attr)?$this.removeAttr(attr):$this.attr(attr,attr)})};
!function($){$(function(){"use strict";$.support.transition=function(){var transitionEnd=function(){var el=document.createElement("bootstrap"),transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},name;for(name in transEndEventNames){if(el.style[name]!==undefined){return transEndEventNames[name]}}}();return transitionEnd&&{end:transitionEnd}}()})}(window.jQuery);!function($){"use strict";var Modal=function(content,options){this.options=options;this.$element=$(content).delegate('[data-dismiss="modal"]',"click.dismiss.modal",$.proxy(this.hide,this))};Modal.prototype={constructor:Modal,toggle:function(){return this[!this.isShown?"show":"hide"]()},show:function(){var that=this,e=$.Event("show");this.$element.trigger(e);if(this.isShown||e.isDefaultPrevented())return;$("body").addClass("modal-open");this.isShown=true;escape.call(this);backdrop.call(this,function(){var transition=$.support.transition&&that.$element.hasClass("fade");if(!that.$element.parent().length){that.$element.appendTo(document.body)}that.$element.show();if(transition){that.$element[0].offsetWidth}that.$element.addClass("in");transition?that.$element.one($.support.transition.end,function(){that.$element.trigger("shown")}):that.$element.trigger("shown")})},hide:function(e){e&&e.preventDefault();var that=this;e=$.Event("hide");this.$element.trigger(e);if(!this.isShown||e.isDefaultPrevented())return;this.isShown=false;$("body").removeClass("modal-open");escape.call(this);this.$element.removeClass("in");$.support.transition&&this.$element.hasClass("fade")?hideWithTransition.call(this):hideModal.call(this)}};function hideWithTransition(){var that=this,timeout=setTimeout(function(){that.$element.off($.support.transition.end);hideModal.call(that)},500);this.$element.one($.support.transition.end,function(){clearTimeout(timeout);hideModal.call(that)})}function hideModal(that){this.$element.hide().trigger("hidden");backdrop.call(this)}function backdrop(callback){var that=this,animate=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate;this.$backdrop=$('<div class="modal-backdrop '+animate+'" />').appendTo(document.body);if(this.options.backdrop!="static"){this.$backdrop.click($.proxy(this.hide,this))}if(doAnimate)this.$backdrop[0].offsetWidth;this.$backdrop.addClass("in");doAnimate?this.$backdrop.one($.support.transition.end,callback):callback()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");$.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one($.support.transition.end,$.proxy(removeBackdrop,this)):removeBackdrop.call(this)}else if(callback){callback()}}function removeBackdrop(){this.$backdrop.remove();this.$backdrop=null}function escape(){var that=this;if(this.isShown&&this.options.keyboard){$(document).on("keyup.dismiss.modal",function(e){e.which==27&&that.hide()})}else if(!this.isShown){$(document).off("keyup.dismiss.modal")}}$.fn.modal=function(option){return this.each(function(){var $this=$(this),data=$this.data("modal"),options=$.extend({},$.fn.modal.defaults,$this.data(),typeof option=="object"&&option);if(!data)$this.data("modal",data=new Modal(this,options));if(typeof option=="string")data[option]();else if(options.show)data.show()})};$.fn.modal.defaults={backdrop:true,keyboard:true,show:true};$.fn.modal.Constructor=Modal;$(function(){$("body").on("click.modal.data-api",'[data-toggle="modal"]',function(e){var $this=$(this),href,$target=$($this.attr("data-target")||(href=$this.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,"")),option=$target.data("modal")?"toggle":$.extend({},$target.data(),$this.data());e.preventDefault();$target.modal(option)})})}(window.jQuery);!function($){"use strict";var toggle='[data-toggle="dropdown"]',Dropdown=function(element){var $el=$(element).on("click.dropdown.data-api",this.toggle);$("html").on("click.dropdown.data-api",function(){$el.parent().removeClass("open")})};Dropdown.prototype={constructor:Dropdown,toggle:function(e){var $this=$(this),$parent,selector,isActive;if($this.is(".disabled, :disabled"))return;selector=$this.attr("data-target");if(!selector){selector=$this.attr("href");selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")}$parent=$(selector);$parent.length||($parent=$this.parent());isActive=$parent.hasClass("open");clearMenus();if(!isActive)$parent.toggleClass("open");return false}};function clearMenus(){$(toggle).parent().removeClass("open")}$.fn.dropdown=function(option){return this.each(function(){var $this=$(this),data=$this.data("dropdown");if(!data)$this.data("dropdown",data=new Dropdown(this));if(typeof option=="string")data[option].call($this)})};$.fn.dropdown.Constructor=Dropdown;$(function(){$("html").on("click.dropdown.data-api",clearMenus);$("body").on("click.dropdown",".dropdown form",function(e){e.stopPropagation()}).on("click.dropdown.data-api",toggle,Dropdown.prototype.toggle)})}(window.jQuery);!function($){"use strict";function ScrollSpy(element,options){var process=$.proxy(this.process,this),$element=$(element).is("body")?$(window):$(element),href;this.options=$.extend({},$.fn.scrollspy.defaults,options);this.$scrollElement=$element.on("scroll.scroll.data-api",process);this.selector=(this.options.target||(href=$(element).attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a";this.$body=$("body");this.refresh();this.process()}ScrollSpy.prototype={constructor:ScrollSpy,refresh:function(){var self=this,$targets;this.offsets=$([]);this.targets=$([]);$targets=this.$body.find(this.selector).map(function(){var $el=$(this),href=$el.data("target")||$el.attr("href"),$href=/^#\w/.test(href)&&$(href);return $href&&href.length&&[[$href.position().top,href]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){self.offsets.push(this[0]);self.targets.push(this[1])})},process:function(){var scrollTop=this.$scrollElement.scrollTop()+this.options.offset,scrollHeight=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,maxScroll=scrollHeight-this.$scrollElement.height(),offsets=this.offsets,targets=this.targets,activeTarget=this.activeTarget,i;if(scrollTop>=maxScroll){return activeTarget!=(i=targets.last()[0])&&this.activate(i)}for(i=offsets.length;i--;){activeTarget!=targets[i]&&scrollTop>=offsets[i]&&(!offsets[i+1]||scrollTop<=offsets[i+1])&&this.activate(targets[i])}},activate:function(target){var active,selector;this.activeTarget=target;$(this.selector).parent(".active").removeClass("active");selector=this.selector+'[data-target="'+target+'"],'+this.selector+'[href="'+target+'"]';active=$(selector).parent("li").addClass("active");if(active.parent(".dropdown-menu")){active=active.closest("li.dropdown").addClass("active")}active.trigger("activate")}};$.fn.scrollspy=function(option){return this.each(function(){var $this=$(this),data=$this.data("scrollspy"),options=typeof option=="object"&&option;if(!data)$this.data("scrollspy",data=new ScrollSpy(this,options));if(typeof option=="string")data[option]()})};$.fn.scrollspy.Constructor=ScrollSpy;$.fn.scrollspy.defaults={offset:10};$(function(){$('[data-spy="scroll"]').each(function(){var $spy=$(this);$spy.scrollspy($spy.data())})})}(window.jQuery);!function($){"use strict";var Tab=function(element){this.element=$(element)};Tab.prototype={constructor:Tab,show:function(){var $this=this.element,$ul=$this.closest("ul:not(.dropdown-menu)"),selector=$this.attr("data-target"),previous,$target,e;if(!selector){selector=$this.attr("href");selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")}if($this.parent("li").hasClass("active"))return;previous=$ul.find(".active a").last()[0];e=$.Event("show",{relatedTarget:previous});$this.trigger(e);if(e.isDefaultPrevented())return;$target=$(selector);this.activate($this.parent("li"),$ul);this.activate($target,$target.parent(),function(){$this.trigger({type:"shown",relatedTarget:previous})})},activate:function(element,container,callback){var $active=container.find("> .active"),transition=callback&&$.support.transition&&$active.hasClass("fade");function next(){$active.removeClass("active").find("> .dropdown-menu > .active").removeClass("active");element.addClass("active");if(transition){element[0].offsetWidth;element.addClass("in")}else{element.removeClass("fade")}if(element.parent(".dropdown-menu")){element.closest("li.dropdown").addClass("active")}callback&&callback()}transition?$active.one($.support.transition.end,next):next();$active.removeClass("in")}};$.fn.tab=function(option){return this.each(function(){var $this=$(this),data=$this.data("tab");if(!data)$this.data("tab",data=new Tab(this));if(typeof option=="string")data[option]()})};$.fn.tab.Constructor=Tab;$(function(){$("body").on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault();$(this).tab("show")})})}(window.jQuery);!function($){"use strict";var Tooltip=function(element,options){this.init("tooltip",element,options)};Tooltip.prototype={constructor:Tooltip,init:function(type,element,options){var eventIn,eventOut;this.type=type;this.$element=$(element);this.options=this.getOptions(options);this.enabled=true;if(this.options.trigger!="manual"){eventIn=this.options.trigger=="hover"?"mouseenter":"focus";eventOut=this.options.trigger=="hover"?"mouseleave":"blur";this.$element.on(eventIn,this.options.selector,$.proxy(this.enter,this));this.$element.on(eventOut,this.options.selector,$.proxy(this.leave,this))}this.options.selector?this._options=$.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(options){options=$.extend({},$.fn[this.type].defaults,options,this.$element.data());if(options.delay&&typeof options.delay=="number"){options.delay={show:options.delay,hide:options.delay}}return options},enter:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type);if(!self.options.delay||!self.options.delay.show)return self.show();clearTimeout(this.timeout);self.hoverState="in";this.timeout=setTimeout(function(){if(self.hoverState=="in")self.show()},self.options.delay.show)},leave:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type);if(this.timeout)clearTimeout(this.timeout);if(!self.options.delay||!self.options.delay.hide)return self.hide();self.hoverState="out";this.timeout=setTimeout(function(){if(self.hoverState=="out")self.hide()},self.options.delay.hide)},show:function(){var $tip,inside,pos,actualWidth,actualHeight,placement,tp;if(this.hasContent()&&this.enabled){$tip=this.tip();this.setContent();if(this.options.animation){$tip.addClass("fade")}placement=typeof this.options.placement=="function"?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement;inside=/in/.test(placement);$tip.remove().css({top:0,left:0,display:"block"}).appendTo(inside?this.$element:document.body);pos=this.getPosition(inside);actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight;switch(inside?placement.split(" ")[1]:placement){case"bottom":tp={top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2};break;case"top":tp={top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2};break;case"left":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth};break;case"right":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width};break}$tip.css(tp).addClass(placement).addClass("in")}},isHTML:function(text){return typeof text!="string"||text.charAt(0)==="<"&&text.charAt(text.length-1)===">"&&text.length>=3||/^(?:[^<]*<[\w\W]+>[^>]*$)/.exec(text)},setContent:function(){var $tip=this.tip(),title=this.getTitle();$tip.find(".tooltip-inner")[this.isHTML(title)?"html":"text"](title);$tip.removeClass("fade in top bottom left right")},hide:function(){var that=this,$tip=this.tip();$tip.removeClass("in");function removeWithAnimation(){var timeout=setTimeout(function(){$tip.off($.support.transition.end).remove()},500);$tip.one($.support.transition.end,function(){clearTimeout(timeout);$tip.remove()})}$.support.transition&&this.$tip.hasClass("fade")?removeWithAnimation():$tip.remove()},fixTitle:function(){var $e=this.$element;if($e.attr("title")||typeof $e.attr("data-original-title")!="string"){$e.attr("data-original-title",$e.attr("title")||"").removeAttr("title")}},hasContent:function(){return this.getTitle()},getPosition:function(inside){return $.extend({},inside?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var title,$e=this.$element,o=this.options;title=$e.attr("data-original-title")||(typeof o.title=="function"?o.title.call($e[0]):o.title);return title},tip:function(){return this.$tip=this.$tip||$(this.options.template)},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()}};$.fn.tooltip=function(option){return this.each(function(){var $this=$(this),data=$this.data("tooltip"),options=typeof option=="object"&&option;if(!data)$this.data("tooltip",data=new Tooltip(this,options));if(typeof option=="string")data[option]()})};$.fn.tooltip.Constructor=Tooltip;$.fn.tooltip.defaults={animation:true,placement:"top",selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0}}(window.jQuery);!function($){"use strict";var Popover=function(element,options){this.init("popover",element,options)};Popover.prototype=$.extend({},$.fn.tooltip.Constructor.prototype,{constructor:Popover,setContent:function(){var $tip=this.tip(),title=this.getTitle(),content=this.getContent();$tip.find(".popover-title")[this.isHTML(title)?"html":"text"](title);$tip.find(".popover-content > *")[this.isHTML(content)?"html":"text"](content);$tip.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var content,$e=this.$element,o=this.options;content=$e.attr("data-content")||(typeof o.content=="function"?o.content.call($e[0]):o.content);return content},tip:function(){if(!this.$tip){this.$tip=$(this.options.template)}return this.$tip}});$.fn.popover=function(option){return this.each(function(){var $this=$(this),data=$this.data("popover"),options=typeof option=="object"&&option;if(!data)$this.data("popover",data=new Popover(this,options));if(typeof option=="string")data[option]()})};$.fn.popover.Constructor=Popover;$.fn.popover.defaults=$.extend({},$.fn.tooltip.defaults,{placement:"right",content:"",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'})}(window.jQuery);!function($){"use strict";var dismiss='[data-dismiss="alert"]',Alert=function(el){$(el).on("click",dismiss,this.close)};Alert.prototype.close=function(e){var $this=$(this),selector=$this.attr("data-target"),$parent;if(!selector){selector=$this.attr("href");selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")}$parent=$(selector);e&&e.preventDefault();$parent.length||($parent=$this.hasClass("alert")?$this:$this.parent());$parent.trigger(e=$.Event("close"));if(e.isDefaultPrevented())return;$parent.removeClass("in");function removeElement(){$parent.trigger("closed").remove()}$.support.transition&&$parent.hasClass("fade")?$parent.on($.support.transition.end,removeElement):removeElement()};$.fn.alert=function(option){return this.each(function(){var $this=$(this),data=$this.data("alert");if(!data)$this.data("alert",data=new Alert(this));if(typeof option=="string")data[option].call($this)})};$.fn.alert.Constructor=Alert;$(function(){$("body").on("click.alert.data-api",dismiss,Alert.prototype.close)})}(window.jQuery);!function($){"use strict";var Button=function(element,options){this.$element=$(element);this.options=$.extend({},$.fn.button.defaults,options)};Button.prototype.setState=function(state){var d="disabled",$el=this.$element,data=$el.data(),val=$el.is("input")?"val":"html";state=state+"Text";data.resetText||$el.data("resetText",$el[val]());$el[val](data[state]||this.options[state]);setTimeout(function(){state=="loadingText"?$el.addClass(d).attr(d,d):$el.removeClass(d).removeAttr(d)},0)};Button.prototype.toggle=function(){var $parent=this.$element.parent('[data-toggle="buttons-radio"]');$parent&&$parent.find(".active").removeClass("active");this.$element.toggleClass("active")};$.fn.button=function(option){return this.each(function(){var $this=$(this),data=$this.data("button"),options=typeof option=="object"&&option;if(!data)$this.data("button",data=new Button(this,options));if(option=="toggle")data.toggle();else if(option)data.setState(option)})};$.fn.button.defaults={loadingText:"loading..."};$.fn.button.Constructor=Button;$(function(){$("body").on("click.button.data-api","[data-toggle^=button]",function(e){var $btn=$(e.target);if(!$btn.hasClass("btn"))$btn=$btn.closest(".btn");$btn.button("toggle")})})}(window.jQuery);!function($){"use strict";var Collapse=function(element,options){this.$element=$(element);this.options=$.extend({},$.fn.collapse.defaults,options);if(this.options.parent){this.$parent=$(this.options.parent)}this.options.toggle&&this.toggle()};Collapse.prototype={constructor:Collapse,dimension:function(){var hasWidth=this.$element.hasClass("width");return hasWidth?"width":"height"},show:function(){var dimension,scroll,actives,hasData;if(this.transitioning)return;dimension=this.dimension();scroll=$.camelCase(["scroll",dimension].join("-"));actives=this.$parent&&this.$parent.find("> .accordion-group > .in");if(actives&&actives.length){hasData=actives.data("collapse");if(hasData&&hasData.transitioning)return;actives.collapse("hide");hasData||actives.data("collapse",null)}this.$element[dimension](0);this.transition("addClass",$.Event("show"),"shown");this.$element[dimension](this.$element[0][scroll])},hide:function(){var dimension;if(this.transitioning)return;dimension=this.dimension();this.reset(this.$element[dimension]());this.transition("removeClass",$.Event("hide"),"hidden");this.$element[dimension](0)},reset:function(size){var dimension=this.dimension();this.$element.removeClass("collapse")[dimension](size||"auto")[0].offsetWidth;this.$element[size!==null?"addClass":"removeClass"]("collapse");return this},transition:function(method,startEvent,completeEvent){var that=this,complete=function(){if(startEvent.type=="show")that.reset();that.transitioning=0;that.$element.trigger(completeEvent)};this.$element.trigger(startEvent);if(startEvent.isDefaultPrevented())return;this.transitioning=1;this.$element[method]("in");$.support.transition&&this.$element.hasClass("collapse")?this.$element.one($.support.transition.end,complete):complete()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};$.fn.collapse=function(option){return this.each(function(){var $this=$(this),data=$this.data("collapse"),options=typeof option=="object"&&option;if(!data)$this.data("collapse",data=new Collapse(this,options));if(typeof option=="string")data[option]()})};$.fn.collapse.defaults={toggle:true};$.fn.collapse.Constructor=Collapse;$(function(){$("body").on("click.collapse.data-api","[data-toggle=collapse]",function(e){var $this=$(this),href,target=$this.attr("data-target")||e.preventDefault()||(href=$this.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,""),option=$(target).data("collapse")?"toggle":$this.data();$(target).collapse(option)})})}(window.jQuery);!function($){"use strict";var Carousel=function(element,options){this.$element=$(element);this.options=options;this.options.slide&&this.slide(this.options.slide);this.options.pause=="hover"&&this.$element.on("mouseenter",$.proxy(this.pause,this)).on("mouseleave",$.proxy(this.cycle,this))};Carousel.prototype={cycle:function(e){if(!e)this.paused=false;this.options.interval&&!this.paused&&(this.interval=setInterval($.proxy(this.next,this),this.options.interval));return this},to:function(pos){var $active=this.$element.find(".active"),children=$active.parent().children(),activePos=children.index($active),that=this;if(pos>children.length-1||pos<0)return;if(this.sliding){return this.$element.one("slid",function(){that.to(pos)})}if(activePos==pos){return this.pause().cycle()}return this.slide(pos>activePos?"next":"prev",$(children[pos]))},pause:function(e){if(!e)this.paused=true;clearInterval(this.interval);this.interval=null;return this},next:function(){if(this.sliding)return;return this.slide("next")},prev:function(){if(this.sliding)return;return this.slide("prev")},slide:function(type,next){var $active=this.$element.find(".active"),$next=next||$active[type](),isCycling=this.interval,direction=type=="next"?"left":"right",fallback=type=="next"?"first":"last",that=this,e=$.Event("slide");this.sliding=true;isCycling&&this.pause();$next=$next.length?$next:this.$element.find(".item")[fallback]();if($next.hasClass("active"))return;if($.support.transition&&this.$element.hasClass("slide")){this.$element.trigger(e);if(e.isDefaultPrevented())return;$next.addClass(type);$next[0].offsetWidth;$active.addClass(direction);$next.addClass(direction);this.$element.one($.support.transition.end,function(){$next.removeClass([type,direction].join(" ")).addClass("active");$active.removeClass(["active",direction].join(" "));that.sliding=false;setTimeout(function(){that.$element.trigger("slid")},0)})}else{this.$element.trigger(e);if(e.isDefaultPrevented())return;$active.removeClass("active");$next.addClass("active");this.sliding=false;this.$element.trigger("slid")}isCycling&&this.cycle();return this}};$.fn.carousel=function(option){return this.each(function(){var $this=$(this),data=$this.data("carousel"),options=$.extend({},$.fn.carousel.defaults,typeof option=="object"&&option);if(!data)$this.data("carousel",data=new Carousel(this,options));if(typeof option=="number")data.to(option);else if(typeof option=="string"||(option=options.slide))data[option]();else if(options.interval)data.cycle()})};$.fn.carousel.defaults={interval:5e3,pause:"hover"};$.fn.carousel.Constructor=Carousel;$(function(){$("body").on("click.carousel.data-api","[data-slide]",function(e){var $this=$(this),href,$target=$($this.attr("data-target")||(href=$this.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,"")),options=!$target.data("modal")&&$.extend({},$target.data(),$this.data());$target.carousel(options);e.preventDefault()})})}(window.jQuery);
!function($){function UTCDate(){return new Date(Date.UTC.apply(Date,arguments))}function UTCToday(){var today=new Date;return UTCDate(today.getUTCFullYear(),today.getUTCMonth(),today.getUTCDate())}var Datepicker=function(element,options){var that=this;this.element=$(element);this.language=options.language||this.element.data("date-language")||"en";this.language=this.language in dates?this.language:this.language.split("-")[0];this.language=this.language in dates?this.language:"en";this.isRTL=dates[this.language].rtl||false;this.format=DPGlobal.parseFormat(options.format||this.element.data("date-format")||dates[this.language].format||"mm/dd/yyyy");this.isInline=false;this.isInput=this.element.is("input");this.component=this.element.is(".date")?this.element.find(".add-on"):false;this.hasInput=this.component&&this.element.find("input").length;if(this.component&&this.component.length===0)this.component=false;this._attachEvents();this.forceParse=true;if("forceParse"in options){this.forceParse=options.forceParse}else if("dateForceParse"in this.element.data()){this.forceParse=this.element.data("date-force-parse")}this.picker=$(DPGlobal.template).appendTo(this.isInline?this.element:"body").on({click:$.proxy(this.click,this),mousedown:$.proxy(this.mousedown,this)});if(this.isInline){this.picker.addClass("datepicker-inline")}else{this.picker.addClass("datepicker-dropdown dropdown-menu")}if(this.isRTL){this.picker.addClass("datepicker-rtl");this.picker.find(".prev i, .next i").toggleClass("icon-arrow-left icon-arrow-right")}$(document).on("mousedown",function(e){if($(e.target).closest(".datepicker.datepicker-inline, .datepicker.datepicker-dropdown").length===0){that.hide()}});this.autoclose=false;if("autoclose"in options){this.autoclose=options.autoclose}else if("dateAutoclose"in this.element.data()){this.autoclose=this.element.data("date-autoclose")}this.keyboardNavigation=true;if("keyboardNavigation"in options){this.keyboardNavigation=options.keyboardNavigation}else if("dateKeyboardNavigation"in this.element.data()){this.keyboardNavigation=this.element.data("date-keyboard-navigation")}this.viewMode=this.startViewMode=0;switch(options.startView||this.element.data("date-start-view")){case 2:case"decade":this.viewMode=this.startViewMode=2;break;case 1:case"year":this.viewMode=this.startViewMode=1;break}this.todayBtn=options.todayBtn||this.element.data("date-today-btn")||false;this.todayHighlight=options.todayHighlight||this.element.data("date-today-highlight")||false;this.calendarWeeks=false;if("calendarWeeks"in options){this.calendarWeeks=options.calendarWeeks}else if("dateCalendarWeeks"in this.element.data()){this.calendarWeeks=this.element.data("date-calendar-weeks")}if(this.calendarWeeks)this.picker.find("tfoot th.today").attr("colspan",function(i,val){return parseInt(val)+1});this.weekStart=(options.weekStart||this.element.data("date-weekstart")||dates[this.language].weekStart||0)%7;this.weekEnd=(this.weekStart+6)%7;this.startDate=-Infinity;this.endDate=Infinity;this.daysOfWeekDisabled=[];this.setStartDate(options.startDate||this.element.data("date-startdate"));this.setEndDate(options.endDate||this.element.data("date-enddate"));this.setDaysOfWeekDisabled(options.daysOfWeekDisabled||this.element.data("date-days-of-week-disabled"));this.fillDow();this.fillMonths();this.update();this.showMode();if(this.isInline){this.show()}};Datepicker.prototype={constructor:Datepicker,_events:[],_attachEvents:function(){this._detachEvents();if(this.isInput){this._events=[[this.element,{focus:$.proxy(this.show,this),keyup:$.proxy(this.update,this),keydown:$.proxy(this.keydown,this)}]]}else if(this.component&&this.hasInput){this._events=[[this.element.find("input"),{focus:$.proxy(this.show,this),keyup:$.proxy(this.update,this),keydown:$.proxy(this.keydown,this)}],[this.component,{click:$.proxy(this.show,this)}]]}else if(this.element.is("div")){this.isInline=true}else{this._events=[[this.element,{click:$.proxy(this.show,this)}]]}for(var i=0,el,ev;i<this._events.length;i++){el=this._events[i][0];ev=this._events[i][1];el.on(ev)}},_detachEvents:function(){for(var i=0,el,ev;i<this._events.length;i++){el=this._events[i][0];ev=this._events[i][1];el.off(ev)}this._events=[]},show:function(e){this.picker.show();this.height=this.component?this.component.outerHeight():this.element.outerHeight();this.update();this.place();$(window).on("resize",$.proxy(this.place,this));if(e){e.stopPropagation();e.preventDefault()}this.element.trigger({type:"show",date:this.date})},hide:function(e){if(this.isInline)return;if(!this.picker.is(":visible"))return;this.picker.hide();$(window).off("resize",this.place);this.viewMode=this.startViewMode;this.showMode();if(!this.isInput){$(document).off("mousedown",this.hide)}if(this.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val()))this.setValue();this.element.trigger({type:"hide",date:this.date})},remove:function(){this._detachEvents();this.picker.remove();delete this.element.data().datepicker},getDate:function(){var d=this.getUTCDate();return new Date(d.getTime()+d.getTimezoneOffset()*6e4)},getUTCDate:function(){return this.date},setDate:function(d){this.setUTCDate(new Date(d.getTime()-d.getTimezoneOffset()*6e4))},setUTCDate:function(d){this.date=d;this.setValue()},setValue:function(){var formatted=this.getFormattedDate();if(!this.isInput){if(this.component){this.element.find("input").val(formatted)}this.element.data("date",formatted)}else{this.element.val(formatted)}},getFormattedDate:function(format){if(format===undefined)format=this.format;return DPGlobal.formatDate(this.date,format,this.language)},setStartDate:function(startDate){this.startDate=startDate||-Infinity;if(this.startDate!==-Infinity){this.startDate=DPGlobal.parseDate(this.startDate,this.format,this.language)}this.update();this.updateNavArrows()},setEndDate:function(endDate){this.endDate=endDate||Infinity;if(this.endDate!==Infinity){this.endDate=DPGlobal.parseDate(this.endDate,this.format,this.language)}this.update();this.updateNavArrows()},setDaysOfWeekDisabled:function(daysOfWeekDisabled){this.daysOfWeekDisabled=daysOfWeekDisabled||[];if(!$.isArray(this.daysOfWeekDisabled)){this.daysOfWeekDisabled=this.daysOfWeekDisabled.split(/,\s*/)}this.daysOfWeekDisabled=$.map(this.daysOfWeekDisabled,function(d){return parseInt(d,10)});this.update();this.updateNavArrows()},place:function(){if(this.isInline)return;var zIndex=parseInt(this.element.parents().filter(function(){return $(this).css("z-index")!="auto"}).first().css("z-index"))+10;var offset=this.component?this.component.offset():this.element.offset();var height=this.component?this.component.outerHeight(true):this.element.outerHeight(true);this.picker.css({top:offset.top+height,left:offset.left,zIndex:zIndex})},update:function(){var date,fromArgs=false;if(arguments&&arguments.length&&(typeof arguments[0]==="string"||arguments[0]instanceof Date)){date=arguments[0];fromArgs=true}else{date=this.isInput?this.element.val():this.element.data("date")||this.element.find("input").val()}this.date=DPGlobal.parseDate(date,this.format,this.language);if(fromArgs)this.setValue();if(this.date<this.startDate){this.viewDate=new Date(this.startDate)}else if(this.date>this.endDate){this.viewDate=new Date(this.endDate)}else{this.viewDate=new Date(this.date)}this.fill()},fillDow:function(){var dowCnt=this.weekStart,html="<tr>";if(this.calendarWeeks){var cell='<th class="cw">&nbsp;</th>';html+=cell;this.picker.find(".datepicker-days thead tr:first-child").prepend(cell)}while(dowCnt<this.weekStart+7){html+='<th class="dow">'+dates[this.language].daysMin[dowCnt++%7]+"</th>"}html+="</tr>";this.picker.find(".datepicker-days thead").append(html)},fillMonths:function(){var html="",i=0;while(i<12){html+='<span class="month">'+dates[this.language].monthsShort[i++]+"</span>"}this.picker.find(".datepicker-months td").html(html)},fill:function(){var d=new Date(this.viewDate),year=d.getUTCFullYear(),month=d.getUTCMonth(),startYear=this.startDate!==-Infinity?this.startDate.getUTCFullYear():-Infinity,startMonth=this.startDate!==-Infinity?this.startDate.getUTCMonth():-Infinity,endYear=this.endDate!==Infinity?this.endDate.getUTCFullYear():Infinity,endMonth=this.endDate!==Infinity?this.endDate.getUTCMonth():Infinity,currentDate=this.date&&this.date.valueOf(),today=new Date;this.picker.find(".datepicker-days thead th.switch").text(dates[this.language].months[month]+" "+year);this.picker.find("tfoot th.today").text(dates[this.language].today).toggle(this.todayBtn!==false);this.updateNavArrows();this.fillMonths();var prevMonth=UTCDate(year,month-1,28,0,0,0,0),day=DPGlobal.getDaysInMonth(prevMonth.getUTCFullYear(),prevMonth.getUTCMonth());prevMonth.setUTCDate(day);prevMonth.setUTCDate(day-(prevMonth.getUTCDay()-this.weekStart+7)%7);var nextMonth=new Date(prevMonth);nextMonth.setUTCDate(nextMonth.getUTCDate()+42);nextMonth=nextMonth.valueOf();var html=[];var clsName;while(prevMonth.valueOf()<nextMonth){if(prevMonth.getUTCDay()==this.weekStart){html.push("<tr>");if(this.calendarWeeks){var a=new Date(prevMonth.getUTCFullYear(),prevMonth.getUTCMonth(),prevMonth.getUTCDate()-prevMonth.getDay()+10-(this.weekStart&&this.weekStart%7<5&&7)),b=new Date(a.getFullYear(),0,4),calWeek=~~((a-b)/864e5/7+1.5);html.push('<td class="cw">'+calWeek+"</td>")}}clsName="";if(prevMonth.getUTCFullYear()<year||prevMonth.getUTCFullYear()==year&&prevMonth.getUTCMonth()<month){clsName+=" old"}else if(prevMonth.getUTCFullYear()>year||prevMonth.getUTCFullYear()==year&&prevMonth.getUTCMonth()>month){clsName+=" new"}if(this.todayHighlight&&prevMonth.getUTCFullYear()==today.getFullYear()&&prevMonth.getUTCMonth()==today.getMonth()&&prevMonth.getUTCDate()==today.getDate()){clsName+=" today"}if(currentDate&&prevMonth.valueOf()==currentDate){clsName+=" active"}if(prevMonth.valueOf()<this.startDate||prevMonth.valueOf()>this.endDate||$.inArray(prevMonth.getUTCDay(),this.daysOfWeekDisabled)!==-1){clsName+=" disabled"}html.push('<td class="day'+clsName+'">'+prevMonth.getUTCDate()+"</td>");if(prevMonth.getUTCDay()==this.weekEnd){html.push("</tr>")}prevMonth.setUTCDate(prevMonth.getUTCDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(html.join(""));var currentYear=this.date&&this.date.getUTCFullYear();var months=this.picker.find(".datepicker-months").find("th:eq(1)").text(year).end().find("span").removeClass("active");if(currentYear&&currentYear==year){months.eq(this.date.getUTCMonth()).addClass("active")}if(year<startYear||year>endYear){months.addClass("disabled")}if(year==startYear){months.slice(0,startMonth).addClass("disabled")}if(year==endYear){months.slice(endMonth+1).addClass("disabled")}html="";year=parseInt(year/10,10)*10;var yearCont=this.picker.find(".datepicker-years").find("th:eq(1)").text(year+"-"+(year+9)).end().find("td");year-=1;for(var i=-1;i<11;i++){html+='<span class="year'+(i==-1||i==10?" old":"")+(currentYear==year?" active":"")+(year<startYear||year>endYear?" disabled":"")+'">'+year+"</span>";year+=1}yearCont.html(html)},updateNavArrows:function(){var d=new Date(this.viewDate),year=d.getUTCFullYear(),month=d.getUTCMonth();switch(this.viewMode){case 0:if(this.startDate!==-Infinity&&year<=this.startDate.getUTCFullYear()&&month<=this.startDate.getUTCMonth()){this.picker.find(".prev").css({visibility:"hidden"})}else{this.picker.find(".prev").css({visibility:"visible"})}if(this.endDate!==Infinity&&year>=this.endDate.getUTCFullYear()&&month>=this.endDate.getUTCMonth()){this.picker.find(".next").css({visibility:"hidden"})}else{this.picker.find(".next").css({visibility:"visible"})}break;case 1:case 2:if(this.startDate!==-Infinity&&year<=this.startDate.getUTCFullYear()){this.picker.find(".prev").css({visibility:"hidden"})}else{this.picker.find(".prev").css({visibility:"visible"})}if(this.endDate!==Infinity&&year>=this.endDate.getUTCFullYear()){this.picker.find(".next").css({visibility:"hidden"})}else{this.picker.find(".next").css({visibility:"visible"})}break}},click:function(e){e.stopPropagation();e.preventDefault();var target=$(e.target).closest("span, td, th");if(target.length==1){switch(target[0].nodeName.toLowerCase()){case"th":switch(target[0].className){case"switch":this.showMode(1);break;case"prev":case"next":var dir=DPGlobal.modes[this.viewMode].navStep*(target[0].className=="prev"?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveMonth(this.viewDate,dir);break;case 1:case 2:this.viewDate=this.moveYear(this.viewDate,dir);break}this.fill();break;case"today":var date=new Date;date=UTCDate(date.getFullYear(),date.getMonth(),date.getDate(),0,0,0);this.showMode(-2);var which=this.todayBtn=="linked"?null:"view";this._setDate(date,which);break}break;case"span":if(!target.is(".disabled")){this.viewDate.setUTCDate(1);if(target.is(".month")){var month=target.parent().find("span").index(target);this.viewDate.setUTCMonth(month);this.element.trigger({type:"changeMonth",date:this.viewDate})}else{var year=parseInt(target.text(),10)||0;this.viewDate.setUTCFullYear(year);this.element.trigger({type:"changeYear",date:this.viewDate})}this.showMode(-1);this.fill()}break;case"td":if(target.is(".day")&&!target.is(".disabled")){var day=parseInt(target.text(),10)||1;var year=this.viewDate.getUTCFullYear(),month=this.viewDate.getUTCMonth();if(target.is(".old")){if(month===0){month=11;year-=1}else{month-=1}}else if(target.is(".new")){if(month==11){month=0;year+=1}else{month+=1}}this._setDate(UTCDate(year,month,day,0,0,0,0))}break}}},_setDate:function(date,which){if(!which||which=="date")this.date=date;if(!which||which=="view")this.viewDate=date;this.fill();this.setValue();this.element.trigger({type:"changeDate",date:this.date});var element;if(this.isInput){element=this.element}else if(this.component){element=this.element.find("input")}if(element){element.change();if(this.autoclose&&(!which||which=="date")){this.hide()}}},moveMonth:function(date,dir){if(!dir)return date;var new_date=new Date(date.valueOf()),day=new_date.getUTCDate(),month=new_date.getUTCMonth(),mag=Math.abs(dir),new_month,test;dir=dir>0?1:-1;if(mag==1){test=dir==-1?function(){return new_date.getUTCMonth()==month}:function(){return new_date.getUTCMonth()!=new_month};new_month=month+dir;new_date.setUTCMonth(new_month);if(new_month<0||new_month>11)new_month=(new_month+12)%12}else{for(var i=0;i<mag;i++)new_date=this.moveMonth(new_date,dir);new_month=new_date.getUTCMonth();new_date.setUTCDate(day);test=function(){return new_month!=new_date.getUTCMonth()}}while(test()){new_date.setUTCDate(--day);new_date.setUTCMonth(new_month)}return new_date},moveYear:function(date,dir){return this.moveMonth(date,dir*12)},dateWithinRange:function(date){return date>=this.startDate&&date<=this.endDate},keydown:function(e){if(this.picker.is(":not(:visible)")){if(e.keyCode==27)this.show();return}var dateChanged=false,dir,day,month,newDate,newViewDate;switch(e.keyCode){case 27:this.hide();e.preventDefault();break;case 37:case 39:if(!this.keyboardNavigation)break;dir=e.keyCode==37?-1:1;if(e.ctrlKey){newDate=this.moveYear(this.date,dir);newViewDate=this.moveYear(this.viewDate,dir)}else if(e.shiftKey){newDate=this.moveMonth(this.date,dir);newViewDate=this.moveMonth(this.viewDate,dir)}else{newDate=new Date(this.date);newDate.setUTCDate(this.date.getUTCDate()+dir);newViewDate=new Date(this.viewDate);newViewDate.setUTCDate(this.viewDate.getUTCDate()+dir)}if(this.dateWithinRange(newDate)){this.date=newDate;this.viewDate=newViewDate;this.setValue();this.update();e.preventDefault();dateChanged=true}break;case 38:case 40:if(!this.keyboardNavigation)break;dir=e.keyCode==38?-1:1;if(e.ctrlKey){newDate=this.moveYear(this.date,dir);newViewDate=this.moveYear(this.viewDate,dir)}else if(e.shiftKey){newDate=this.moveMonth(this.date,dir);newViewDate=this.moveMonth(this.viewDate,dir)}else{newDate=new Date(this.date);newDate.setUTCDate(this.date.getUTCDate()+dir*7);newViewDate=new Date(this.viewDate);newViewDate.setUTCDate(this.viewDate.getUTCDate()+dir*7)}if(this.dateWithinRange(newDate)){this.date=newDate;this.viewDate=newViewDate;this.setValue();this.update();e.preventDefault();dateChanged=true}break;case 13:this.hide();e.preventDefault();break;case 9:this.hide();break}if(dateChanged){this.element.trigger({type:"changeDate",date:this.date});var element;if(this.isInput){element=this.element}else if(this.component){element=this.element.find("input")}if(element){element.change()}}},showMode:function(dir){if(dir){this.viewMode=Math.max(0,Math.min(2,this.viewMode+dir))}this.picker.find(">div").hide().filter(".datepicker-"+DPGlobal.modes[this.viewMode].clsName).css("display","block");this.updateNavArrows()}};$.fn.datepicker=function(option){var args=Array.apply(null,arguments);args.shift();return this.each(function(){var $this=$(this),data=$this.data("datepicker"),options=typeof option=="object"&&option;if(!data){$this.data("datepicker",data=new Datepicker(this,$.extend({},$.fn.datepicker.defaults,options)))}if(typeof option=="string"&&typeof data[option]=="function"){data[option].apply(data,args)}})};$.fn.datepicker.defaults={};$.fn.datepicker.Constructor=Datepicker;var dates=$.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today"}};var DPGlobal={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(year){return year%4===0&&year%100!==0||year%400===0},getDaysInMonth:function(year,month){return[31,DPGlobal.isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31][month]},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(format){var separators=format.replace(this.validParts,"\x00").split("\x00"),parts=format.match(this.validParts);if(!separators||!separators.length||!parts||parts.length===0){throw new Error("Invalid date format.")}return{separators:separators,parts:parts}},parseDate:function(date,format,language){if(date instanceof Date)return date;if(/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(date)){var part_re=/([\-+]\d+)([dmwy])/,parts=date.match(/([\-+]\d+)([dmwy])/g),part,dir;date=new Date;for(var i=0;i<parts.length;i++){part=part_re.exec(parts[i]);dir=parseInt(part[1]);switch(part[2]){case"d":date.setUTCDate(date.getUTCDate()+dir);break;case"m":date=Datepicker.prototype.moveMonth.call(Datepicker.prototype,date,dir);break;case"w":date.setUTCDate(date.getUTCDate()+dir*7);break;case"y":date=Datepicker.prototype.moveYear.call(Datepicker.prototype,date,dir);break}}return UTCDate(date.getUTCFullYear(),date.getUTCMonth(),date.getUTCDate(),0,0,0)}var parts=date&&date.match(this.nonpunctuation)||[],date=new Date,parsed={},setters_order=["yyyy","yy","M","MM","m","mm","d","dd"],setters_map={yyyy:function(d,v){return d.setUTCFullYear(v)},yy:function(d,v){return d.setUTCFullYear(2e3+v)},m:function(d,v){v-=1;while(v<0)v+=12;v%=12;d.setUTCMonth(v);while(d.getUTCMonth()!=v)d.setUTCDate(d.getUTCDate()-1);return d},d:function(d,v){return d.setUTCDate(v)}},val,filtered,part;setters_map["M"]=setters_map["MM"]=setters_map["mm"]=setters_map["m"];setters_map["dd"]=setters_map["d"];date=UTCDate(date.getFullYear(),date.getMonth(),date.getDate(),0,0,0);var fparts=format.parts.slice();if(parts.length!=fparts.length){fparts=$(fparts).filter(function(i,p){return $.inArray(p,setters_order)!==-1}).toArray()}if(parts.length==fparts.length){for(var i=0,cnt=fparts.length;i<cnt;i++){val=parseInt(parts[i],10);part=fparts[i];if(isNaN(val)){switch(part){case"MM":filtered=$(dates[language].months).filter(function(){var m=this.slice(0,parts[i].length),p=parts[i].slice(0,m.length);return m==p});val=$.inArray(filtered[0],dates[language].months)+1;break;case"M":filtered=$(dates[language].monthsShort).filter(function(){var m=this.slice(0,parts[i].length),p=parts[i].slice(0,m.length);return m==p});val=$.inArray(filtered[0],dates[language].monthsShort)+1;break}}parsed[part]=val}for(var i=0,s;i<setters_order.length;i++){s=setters_order[i];if(s in parsed&&!isNaN(parsed[s]))setters_map[s](date,parsed[s])}}return date},formatDate:function(date,format,language){var val={d:date.getUTCDate(),D:dates[language].daysShort[date.getUTCDay()],DD:dates[language].days[date.getUTCDay()],m:date.getUTCMonth()+1,M:dates[language].monthsShort[date.getUTCMonth()],MM:dates[language].months[date.getUTCMonth()],yy:date.getUTCFullYear().toString().substring(2),yyyy:date.getUTCFullYear()};val.dd=(val.d<10?"0":"")+val.d;val.mm=(val.m<10?"0":"")+val.m;var date=[],seps=$.extend([],format.separators);for(var i=0,cnt=format.parts.length;i<cnt;i++){if(seps.length)date.push(seps.shift());date.push(val[format.parts[i]])}return date.join("")},headTemplate:"<thead>"+"<tr>"+'<th class="prev"><i class="icon-arrow-left"/></th>'+'<th colspan="5" class="switch"></th>'+'<th class="next"><i class="icon-arrow-right"/></th>'+"</tr>"+"</thead>",contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr></tfoot>'};DPGlobal.template='<div class="datepicker">'+'<div class="datepicker-days">'+'<table class=" table-condensed">'+DPGlobal.headTemplate+"<tbody></tbody>"+DPGlobal.footTemplate+"</table>"+"</div>"+'<div class="datepicker-months">'+'<table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+DPGlobal.footTemplate+"</table>"+"</div>"+'<div class="datepicker-years">'+'<table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+DPGlobal.footTemplate+"</table>"+"</div>"+"</div>";$.fn.datepicker.DPGlobal=DPGlobal}(window.jQuery);
!function($){"use strict";var Tooltip=function(element,options){this.init("tooltip",element,options)};Tooltip.prototype={constructor:Tooltip,init:function(type,element,options){var eventIn,eventOut;this.type=type;this.$element=$(element);this.options=this.getOptions(options);this.enabled=true;if(this.options.trigger=="click"){this.$element.on("click."+this.type,this.options.selector,$.proxy(this.toggle,this))}else if(this.options.trigger!="manual"){eventIn=this.options.trigger=="hover"?"mouseenter":"focus";eventOut=this.options.trigger=="hover"?"mouseleave":"blur";this.$element.on(eventIn+"."+this.type,this.options.selector,$.proxy(this.enter,this));this.$element.on(eventOut+"."+this.type,this.options.selector,$.proxy(this.leave,this))}this.options.selector?this._options=$.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(options){options=$.extend({},$.fn[this.type].defaults,options,this.$element.data());if(options.delay&&typeof options.delay=="number"){options.delay={show:options.delay,hide:options.delay}}return options},enter:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type);if(!self.options.delay||!self.options.delay.show)return self.show();clearTimeout(this.timeout);self.hoverState="in";this.timeout=setTimeout(function(){if(self.hoverState=="in")self.show()},self.options.delay.show)},leave:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type);if(this.timeout)clearTimeout(this.timeout);if(!self.options.delay||!self.options.delay.hide)return self.hide();self.hoverState="out";this.timeout=setTimeout(function(){if(self.hoverState=="out")self.hide()},self.options.delay.hide)},show:function(){var $tip,inside,pos,actualWidth,actualHeight,placement,tp;if(this.hasContent()&&this.enabled){$tip=this.tip();this.setContent();if(this.options.animation){$tip.addClass("fade")}placement=typeof this.options.placement=="function"?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement;inside=/in/.test(placement);$tip.remove().css({top:0,left:0,display:"block"}).appendTo(inside?this.$element:document.body);pos=this.getPosition(inside);actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight;switch(inside?placement.split(" ")[1]:placement){case"bottom":tp={top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2};break;case"top":tp={top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2};break;case"left":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth};break;case"right":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width};break}$tip.css(tp).addClass(placement).addClass("in")}},setContent:function(){var $tip=this.tip(),title=this.getTitle();$tip.find(".tooltip-inner")[this.options.html?"html":"text"](title);$tip.removeClass("fade in top bottom left right")},hide:function(){var that=this,$tip=this.tip();$tip.removeClass("in");function removeWithAnimation(){var timeout=setTimeout(function(){$tip.off($.support.transition.end).remove()},500);$tip.one($.support.transition.end,function(){clearTimeout(timeout);$tip.remove()})}$.support.transition&&this.$tip.hasClass("fade")?removeWithAnimation():$tip.remove();return this},fixTitle:function(){var $e=this.$element;if($e.attr("title")||typeof $e.attr("data-original-title")!="string"){$e.attr("data-original-title",$e.attr("title")||"").removeAttr("title")}},hasContent:function(){return this.getTitle()},getPosition:function(inside){return $.extend({},inside?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var title,$e=this.$element,o=this.options;title=$e.attr("data-original-title")||(typeof o.title=="function"?o.title.call($e[0]):o.title);return title},tip:function(){return this.$tip=this.$tip||$(this.options.template)},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};$.fn.tooltip=function(option){return this.each(function(){var $this=$(this),data=$this.data("tooltip"),options=typeof option=="object"&&option;if(!data)$this.data("tooltip",data=new Tooltip(this,options));if(typeof option=="string")data[option]()})};$.fn.tooltip.Constructor=Tooltip;$.fn.tooltip.defaults={animation:true,placement:"top",selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0,html:true}}(window.jQuery);
(function(module){if(typeof define==="function"&&define.amd){define(["jquery"],module)}else{module(jQuery)}})(function(jQuery,undefined){var threshold=6,add=jQuery.event.add,remove=jQuery.event.remove,trigger=function(node,type,data){jQuery.event.trigger(type,data,node)},requestFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(fn,element){return window.setTimeout(function(){fn()},25)}}(),ignoreTags={textarea:true,input:true,select:true},mouseevents={move:"mousemove",cancel:"mouseup dragstart",end:"mouseup"},touchevents={move:"touchmove",cancel:"touchend",end:"touchend"};function Timer(fn){var callback=fn,active=false,running=false;function trigger(time){if(active){callback();requestFrame(trigger);running=true;active=false}else{running=false}}this.kick=function(fn){active=true;if(!running){trigger()}};this.end=function(fn){var cb=callback;if(!fn){return}if(!running){fn()}else{callback=active?function(){cb();fn()}:fn;active=true}}}function returnTrue(){return true}function returnFalse(){return false}function preventDefault(e){e.preventDefault()}function preventIgnoreTags(e){if(ignoreTags[e.target.tagName.toLowerCase()]){return}e.preventDefault()}function isLeftButton(e){return e.which===1&&!e.ctrlKey&&!e.altKey}function identifiedTouch(touchList,id){var i,l;if(touchList.identifiedTouch){return touchList.identifiedTouch(id)}i=-1;l=touchList.length;while(++i<l){if(touchList[i].identifier===id){return touchList[i]}}}function changedTouch(e,event){var touch=identifiedTouch(e.changedTouches,event.identifier);if(!touch){return}if(touch.pageX===event.pageX&&touch.pageY===event.pageY){return}return touch}function mousedown(e){var data;if(!isLeftButton(e)){return}data={target:e.target,startX:e.pageX,startY:e.pageY,timeStamp:e.timeStamp};add(document,mouseevents.move,mousemove,data);add(document,mouseevents.cancel,mouseend,data)}function mousemove(e){var data=e.data;checkThreshold(e,data,e,removeMouse)}function mouseend(e){removeMouse()}function removeMouse(){remove(document,mouseevents.move,mousemove);remove(document,mouseevents.cancel,removeMouse)}function touchstart(e){var touch,template;if(ignoreTags[e.target.tagName.toLowerCase()]){return}touch=e.changedTouches[0];template={target:touch.target,startX:touch.pageX,startY:touch.pageY,timeStamp:e.timeStamp,identifier:touch.identifier};add(document,touchevents.move+"."+touch.identifier,touchmove,template);add(document,touchevents.cancel+"."+touch.identifier,touchend,template)}function touchmove(e){var data=e.data,touch=changedTouch(e,data);if(!touch){return}checkThreshold(e,data,touch,removeTouch)}function touchend(e){var template=e.data,touch=identifiedTouch(e.changedTouches,template.identifier);if(!touch){return}removeTouch(template.identifier)}function removeTouch(identifier){remove(document,"."+identifier,touchmove);remove(document,"."+identifier,touchend)}function checkThreshold(e,template,touch,fn){var distX=touch.pageX-template.startX,distY=touch.pageY-template.startY;if(distX*distX+distY*distY<threshold*threshold){return}triggerStart(e,template,touch,distX,distY,fn)}function handled(){this._handled=returnTrue;return false}function flagAsHandled(e){e._handled()}function triggerStart(e,template,touch,distX,distY,fn){var node=template.target,touches,time;touches=e.targetTouches;time=e.timeStamp-template.timeStamp;template.type="movestart";template.distX=distX;template.distY=distY;template.deltaX=distX;template.deltaY=distY;template.pageX=touch.pageX;template.pageY=touch.pageY;template.velocityX=distX/time;template.velocityY=distY/time;template.targetTouches=touches;template.finger=touches?touches.length:1;template._handled=handled;template._preventTouchmoveDefault=function(){e.preventDefault()};trigger(template.target,template);fn(template.identifier)}function activeMousemove(e){var event=e.data.event,timer=e.data.timer;updateEvent(event,e,e.timeStamp,timer)}function activeMouseend(e){var event=e.data.event,timer=e.data.timer;removeActiveMouse();endEvent(event,timer,function(){setTimeout(function(){remove(event.target,"click",returnFalse)},0)})}function removeActiveMouse(event){remove(document,mouseevents.move,activeMousemove);remove(document,mouseevents.end,activeMouseend)}function activeTouchmove(e){var event=e.data.event,timer=e.data.timer,touch=changedTouch(e,event);if(!touch){return}e.preventDefault();event.targetTouches=e.targetTouches;updateEvent(event,touch,e.timeStamp,timer)}function activeTouchend(e){var event=e.data.event,timer=e.data.timer,touch=identifiedTouch(e.changedTouches,event.identifier);if(!touch){return}removeActiveTouch(event);endEvent(event,timer)}function removeActiveTouch(event){remove(document,"."+event.identifier,activeTouchmove);remove(document,"."+event.identifier,activeTouchend)}function updateEvent(event,touch,timeStamp,timer){var time=timeStamp-event.timeStamp;event.type="move";event.distX=touch.pageX-event.startX;event.distY=touch.pageY-event.startY;event.deltaX=touch.pageX-event.pageX;event.deltaY=touch.pageY-event.pageY;event.velocityX=.3*event.velocityX+.7*event.deltaX/time;event.velocityY=.3*event.velocityY+.7*event.deltaY/time;event.pageX=touch.pageX;event.pageY=touch.pageY;timer.kick()}function endEvent(event,timer,fn){timer.end(function(){event.type="moveend";trigger(event.target,event);return fn&&fn()})}function setup(data,namespaces,eventHandle){add(this,"dragstart.move drag.move",preventDefault);add(this,"mousedown.move",preventIgnoreTags);add(this,"movestart.move",flagAsHandled);return true}function teardown(namespaces){remove(this,"dragstart drag",preventDefault);remove(this,"mousedown touchstart",preventIgnoreTags);remove(this,"movestart",flagAsHandled);return true}jQuery.event.special.movestart={setup:setup,teardown:teardown,_default:function(e){var template,data;if(!e._handled()){return}template={target:e.target,startX:e.startX,startY:e.startY,pageX:e.pageX,pageY:e.pageY,distX:e.distX,distY:e.distY,deltaX:e.deltaX,deltaY:e.deltaY,velocityX:e.velocityX,velocityY:e.velocityY,timeStamp:e.timeStamp,identifier:e.identifier,targetTouches:e.targetTouches,finger:e.finger};data={event:template,timer:new Timer(function(time){trigger(e.target,template)})};if(e.identifier===undefined){add(e.target,"click",returnFalse);add(document,mouseevents.move,activeMousemove,data);add(document,mouseevents.end,activeMouseend,data)}else{e._preventTouchmoveDefault();add(document,touchevents.move+"."+e.identifier,activeTouchmove,data);add(document,touchevents.end+"."+e.identifier,activeTouchend,data)}}};jQuery.event.special.move={setup:function(){add(this,"movestart.move",jQuery.noop)},teardown:function(){remove(this,"movestart.move",jQuery.noop)}};jQuery.event.special.moveend={setup:function(){add(this,"movestart.moveend",jQuery.noop)},teardown:function(){remove(this,"movestart.moveend",jQuery.noop)}};add(document,"mousedown.move",mousedown);add(document,"touchstart.move",touchstart);if(typeof Array.prototype.indexOf==="function"){(function(jQuery,undefined){var props=["changedTouches","targetTouches"],l=props.length;while(l--){if(jQuery.event.props.indexOf(props[l])===-1){jQuery.event.props.push(props[l])}}})(jQuery)}});
(function(window,undefined){"$:nomunge";var $=window.jQuery||window.Cowboy||(window.Cowboy={}),jq_throttle;$.throttle=jq_throttle=function(delay,no_trailing,callback,debounce_mode){var timeout_id,last_exec=0;if(typeof no_trailing!=="boolean"){debounce_mode=callback;callback=no_trailing;no_trailing=undefined}function wrapper(){var that=this,elapsed=+new Date-last_exec,args=arguments;function exec(){last_exec=+new Date;callback.apply(that,args)}function clear(){timeout_id=undefined}if(debounce_mode&&!timeout_id){exec()}timeout_id&&clearTimeout(timeout_id);if(debounce_mode===undefined&&elapsed>delay){exec()}else if(no_trailing!==true){timeout_id=setTimeout(debounce_mode?clear:exec,debounce_mode===undefined?delay-elapsed:delay)}}if($.guid){wrapper.guid=callback.guid=callback.guid||$.guid++}return wrapper};$.debounce=function(delay,at_begin,callback){return callback===undefined?jq_throttle(delay,at_begin,false):jq_throttle(delay,callback,at_begin!==false)}})(this);
(function($,e,b){var c="hashchange",h=document,f,g=$.event.special,i=h.documentMode,d="on"+c in e&&(i===b||i>7);function a(j){j=j||location.href;return"#"+j.replace(/^[^#]*#?(.*)$/,"$1")}$.fn[c]=function(j){return j?this.bind(c,j):this.trigger(c)};$.fn[c].delay=50;g[c]=$.extend(g[c],{setup:function(){if(d){return false}$(f.start)},teardown:function(){if(d){return false}$(f.stop)}});f=function(){var j={},p,m=a(),k=function(q){return q},l=k,o=k;j.start=function(){p||n()};j.stop=function(){p&&clearTimeout(p);p=b};function n(){var r=a(),q=o(m);if(r!==m){l(m=r,q);$(e).trigger(c)}else{if(q!==m){location.href=location.href.replace(/#.*/,"")+q}}p=setTimeout(n,$.fn[c].delay)}$.browser.msie&&!d&&function(){var q,r;j.start=function(){if(!q){r=$.fn[c].src;r=r&&r+a();q=$('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){r||l(a());n()}).attr("src",r||"javascript:0").insertAfter("body")[0].contentWindow;h.onpropertychange=function(){try{if(event.propertyName==="title"){q.document.title=h.title}}catch(s){}}}};j.stop=k;o=function(){return a(q.location.href)};l=function(v,s){var u=q.document,t=$.fn[c].domain;if(v!==s){u.title=h.title;u.open();t&&u.write('<script>document.domain="'+t+'"</script>');u.close();q.location.hash=v}}}();return j}()})(jQuery,this);
(function(factory){if(typeof define!=="undefined"&&define.amd){define(["jquery"],factory)}else if(typeof module!=="undefined"&&module.exports){var $=require("jquery");module.exports=factory($)}else{window.scrollMonitor=factory(jQuery)}})(function($){var exports={};var $window=$(window);var $document=$(document);var watchers=[];var VISIBILITYCHANGE="visibilityChange";var ENTERVIEWPORT="enterViewport";var FULLYENTERVIEWPORT="fullyEnterViewport";var EXITVIEWPORT="exitViewport";var PARTIALLYEXITVIEWPORT="partiallyExitViewport";var LOCATIONCHANGE="locationChange";var STATECHANGE="stateChange";var eventTypes=[VISIBILITYCHANGE,ENTERVIEWPORT,FULLYENTERVIEWPORT,EXITVIEWPORT,PARTIALLYEXITVIEWPORT,LOCATIONCHANGE,STATECHANGE];var defaultOffsets={top:0,bottom:0};exports.viewportTop;exports.viewportBottom;exports.documentHeight;exports.viewportHeight=$window.height();var previousDocumentHeight;var latestEvent;var calculateViewportI;function calculateViewport(){exports.viewportTop=$window.scrollTop();exports.viewportBottom=exports.viewportTop+exports.viewportHeight;exports.documentHeight=$document.height();if(exports.documentHeight!==previousDocumentHeight){calculateViewportI=watchers.length;while(calculateViewportI--){watchers[calculateViewportI].recalculateLocation()}previousDocumentHeight=exports.documentHeight}}function recalculateWatchLocationsAndTrigger(){exports.viewportHeight=$window.height();calculateViewport();updateAndTriggerWatchers()}var recalculateAndTriggerTimer;function debouncedRecalcuateAndTrigger(){clearTimeout(recalculateAndTriggerTimer);recalculateAndTriggerTimer=setTimeout(recalculateWatchLocationsAndTrigger,100)}var updateAndTriggerWatchersI;function updateAndTriggerWatchers(){updateAndTriggerWatchersI=watchers.length;while(updateAndTriggerWatchersI--){watchers[updateAndTriggerWatchersI].update()}updateAndTriggerWatchersI=watchers.length;while(updateAndTriggerWatchersI--){watchers[updateAndTriggerWatchersI].triggerCallbacks()}}function ElementWatcher(watchItem,offsets){var self=this;this.watchItem=watchItem;if(!offsets){this.offsets=defaultOffsets}else if(offsets===+offsets){this.offsets={top:offsets,bottom:offsets}}else{this.offsets=$.extend({},defaultOffsets,offsets)}this.callbacks={};for(var i=0,j=eventTypes.length;i<j;i++){self.callbacks[eventTypes[i]]=[]}this.locked=false;var wasInViewport;var wasFullyInViewport;var wasAboveViewport;var wasBelowViewport;var listenerToTriggerListI;var listener;function triggerCallbackArray(listeners){if(listeners.length===0){return}listenerToTriggerListI=listeners.length;while(listenerToTriggerListI--){listener=listeners[listenerToTriggerListI];listener.callback.call(self,latestEvent);if(listener.isOne){listeners.splice(listenerToTriggerListI,1)}}}this.triggerCallbacks=function triggerCallbacks(){if(this.isInViewport&&!wasInViewport){triggerCallbackArray(this.callbacks[ENTERVIEWPORT])}if(this.isFullyInViewport&&!wasFullyInViewport){triggerCallbackArray(this.callbacks[FULLYENTERVIEWPORT])}if(this.isAboveViewport!==wasAboveViewport&&this.isBelowViewport!==wasBelowViewport){triggerCallbackArray(this.callbacks[VISIBILITYCHANGE]);if(!wasFullyInViewport&&!this.isFullyInViewport){triggerCallbackArray(this.callbacks[FULLYENTERVIEWPORT]);triggerCallbackArray(this.callbacks[PARTIALLYEXITVIEWPORT])}if(!wasInViewport&&!this.isInViewport){triggerCallbackArray(this.callbacks[ENTERVIEWPORT]);triggerCallbackArray(this.callbacks[EXITVIEWPORT])}}if(!this.isFullyInViewport&&wasFullyInViewport){triggerCallbackArray(this.callbacks[PARTIALLYEXITVIEWPORT])}if(!this.isInViewport&&wasInViewport){triggerCallbackArray(this.callbacks[EXITVIEWPORT])}if(this.isInViewport!==wasInViewport){triggerCallbackArray(this.callbacks[VISIBILITYCHANGE])}switch(true){case wasInViewport!==this.isInViewport:case wasFullyInViewport!==this.isFullyInViewport:case wasAboveViewport!==this.isAboveViewport:case wasBelowViewport!==this.isBelowViewport:triggerCallbackArray(this.callbacks[STATECHANGE])}wasInViewport=this.isInViewport;wasFullyInViewport=this.isFullyInViewport;wasAboveViewport=this.isAboveViewport;wasBelowViewport=this.isBelowViewport};this.recalculateLocation=function(){if(this.locked){return}var previousTop=this.top;var previousBottom=this.bottom;if(this.watchItem.nodeName){var cachedDisplay=this.watchItem.style.display;if(cachedDisplay==="none"){this.watchItem.style.display=""}var elementLocation=$(this.watchItem).offset();this.top=elementLocation.top;this.bottom=elementLocation.top+this.watchItem.offsetHeight;if(cachedDisplay==="none"){this.watchItem.style.display=cachedDisplay}}else if(this.watchItem===+this.watchItem){if(this.watchItem>0){this.top=this.bottom=this.watchItem}else{this.top=this.bottom=exports.documentHeight-this.watchItem}}else{this.top=this.watchItem.top;this.bottom=this.watchItem.bottom}this.top-=this.offsets.top;this.bottom+=this.offsets.bottom;this.height=this.bottom-this.top;if((previousTop!==undefined||previousBottom!==undefined)&&(this.top!==previousTop||this.bottom!==previousBottom)){triggerCallbackArray(this.callbacks[LOCATIONCHANGE])}};this.recalculateLocation();this.update();wasInViewport=this.isInViewport;wasFullyInViewport=this.isFullyInViewport;wasAboveViewport=this.isAboveViewport;wasBelowViewport=this.isBelowViewport}ElementWatcher.prototype={on:function(event,callback,isOne){switch(true){case event===VISIBILITYCHANGE&&!this.isInViewport&&this.isAboveViewport:case event===ENTERVIEWPORT&&this.isInViewport:case event===FULLYENTERVIEWPORT&&this.isFullyInViewport:case event===EXITVIEWPORT&&this.isAboveViewport&&!this.isInViewport:case event===PARTIALLYEXITVIEWPORT&&this.isAboveViewport:callback();if(isOne){return}}if(this.callbacks[event]){this.callbacks[event].push({callback:callback,isOne:isOne})}else{throw new Error("Tried to add a scroll monitor listener of type "+event+". Your options are: "+eventTypes.join(", "))}},off:function(event,callback){if(this.callbacks[event]){for(var i=0,item;item=this.callbacks[event][i];i++){if(item.callback===callback){this.callbacks[event].splice(i,1);break}}}else{throw new Error("Tried to remove a scroll monitor listener of type "+event+". Your options are: "+eventTypes.join(", "))}},one:function(event,callback){this.on(event,callback,true)},recalculateSize:function(){this.height=this.watchItem.offsetHeight+this.offsets.top+this.offsets.bottom;this.bottom=this.top+this.height},update:function(){this.isAboveViewport=this.top<exports.viewportTop;this.isBelowViewport=this.bottom>exports.viewportBottom;this.isInViewport=this.top<=exports.viewportBottom&&this.bottom>=exports.viewportTop;this.isFullyInViewport=this.top>=exports.viewportTop&&this.bottom<=exports.viewportBottom||this.isAboveViewport&&this.isBelowViewport},destroy:function(){var index=watchers.indexOf(this),self=this;watchers.splice(index,1);for(var i=0,j=eventTypes.length;i<j;i++){self.callbacks[eventTypes[i]].length=0}},lock:function(){this.locked=true},unlock:function(){this.locked=false}};var eventHandlerFactory=function(type){return function(callback,isOne){this.on.call(this,type,callback,isOne)}};for(var i=0,j=eventTypes.length;i<j;i++){var type=eventTypes[i];ElementWatcher.prototype[type]=eventHandlerFactory(type)}calculateViewport();function scrollMonitorListener(event){latestEvent=event;calculateViewport();updateAndTriggerWatchers()}$window.on("scroll",scrollMonitorListener);$window.on("resize",debouncedRecalcuateAndTrigger);exports.beget=exports.create=function(element,offsets){if(typeof element==="string"){element=$(element)[0]}if(element instanceof $){element=element[0]}var watcher=new ElementWatcher(element,offsets);watchers.push(watcher);watcher.update();return watcher};exports.update=function(){latestEvent=null;calculateViewport();updateAndTriggerWatchers()};exports.recalculateLocations=function(){exports.documentHeight=0;exports.update()};return exports});
(function(window){"use strict";function classReg(className){return new RegExp("(^|\\s+)"+className+"(\\s+|$)")}var hasClass,addClass,removeClass;if("classList"in document.documentElement){hasClass=function(elem,c){return elem.classList.contains(c)};addClass=function(elem,c){elem.classList.add(c)};removeClass=function(elem,c){elem.classList.remove(c)}}else{hasClass=function(elem,c){return classReg(c).test(elem.className)};addClass=function(elem,c){if(!hasClass(elem,c)){elem.className=elem.className+" "+c}};removeClass=function(elem,c){elem.className=elem.className.replace(classReg(c)," ")}}function toggleClass(elem,c){var fn=hasClass(elem,c)?removeClass:addClass;fn(elem,c)}var classie={hasClass:hasClass,addClass:addClass,removeClass:removeClass,toggleClass:toggleClass,has:hasClass,add:addClass,remove:removeClass,toggle:toggleClass};if(typeof define==="function"&&define.amd){define(classie)}else if(typeof exports==="object"){module.exports=classie}else{window.classie=classie}})(window);
(function(){var _global=this;var _rng;if(typeof _global.require=="function"){try{var _rb=_global.require("crypto").randomBytes;_rng=_rb&&function(){return _rb(16)}}catch(e){}}if(!_rng&&_global.crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);_rng=function whatwgRNG(){crypto.getRandomValues(_rnds8);return _rnds8}}if(!_rng){var _rnds=new Array(16);_rng=function(){for(var i=0,r;i<16;i++){if((i&3)===0)r=Math.random()*4294967296;_rnds[i]=r>>>((i&3)<<3)&255}return _rnds}}var BufferClass=typeof _global.Buffer=="function"?_global.Buffer:Array;var _byteToHex=[];var _hexToByte={};for(var i=0;i<256;i++){_byteToHex[i]=(i+256).toString(16).substr(1);_hexToByte[_byteToHex[i]]=i}function parse(s,buf,offset){var i=buf&&offset||0,ii=0;buf=buf||[];s.toLowerCase().replace(/[0-9a-f]{2}/g,function(oct){if(ii<16){buf[i+ii++]=_hexToByte[oct]}});while(ii<16){buf[i+ii++]=0}return buf}function unparse(buf,offset){var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}var _seedBytes=_rng();var _nodeId=[_seedBytes[0]|1,_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]];var _clockseq=(_seedBytes[6]<<8|_seedBytes[7])&16383;var _lastMSecs=0,_lastNSecs=0;function v1(options,buf,offset){var i=buf&&offset||0;var b=buf||[];options=options||{};var clockseq=options.clockseq!=null?options.clockseq:_clockseq;var msecs=options.msecs!=null?options.msecs:(new Date).getTime();var nsecs=options.nsecs!=null?options.nsecs:_lastNSecs+1;var dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&options.clockseq==null){clockseq=clockseq+1&16383}if((dt<0||msecs>_lastMSecs)&&options.nsecs==null){nsecs=0}if(nsecs>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}_lastMSecs=msecs;_lastNSecs=nsecs;_clockseq=clockseq;msecs+=122192928e5;var tl=((msecs&268435455)*1e4+nsecs)%4294967296;b[i++]=tl>>>24&255;b[i++]=tl>>>16&255;b[i++]=tl>>>8&255;b[i++]=tl&255;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255;b[i++]=tmh&255;b[i++]=tmh>>>24&15|16;b[i++]=tmh>>>16&255;b[i++]=clockseq>>>8|128;b[i++]=clockseq&255;var node=options.node||_nodeId;for(var n=0;n<6;n++){b[i+n]=node[n]}return buf?buf:unparse(b)}function v4(options,buf,offset){var i=buf&&offset||0;if(typeof options=="string"){buf=options=="binary"?new BufferClass(16):null;options=null}options=options||{};var rnds=options.random||(options.rng||_rng)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){for(var ii=0;ii<16;ii++){buf[i+ii]=rnds[ii]}}return buf||unparse(rnds)}var uuid=v4;uuid.v1=v1;uuid.v4=v4;uuid.parse=parse;uuid.unparse=unparse;uuid.BufferClass=BufferClass;if(typeof define==="function"&&define.amd){define(function(){return uuid})}else if(typeof module!="undefined"&&module.exports){module.exports=uuid}else{var _previousRoot=_global.uuid;uuid.noConflict=function(){_global.uuid=_previousRoot;return uuid};_global.uuid=uuid}}).call(this);
(function($){$.fn.twentytwenty=function(options){var options=$.extend({default_offset_pct:.5},options);return this.each(function(){var sliderPct=options.default_offset_pct;var container=$(this);var beforeImg=container.find("img:first");var afterImg=container.find("img:last");container.append("<div class='twentytwenty-handle-wrapper'><div class='twentytwenty-handle'></div></div>");var slider=container.find(".twentytwenty-handle");slider.append("<div class='twentytwenty-left-arrow'></div>");slider.append("<div class='twentytwenty-right-arrow'></div>");container.addClass("twentytwenty-container");beforeImg.addClass("twentytwenty-before");afterImg.addClass("twentytwenty-after");var captionHeight=container.find("figcaption").height()||0;var calcOffset=function(widthPct){var w=beforeImg.width();var h=beforeImg.height();return{w:w+"px",h:h+"px",cw:widthPct*w+"px"}};var adjustContainer=function(offset){beforeImg.css("clip","rect(0,"+offset.cw+","+offset.h+",0)");container.css("height",offset.h+captionHeight);container.find("a:last, .twentytwenty-handle-wrapper").css("height",offset.h)};var adjustSlider=function(pct){var offset=calcOffset(pct);if(offset.h==="0px"){beforeImg.on("load",function(){adjustSlider(pct)})}slider.css("left",offset.cw);adjustContainer(offset)};$(window).on("resize.twentytwenty",function(e){adjustSlider(sliderPct)});var offsetX=0;var imgWidth=0;container.on("movestart",function(e){if(e.distX>e.distY&&e.distX<-e.distY||e.distX<e.distY&&e.distX>-e.distY){e.preventDefault()}container.addClass("active");offsetX=container.offset().left;imgWidth=beforeImg.width()});container.on("moveend",function(e){container.removeClass("active")});container.on("move",function(e){if(container.hasClass("active")){sliderPct=(e.pageX-offsetX)/imgWidth;if(sliderPct<0){sliderPct=0}if(sliderPct>1){sliderPct=1}adjustSlider(sliderPct)}});container.find("img").on("mousedown",function(e){e.preventDefault()});slider.on("mousedown",function(e){offsetX=container.offset().left;imgWidth=beforeImg.width();sliderPct=(e.pageX-offsetX)/imgWidth;if(sliderPct<0){sliderPct=0}if(sliderPct>1){sliderPct=1}adjustSlider(sliderPct)});$(window).trigger("resize.twentytwenty")})}})(jQuery);$(function(){$('[data-embed-type="comparison"]').twentytwenty();if(typeof tinymce!=="undefined"){tinymce.onAddEditor.add(function(mgr,ed){$(ed.getDoc()).find('[data-embed-type="comparison"]').twentytwenty();ed.onExecCommand.add(function(ed,cmd,ui,val){if(cmd=="mceEmbedImage"){$(ed.getDoc()).find('[data-embed-type="comparison"]').twentytwenty()}});ed.onInit.add(function(ed){$(ed.getDoc()).find('[data-embed-type="comparison"]').twentytwenty()})})}});
var hinclude=function($){"use strict";var classprefix="include_",cookieName="REMEMBERME",webStorage=null,includeTags,includes={},pending,urls=[],etags=[],hincludeLoaded=false,exports={loaded:function(callback){if(hincludeLoaded){callback()}else{$(document).on("hincludeLoaded",callback)}}};if(typeof localStorage!=="undefined"){webStorage=localStorage}else if(typeof sessionStorage!=="undefined"){webStorage=sessionStorage}$(document).ready(function(){includeTags=$("hx\\:include");if($.cookie(cookieName)===null){includeTags=includeTags.filter("[data-always-load]")}pending=includeTags.length;if(pending===0){pending=0;includeComplete();return}includeTags.each(function(){var include=$(this),url=include.attr("src"),localCache=loadFromStorage(url);if(localCache){include.html(localCache.data);if(typeof localCache.expires!=="undefined"&&$.now()<localCache.expires){includeComplete();registerEvents(include,url);return}}includes[url]=include;urls.push(url);if(localCache){etags.push(localCache.etag)}});if(urls.length===1){$.each(urls,function(key,url){var realurl=url;if(webStorage!==null&&typeof etags[key]!=="undefined"){realurl=url+(/\?/.test(url)?"&":"?")+"_="+etags[key]}AjaxApiRequest.makeGetApiRequest(realurl,{},function(data,textStatus,jqXHR){updateHinclude(url,data,jqXHR.getResponseHeader("Cache-Control"),jqXHR.getResponseHeader("Etag"),jqXHR.status)})})}else if(urls.length>0){AjaxApiRequest.makeGetApiRequest("/hinclude/",{urls:urls,etags:etags},function(data,textStatus,jqXHR){$.each(data,function(url,value){updateHinclude(url,value.html,value.cache,value.etag,value.status)});if(!hincludeLoaded){pending=0;includeComplete()}})}});var updateHinclude=function(url,data,cache,etag,status){if(status===304){var cached=loadFromStorage(url);data=cached.data}includes[url].html(data);var age=cache.match(/max-age=(\d+)/),expires=false;if(age){expires=$.now()+age.pop()*1e3}if(expires){saveToStorage(url,data,expires,etag);registerEvents(includes[url],url)}includeComplete()};var includeComplete=function(){pending--;if(pending<=0){hincludeLoaded=true;$(document).trigger("hincludeLoaded")}$(document.documentElement).removeClass("hinclude-loading")};var loadFromStorage=function(url){if(webStorage===null){return false}var result,key=getKey(url);try{result=webStorage.getItem(key)}catch(e){if(webStorage!==sessionStorage&&typeof sessionStorage!=="undefined"){webStorage=sessionStorage;try{result=webStorage.getItem(key)}catch(e){webStorage=null}}}if(typeof result==="undefined"){return false}return JSON.parse(result)};var saveToStorage=function(url,result,expires,etag){if(webStorage===null){return}var key=getKey(url);var data=JSON.stringify({data:result,expires:expires,etag:etag});try{webStorage.setItem(key,data)}catch(e){try{webStorage.clear();webStorage.setItem(key,data)}catch(e){webStorage=null}}};var registerEvents=function(include,url){include.one("click",function(){var data=loadFromStorage(url);if(data){saveToStorage(url,data.data,$.now(),$.now())}})};var getKey=function(url){return"hinclude:v2:"+$.cookie(cookieName)+":"+url};return exports}(jQuery);
(function($){$.fn.unveil=function(threshold,callback){var $w=$(window),th=threshold||0,retina=window.devicePixelRatio>1,attrib=retina?"data-src-retina":"data-src",images=this,loaded;this.one("unveil",function(){var source=this.getAttribute(attrib);source=source||this.getAttribute("data-src");if(source){this.setAttribute("src",source);if(typeof callback==="function")callback.call(this)}});function unveil(){var inview=images.filter(function(){var $e=$(this);if($e.is(":hidden"))return;var wt=$w.scrollTop(),wb=wt+$w.height(),et=$e.offset().top,eb=et+$e.height();return eb>=wt-th&&et<=wb+th});loaded=inview.trigger("unveil");images=images.not(loaded)}$w.on("scroll.unveil resize.unveil lookup.unveil",unveil);unveil();return this}})(window.jQuery||window.Zepto);
var _documentHiddenPropertyName=null;var _documentVisibilityChangeEventName=null;$.fn.hidden=function(){if(this[0]!==document){return false}if(_documentHiddenPropertyName===null&&_documentHiddenPropertyName!=="incompatible"){var properties=[["hidden","visibilitychange"],["mozHidden","mozvisibilitychange"],["msHidden","msvisibilitychange"],["webkitHidden","webkitvisibilitychange"]];$.each(properties,function(key,value){if(typeof document[value[0]]!=="undefined"){_documentHiddenPropertyName=value[0];_documentVisibilityChangeEventName=value[1];return false}});if(_documentHiddenPropertyName===null){_documentHiddenPropertyName="incompatible"}}if(arguments.length===0){if(_documentHiddenPropertyName===null){return true}return document[_documentHiddenPropertyName]}return this.on(_documentVisibilityChangeEventName,arguments[0])};
$(document).ready(function(){"use strict";var switchToDetailsView=function(){$("#feed-view-details").addClass("on");$("#feed-view-river").removeClass("on");$("#feed-view-compact").removeClass("on");$("#feed-view-grid").removeClass("on");var editorial=$("#river .editorial");if(editorial.length===0){editorial=$("#feed-view-details").parents(".feed-hdr").first().siblings(".editorial")}editorial.addClass("details");editorial.removeClass("compact");editorial.removeClass("river");editorial.removeClass("grid row")};var switchToCompactView=function(){$("#feed-view-compact").addClass("on");$("#feed-view-river").removeClass("on");$("#feed-view-details").removeClass("on");$("#feed-view-grid").removeClass("on");var editorial=$("#river .editorial");if(editorial.length===0){editorial=$("#feed-view-compact").parents(".feed-hdr").first().siblings(".editorial")}editorial.addClass("compact");editorial.removeClass("details");editorial.removeClass("list");editorial.removeClass("grid row")};var switchToRiverView=function(){$("#feed-view-river").addClass("on");$("#feed-view-details").removeClass("on");$("#feed-view-compact").removeClass("on");$("#feed-view-grid").removeClass("on");var editorial=$("#river .editorial");if(editorial.length===0){editorial=$("#feed-view-river").parents(".feed-hdr").first().siblings(".editorial")}editorial.addClass("river");editorial.removeClass("details");editorial.removeClass("compact");editorial.removeClass("grid row")};var switchToGridView=function(){$("#feed-view-grid").addClass("on");$("#feed-view-river").removeClass("on");$("#feed-view-details").removeClass("on");$("#feed-view-compact").removeClass("on");var editorial=$("#river .editorial");if(editorial.length===0){editorial=$("#feed-view-river").parents(".feed-hdr").first().siblings(".editorial")}editorial.addClass("grid row");editorial.removeClass("river");editorial.removeClass("details");editorial.removeClass("compact")};var setFeedCookie=function(name,type){if(name!==undefined){$.cookie("feed-group-"+name,type,{expires:365,path:"/"})}};$(document).on("click","#feed-view-details",function(e){var feedName=$(this).parents("dl:first").attr("data-feed-group");switchToDetailsView();e.preventDefault();setFeedCookie(feedName,"Details")});$(document).on("click","#feed-view-compact",function(e){var feedName=$(this).parents("dl:first").attr("data-feed-group");switchToCompactView();e.preventDefault();setFeedCookie(feedName,"Compact")});$(document).on("click","#feed-view-river",function(e){var feedName=$(this).parents("dl:first").attr("data-feed-group");switchToRiverView();e.preventDefault();setFeedCookie(feedName,"River")});$(document).on("click","#feed-view-grid",function(e){var feedName=$(this).parents("dl:first").attr("data-feed-group");switchToGridView();e.preventDefault();setFeedCookie(feedName,"Grid")})});
$(document).ready(function(){"use strict";var countdownSelector=".js-time-countdown";var countdownHideClassName="hide";var countdownUnitSingularClassName="time-unit--singular";var countdownHasMsKey="has-ms";var countdownIdDataKey="countdown-id";var countdownTargetDateKey="target-date";var countdownTickKey="tick";var msPerSecond=1e3;var msPerMinute=msPerSecond*60;var msPerHour=msPerMinute*60;var msPerDay=msPerHour*24;var msPerSwatchBeat=msPerDay/1e3;var msPerCentiSwatchBeat=msPerSwatchBeat/100;var countdownCount=0;var countdownUnitElements={};var isSwatchCountdown=false;var masterTickDuration=null;var countdownsByTicks={};var formatUnit=function(unit){return(unit<10?"0":"")+unit};var getTimeString=function(diffInfo,timeStringPrefix){var timeString="";if(undefined===timeStringPrefix){timeStringPrefix="in "}if(diffInfo.swatch){timeString+="<em>@</em>"+diffInfo.swatch+" <em>.beats</em>"}else{if(diffInfo.days>0){timeString+=diffInfo.days+"<em>d</em> "}timeString+=formatUnit(diffInfo.hours)+"<em>h</em> ";timeString+=formatUnit(diffInfo.minutes)+"<em>m</em> ";timeString+=formatUnit(diffInfo.seconds)+"<em>s</em>"}return timeStringPrefix+timeString};var getTimeDifference=function(targetDate){var now=Date.now(),diff=targetDate-now;if(diff<=0){diff=null}return diff};var getCountdownInfo=function(difference,unitElements){if(isSwatchCountdown){var swatch=Math.floor(difference/msPerCentiSwatchBeat)/100;if(isNaN(swatch)){swatch=0}if(swatch>0){swatch=swatch.toFixed(2)}return{swatch:swatch}}var info={},daysDifference,hoursDifference,minutesDifference,secondsDifference,isSimpleCountdown=$.isEmptyObject(unitElements);if(isSimpleCountdown||unitElements.days){daysDifference=Math.floor(difference/msPerDay);difference-=daysDifference*msPerDay;info.days=isNaN(daysDifference)?0:daysDifference}if(isSimpleCountdown||unitElements.hours){hoursDifference=Math.floor(difference/msPerHour);difference-=hoursDifference*msPerHour;info.hours=isNaN(hoursDifference)?0:hoursDifference}if(isSimpleCountdown||unitElements.minutes){minutesDifference=Math.floor(difference/msPerMinute);difference-=minutesDifference*msPerMinute;info.minutes=isNaN(minutesDifference)?0:minutesDifference}if(isSimpleCountdown||unitElements.seconds){secondsDifference=Math.floor(difference/msPerSecond);difference-=secondsDifference*msPerSecond;info.seconds=isNaN(secondsDifference)?0:secondsDifference}if(!isSimpleCountdown&&unitElements.milliseconds){info.milliseconds=isNaN(difference)?0:difference}return info};var getCountdownId=function($countdown){var countdownId=$countdown.data(countdownIdDataKey);if(!countdownId){countdownCount++;countdownId=countdownCount;$countdown.data(countdownIdDataKey,countdownId)}return countdownId};var setUnitElements=function(countdownId,unitElements){countdownUnitElements[countdownId]=unitElements};var getUnitElements=function($countdown){var countdownId=getCountdownId($countdown),unitElements=countdownUnitElements[countdownId],$unitElements;if(undefined===unitElements){unitElements={};$unitElements=$countdown.find(".js-time-unit");if(!$unitElements||0===$unitElements.length){unitElements=null}else{$unitElements.each(function(){var $unitElement=$(this),$value=$unitElement.find(".js-time-value"),unitName=$unitElement.data("unit");if(!!unitName){unitElements[unitName]={$element:$unitElement,$value:$value}}})}countdownUnitElements[countdownId]=unitElements}return unitElements};var formatCountdown=function($countdown,diff){var countdownId=getCountdownId($countdown),unitElements=getUnitElements($countdown),matchedUnitElements=0,changedUnitElementsObject=false,showLeadZero=!!$countdown.data("show-lead-zero"),timeInfo=getCountdownInfo(diff,unitElements),previousUnitValue=0;if(null!==unitElements){$.each(timeInfo,function(unitName,unitValue){var unit=unitElements[unitName];if(!unit){return}var unitValueText=unitValue.toString(),$unitElement=unit.$element,$unitValue=unit.$value,removeOnZero=!!$unitElement.data("remove-on-zero");if($unitElement){$unitElement.removeClass(countdownHideClassName);if(true===removeOnZero&&1>unitValue&&1>previousUnitValue){$unitElement.remove();delete unitElements[unitName];changedUnitElementsObject=true}else{if(unitValue===1){$unitElement.addClass(countdownUnitSingularClassName)}else{$unitElement.removeClass(countdownUnitSingularClassName)}if(true===showLeadZero){unitValueText=formatUnit(unitValue)}if(!!$unitValue&&0<$unitValue.length){$unitValue.text(unitValueText)}else{$unitElement.text(unitValueText)}matchedUnitElements++}}previousUnitValue+=unitValue})}if(0===matchedUnitElements){if(!$.isEmptyObject(unitElements)){unitElements=null;setUnitElements(countdownId,unitElements)}if(!timeInfo.seconds){timeInfo=getCountdownInfo(diff,unitElements)}$countdown.html(getTimeString(timeInfo))}if(changedUnitElementsObject){setUnitElements(countdownId,unitElements)}};var hasMilliseconds=function($countdown){var hasMs=$countdown.data(countdownHasMsKey)||null,unitElements;if(null===hasMs){unitElements=getUnitElements($countdown);if(null!==unitElements&&unitElements.milliseconds){hasMs=true}$countdown.data(countdownHasMsKey,hasMs)}return hasMs};var getTickDuration=function(){if(null===masterTickDuration){masterTickDuration=msPerSecond;if(isSwatchCountdown){masterTickDuration=msPerCentiSwatchBeat}}return masterTickDuration};var getTimeToNextTick=function(tick,hasTicked){var timeToNextTick=tick,now;if(false===hasTicked){now=Date.now();timeToNextTick=now%timeToNextTick}return timeToNextTick};var clearTickTimeout=function(countdownsByTick){clearTimeout(countdownsByTick.timeoutId);countdownsByTick.timeoutId=null};var finishCountdown=function($countdown){var liveMsg=$countdown.data("live-msg"),countdownsByTick,$countdowns;$countdown.trigger("complete");$countdown.data("complete",true);if(null===liveMsg||undefined===liveMsg){liveMsg="is Live!"}$countdown.html(liveMsg);countdownsByTick=countdownsByTicks[$countdown.data(countdownTickKey)];$countdowns=countdownsByTick.$countdowns;$countdowns=$countdowns.not($countdown);countdownsByTick.$countdowns=$countdowns};var updateCountdown=function(){var $countdown=$(this),targetDate=$countdown.data(countdownTargetDateKey),diff=getTimeDifference(targetDate);if(!diff){finishCountdown($countdown);return}formatCountdown($countdown,diff)};var updateCountdowns=function(tick,countdownsByTick){var hasTicked=countdownsByTick.hasTicked,$countdowns=countdownsByTick.$countdowns,adjustedTick;clearTickTimeout(countdownsByTick);if($countdowns.length>0){adjustedTick=getTimeToNextTick(tick,hasTicked);$countdowns.each(updateCountdown);if(false===hasTicked){countdownsByTick.hasTicked=true}countdownsByTick.timeoutId=setTimeout(function(){updateCountdowns(tick,countdownsByTick)},adjustedTick)}};var updateCountdownsByTicks=function(){var tick,countdownsByTick;for(tick in countdownsByTicks){if(countdownsByTicks.hasOwnProperty(tick)){countdownsByTick=countdownsByTicks[tick];updateCountdowns(tick,countdownsByTick)}}};var initCountdownTimer=function(){var countdown=this,$countdown=$(countdown),timestamp=$countdown.data("timestamp")||$countdown.text(),targetDate=parseInt(timestamp,10)*1e3,tick;$countdown.data(countdownTargetDateKey,targetDate);getCountdownId($countdown);if(!isSwatchCountdown&&hasMilliseconds($countdown)){tick=1}else{tick=getTickDuration()}$countdown.data(countdownTickKey,tick);if(undefined===countdownsByTicks[tick]){countdownsByTicks[tick]=[]}countdownsByTicks[tick].push(countdown)};var initCountdownTimers=function($countdowns){var params=$.deparam.querystring(),tick,countdownsByTick;if(params.swatch){isSwatchCountdown=true}$countdowns.each(initCountdownTimer);$countdowns.removeClass(countdownHideClassName);$countdowns.addClass("is-counting");for(tick in countdownsByTicks){if(countdownsByTicks.hasOwnProperty(tick)){countdownsByTick=countdownsByTicks[tick];if(typeof countdownsByTick["$countdowns"]==="undefined"){countdownsByTicks[tick]={timeoutId:null,hasTicked:false,$countdowns:$(countdownsByTick)}}}}updateCountdownsByTicks()};(function(){var $countdowns=$(countdownSelector);if(!$countdowns||$countdowns.length===0){return}initCountdownTimers($countdowns)})();$(document).ajaxComplete(function(){masterTickDuration++;var $countdowns=$(countdownSelector).not(".is-counting");if(!$countdowns||$countdowns.length===0){return}initCountdownTimers($countdowns)})});
$.ui.draggable.prototype._generatePosition=function(event){var o=this.options,scroll=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName);var pageX=event.pageX;var pageY=event.pageY;if(this.originalPosition){var containment;if(this.containment){if(this.relative_container){var co=this.relative_container.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top]}else{containment=this.containment}if(event.pageX-this.offset.click.left<containment[0])pageX=containment[0]+this.offset.click.left;if(event.pageY-this.offset.click.top<containment[1])pageY=containment[1]+this.offset.click.top;if(event.pageX-this.offset.click.left>containment[2])pageX=containment[2]+this.offset.click.left;if(event.pageY-this.offset.click.top>containment[3])pageY=containment[3]+this.offset.click.top}if(o.grid){var top=o.grid[1]?this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment?!(top-this.offset.click.top<containment[1]||top-this.offset.click.top>containment[3])?top:!(top-this.offset.click.top<containment[1])?top-o.grid[1]:top+o.grid[1]:top;var left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment?!(left-this.offset.click.left<containment[0]||left-this.offset.click.left>containment[2])?left:!(left-this.offset.click.left<containment[0])?left-o.grid[0]:left+o.grid[0]:left}}ret={top:pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+($.browser.safari&&$.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop()),left:pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+($.browser.safari&&$.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())};if($(this.element.parents("div")[0]).css("overflow-x")==="scroll"&&pageY-this.offset.click.top===ret.top){}return ret};
var Phoenix=function(){};Phoenix._$body=$("body");Phoenix._$window=$(window);Phoenix._$document=$(document);Phoenix._$messageBlock=$("#message-block");Phoenix.setWindow=function(){return Phoenix._$window};Phoenix.setDocument=function(){return Phoenix._$document};Phoenix.setBody=function(){return Phoenix._$body};Phoenix.setMessageBlock=function(){return Phoenix._$messageBlock};Phoenix.getWindow=function(){return Phoenix._$document};Phoenix.getDocument=function(){return Phoenix._$document};Phoenix.getBody=function(){return Phoenix._$body};Phoenix.getMessageBlock=function(){return Phoenix._$messageBlock};Phoenix._uniqueIdAlphabet="abcdefghijklmnopqrstuvwxyz0123456789";Phoenix._uniqueIdAlphabetLength=Phoenix._uniqueIdAlphabet.length-1;Phoenix.makeUniqueId=function(prefix,length){var output="";var min=0,max=Phoenix._uniqueIdAlphabetLength;var alphabet=Phoenix._uniqueIdAlphabet;var i,rand;if(prefix===undefined){prefix=""}for(i=0,rand;i<length;i++){rand=Math.floor(Math.random()*(max-min+1))+min;output+=alphabet[rand]}return prefix+output};Phoenix.userLoggedIn=function(){return $("meta[name=userAuthState]").attr("content")==="loggedIn"};
Phoenix.Cryptography=function(){};Phoenix.Cryptography.random=function(min,max){min=parseInt(min,10);max=parseInt(max,10);if(!isNaN(min)&&!isNaN(max)){return Math.floor(Math.random()*(max-min+1))+min}return Math.random()};Phoenix.Cryptography.randomString=function(length,type){if(!length){length=32}var digits="0123456789";var abcdef="abcdef";var upperAlpha="ABCDEFGHIJKLMNOPQRSTUVWXYZ";var alphabet=upperAlpha.toLowerCase()+upperAlpha+digits+"+/";var output="";if(type!==undefined){if(type==="alphanumeric"){alphabet=upperAlpha.toLowerCase()+upperAlpha+digits}else if(type==="base56"){alphabet=upperAlpha.toLowerCase()+upperAlpha+digits.substr(2)}else if(type==="alpha"){alphabet=upperAlpha.toLowerCase()+upperAlpha}else if(type==="base36"){alphabet=upperAlpha+digits}else if(type==="hexadecimal"){alphabet=abcdef+digits}else if(type==="numeric"){alphabet=digits}}for(var i=0,alphaLen=alphabet.length-1;i<length;i++){output+=alphabet.charAt(Phoenix.Cryptography.random(0,alphaLen))}return output};
Phoenix.CMS=function(){};
Phoenix.jQuery=function(window,document){"use strict";var elements={};var setters={setWindow:function(){elements.win=$(window);return elements.win},setDocument:function(){elements.doc=$(document);return elements.doc},setHtml:function(){elements.html=$("html");return elements.html},setBody:function(){elements.body=$("body");return elements.body},setWrapper:function(){elements.wrapper=$("#wrapper");return elements.wrapper},setMessageBlock:function(){elements.messageBlock=$("#message-block");return elements.messageBlock},setLoadingScreen:function(message){if(!message){message="Very busy&hellip;"}elements.loadingScreen=$('<div class="modal-backdrop"></div><div class="loading-global">'+message+"</div>").data("msg",message);return elements.loadingScreen}};var getters={getWindow:function(){return elements.win||setters.setWindow()},getDocument:function(){return elements.doc||setters.setDocument()},getHtml:function(){return elements.html||setters.setHtml()},getBody:function(){return elements.body||setters.setBody()},getWrapper:function(){return elements.wrapper||setters.setWrapper()},getMessageBlock:function(){return elements.messageBlock||setters.setMessageBlock()},getLoadingScreen:function(msg,remove){return elements.loadingScreen&&(elements.loadingScreen.data("msg")===msg||remove)?elements.loadingScreen:setters.setLoadingScreen(msg)},getEvents:function($element){var processChildEvents=function(){var $this=$(this);var events=$this.data("events");if(events===undefined){return}window.console.log($this,events);if($this.children().length!==0){processChildEvents($this.children())}};var events=$element.data("events");if(events!==undefined){window.console.log($element,$element.data("events"))}$element.children().each(processChildEvents)}};return getters}(this,this.document);
Phoenix.Grammar={};Phoenix.Grammar._humanizeCache={};Phoenix.Grammar._underscorizeCache={};Phoenix.Grammar._camelizeCache={upper:{},lower:{}};Phoenix.Grammar._rules={humanize:{},camelize:{},singularize:{},pluralize:{},underscorize:{}};Phoenix.Grammar._pluralizeCache={};Phoenix.Grammar._singularizeCache={};Phoenix.Grammar._singularToPluralRules=[[/([ml])ouse$/i,"ice"],[/(media|info(rmation)?|news)$/i,""],[/(phot|log|vide)o$/i,"os"],[/^(q)uiz$/i,"uizzes"],[/(c)hild$/i,"hildren"],[/(p)erson$/i,"eople"],[/(m)an$/i,"en"],[/([ieu]s|[ieuo]x)$/i,"es"],[/([cs]h)$/i,"es"],[/(ss)$/i,"es"],[/([aeo]l)f$/i,"ves"],[/([^d]ea)f$/i,"ves"],[/(ar)f$/i,"ves"],[/([nlw]i)fe$/i,"ves"],[/([aeiou]y)$/i,"s"],[/([^aeiou])y$/i,"ies"],[/([^o])o$/i,"oes"],[/s$/i,"ses"],[/(.)$/i,"s"]];Phoenix.Grammar._pluralToSingularRules=[[/([ml])ice$/i,"ouse"],[/(media|info(rmation)?|news)$/i,""],[/(q)uizzes$/i,"uiz"],[/(c)hildren$/i,"ild"],[/(p)eople$/i,"erson"],[/(m)en$/i,"an"],[/((?!sh).)oes$/i,"o"],[/((?!o)[ieu]s|[ieuo]x)es$/i,""],[/([cs]h)es$/i,""],[/(ss)es$/i,""],[/([aeo]l)ves$/i,"f"],[/([^d]ea)ves$/i,"f"],[/(ar)ves$/i,"f"],[/([nlw]i)ves$/i,"fe"],[/([aeiou]y)s$/i,""],[/([^aeiou])ies$/i,"y"],[/(la)ses$/i,"s"],[/(.)s$/i,""]];Phoenix.Grammar._commonize=function(str,delimiter,cacheToCheck){if(cacheToCheck[str]){return cacheToCheck[str]}var original=str;str=str.charAt(0).toLowerCase()+str.substr(1);if(str.indexOf("_")!==-1&&str.toLowerCase()===str){}else if(str.indexOf(" ")!==-1){str=str.replace(/\s+/g,"_").toLowerCase()}else{var old;do{old=str;str=str.replace(/([a-zA-Z])([0-9])/,"$1"+delimiter+"$2");str=str.replace(/([a-z0-9A-Z])([A-Z])/,"$1"+delimiter+"$2")}while(old!==str);str=str.toLowerCase()}cacheToCheck[original]=str;return str};Phoenix.Grammar.underscorize=function(str){if(Phoenix.Grammar._rules.underscorize[str]!==undefined){return Phoenix.Grammar._rules.underscorize[str]}return Phoenix.Grammar._commonize(str,"_",Phoenix.Grammar._underscorizeCache)};Phoenix.Grammar.humanize=function(str){if(Phoenix.Grammar._rules.humanize[str]!==undefined){return Phoenix.Grammar._rules.humanize[str]}if(Phoenix.Grammar._humanizeCache[str]){return Phoenix.Grammar._humanizeCache[str]}var original=str;if(str.indexOf(" ")===-1){if(str.indexOf("_")===-1){str=Phoenix.Grammar.underscorize(str)}str=str.replace(/_/g," ");var split=str.split(" ");for(var i=0;i<split.length;i++){split[i]=split[i].charAt(0).toUpperCase()+split[i].substr(1)}str=split.join(" ");var regex=/(\b(api|css|gif|html|id|jpg|js|mp3|pdf|php|png|sql|swf|url|xhtml|xml)\b)/gi;str=str.replace(regex,function(m0){return m0.toUpperCase()});str=str.replace(/\.(\w+)$/,function(m0,m1){return"."+m1.charAt(0).toUpperCase()+m1.substr(1)})}Phoenix.Grammar._humanizeCache[original]=str;return str};Phoenix.Grammar.camelize=function(str,upper,delimiter){if(Phoenix.Grammar._rules.camelize[str]!==undefined){return Phoenix.Grammar._rules.camelize[str]}if(upper&&Phoenix.Grammar._camelizeCache.upper[str]){return Phoenix.Grammar._camelizeCache.upper[str]}else if(!upper&&Phoenix.Grammar._camelizeCache.lower[str]){return Phoenix.Grammar._camelizeCache.lower[str]}if(upper===undefined){upper=false}if(delimiter===undefined){delimiter="_"}var original=str;if(str.indexOf(" ")!==-1){str=str.replace(/\s+/g,delimiter).toLowerCase()}if(str.indexOf(delimiter)===-1){if(upper){str=str.charAt(0).toUpperCase()+str.substr(1)}}else{var next=str.indexOf(delimiter);var beginning;var parts=[];while(next!==-1){beginning=str.charAt(0).toUpperCase();parts.push(beginning+str.substr(1,next-1));str=str.substr(next+1);next=str.indexOf(delimiter)}parts.push(str.charAt(0).toUpperCase()+str.substr(1));str=parts.join("");if(!upper){str=str.charAt(0).toLowerCase()+str.substr(1)}}if(upper){Phoenix.Grammar._camelizeCache.upper[original]=str}else{Phoenix.Grammar._camelizeCache.lower[original]=str}return str};Phoenix.Grammar.inflectOnQuantity=function(number,singular,plural){if(number!==1){return plural.replace("%d",number.toString())}return singular};Phoenix.Grammar._splitLastWord=function(str){if(str.indexOf(" ")!==-1){return[str.substr(0,str.lastIndexOf(" ")+1),str.substr(str.lastIndexOf(" ")+1)]}if(str===Phoenix.Grammar.underscorize(str)){if(str.indexOf(" ")===-1){return["",str]}return[str.substr(0,str.lastIndexOf("_")+1),str.substr(str.lastIndexOf("_")+1)]}var matches=str.match(/(.*)((?=[a-zA-Z_]|^)(?:[0-9]+|[A-Z][a-z]*)|(?=[0-9A-Z_]|^)(?:[A-Z][a-z]*))$/);if(matches.length&&matches.length===3){return[matches[1],matches[2]]}return["",str]};Phoenix.Grammar.pluralize=function(noun){if(Phoenix.Grammar._rules.pluralize[noun]!==undefined){return Phoenix.Grammar._rules.pluralize[noun]}if(Phoenix.Grammar._pluralizeCache[noun]!==undefined){return Phoenix.Grammar._pluralizeCache[noun]}var original=noun;var plural=null;var beginning,singular;var matches=Phoenix.Grammar._splitLastWord(noun);var to,regex,found;beginning=matches[0];singular=matches[1];for(var i=0;i<Phoenix.Grammar._singularToPluralRules.length;i++){regex=Phoenix.Grammar._singularToPluralRules[i][0];to=Phoenix.Grammar._singularToPluralRules[i][1];if(regex.test(singular)){found=singular.match(regex);plural=beginning+singular.replace(regex,(found[1]?"$1":"")+to);break}}Phoenix.Grammar._pluralizeCache[original]=plural;return plural};Phoenix.Grammar.singularize=function(noun){if(Phoenix.Grammar._rules.singularize[noun]!==undefined){return Phoenix.Grammar._rules.singularize[noun]}if(Phoenix.Grammar._singularizeCache[noun]!==undefined){return Phoenix.Grammar._singularizeCache[noun]}var original=noun;var singular=null;var beginning,plural,matches;var to,regex,found;matches=Phoenix.Grammar._splitLastWord(noun);beginning=matches[0];plural=matches[1];for(var i=0;i<Phoenix.Grammar._pluralToSingularRules.length;i++){regex=Phoenix.Grammar._pluralToSingularRules[i][0];to=Phoenix.Grammar._pluralToSingularRules[i][1];if(regex.test(plural)){found=plural.match(regex);singular=beginning+plural.replace(regex,(found[1]?"$1":"")+to);break}}Phoenix.Grammar._singularizeCache[original]=singular;return singular};Phoenix.Grammar.addSingularPluralRule=function(singular,plural){Phoenix.Grammar._rules.singularize[plural]=singular;Phoenix.Grammar._rules.pluralize[singular]=plural};Phoenix.Grammar.addHumanizeRule=function(original,to){Phoenix.Grammar._rules.humanize[original]=to};Phoenix.Grammar.addCamelUnderscoreRule=function(camelCase,underscore){Phoenix.Grammar._rules.camelize[underscore]=camelCase;Phoenix.Grammar._rules.underscorize[camelCase]=underscore};
Phoenix.Request={};Phoenix.Request._REQUEST=null;Phoenix.Request._cast=function(value,to){var lcValue,trues={"true":1,yes:1,on:1,"false":0,no:0,off:0};var ret=value;switch(to){case"number":ret=parseInt(value,10);if(isNaN(ret)){ret=value?1:0}break;case"float":ret=parseFloat(ret);if(isNaN(ret)){ret=value?1:0}break;case"bool":case"boolean":lcValue=value&&value.toLowerCase?value.toLowerCase():"";if(trues[lcValue]!==undefined){ret=trues[lcValue]?true:false}else{ret=value?true:false}break}return ret};Phoenix.Request._initialize=function(){if(Phoenix.Request._REQUEST===null){var qs=location.search.substr(1);var items=qs.split("&");var itemsAsObject={},current;for(var i=0;i<items.length;i++){current=items[i].split("=");itemsAsObject[current[0]]=current[1]}Phoenix.Request._REQUEST=itemsAsObject}};Phoenix.Request.get=function(name,castTo,defaultValue,useDefaultForBlank){Phoenix.Request._initialize();if(useDefaultForBlank===undefined){useDefaultForBlank=false}if(defaultValue===undefined){defaultValue=null}if(castTo===undefined){castTo="string"}var value=Phoenix.Request._REQUEST[name];if(value===""&&useDefaultForBlank){return defaultValue}else if(value===undefined){value=defaultValue}if(defaultValue!==null){return defaultValue}return Phoenix.Request._cast(value,castTo)};
(function(context){"use strict";var Phoenix=context.Phoenix,setTimeout=context.setTimeout,clearTimeout=context.clearTimeout,defaultMsgHideDelay=1250,defaultMsgHideDuration=400,msgBlock=Phoenix.jQuery.getMessageBlock(),msgClassDivider=" ",msgClassShow="in",msgClassSuccess="message-success",msgClassError="message-danger",msgClassNotification="message-info",msgClassTransition="transitioning",msgClasses=[msgClassTransition,msgClassError,msgClassNotification,msgClassSuccess],storageKeySuccessReferrer="successReferrer",storageKeySuccessMessage="successMessage",storageKeyErrorReferrer="errorReferrer",storageKeyErrorMessage="errorMessage",msgTypeError="error",msgTypeNotification="notification",msgTypeSuccess="success",messageQueue=[],permanentMessage=false,hideMsgTimeoutId=null;var _resetMessage=function(callback){msgBlock.text("").removeClass(msgClasses.join(msgClassDivider));if(!!callback){try{callback()}catch(e){}}};var _showMessage=function(msg,msgType,settings){var callback,afterPost,permanent,hideDelay,hideDuration,newMsgClass="",newMsgClasses=[],referrerKey=false,msgKey=false;if(null!==hideMsgTimeoutId){clearTimeout(hideMsgTimeoutId);hideMsgTimeoutId=null}switch(msgType){case msgTypeError:newMsgClasses.push(msgClassError);referrerKey=storageKeyErrorReferrer;msgKey=storageKeyErrorMessage;break;case msgTypeNotification:newMsgClasses.push(msgClassNotification);break;case msgTypeSuccess:newMsgClasses.push(msgClassSuccess);referrerKey=storageKeySuccessReferrer;msgKey=storageKeySuccessMessage;break;default:break}if(newMsgClasses.length>0){newMsgClasses.push(msgClassShow);newMsgClass=newMsgClasses.join(msgClassDivider)}else{newMsgClass=msgClassShow}settings=settings||{};callback=settings.callback;afterPost=settings.afterPost||false;permanent=settings.permanent||false;hideDelay=settings.hideDelay||defaultMsgHideDelay;hideDuration=settings.hideDuration||defaultMsgHideDuration;if(afterPost===true&&!!referrerKey&&!!msgKey){sessionStorage.setItem(referrerKey,location.href);sessionStorage.setItem(msgKey,msg)}else{if(permanentMessage){Ui.clearPermanentMessage()}msgBlock.addClass(newMsgClass).addClass(msgClassTransition).text(msg).fadeIn();if(permanent===false){hideMsgTimeoutId=setTimeout(function(){clearTimeout(hideMsgTimeoutId);hideMsgTimeoutId=null;msgBlock.fadeOut(hideDuration,function(){_resetMessage(callback)})},hideDelay)}else{permanentMessage=true}}};var Ui={showSuccessMessage:function(msg,settings){_showMessage(msg,msgTypeSuccess,settings)},showMessageBar:function(message){_showMessage(message)},showErrorMessage:function(msg,settings){_showMessage(msg,msgTypeError,settings)},showNotificationMessage:function(msg,settings){_showMessage(msg,msgTypeNotification,settings)},showPermanentMessage:function(msg){_showMessage(msg,msgTypeNotification,{permanent:true})},checkSuccessMessages:function(){var referrer=sessionStorage.getItem(storageKeySuccessReferrer);if(referrer){if(referrer===document.referrer){var msg=sessionStorage.getItem(storageKeySuccessMessage);_showMessage(msg,msgTypeSuccess)}sessionStorage.removeItem(storageKeySuccessMessage);sessionStorage.removeItem(storageKeySuccessReferrer)}},removePermanentMessage:function(callback){msgBlock.fadeOut(defaultMsgHideDuration,function(){_resetMessage(callback)})},clearPermanentMessage:function(){msgBlock.hide();_resetMessage()},checkErrorMessages:function(){var referrer=sessionStorage.getItem(storageKeyErrorReferrer);if(referrer){if(referrer===document.referrer){var msg=sessionStorage.getItem(storageKeyErrorMessage);_showMessage(msg,msgTypeError)}sessionStorage.removeItem(storageKeyErrorMessage);sessionStorage.removeItem(storageKeyErrorReferrer)}},showLoadingScreen:function(msg){var $screen=Phoenix.jQuery.getLoadingScreen(msg);Phoenix.jQuery.getBody().append($screen)},hideLoadingScreen:function(){var $screen=Phoenix.jQuery.getLoadingScreen(null,true);$screen.remove()},convertTime:function(time,longFormat){if(!time){time=0}if(time<0||isNaN(time)){time=0}var minutes=Math.floor(time/60%60);var hours=Math.floor(time/60/60);var seconds=Math.floor(time%60);if(seconds<10){seconds="0"+seconds}if(minutes<10){minutes="0"+minutes}if(time>3600||longFormat===true){return hours+":"+minutes+":"+seconds}else{return minutes+":"+seconds}}};Phoenix.Ui=Ui;Phoenix.jQuery.getDocument().ready(function(){Phoenix.Ui.checkSuccessMessages();Phoenix.Ui.checkErrorMessages()})})(this);
Phoenix.Core={_debugEnabled:false,keycodes:{enterKey:13,rightArrow:39,leftArrow:37,upArrow:38,downArrow:40,escapeKey:27},isTrue:function(val,defaultValue){if(defaultValue===undefined){defaultValue=false}if(typeof val==="string"){val=val.toLowerCase()}return!!val||"true"===val||defaultValue},getDebug:function(){return Phoenix.Core._debugEnabled},enableDebugging:function(bool){Phoenix.Core._debugEnabled=bool?true:false},debug:function(str){if(Phoenix.Core._debugEnabled){console.log(str)}},basename:function(str){var newName=str.split("/");return newName[newName.length-1]}};
Phoenix.Uploader=function(){"use strict";return this};Phoenix.Uploader._init=function(instance,data){"use strict";var i;var order=["main","url","previous","search","progress"];var templates={progressItem:true,searchItem:true,searchListItem:true,searchImageItem:true};var special={previewImage:true};var isIE10=$.browser.msie&&$.browser.version>=10;$.each(data["modals"]["uploader"],function(key,value){if(templates[key]!==undefined){instance._templates[key]=$(value);if(isIE10){instance._templates[key].removeClass("fade");instance._templates[key].find("*").removeClass("fade")}}else if(special[key]!==undefined){instance._templates[key]=$(value);if(isIE10){instance._templates[key].removeClass("fade");instance._templates[key].find("*").removeClass("fade")}}else{instance._modals[key]=$(value);if(isIE10){instance._modals[key].removeClass("fade");instance._modals[key].find("*").removeClass("fade")}}if(key!=="main"&&templates[key]===undefined&&special[key]===undefined){instance._modals[key].modal(Phoenix.Uploader.SUBMODAL_OPTIONS)}});for(i=0;i<order.length;i++){instance._modals[order[i]].appendTo(document.body)}instance._templates["previewImage"].insertAfter(instance._modals["search"]);instance._modals["progress"].on("hidden",function(){instance._abortXHR();instance._resetAll()});instance._modals["main"].find(".modal-footer").addClass("hide");instance._modals["main"].modal({show:false,keyboard:true,backdrop:"static"});instance._modals["previous"].on("hidden",function(){var $this=$(this);instance._templates["previewImage"].find("img").attr("src","");instance._templates["previewImage"].find(".width").text("");instance._templates["previewImage"].find(".height").text("");$this.find(".galleries > li:not(:first-child)").remove();$this.find(".images-in-gallery > li:not(.loading)").remove()});if(typeof window.File==="undefined"){instance._modals["main"].find(".modal-body > p").addClass("hide")}Phoenix.jQuery.getDocument().trigger("uploaderReady");return instance};Phoenix.Uploader.DEFAULT_OPTIONS={complete:function(data){"use strict";Phoenix.Core.debug("> complete");Phoenix.Core.debug(data)},error:function(data){"use strict";Phoenix.Core.debug("> error");Phoenix.Core.debug(data);if(data.message){Phoenix.Ui.showErrorMessage("Problem occured while uploading image: "+data.message)}},logger:function(data){"use strict";Phoenix.Core.debug("> logger");Phoenix.Core.debug(data)},type:"image",headerText:"Where does your image live?",postURL:"/images/upload",urlPostURL:"/images/url-submit",placeholderIcon:"",fileType:["image/gif","image/jpeg","image/png"],multiple:false,drop:true,dropText:"Or drag and drop your image to this window.",urlFieldCount:3,showButtons:["desktop","url-address","search-site","previous-uploads"]};Phoenix.Uploader.SUBMODAL_OPTIONS={backdrop:false,show:false};Phoenix.Uploader.EVENT_NAMESPACE="uploader";Phoenix.Uploader.prototype._modals={main:null,url:null,search:null,previous:null,progress:null};Phoenix.Uploader.prototype._templates={progressItem:null,searchImageItem:null};Phoenix.Uploader._instance=null;Phoenix.Uploader._lastDroppedFiles=[];Phoenix.Uploader.getInstance=function(callback){"use strict";if(Phoenix.Uploader._instance===null){Phoenix.Uploader._instance=new Phoenix.Uploader}if(typeof callback==="function"){callback.apply(Phoenix.Uploader._instance,[])}return Phoenix.Uploader._instance};Phoenix.Uploader.prototype.getDefaultProgressListener=function($imageList){"use strict";var instance=this;return function(e){if(!e.lengthComputable){Phoenix.Core.debug("defaultProgressListener(): length not computable!");instance._currentOptions.logger({message:"Unable to calculate progress percentage."});$imageList.find(".bar").css("width","100%");$imageList.find(".percent").text("Saving... please wait");return}var position=e["loaded"]||e["position"];var total=e["total"]||e["totalSize"];var percent=Math.round(position/total*100);$imageList.find(".bar").css("width",percent+"%");$imageList.find(".percent").text(percent+"%");if(percent>99){$imageList.find(".percent").text("Saving... please wait")}}};Phoenix.Uploader.prototype._resetAll=function(){"use strict";var $progressModal=this._modals["progress"];var $urlModal=this._modals["url"];var $searchModal=this._modals["search"];var $previousModal=this._modals["previous"];var $galleryListItems=$searchModal.find(".galleries > li");this._lastDroppedFiles=[];$progressModal.find("li").remove();$.each(this._modals,function(i,$modal){$modal.modal("hide")});$searchModal.find("input").val("");$previousModal.find("input").val("");$urlModal.find("input").each(function(i){if(i===0){$(this).val("");return true}$(this).remove()});$galleryListItems.each(function(i){if(i===0){return true}$(this).remove();i++});$previousModal.find(".galleries > li").remove();this._templates["previewImage"].find("img").attr("href","");this._templates["previewImage"].find(".width").text("");this._templates["previewImage"].find(".height").text("");return this};Phoenix.Uploader.prototype._xhr=null;Phoenix.Uploader.prototype._sendFiles=function(progressListener){"use strict";var files=this._lastDroppedFiles;var data=new FormData(this._modals["main"].find("form")[0]);var xhr=this._xhr=new XMLHttpRequest;var instance=this;var $imageList=this._modals["progress"].find("ul");if(files.length===0){Phoenix.Core.debug("_sendFiles(): files.length === 0!");return this}for(var i=0;i<files.length;i++){data.append("files["+i+"]",files[i])}if(progressListener===undefined){progressListener=this.getDefaultProgressListener($imageList)}xhr.ontimeout=function(){instance._currentOptions.error($.extend({},{status:this.status},data));this.abort();instance._resetAll()};var callback=function(){var data={};var isObject=false;var $cloned,$input;var errorMessageFileType;var i;if(this.readyState===4){if(this.status===200){data=$.parseJSON(this.responseText);isObject=$.isPlainObject(data);if(!isObject||!data["successful"]){instance._currentOptions.error({message:'No "successful" array/object was returned in the JSON response.'});return}instance._modals["progress"].find(".progress").addClass("progress-success");instance._modals["progress"].find(".progress").removeClass("active");$imageList.find(".bar").css("width","100%");$imageList.find(".percent").text("Done!");i=0;$.each(data["successful"],function(name,d){if(files[i]===undefined){return false}if(typeof data["successful"][name]=="string"||data["successful"][name]instanceof String){if(files[i].name){data["successful"]["clientName"]=files[i].name}if(files[i].type){data["successful"]["clientType"]=files[i].type}}else{if(files[i].name){data["successful"][name]["clientName"]=files[i].name}if(files[i].type){data["successful"][name]["clientType"]=files[i].type}}i++});instance._currentOptions.complete(data);instance._resetAll()}else{try{data=$.parseJSON(this.responseText);isObject=$.isPlainObject(data)}catch(e){isObject=true;data={errors:{file:"Failed to upload file. Please try again."}}}if(instance._currentOptions.type==="image"){errorMessageFileType="images"}else{errorMessageFileType="files"}Phoenix.Ui.showErrorMessage("Error uploading "+errorMessageFileType+": "+this.statusText);instance._currentOptions.error($.extend({},{status:this.status},isObject?data:{successful:{}}));this.abort();instance._resetAll()}try{instance._modals["main"].find("input")[0].value=""}catch(e){$input=$("#js-uploader-file-input");$cloned=$("#js-uploader-file-input").clone(true);$cloned.val("");$input.remove();instance._modals["main"].prepend($cloned)}}else if(this.readyState>1){try{if(this.status===413){data={message:this.responseText};instance._currentOptions.error($.extend({},{status:this.status},data));this.abort();instance._resetAll()}else{if(this.status===504){data={message:"Request timed out"};instance._currentOptions.error($.extend({},{status:this.status},data));this.abort();instance._resetAll()}}}catch(e){instance._currentOptions.error(e)}}};$.get("/blank.html");xhr.upload.addEventListener("loadstart",function(){},false);xhr.upload.addEventListener("progress",progressListener,false);xhr.addEventListener("error",function(){instance._currentOptions.error({message:"An error occurred during the request.",args:arguments});Phoenix.Ui.showErrorMessage("Error")},false);xhr.addEventListener("readystatechange",callback,false);xhr.open("POST",this._currentOptions.postURL);xhr.setRequestHeader("Cache-Control","no-cache");xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.send(data);return this};Phoenix.Uploader.prototype._abortXHR=function(){"use strict";if(this._xhr!==null){this._xhr.abort()}return this};Phoenix.Uploader.prototype._commonFileOnRead=function(shouldUpload,instance){"use strict";var file=this;return function(){var $progressModal=instance._modals["progress"];var $list=$progressModal.find("ul");var $template=instance._templates["progressItem"].clone();$template.find("img").attr("src",file.type.substr(0,6)==="image/"?this.result:instance._currentOptions.placeholderIcon);$template.find(".details > .name").text(file.name);$template.find(".details > .percent").text("1%");$template.find(".progress > .bar").css("width","1%");$list.append($template);if(shouldUpload){var word="image";if(instance._currentOptions.type==="media"){word="file"}if(instance._currentOptions.multiple){word+="s"}$progressModal.find(".js-modal-title").text("Uploading "+word);$progressModal.modal("show");instance._sendFiles()}}};Phoenix.Uploader.prototype._modalFileUpload=function(){"use strict";var $progressModal=this._modals["progress"];var word="image";var $template;var $list=$progressModal.find("ul");for(var i=0,file,reader,len=this._lastDroppedFiles.length;i<len;i++){file=this._lastDroppedFiles[i];if(typeof window.FileReader!=="undefined"){reader=new FileReader;reader.onloadend=this._commonFileOnRead.call(file,i===this._lastDroppedFiles.length-1,this);reader.readAsDataURL(file)}else{$template=this._templates["progressItem"].clone();$template.find("img").attr("src",this._currentOptions.placeholderIcon);$template.find(".details > .name").text(file.name);$template.find(".details > .percent").text("1%");$template.find(".progress > .bar").css("width","1%");$list.append($template);if(i===this._lastDroppedFiles.length-1){if(this._currentOptions.type==="media"){word="file"}if(this._currentOptions.multiple){word+="s"}$progressModal.find(".js-modal-title").text("Uploading "+word);$progressModal.modal("show");this._sendFiles()}}}};Phoenix.Uploader.prototype._createListItem=function(title,image){"use strict";if(this._currentOptions.type!=="image"||image===undefined){image=this._currentOptions.placeholderIcon}var $li=this._templates["progressItem"].clone();$li.find("img").attr("src",image);$li.find(".details > .name").text(title);$li.find(".details > .percent").text("1%");$li.find(".progress > .bar").css("width","1%");return $li};Phoenix.Uploader._sendURLsCallback=function(){"use strict";var $modal=this._modals["url"];var $urlFields=$modal.find('[type="url"]');var urls={};var i=0;var supportsValidity=typeof $urlFields[0].checkValidity==="function";var instance=this;var $progressModal=this._modals["progress"];var $progressModalList=$progressModal.find("ul");var $errorMessage=$modal.find(".error-message");var error=false;var count=0;$errorMessage.addClass("hide");$urlFields.each(function(){var value=$(this).val();if(!value){return}if(supportsValidity&&!this.checkValidity()||!/^https?\:\/\//.test(value)){$errorMessage.removeClass("hide");error=true;return false}var split=value.split(/https?\:\/\//);var title;if(!split[0]){title=split[1]}else{title=split[0]}title=title.substr(0,20)+"...";var $li;urls["urls["+i+"]"]=value;$li=instance._createListItem(title,value);$progressModalList.append($li);count++;i++});if(i===0||error){return}var setProgress=function(value,number){var $lis=$progressModalList.children("li");$lis.find(".progress > .bar").css("width",number+"%");$lis.find(".details > .percent").text(value)};setProgress("",0);$progressModal.modal("show");setTimeout(function(){setProgress("Saving... please wait",25)},200);this._xhr=$.post(this._currentOptions.urlPostURL,urls,function(data){setProgress("Done",100);$progressModal.find(".progress").addClass("progress-success");$progressModal.find(".progress").removeClass("active");$.each(data["successful"],function(k,values){data["successful"][k]["clientName"]=values["name"]?values["name"]:"";data["successful"][k]["clientType"]=values["mimeType"]?values["mimeType"]:""});setTimeout(function(){instance._resetAll();instance._currentOptions.complete(data);instance._resetAll()},300)},"json").error(function(xhr){var data;try{data=$.parseJSON(xhr.responseText)}catch(e){data={url:"An unknown error occurred. Please try again."}}instance._resetAll();instance._currentOptions.error(data)})};Phoenix.Uploader.prototype._eventsBound={desktopButtonClick:false,fileInputChange:false,urlModalNext:false,searchModalNext:false,searchModalClose:false,previousModalNext:false,previousModalClose:false,urlAddFieldClick:false,searchFieldAutocomplete:false,dragAndDrop:false,previousModalShown:false,modalEditClick:false,modalSelectButtonClick:false,modalPreviewClick:false,previousModalScroll:false,galleryImageClick:false,searchModalTagClick:false};Phoenix.Uploader._currentSearchGUID=null;Phoenix.Uploader._addURLFieldCallback=function(event){"use strict";var $this=$(this);var $parent=$this.parent();var count=$parent.find("input").length;if(count===10){event.preventDefault();return false}var $input=$parent.find("input:first-child").clone();$input.val("").insertBefore($this);event.preventDefault();return false};Phoenix.Uploader.prototype._enableDragAndDrop=function(bool){"use strict";if(typeof window.File==="undefined"){return this}var $target=Phoenix.jQuery.getBody();var instance=this;var callback=function(e){e.preventDefault();e.stopPropagation();if(!e.originalEvent.dataTransfer||!e.originalEvent.dataTransfer.files){return false}instance._lastDroppedFiles=e.originalEvent.dataTransfer.files;if(!instance._currentOptions.multiple){instance._lastDroppedFiles=[instance._lastDroppedFiles[0]]}instance._modalFileUpload();return false};var cancel=function(e){e.preventDefault();e.stopPropagation();return false};if(!bool&&this._eventsBound.dragAndDrop){$target.unbind("dragover."+Phoenix.Uploader.EVENT_NAMESPACE);$target.unbind("drop."+Phoenix.Uploader.EVENT_NAMESPACE);this._eventsBound.dragAndDrop=false;return this}if(!this._eventsBound.dragAndDrop){$target.bind("dragover."+Phoenix.Uploader.EVENT_NAMESPACE,cancel);$target.bind("dragenter."+Phoenix.Uploader.EVENT_NAMESPACE,cancel);$target.bind("drop."+Phoenix.Uploader.EVENT_NAMESPACE,callback);this._eventsBound.dragAndDrop=true}return this};Phoenix.Uploader.show=function(){"use strict";var isSafari=/Safari\/\d+/.test(navigator.userAgent)&&navigator.vendor==="Apple Computer, Inc.";var swfUploader;Phoenix.Uploader.getInstance(function(){var instance=this;var $mainModal=this._modals["main"];var loadingMore=false;var $container,$nav,$list;var userImageDataReceivedCallback;if(!$mainModal){return}var $fileInput=$("#js-uploader-file-input");var $desktopButton=$("#js-desktop-button");var $urlModal=this._modals["url"];var $addFieldButton=$urlModal.find(".js-add-another");var $swfUploaderContainer=$("#swfuploader-placeholder");var PLACEHOLDER_IMAGE="/bundles/phoenixsite/images/core/loose/loading-light.gif";$mainModal.find(".js-modal-title").text(this._currentOptions.headerText);if(isSafari){$mainModal.on("shown",function(){$fileInput.css($.extend({},{width:$desktopButton.outerWidth()},$desktopButton.position()));$fileInput.css("top",parseInt($fileInput.css("top"),10)+1);$mainModal.off("shown")})}else if(!this._eventsBound.desktopButtonClick){if(typeof window.File==="function"||typeof window.File==="object"){$(window).bind("blur",function(){$desktopButton.prop("disabled",true);setTimeout(function(){$desktopButton.prop("disabled",false)},2e3)}).bind("focus",function(){$desktopButton.prop("disabled",false)});$desktopButton.click(function(event){$fileInput.click();event.preventDefault();return false});$fileInput.css("left",-1e4)}else{$fileInput.addClass("hide");if($swfUploaderContainer.length===0){$swfUploaderContainer=$('<div id="swfuploader-placeholder">').insertAfter($desktopButton)}var current=0;var end=0;var multipleResponses=[];swfUploader=new SWFUpload({upload_url:this._currentOptions.postURL,flash_url:"/bundles/phoenixsite/flash/swfupload.swf",file_size_limit:"10 MB",file_post_name:"files[]",button_placeholder_id:"swfuploader-placeholder",button_width:73,button_height:20,post_params:{"X-Requested-With":"SWFUpload"},file_upload_limit:this._currentOptions.multiple?10:1,prevent_swf_caching:false,button_text:$desktopButton.text(),button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,file_dialog_complete_handler:function(countFiles){current=0;end=countFiles;this.startUpload()},upload_start_handler:function(file){var $modal=instance._modals["progress"];var $list=$modal.find("ul");var $item;if($modal.hasClass("hide")){$modal.modal("show")}$item=instance._templates["progressItem"].clone();$item.attr("id","swfupload-"+file.id);$item.find("img").attr("src",PLACEHOLDER_IMAGE);$item.find(".details > .name").text(file.name);$item.find(".details > .percent").text("1%");$item.find(".progress > .bar").css("width","1%");$list.append($item)},upload_progress_handler:function(file,bytesComplete,totalBytes){var progress=Math.round(bytesComplete/totalBytes*100)+"%";var $item=$("#swfupload-"+file.id);$item.find(".details > .percent").text(progress);$item.find(".progress > .bar").css("width",progress)},upload_error_handler:function(file,errorNumber,stringName){throw[file,errorNumber,stringName]},upload_success_handler:function(file,responseText){var $item=$("#swfupload-"+file.id);$item.find(".details > .percent").text("100%");$item.find(".progress > .bar").css("width","100%");current++;if(!instance._currentOptions.multiple){instance._currentOptions.complete($.parseJSON(responseText))}else if(current==end){multipleResponses.push(responseText);var allResponses={successful:{}};$.each(multipleResponses,function(i,res){try{var successful=$.parseJSON(res)["successful"];$.each(successful,function(filename,data){allResponses["successful"][filename]=data})}catch(e){}});instance._currentOptions.complete(allResponses);multipleResponses=[]}else if(instance._currentOptions.multiple){multipleResponses.push(responseText)}},upload_complete_handler:function(){if(instance._currentOptions.multiple&&current<end){this.startUpload()}},swfupload_loaded_handler:function(){$desktopButton.prop("disabled",false);$swfUploaderContainer=$desktopButton.next("object").css({marginLeft:-$desktopButton.outerWidth()-5,marginRight:5,opacity:0,width:$desktopButton.outerWidth(),height:$desktopButton.outerHeight(),position:"relative",top:12})}});$desktopButton.prop("disabled",true)}this._eventsBound.desktopButtonClick=true}if(!this._eventsBound.fileInputChange){if(typeof window.File==="function"||typeof window.File==="object"){$fileInput.change(function(){if(this.files&&this.files.length){instance._lastDroppedFiles=this.files;instance._modalFileUpload()}})}this._eventsBound.fileInputChange=true}$fileInput.prop("multiple",this._currentOptions.multiple);$fileInput.attr("accept",this._currentOptions.fileType.join(","));if(!this._currentOptions.multiple){$addFieldButton.addClass("hide")}else{$addFieldButton.removeClass("hide");if(!this._eventsBound.urlAddFieldClick){$addFieldButton.click(Phoenix.Uploader._addURLFieldCallback);this._eventsBound.urlAddFieldClick=true}}if(!this._eventsBound.urlModalNext){$urlModal.find(".js-btn-next").click(function(e){Phoenix.Uploader._sendURLsCallback.apply(instance,[]);e.preventDefault();return false});this._eventsBound.urlModalNext=true}var ajaxErrorHandler=function(){Phoenix.Core.debug("Error occurred while getting data.");Phoenix.Core.debug(arguments,true)};var $searchImageList=instance._modals["search"].find(".images-in-gallery");var $searchGalleryList=instance._modals["search"].find(".galleries");var getEachImageCallback=function($list){return function(i,object){var originalURL=object["original"];var thumbnailURL=object["thumbnail"];var $li=instance._templates["searchImageItem"].clone();var $dimensions=$li.find(".dimensions");$li.attr("data-original-url",originalURL);$li.attr("data-original-width",object["width"]);$li.attr("data-original-height",object["height"]);$li.attr("data-image-id",object["id"]);$li.attr("data-mimetype",object["mimetype"]);$li.find("img").attr("src",thumbnailURL);$li.find("a").attr("title",object["caption"]);$dimensions.find(".width").text(object["width"]);$dimensions.find(".height").text(object["height"]);$li.insertBefore($list.children("li.loading"))}};var getEachTagCallback=function($list){return function(i,object){var name=object["name"];var id=object["id"];var $li,$selected;if(name.toLowerCase()==="all images"){$selected=$list.find(".all-images-link").parent();if($selected.length===0){$selected=$('<li class="selected"/>');$selected.append($('<a href="#" class="all-images-link"/>').text("All Images"));$list.append($selected)}$selected.children("a").attr("data-id",id);return}$li=$("<li>");$li.append($('<a href="#">').text(name).attr("data-id",id));$list.append($li)}};var dataReceivedCallback=function(processTags,removeExisting){return function(data){var images=data["images"];var tags=data["tags"];var $noImagesText=$searchImageList.parent().find(".js-no-images");var $loading=$searchImageList.parent().find("li.loading");var $errorText=$searchImageList.parent().find(".js-error");$loading.addClass("hide");$noImagesText.addClass("hide");$errorText.addClass("hide");if(removeExisting===undefined||removeExisting){$searchImageList.find("li:not(.loading)").remove()}if(images===undefined||tags===undefined||images.length===0){$noImagesText.removeClass("hide");return}$.each(images,getEachImageCallback($searchImageList));if(processTags){$.each(tags,getEachTagCallback($searchGalleryList))}}};var commonSearchPreviousCallback=function(url,returnedCallback,needsGUID){return function(event){var $this=$(this);var id=parseInt($this.attr("data-id"),10);var postData={count:16,tag:id};var $noImagesText=$this.parent().find(".js-no-images");var $loading=$searchImageList.parent().find("li.loading");var $errorText=$searchImageList.parent().find(".js-error");$loading.removeClass("hide");$noImagesText.addClass("hide");$errorText.addClass("hide");if(isNaN(id)){$loading.addClass("hide");$errorText.removeClass("hide");event.preventDefault();return false}$searchImageList.find("li:not(.loading)").remove();$this.parents(".galleries").find("li").removeClass("selected");$this.parent().addClass("selected");if(needsGUID){postData=$.extend({},postData,{object:instance._currentSearchGUID})}$.post(url,postData,returnedCallback(false),"json").error(function(){ajaxErrorHandler();$loading.addClass("hide");$errorText.removeClass("hide")});event.preventDefault();return false}};if(!this._eventsBound.searchFieldAutocomplete){var $input=this._modals["search"].find("input");$input.autocomplete({autoRedirect:false,delay:0,showNotificationBar:true,onItemSelect:function(data){if(!Object.keys(data).length){return false}instance._modals["search"].children("form").trigger("reset");if(isNaN(data["contentTypeId"])){return false}if(isNaN(data["id"])){return false}var guid=data["contentTypeId"]+"-"+data["id"];var postData={object:guid,count:16};instance._modals["search"].find("li:not(.loading)").remove();instance._modals["search"].find("li.loading").removeClass("hide");instance._modals["search"].find(".js-error").addClass("hide");instance._modals["search"].find(".js-no-images").addClass("hide");instance._currentSearchGUID=guid;AjaxApiRequest.makePostApiRequest("/api/image/object-image/",postData,dataReceivedCallback(true),function(){ajaxErrorHandler();instance._modals["search"].find("li.loading").addClass("hide");instance._modals["search"].find(".js-error").removeClass("hide")});return false}});this._eventsBound.searchFieldAutocomplete=true}if(!this._eventsBound.searchModalClose){var removeLis=function(){var $this=$(this);$this.find(".galleries > li:not(:first-child)").removeAttr("data-id").remove();$this.find(".images-in-gallery > li:not(.loading)").remove()};this._modals["search"].on("hidden",removeLis);this._eventsBound.searchModalClose=true}if(!this._eventsBound.searchModalTagClick){this._modals["search"].on("click",".galleries > li > a",commonSearchPreviousCallback("/api/image/object-image/",dataReceivedCallback,true));this._eventsBound.searchModalTagClick=true}userImageDataReceivedCallback=function(processTags,removeExisting){return function(data){var images=data["images"];var tags=data["tags"];var $list=instance._modals["previous"].find(".images-in-gallery");var $galleryList=instance._modals["previous"].find(".galleries");var $loading=$galleryList.parent().find("li.loading");var $noImagesText=$galleryList.parent().find(".js-no-images");var $errorText=$galleryList.parent().find(".js-error");$loading.addClass("hide");$noImagesText.addClass("hide");$errorText.addClass("hide");if(removeExisting===undefined||removeExisting){$list.children("li:not(.loading)").remove()}if(images===undefined||tags===undefined||!images.length){$noImagesText.removeClass("hide");return}$.each(images,getEachImageCallback($list));if(processTags){$.each(tags,getEachTagCallback($galleryList))}}};if(!this._eventsBound.previousModalShown){this._modals["previous"].on("show",function(){var $loading=$(this).find(".loading");$loading.removeClass("hide");AjaxApiRequest.makePostApiRequest("/api/image/user-image/",{count:16},userImageDataReceivedCallback(true),function(){$loading.addClass("hide")})});this._modals["previous"].on("click",".galleries > li > a",function(event){var $this=$(this);var id=parseInt($this.attr("data-id"),10);var $galleries=$this.parents(".galleries");var $images=$galleries.siblings(".images-in-gallery-container");if(isNaN(id)){$images.find(".js-error").removeClass("hide");event.preventDefault();return false}$images.find("li:not(.loading)").remove();$images.find("li.loading").removeClass("hide");$galleries.find("li").removeClass("selected");$this.parent().addClass("selected");AjaxApiRequest.makePostApiRequest("/api/image/user-image/",{count:16,tag:id},userImageDataReceivedCallback(),function(){ajaxErrorHandler();$images.find("li.loading").addClass("hide");$images.find(".js-error").removeClass("hide")});event.preventDefault();return false});this._eventsBound.previousModalShown=true}var commonEditClickHandler=function(modalKey){return function(){var $li=$(this).parents("li");var data;var url=$li.attr("data-original-url");if(!instance._currentOptions.multiple){$li.parent().children("li").removeClass("selected")}$li.addClass("selected");data={successful:{}};data["successful"][url]={url:url,clientName:Phoenix.Core.basename(url),clientType:$li.attr("data-mimetype"),id:null,guid:null};data.from=modalKey;instance._currentOptions.complete(data)}};if(!this._eventsBound.modalEditClick){this._modals["previous"].on("click","li span.js-edit",commonEditClickHandler("previous"));this._modals["search"].on("click","li span.js-edit",commonEditClickHandler("search"));this._eventsBound.modalEditClick=true}if(!this._eventsBound.modalPreviewClick){var commonPreviewClickHandler=function(){var $preview=instance._templates["previewImage"];var $li=$(this).parents("li");var originalURL=$li.attr("data-original-url");var width=$li.attr("data-original-width");var height=$li.attr("data-original-height");var caption=$li.find("a").attr("title");$preview.find(".width").text(width);$preview.find(".height").text(height);$preview.find("img").attr("src",originalURL).attr("title",caption);$preview.removeClass("hide")};this._modals["previous"].on("click","li span.js-preview",commonPreviewClickHandler);this._modals["search"].on("click","li span.js-preview",commonPreviewClickHandler);this._templates["previewImage"].on("click",function(){$(this).addClass("hide")});this._eventsBound.modalPreviewClick=true}if(!this._eventsBound.modalSelectButtonClick){var getSelectButtonClickHandler=function(which){return function(event){var $modal=instance._modals[which];var $selected=$modal.find(".images-in-gallery > li.selected");var data={successful:{}};if($selected.length!==0){$selected.each(function(){var url=$(this).attr("data-original-url");var id=parseInt($(this).attr("data-image-id"),10);data["successful"][url]={url:url,id:isNaN(id)?null:id,guid:isNaN(id)?null:"1300-"+id}});instance._currentOptions.complete(data);$modal.modal("hide");$mainModal.modal("hide")}event.preventDefault();return false}};this._modals["previous"].on("click",".btn-success",getSelectButtonClickHandler("previous"));this._modals["search"].on("click",".btn-success",getSelectButtonClickHandler("search"));this._eventsBound.modalSelectButtonClick=true}var commonScrollCallback=function(url,$container,$nav,$list,returnedCallback,needsGUID){return function(){if(this.scrollHeight-this.offsetHeight===this.scrollTop&&!loadingMore){var start=$list.find("li:not(.loading)").length;var id=parseInt($container.parent().find(".galleries > .selected > a").attr("data-id"),10);var postData={count:16,start:start,tag:id};var $loading=$container.find("li.loading");$loading.removeClass("hide");if(isNaN(id)){$loading.addClass("hide");return}if(needsGUID){postData=$.extend({},postData,{object:instance._currentSearchGUID})}loadingMore=true;AjaxApiRequest.makePostApiRequest(url,postData,function(data){loadingMore=false;$loading.addClass("hide");returnedCallback(false,false)(data);if(!data||!data["images"]||!data["images"].length){$container.find(".js-no-images").hide()}},function(){$loading.addClass("hide");window.alert("Error loading images. Please try again")})}}};if(!this._eventsBound.previousModalScroll){$container=this._modals["previous"].find(".images-in-gallery-container");$nav=this._modals["previous"].find(".images-in-gallery-container > .navigation");$list=this._modals["previous"].find(".images-in-gallery");$container.on("scroll",commonScrollCallback("/api/image/user-image/",$container,$nav,$list,userImageDataReceivedCallback));this._eventsBound.previousModalScroll=true}if(!this._eventsBound.searchModalScroll){$container=this._modals["search"].find(".images-in-gallery-container");$nav=this._modals["search"].find(".images-in-gallery-container > .navigation");$list=this._modals["search"].find(".images-in-gallery");$container.on("scroll",commonScrollCallback("/api/image/object-image/",$container,$nav,$list,dataReceivedCallback,true));this._eventsBound.searchModalScroll=true}if(!this._eventsBound.galleryImageClick){var commonGalleryImageClickHandler=function(event){var $this=$(this);var $parent=$this.parent();if($parent.hasClass("selected")){$parent.removeClass("selected")}else{if(!instance._currentOptions.multiple){$parent.parent().find(".selected").removeClass("selected")}$parent.addClass("selected")}event.preventDefault();return false};this._modals["previous"].on("click",".images-in-gallery > li > a",commonGalleryImageClickHandler);this._modals["search"].on("click",".images-in-gallery > li > a",commonGalleryImageClickHandler);this._eventsBound.galleryImageClick=true}this._enableDragAndDrop(this._currentOptions.drop);this._modals["main"].find(".modal-body > p").text(this._currentOptions.dropText)})};Phoenix.Uploader.uploadDataURIImage=function(dataURI,clientName,callback,errorCallback){"use strict";var supportsNewFeatures=typeof Blob==="function"&&typeof FormData==="function"&&typeof Uint8Array==="function"&&typeof ArrayBuffer==="function"&&typeof DataView==="function";var xhr,formData,postData;var byteString,mimeString,arrayBuffer,u8Array;var i,bsLength;if(supportsNewFeatures){xhr=new XMLHttpRequest;formData=new FormData;clientName=Phoenix.Core.basename(clientName);if(dataURI.split(",")[0].indexOf("base64")>=0){byteString=window.atob(dataURI.split(",")[1])}else{byteString=window.unescape(dataURI.split(",")[1])}mimeString=dataURI.split(",")[0].split(":")[1].split(";")[0];arrayBuffer=new ArrayBuffer(byteString.length);u8Array=new Uint8Array(arrayBuffer);
for(i=0,bsLength=byteString.length;i<bsLength;i++){u8Array[i]=byteString.charCodeAt(i)}formData.append("filename",clientName);formData.append("blob",new window.Blob([new DataView(arrayBuffer)],{type:mimeString}));xhr.addEventListener("error",function(){Phoenix.Core.debug({message:"An error occurred during the request.",args:arguments})},false);xhr.addEventListener("readystatechange",function(){var obj;if(this.readyState===4){if(this.status===200){try{obj=$.parseJSON(this.responseText);callback({successful:{editedImage:{name:clientName,id:obj["id"],url:obj["url"],guid:"1300-"+obj["id"]}}})}catch(e){errorCallback()}}}},false);xhr.open("POST","/images/upload/blob/");xhr.setRequestHeader("Cache-Control","no-cache");xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.send(formData)}else{postData={filename:clientName,data_uri:dataURI};if(!postData["filename"]){postData["filename"]=Phoenix.Cryptography.randomString(16,"alphanumeric")}postData["filename"]=Phoenix.Core.basename(postData["filename"]);AjaxApiRequest.makePostApiRequest("/images/upload/data-uri/",postData,function(obj){callback({successful:{editedImage:{name:postData["filename"],id:obj["id"],url:obj["url"],guid:"1300-"+obj["id"]}}})})}};Phoenix.Uploader.prototype._currentOptions=Phoenix.Uploader.DEFAULT_OPTIONS;$(document).ready(function(){"use strict";var modalUrl=$("meta[name=modal-cdn-url]").attr("content");$.getJSON(modalUrl,function(data){Phoenix.Uploader._init(Phoenix.Uploader.getInstance(),data)});$.uploader=function(options){Phoenix.Uploader.getInstance(function(){if(options.multiple===undefined){options.multiple=false}this._currentOptions=$.extend({},Phoenix.Uploader.DEFAULT_OPTIONS,options);this._originalCallback=this._currentOptions.complete;var instance=this;var items=["desktop","url-address","search-site","previous-uploads"];if(!this._modals["progress"]){return}this._modals["progress"].find(".modal-header > .close").click(function(e){instance._abortXHR();instance._resetAll();e.preventDefault();return false});$.each(items,function(i,target){var $btn=$('button[data-target="#js-'+target+'-modal"]');if(0<=$.inArray(target,instance._currentOptions.showButtons)){$btn.removeClass("hide")}else{$btn.addClass("hide")}});Phoenix.Uploader.show()})}});
(function(context){"use strict";var guidSelector="#view-guid-meta";var $=context.jQuery,Phoenix=context.Phoenix||{},uuidApi=context.uuid,$doc=!!Phoenix.getDocument?Phoenix.getDocument():$(context.document);var $guidMeta;var getGuidMeta=function(){if($guidMeta===undefined){$guidMeta=$(guidSelector)}return $guidMeta};var guid;var generate=function(){var $meta=getGuidMeta();guid=uuidApi.v1();if($meta.length>0){$meta.attr("content",guid)}};var init=function(){var $meta=getGuidMeta();guid=$.cookie("vguid");if(guid&&guid!=null){$meta.attr("content",guid)}else{guid=$meta.attr("content");if(guid===null){generate()}if(!guid){generate()}}$doc.on("pre_page_event",function(){generate()})};init();Phoenix.ViewGuid={get:function(){if(guid===undefined){generate()}return guid}};context.Phoenix=Phoenix})(this);
(function(context){"use strict";var name="CampaignParams";var Phoenix=context.Phoenix||{};var queryParamKeys=["ftag","ttag","utm_source","utm_medium","utm_campaign","vndid"];var hashParamKeys=["ftag","vndid"];var toObject=function(params){var obj,pairs,pair,key,val,i;if(params.length>0&&params.indexOf("=")>0){pairs=params.split("&");for(i=0;i<pairs.length;i++){pair=pairs[i];if(pair.indexOf("=")>0){pair=pair.split("=");key=pair[0];val=pair[1];if(key&&val){if(!obj){obj={}}obj[key]=val}}}}return obj};var filterByKeys=function(params,keys){var filtered,key,val,i;if(params){for(i=0;i<keys.length;i++){key=keys[i];val=params[key];if(!!val){if(undefined===filtered){filtered={}}filtered[key]=val}}}if(undefined===filtered){filtered=null}return filtered};var createParamGetter=function(paramType,paramKeys){var params;return function(){if(undefined===params){params=filterByKeys(toObject(window.location[paramType].substring(1)),paramKeys)}return params}};Phoenix[name]={getParams:function(){var params;return function(){if(undefined===params){var self=this,hashParams=self.getHashParams(),queryParams=self.getQueryParams();if(queryParams){params=$.extend({},queryParams)}if(hashParams){if(params){params=$.extend(params,hashParams)}else{params=$.extend({},hashParams)}}if(undefined===params){params=null}}return params}}(),getHashParams:createParamGetter("hash",hashParamKeys),getQueryParams:createParamGetter("search",queryParamKeys)};context.Phoenix=Phoenix})(this);
(function($){"use strict";$.fn.autocomplete=function(options){var passedOptions=options||{},autocompleters=$();if(typeof options==="string"){throw new Error("Please pass options as an object.")}return this.each(function(){if($(this).data().autocompleter){return}var inlineOptions=$(this).data();var mergedOptions=$.extend({},$.fn.autocomplete.defaults,passedOptions,inlineOptions);if(typeof mergedOptions.enableForMedia==="string"&&window.matchMedia&&!window.matchMedia(mergedOptions.enableForMedia).matches){return false}if(mergedOptions.multiple===false){mergedOptions.podLimit=1}autocompleters.add(new Autocompleter($(this),mergedOptions))})};$.fn.autocomplete.defaults={loadingClass:"loading",resultsClass:"dropdown-menu typeahead typeahead-full",resultListId:"resultsWrap",selectClass:"selected",queryParamName:"q",extraParams:{},url:"/jsonsearch/",minChars:1,maxItemsToShow:10,delay:300,useCache:false,maxCacheLength:10,matchSubset:true,matchCase:false,matchInside:true,mustMatch:false,selectFirst:false,selectOnly:false,showResult:null,preventDefaultReturn:true,preventDefaultTab:false,filterResults:false,sortResults:false,sortFunction:null,matchStringConverter:null,autoWidth:"min-width",useDelimiter:false,delimiterChar:",",delimiterKeyCode:188,autoRedirect:false,placeholderGraphic:"/bundles/phoenixsite/images/core/loose/no-image-30x30.png",emptyText:"'tis but a barren wasteland",showEmptyText:true,podInputName:null,podInputNoIndex:false,searchIndex:null,searchField:null,resultPodTemplate:false,podLimit:5,inputRequired:null,showNotificationBar:false,parentModal:null,extraClasses:null,sortable:false,sortableOrderFieldName:null,multiple:true,notificationText:null,notificationClass:null,notificationBarSearch:false,notificationSearchUrl:null,afterShowResults:null,finishOnBlur:true,stopPositioning:false,bodyOnClickFilter:[],enableForMedia:null,searchIndexOnly:null,podClass:"resultPod"};var defaultEventHandlerOptions={onActivate:null,onFetchRemoteData:null,onItemSelect:null,onNoMatch:null,onFinish:null,onRequestComplete:null,onError:null,onDisplayResults:null,onHideResults:null,onNotificationBarClick:null};$.extend($.fn.autocomplete.defaults,defaultEventHandlerOptions);var sanitizeResult=function(result){var data={},type=$.type(result);if(type==="string"){data.name=result.name;data.url=result.url;data.id=result.id}else if(type==="object"){data.name=result.name||result.title;data.type=result.index_name||result.bundle||result.type||result.label;data.id=result.native_id||result.id;data.contentTypeId=result.content_type_id;data.image=result.image_thumbnail_url;data.url=result.url;data.full_name=result.full_name;data.label=result.label;data.engineId=result.engineId;data.engineKey=result.engineKey;data.slug=result.slug}return data};var sanitizeInteger=function(value,stdValue,options){var num=parseInt(value,10);options=options||{};if(isNaN(num)||options.min&&num<options.min){num=stdValue}return num};var makeUrlParam=function(name,value){return[name,encodeURIComponent(value)].join("=")};var makeUrl=function(url,params){var urlAppend=[];$.each(params,function(index,value){urlAppend.push(makeUrlParam(index,value))});if(urlAppend.length){url+=url.indexOf("?")===-1?"?":"&";url+=urlAppend.join("&")}return url};var sortValueAlpha=function(a,b,matchCase){a=String(a.id);b=String(b.id);if(!matchCase){a=a.toLowerCase();b=b.toLowerCase()}if(a>b){return 1}if(a<b){return-1}return 0};var Autocompleter=function($elem,options){if(!$elem||!($elem instanceof $)||$elem.length!==1||$elem.get(0).tagName.toUpperCase()!=="INPUT"){throw new Error("Invalid parameter for jquery.Autocompleter, jQuery object with one element with INPUT tag expected.")}var self=this;var pods_;this.options=options;this.cacheData_={};this.draggableOptions_={containment:"parent"};this.droppableOptions_={drop:function(event,ui){var $this=$(event.target);var $draggable=ui.draggable;var draggableHTML=$draggable.html();var thisHTML=$this.html();var values=[];$this.html(draggableHTML);$draggable.html(thisHTML);$this.attr("style","position:relative");$draggable.attr("style","position:relative");$this.parent().find('input[type="hidden"]').each(function(i){var $this=$(this);var name=$this.attr("name");var parts=name.match(/(.*\])\[\d+\]$/);if(!$.isArray(parts)||parts[1]===undefined){return}$this.attr("name",parts[1]+"["+i+"]")})}};this.canDoSortable_=!!($.ui&&$.ui.draggable&&$.ui.droppable);this.cacheLength_=0;this.selectClass_=this.options.selectClass;this.lastKeyPressed_=null;this.lastProcessedValue_=null;this.lastSelectedValue_=null;this.active_=false;this.finishOnBlur_=this.options.finishOnBlur;this.paginationOffset_=0;this.pageNumber_=1;this.maxOffset_=0;this.extraParams_=$.extend({},this.options.extraParams)||{};this.podCount_=0;this.curJQXHR_=null;this.resultsShowing=false;this.resultsPaginating_=false;this.options.minChars=sanitizeInteger(this.options.minChars,$.fn.autocomplete.defaults.minChars,{min:0});this.options.maxItemsToShow=sanitizeInteger(this.options.maxItemsToShow,$.fn.autocomplete.defaults.maxItemsToShow,{min:0});this.options.maxCacheLength=sanitizeInteger(this.options.maxCacheLength,$.fn.autocomplete.defaults.maxCacheLength,{min:1});this.options.delay=sanitizeInteger(this.options.delay,$.fn.autocomplete.defaults.delay,{min:0});this.dom={};this.dom.$elem=$elem;this.dom.$parent=$elem.parent(".autocomplete");this.dom.$first=null;this.dom.$notificationBar=null;if(!this.options.autoRedirect&&this.dom.$parent){this.dom.$existingPods=this.dom.$parent.find(".resultPod");this.podCount_=this.dom.$existingPods.length}this.options.inputRequired=!!$elem.attr("required");if(this.options.extraClasses){this.options.resultsClass+=" "+$.trim(this.options.extraClasses)}this.options.podInputName=this.options.podInputName||this.dom.$elem.attr("name");this.dom.$elem.attr("autocomplete","off");this.dom.$results=$('<div class="'+this.options.resultsClass+'"></div>').hide();var containerWidth=this.dom.$elem.outerWidth();if(containerWidth>0){this.dom.$results.css("width",containerWidth+"px")}$(window).on("resize",function(event){if(!self.options.stopPositioning){var containerWidth=self.dom.$elem.outerWidth();if(containerWidth>0){self.dom.$results.css("width",containerWidth+"px")}self.position()}});this.dom.$resultList=$('<ul class="js-autocomplete-list" id="'+this.options.resultListId+'"></ul>');this.dom.$resultList.appendTo(this.dom.$results);this.dom.$container=this.options.parentModal?$(this.options.parentModal):Phoenix.jQuery.getBody();if(this.options.showNotificationBar){var notificationBar=$('<li class="notificationBar"><span id="notificationText">Searching for</span> <span id="notificationTerm"></span></li>');if(this.options.notificationClass){notificationBar.addClass(this.options.notificationClass)}this.dom.$first=notificationBar.prependTo(this.dom.$resultList);this.dom.$notificationTerm=this.dom.$results.find("#notificationTerm");this.dom.$notificationText=this.dom.$results.find("#notificationText");this.dom.$notificationBar=notificationBar;var autocompleter=this;if(this.options.notificationBarSearch){notificationBar.click(function(event){var value=autocompleter.dom.$elem.val();var url=autocompleter.makeUrl(value,autocompleter.options.notificationSearchUrl);window.location=url})}else if(this.options.onNotificationBarClick){notificationBar.click(function(event){autocompleter.options.onNotificationBarClick(event,autocompleter)})}}this.dom.$container.append(this.dom.$results);$elem.keydown(function(e,param1){self.lastKeyPressed_=e.keyCode;switch(self.lastKeyPressed_){case self.options.delimiterKeyCode:if(self.options.useDelimiter&&self.active_){self.selectCurrent()}break;case 35:case 36:case 16:case 17:case 18:case 37:case 39:break;case 38:e.preventDefault();if(self.active_){self.focusPrev()}else{self.activate()}return false;case 40:e.preventDefault();if(self.active_){self.focusNext()}else{self.activate()}return false;case 9:if(self.active_){self.selectCurrent();if(self.options.preventDefaultTab){e.preventDefault();return false}}break;case 13:if(param1===true){delete self.extraParams_["page"];self.pageNumber_=1;self.activateNow(true);e.preventDefault();return false}if(self.active_){self.selectCurrent();e.preventDefault();return false}if(self.options.preventDefaultReturn){e.preventDefault();return false}break;case 27:if(self.active_||param1){e.preventDefault();self.deactivate(true);return false}break;default:self.activate()}}).click(function(){self.activateNow()});this.bodyClickEvent=null;this.onClickHandler=function(e){var prevent=false;var $target=$(e.target);$.each(self.options.bodyOnClickFilter,function(i,elemSel){prevent=$target.is(elemSel)||$(elemSel).find($target).length!==0;if(prevent){return false}});if(prevent){return}if(e.target==$elem[0]||$target.hasClass("next")||$target.hasClass("prev")){e.preventDefault();return false}self.resultsPaginating_=false;self.deactivate()};this.dom.$body=$("body");this.checkRequiredAttribute=function(){if(this.options.inputRequired){if(this.podCount_>0){$elem.removeAttr("required")}else{$elem.attr("required","required")}}};if(this.dom.$parent.length>0){this.dom.$parent.on("click",".resultPod i, .resultPod svg",function(event){$(this).parent(".resultPod").remove();self.podCount_--;self.checkRequiredAttribute();if(self.options.podLimit===null||self.podCount_<self.options.podLimit){self.dom.$elem.removeClass("hide")}event.preventDefault();event.stopPropagation()})}if(this.options.podLimit!==null&&this.podCount_>=this.options.podLimit){this.dom.$elem.addClass("hide")}if(this.options.sortable&&this.canDoSortable_){pods_=this.dom.$parent.find(".resultPod");pods_.draggable(this.draggableOptions_);pods_.droppable(this.droppableOptions_);this.dom.$parent.droppable({drop:function(event,ui){ui.draggable.attr("style","position:relative;")}})}else{Phoenix.Core.debug("autocompleter: Wanted to make sortable but jQuery UI required libraries are not present.")}this.checkRequiredAttribute();$(window).on("scroll",function(event){self.checkScroll(event)});$elem.data("autocompleter",true);$elem.data("autocompleterObject",this);var seedValue=this.dom.$parent.attr("data-seed-value");if(seedValue){var parts=seedValue.split(":");var item={guid:parts[0],name:seedValue.substring(seedValue.indexOf(":")+1)};this.addResultPodFromTemplate(item)}return this.dom.$results};var acProto=Autocompleter.prototype;acProto.position=function(){if(!this.options.stopPositioning){var offset=this.dom.$elem.offset();var inputBottom=offset.top+this.dom.$elem.outerHeight();var position={top:inputBottom,left:offset.left};this.dom.$results.css(position)}};acProto.checkScroll=function(event){if(this.resultsShowing){this.position()}};acProto.cacheRead=function(filter){var filterLength,searchLength,search,maxPos,pos;if(this.options.useCache){filter=String(filter);filterLength=filter.length;if(this.options.matchSubset){searchLength=1}else{searchLength=filterLength}while(searchLength<=filterLength){if(this.options.matchInside){maxPos=filterLength-searchLength}else{maxPos=0}pos=0;while(pos<=maxPos){search=filter.substr(0,searchLength);if(this.cacheData_[search]!==undefined){return this.cacheData_[search]}pos++}searchLength++}}return false};acProto.cacheWrite=function(filter,data){if(this.options.useCache){if(this.cacheLength_>=this.options.maxCacheLength){this.cacheFlush()}filter=String(filter);if(this.cacheData_[filter]!==undefined){this.cacheLength_++}this.cacheData_[filter]=data;return this.cacheData_[filter]}return false};acProto.cacheFlush=function(){this.cacheData_={};this.cacheLength_=0};acProto.callHook=function(hook,data){var f=this.options[hook];if(f&&$.isFunction(f)){return f(data,this)}return false};acProto.activate=$.debounce(400,function(){var self=this;this.maxOffset_=0;self.activateNow()});acProto.activateNow=function(force){var overrideValue=null;if(this.options.onActivate){overrideValue=this.options.onActivate.call(this)}if(this.bodyClickEvent===null){this.bodyClickEvent=this.onClickHandler;this.dom.$body.on("click.autocomplete",this.bodyClickEvent)}this.checkSearchIndex();this.checkSearchField();this.abandonAJAX();var value=this.dom.$elem.val();if(overrideValue){value=overrideValue}if(value){if(force||value!==this.lastProcessedValue_&&value!==this.lastSelectedValue_){if(this.options.showNotificationBar){this.showNotificationBar(value)}this.fetchData(value)}else if(value===this.lastProcessedValue_){this.displayResults()}}else{this.deactivate(false)}};acProto.abandonAJAX=function(){if(this.curJQXHR_&&this.curJQXHR_.readyState!=4){this.curJQXHR_.abort();this.dom.$results.find(".loading").remove();return true}return false};acProto.fetchData=function(value){var self=this,processResults=function(results,filter){self.showResults(self.filterResults(results,filter),filter)};this.lastProcessedValue_=value;if(value.length<this.options.minChars){return false}else if(this.options.data){processResults(this.options.data,value)}else{this.fetchRemoteData(value,function(remoteData){if($.isFunction(self.options.onRequestComplete)){self.options.onRequestComplete(remoteData,value)}processResults(remoteData,value)})}};acProto.fetchRemoteData=function(filter,callback){var data=this.cacheRead(filter);var self=this;var wrapper=this.dom.$results;var ajaxCallback;var resultList=this.dom.$resultList;this.curJQXHR_=null;if(data){callback(data)}else{ajaxCallback=function(data){var parsed=false;wrapper.find(".loading").remove();if(data!==false){parsed=self.parseRemoteData(data);self.cacheWrite(filter,parsed);callback(parsed)}};resultList.find("li:not(.notificationBar)").remove();wrapper.find(".loading").remove();wrapper.find("#resultsWrap").append($('<li class="loading"/>'));if($.isFunction(self.options.onFetchRemoteData)){self.options.onFetchRemoteData(this)}this.curJQXHR_=$.ajax({url:this.makeUrl(filter),success:ajaxCallback,error:function(jqXHR,textStatus,errorThrown){if(errorThrown==="abort"||this.readyState===0){return}if($.isFunction(self.options.onError)){self.options.onError(jqXHR,textStatus,errorThrown)}else{ajaxCallback(false)}},dataType:"json"})}};acProto.setExtraParam=function(name,value){var index=$.trim(String(name));if(index){if(!this.extraParams_){this.extraParams_={}}if(this.extraParams_[index]!==value){this.extraParams_[index]=value;this.cacheFlush()}}};acProto.checkSearchIndex=function(){var rawParams=this.options.searchIndex;var params=[];var i=0;var instance=this;var page=1;if(this.extraParams_["page"]!==undefined){page=parseInt(this.extraParams_["page"],10);if(isNaN(page)){this.pageNumber_=page=1;this.paginationOffset_=0}}var value=this.dom.$elem.val();if(value!==this.lastProcessedValue_&&value!==this.lastSelectedValue_){this.pageNumber_=page=1;this.paginationOffset_=0}this.extraParams_=$.extend({},this.options.extraParams);if(rawParams){if($.type(rawParams)!=="array"){rawParams=rawParams.split(",")}$.each(rawParams,function(index,value){instance.setExtraParam("indices["+i+"]",value);i++});instance.setExtraParam("page",page);if(this.options.searchIndexOnly){instance.setExtraParam("indexOnly",this.options.searchIndexOnly)}}};acProto.checkSearchField=function(){var rawParams=this.options.searchField;var params=[];var i=0;var instance=this;if(rawParams){if($.type(rawParams)!=="array"){rawParams=rawParams.split(",")}$.each(rawParams,function(index,value){instance.setExtraParam("fields["+i+"]",value);i++})}};acProto.makeUrl=function(param,overrideUrl){var url=this.options.url,params=$.extend({},this.extraParams_);if(typeof overrideUrl!=="undefined"){url=overrideUrl}if(this.options.queryParamName===false){url+=encodeURIComponent(param)}else{params[this.options.queryParamName]=param}return makeUrl(url,params)};acProto.parseRemoteData=function(remoteData){var remoteDataType,data=remoteData;remoteDataType=typeof remoteData;switch(remoteDataType){case"object":data=remoteData;break;case"string":data=$.parseJSON(remoteData);break;default:throw new Error("Unexpected remote data type: "+remoteDataType)}return data};acProto.filterResult=function(result,filter){if(!result.name){return false}if(this.options.filterResults){var pattern=this.matchStringConverter(filter);var testValue=this.matchStringConverter(result.name);if(!this.options.matchCase){pattern=pattern.toLowerCase();testValue=testValue.toLowerCase()}var patternIndex=testValue.indexOf(pattern);if(this.options.matchInside){return patternIndex>-1}else{return patternIndex===0}}return true};acProto.filterResults=function(results,filter){var filtered=[];var self=this;var result;if(results.results){$.each(results.results,function(key,value){result=sanitizeResult(value);if(self.filterResult(result,filter)){filtered.push(result)}if(self.options.sortResults){filtered=self.sortResults(filtered,filter)}});this.calculateMaxOffset(results)}return filtered};acProto.calculateMaxOffset=function(results){var max=this.options.maxItemsToShow;this.maxOffset_=Math.floor(results.count/max)*max;if(results.count%max===0){this.maxOffset_-=max}};acProto.sortResults=function(results,filter){var self=this;var sortFunction=this.options.sortFunction;if(!$.isFunction(sortFunction)){sortFunction=function(a,b){return sortValueAlpha(a,b,self.options.matchCase)}}results.sort(function(a,b){return sortFunction(a,b,filter,self.options)});return results};acProto.matchStringConverter=function(s,a,b){var converter=this.options.matchStringConverter;if($.isFunction(converter)){s=converter(s,a,b)}return s};acProto.enableFinishOnBlur=function(){this.finishOnBlur_=true};acProto.disableFinishOnBlur=function(){this.finishOnBlur_=false};acProto.showNotificationBar=function(value){value=value||this.getValue();if(value.length>=this.options.minChars){this.dom.$notificationTerm.text(value);if(this.options.notificationText){this.dom.$notificationText.text(this.options.notificationText)}else{this.dom.$notificationText.text("Search for")}this.position();this.displayResults();this.focusItem(this.dom.$first)}};acProto.createItemFromResult=function(result){var self=this,$li=$("<li/>").append($(this.showResult(result)));if(!this.options.autoRedirect){$li.click(function(){if($li.find(".noResults").length>0){return}self.selectItem($li)})}$li.data(result||{}).mousedown(self.disableFinishOnBlur).mouseup(self.enableFinishOnBlur);return $li};acProto.showResult=function(result){var imgSrc,resultType="",resultImg="",resultClass="resultWrap",formattedResults,displayField;if($.isFunction(this.options.showResult)){return this.options.showResult(result)}else if(!result&&this.options.showEmptyText){return'<div class="noResults">'+this.options.emptyText+"</div>"}else{imgSrc=result.image||this.options.placeholderGraphic;if(!!result.label){resultType="<span>"+result.label+"</span>"}else if(!!result.type){resultType="<span>"+result.type+"<span>"}if(this.options.textOnly){resultClass+=" resultTextOnly"}else{resultImg='<img src="'+imgSrc+'">'}displayField=result.name;if(this.dom.$elem.data("display-field")&&result[this.dom.$elem.data("display-field")]){displayField=result[this.dom.$elem.data("display-field")];result.name=displayField}if(this.options.autoRedirect){formattedResults='<a href="'+result.url+'" class="'+resultClass+'" data-type="'+result.type.toLowerCase()+'" data-id="'+result.id+'" data-key="'+result.engineKey+'">'+resultImg+"<h5>"+displayField+"</h5>"+resultType+"</a>"}else{formattedResults='<div class="'+resultClass+'">'+resultImg+"<h5>"+displayField+"</h5>"+resultType+"</div>"}return formattedResults}};acProto.getItems=function(){return this.dom.$resultList.find(">li")};acProto.showResults=function(results){if(!results){results=[]}var numResults=results.length,self=this,$ul=$("<ul/>"),i,result,$li,autoWidth,resultsDiv=this.dom.$results,resultList=this.dom.$resultList;if(numResults>0){if(this.pageNumber_>1){$ul.append(this.addPagination("prev"))}for(i=0;i<numResults;i++){result=results[i];$li=this.createItemFromResult(result);$ul.append($li);if(!this.dom.$first){this.dom.$first=$li}if(i===numResults-1){$li.addClass(this.options.lastItemClass)}}if(this.paginationOffset_<this.maxOffset_){$ul.append(this.addPagination("next"))}}else{$ul.append(this.createItemFromResult(result))}resultList.find("li:not(.notificationBar)").remove();resultList.append($ul.find("li"));if(this.options.afterShowResults){this.options.afterShowResults(results,resultList,this)}this.displayResults();this.position();if(this.options.autoWidth){autoWidth=this.dom.$elem.outerWidth()-resultsDiv.outerWidth()+resultsDiv.width();resultsDiv.css(this.options.autoWidth,autoWidth)}this.getItems().hover(function(){self.focusItem(this)},function(){});if(this.options.selectFirst||this.options.selectOnly&&numResults===1){this.focusItem(this.dom.$first)}this.active_=true};acProto.addPagination=function(direction){var el=direction==="next"?$('<li class="next">See more results</li>').data("paginate",direction):$('<li class="prev">See previous results</li>').data("paginate",direction);if(!el.data("clickEventAdded")){this.addPaginationEvent(el,direction)}return el};acProto.paginate=function(direction){var loading=this.dom.$results.find("li.loading").length>0;if(loading){this.resultsPaginating_=true;return}if(this.pageNumber_<=1&&direction==="prev"){this.resultsPaginating_=false;return}else if(this.paginationOffset_>=this.maxOffset_&&direction=="next"){this.resultsPaginating_=false;return}var max=Number(this.options.maxItemsToShow);if(direction==="next"){this.paginationOffset_+=max;this.pageNumber_++}else if(direction==="prev"){this.paginationOffset_-=max;this.pageNumber_--}this.resultsPaginating_=true;this.setExtraParam("page",this.pageNumber_);this.activateNow(true)};acProto.addPaginationEvent=function(el,direction){var self=this;el.click(function(){self.paginate(direction)}).data("clickEventAdded",true)};acProto.focusNext=function(){this.focusMove(+1)};acProto.focusPrev=function(){this.focusMove(-1)};acProto.focusMove=function(modifier){var $items=this.getItems(),i;modifier=sanitizeInteger(modifier,0);if(modifier){for(i=0;i<$items.length;i++){if($($items[i]).hasClass(this.selectClass_)){this.focusItem(i+modifier);return}}}this.focusItem(0)};acProto.focusItem=function(item){var $item,$items=this.getItems();if($items.length){$items.removeClass(this.selectClass_);if(typeof item==="number"){if(item<0){item=0;this.paginate("prev")}else if(item>=$items.length){item=$items.length-1;this.paginate("next")}$item=$($items[item])}else{$item=$(item)}if($item){$item.addClass(this.selectClass_)}}};acProto.selectCurrent=function(){var $item=$("li."+this.selectClass_,this.dom.$results);if($item&&$item.length===1){if(this.dom.$notificationBar instanceof jQuery&&$item.get(0)===this.dom.$notificationBar.get(0)){if(this.options.notificationBarSearch){var value=this.dom.$elem.val();var url=this.makeUrl(value,this.options.notificationSearchUrl);window.location=url}else if(this.options.onNotificationBarClick){this.options.onNotificationBarClick(event,this)}}else{this.selectItem($item)}}else{this.deactivate(false)}};acProto.selectItem=function($li){if(this.options.onItemSelect){var continueAdding=this.callHook("onItemSelect",$li.data());if(!continueAdding){this.dom.$elem.focus();this.deactivate(true);this.hideResults();return}}var searchTerm=this.getValue(),paginationDirection=$li.data("paginate");this.lastProcessedValue_=searchTerm;this.lastSelectedValue_=searchTerm;if(paginationDirection){this.paginate(paginationDirection)}else if(this.options.autoRedirect){if($li.get(0)===$(this.dom.$first).get(0)){this.dom.$elem.closest("form").submit()}else{window.location.href=$li.data("url")}}else if(this.options.podLimit===null||this.podCount_<this.options.podLimit){this.addResultPodFromTemplate($li.data())}else{Phoenix.Ui.showErrorMessage("You've exceeded the limit.");this.setValue("")}this.deactivate(true);this.hideResults()};acProto.addResultPodFromTemplate=function(data){var resultTemplate=this.buildResultPod(data),elem=this.dom.$elem;resultTemplate.insertBefore(elem);this.podCount_++;this.checkRequiredAttribute();this.setValue("");elem.focus();if(this.options.podLimit!==null&&this.podCount_===this.options.podLimit){elem.addClass("hide")}return resultTemplate};acProto.buildResultPod=function(result){if($.isFunction(this.options.resultPodTemplate)){return this.options.resultPodTemplate.call(this,result)}else{var i=this.dom.$parent.find('input[type="hidden"]').length;var guid,inputName=this.options.podInputName+(this.options.podInputNoIndex||/\[\]$/.test(this.options.podInputName)?"":"["+i+"]"),self=this;if(typeof result.guid!="undefined"){guid=result.guid}else{guid=result.contentTypeId+"-"+result.id}if(inputName){var resultPod=$('<span class="resultPod"><span>'+(result.name||result.title)+'</span><svg class="symbol symbol-remove"><use xlink:href="#symbol-remove"></use></svg><input type="hidden" name="'+inputName+'" value="'+guid+'"></span>');if(this.options.sortable&&this.canDoSortable_){resultPod.draggable(this.draggableOptions_);resultPod.droppable(this.droppableOptions_)}return resultPod}else{throw new Error("Missing required option: podInputName.")}}};acProto.hideResults=function(){this.dom.$results.hide();this.resultsShowing=false;if(this.options.onHideResults){this.options.onHideResults(this.dom.$results)}};acProto.displayResults=function(){this.dom.$results.show();this.dom.$results.addClass("visible");this.resultsShowing=true;if(this.options.onDisplayResults){this.options.onDisplayResults(this.dom.$results)}};acProto.deactivate=function(finish){if(this.abandonAJAX()){finish=true}if(this.bodyClickEvent!==null){this.dom.$body.off("click.autocomplete",this.bodyClickEvent);this.bodyClickEvent=null}if(this.resultsPaginating_){return}if(finish){if(this.lastProcessedValue_!==this.lastSelectedValue_){if(this.options.mustMatch){this.setValue("")}this.callHook("onNoMatch")}if(this.active_){this.callHook("onFinish")}this.lastKeyPressed_=null;this.lastProcessedValue_=null;this.lastSelectedValue_=null;this.active_=false;this.pageNumber_=1;this.paginationOffset_=0}this.hideResults()};acProto.getCaret=function(){var elem=this.dom.$elem,range,s,e;if($.browser.msie){var selection=document.selection;if(elem[0].tagName.toLowerCase()!=="textarea"){var val=elem.val();range=selection.createRange().duplicate();range.moveEnd("character",val.length);s=range.text===""?val.length:val.lastIndexOf(range.text);range=selection.createRange().duplicate();range.moveStart("character",-val.length);e=range.text.length}else{range=selection.createRange();var stored_range=range.duplicate();stored_range.moveToElementText(elem[0]);stored_range.setEndPoint("EndToEnd",range);s=stored_range.text.length-range.text.length;e=s+range.text.length}}else{s=elem[0].selectionStart;e=elem[0].selectionEnd}return{start:s,end:e}};acProto.setValue=function(value){if(this.options.useDelimiter){var val=this.dom.$elem.val();var d=this.getDelimiterOffsets();var preVal=val.substring(0,d.start);var postVal=val.substring(d.end);value=preVal+value+postVal}this.dom.$elem.val(value)};acProto.getValue=function(){var val=this.dom.$elem.val();if(this.options.useDelimiter){var d=this.getDelimiterOffsets();return val.substring(d.start,d.end).trim()}else{return val}};acProto.getDelimiterOffsets=function(){var val=this.dom.$elem.val(),start,end;if(this.options.useDelimiter){var preCaretVal=val.substring(0,this.getCaret().start);start=preCaretVal.lastIndexOf(this.options.delimiterChar)+1;var postCaretVal=val.substring(this.getCaret().start);end=postCaretVal.indexOf(this.options.delimiterChar);if(end===-1){end=val.length}end+=this.getCaret().start}else{start=0;end=val.length}return{start:start,end:end}};acProto.getValueForReal=function(){var valueHolders=this.dom.$parent.find('input[type="hidden"]');if(!valueHolders.length){return null}else if(valueHolders.length==1){return $(valueHolders[0]).val()}else{var result=[];valueHolders.each(function(e){result.push($(e).val())});return result}};acProto.setValueForReal=function(value,append){if(typeof append=="undefined"){append=false}if(!$.isArray(value)){value=[value]}if(!append){this.dom.$elem.empty()}var self=this;$.each(value,function(e){self.addResultPodFromTemplate(e)})};$(document).ready(function(){var answersContainer=$(".autoCompleteSSContainer");$(".autoCompleteSSCommit").click(function(){answersContainer.find(".js-ac-needs-hacks").each(function(i,e){var optionElement=$(e);var ctrl=optionElement.find(".js-ac-needs-hacks-name");var ac=ctrl.data().autocompleterObject;var guid=ac.getValueForReal();if(guid){ctrl.removeAttr("name")}})})})})(jQuery);
$(document).ready(function(){"use strict";var initialize=function(){$(".js-autocompleter-checkbox-span").each(function(){var $this=$(this);if($this.data("initialized")){return}var checkbox=$this.parent().find(".js-autocompleter-checkbox").find("input").first();$this.on("click",function(event){if(checkbox.attr("checked")==="checked"){checkbox.removeAttr("checked");$this.text("Click to match all above")}else{checkbox.attr("checked","checked");$this.text("Click to match individually above")}event.preventDefault()});$this.data("initialized",true)})};initialize();$(document).ajaxStop(function(){initialize()})});
Phoenix.SiteSearch=null;$(function(){"use strict";window.Swiftype=window.Swiftype||{};Swiftype.root_url=Swiftype.root_url||"https://api.swiftype.com";Swiftype.pingUrl=function(endpoint,callback){var to=setTimeout(callback,350);var img=new Image;img.onload=img.onerror=function(){clearTimeout(to);callback()};img.src=endpoint;return false};Swiftype.pingAutoSelection=function(engineKey,typeId,docId,value,callback){var params={t:(new Date).getTime(),engine_key:engineKey,document_type_id:typeId,doc_id:docId,prefix:value};var url=Swiftype.root_url+"/api/v1/public/analytics/pas?"+$.param(params);Swiftype.pingUrl(url,callback)};Phoenix.SiteSearch=function(){var siteSearch=$("#siteSearch");var hasInteracted=false;var ctrlDown=false;if(!siteSearch.length){return}var searchToggle=$("#search-toggle");searchToggle.find("a").first().click(function(event){event.preventDefault()});$(siteSearch).find("input").focusin(function(){$(siteSearch).addClass("is-focused");$("body").addClass("has-search-focused")});$(siteSearch).find("input").focusout(function(){$(siteSearch).removeClass("is-focused");$("body").removeClass("has-search-focused")});siteSearch.on("keydown",function(e){if(e.which==224||e.which==17||e.which==91||e.which==93){ctrlDown=e.which}}).on("keyup",function(e){if(e.which==ctrlDown){ctrlDown=false}});siteSearch.on("click","li a",function(event){if(ctrlDown!=false){return}event.preventDefault();var query=$(siteSearch).find('input[type="text"]').val();var entityType=$(this).data("type");var id=$(this).data("id");var key=$(this).data("key");var href=$(this).attr("href");if(key&&entityType&&id&&query){Swiftype.pingAutoSelection(key,entityType,id,query,function(){window.location=href})}else{return true}return false});var allFilters=siteSearch.find('input[type="checkbox"]'),wikiFilters=siteSearch.find('.search-group-wiki input[type="checkbox"]'),checkAll=siteSearch.find(".checkall"),uncheckAll=siteSearch.find(".uncheck"),wikiAll=siteSearch.find(".wikionly"),searchIndex=[],updateSearchFilters=function(){searchIndex.length=0;allFilters.filter(":checked").each(function(){searchIndex.push($(this).val())})};var $field=siteSearch.find("#search-main");var extraParams={};if(siteSearch.find('[name="from_cms"]').length!==0){extraParams["cms"]=1}var forceSearchOnCheck=function(){var e;if($field.val().length){e=$.Event("keydown");e.keyCode=27;$field.trigger(e);e=$.Event("keydown");e.keyCode=13;$field.trigger(e,true)}};checkAll.click(function(e){e.preventDefault();allFilters.prop("checked",true);updateSearchFilters();forceSearchOnCheck()});uncheckAll.click(function(e){e.preventDefault();allFilters.prop("checked",false);updateSearchFilters();forceSearchOnCheck()});wikiAll.click(function(e){e.preventDefault();allFilters.prop("checked",false);wikiFilters.prop("checked",true);updateSearchFilters();forceSearchOnCheck()});allFilters.click(function(){var checked=$(this).prop("checked");if(!hasInteracted&&checked){allFilters.not(this).prop("checked",false)}hasInteracted=true;updateSearchFilters();forceSearchOnCheck()});updateSearchFilters();var termValues={};allFilters.each(function(){var parent=$(this).parent();var text=$.trim(parent.text());termValues[text]=$(this).val()});var parseSearchTerms=function(searchString){var splitTerms=searchString.split(" ");if(splitTerms.length<=0){return null}var newIndicies=[];var terms=[];var termIndex=0;for(termIndex=0;termIndex<splitTerms.length;termIndex=termIndex+1){var potentialTerm=splitTerms[termIndex];potentialTerm=$.trim(potentialTerm);if(potentialTerm===""){continue}var lastChar=potentialTerm.charAt(potentialTerm.length-1);if(lastChar!==":"){break}potentialTerm=potentialTerm.slice(0,-1);potentialTerm=$.trim(potentialTerm);if(potentialTerm===""){continue}if(potentialTerm==="person"||potentialTerm==="persons"){potentialTerm="people"}var potentialValue=termValues[potentialTerm]||termValues[potentialTerm+"s"]||termValues[potentialTerm.substr(0,potentialTerm.length-1)];if(potentialValue){newIndicies.push(potentialValue);terms.push(potentialTerm)}else{break}}if(newIndicies.length<=0){return null}var searchText=splitTerms.slice(termIndex).join(" ");return{newIndicies:newIndicies,searchText:searchText,terms:terms}};return $field.autocomplete({autoRedirect:true,searchIndex:searchIndex,selectFirst:true,showNotificationBar:true,notificationBarSearch:true,notificationSearchUrl:"/search/",extraParams:extraParams,parentModal:siteSearch,autoWidth:null,enableForMedia:"(min-width: 321px)",onActivate:function(){var searchTerms=this.dom.$elem.val();var newTerms=parseSearchTerms(searchTerms);if(!newTerms){this.options.notificationText=null;updateSearchFilters();return}if(newTerms.terms.length===1){this.options.notificationText="Searching "+newTerms.terms[0]+" for"}else{this.options.notificationText=null}searchIndex.length=0;$.extend(searchIndex,newTerms.newIndicies);return newTerms.searchText},preventDefaultReturn:false,finishOnBlur:false,bodyOnClickFilter:siteSearch})}()});$(function(){"use strict";var NO_IMAGE_URL="/bundles/phoenixsite/images/core/loose/no-image.jpg";var $filtersContainer=$("#default-content .search-filters");var hasInteracted=false;var $checkboxes,$toggleGroup,$wikiCheckboxes;var updateSearchContent;var $searchUL=$("#default-content .primary-content .search-results");var isUpdating=false;var $previouslyCheckedBoxes=$();if($filtersContainer.length===0){return}$checkboxes=$filtersContainer.find(":checkbox");$toggleGroup=$filtersContainer.find(".search-group-toggle");$wikiCheckboxes=$filtersContainer.find(".search-group-wiki :checkbox");$wikiCheckboxes=$filtersContainer.find(".search-group-wiki :checkbox");updateSearchContent=function(client,extraData){var sentData={page:1,q:Phoenix.Request.get("q","string"),srp:true};var i=0;var $clonedList;if(isUpdating){return}if(extraData){sentData=$.extend({},sentData,extraData)}if(client){sentData["client"]=client}if(Phoenix.Request.get("indexOnly")){sentData["searchIndexOnly"]=Phoenix.Request.get("indexOnly","boolean")}$searchUL.addClass("loading");$checkboxes.each(function(){var $this=$(this);if($this.prop("checked")===true){sentData["indices["+i+"]"]=$this.val();i=i+1}$this.prop("disabled",true)});$clonedList=$searchUL.children("li").clone(true);$searchUL.children("li").remove();AjaxApiRequest.makeGetApiRequest("/jsonsearch/",sentData,function(data){var $pagination=$(data["pagination"]);var template=_.template($("#resultTemplate").html());$.each(data["results"],function(i,values){if(!values["image_url"]){values["image_url"]=NO_IMAGE_URL}if(values["deck"]){values["deck"]=values["deck"].replace(/(<([^>]+)>)/gi,"")}else{values["deck"]=""}$searchUL.append(template(values))});if($($pagination[0]).hasClass("paginate")){var $existingPagination=$searchUL.siblings(".paginate");if($existingPagination.length===0){$pagination.insertAfter($searchUL)}else{$existingPagination.replaceWith($pagination)}$pagination.find("a").each(function(){var $this=$(this);var page=parseInt($(this).text(),10);var href="/search/?q="+sentData["q"]+"&page=";var i=0;var $parent=$this.parent();if($parent.hasClass("results")){return}if(isNaN(page)){if($parent.hasClass("next")){page=sentData["page"]+1}else if($parent.hasClass("prev")){page=sentData["page"]-1}else{page=1}}href+=page;$.each(sentData,function(key,value){if(key.substr(0,8)==="indices["){href+="&"+encodeURIComponent("indices["+i+"]")+"="+encodeURIComponent(value);i=i+1}else if(key=="sort"&&sentData[value]){href+="&"+encodeURIComponent(key)+"="+encodeURIComponent(value)+"&"+encodeURIComponent(value)+"="+encodeURIComponent(sentData[value])}});$this.attr("href",href)})}else{var $existingPagination=$searchUL.siblings(".paginate");$existingPagination.replaceWith("")}isUpdating=false;$checkboxes.prop("disabled",false);$searchUL.removeClass("loading")},function(){isUpdating=false;$checkboxes.prop("disabled",false);$searchUL.append($clonedList);$searchUL.removeClass("loading");$checkboxes.prop("checked",false);$previouslyCheckedBoxes.prop("checked",true);Phoenix.Ui.showErrorMessage("Error occurred while loading results, showing previous results")})};$filtersContainer.on("click",":checkbox",function(){var checked=$(this).prop("checked");$(this).parent().toggleClass("s-active");$previouslyCheckedBoxes=$checkboxes.filter(":checked").not(this);if(!hasInteracted&&checked){$checkboxes.not(this).prop("checked",false)}jQuery.param.querystring(window.location.href,"q="+Phoenix.Request.get("q","string")+"&page=1");hasInteracted=true;updateSearchContent("search")});$toggleGroup.on("click",".checkall",function(e){$checkboxes.prop("checked",true);updateSearchContent("search");e.preventDefault();return false});$toggleGroup.on("click",".uncheck",function(e){$checkboxes.prop("checked",false);updateSearchContent("search");e.preventDefault();return false});$toggleGroup.on("click",".wikionly",function(e){$checkboxes.prop("checked",false);$wikiCheckboxes.prop("checked",true);updateSearchContent("search");e.preventDefault();return false});$("select.ajax-js-filter").on("change",function(e){e.preventDefault();var $this=$(this);var param={};if($this.val()&&$this.val().length){param["sort"]=$this.attr("data-filter-query");param[$this.attr("data-filter-query")]=$this.val()}updateSearchContent("search",param);return false})});
(function(context,$){"use strict";var ajaxFormSubmitCallback=function(e,extraParams){var $form=$(e.target),callback=e.data.callback,invalidForm;$form.data("invalid",null);$form.trigger("preSend");invalidForm=$form.data("invalid");if(invalidForm){e.preventDefault();e.stopPropagation()}else{if(callback!==undefined){callback.call(this,e,extraParams)}}};var ajaxFormAttr="data-ajaxForm";$.ajaxFormOn=function(selector,submitCallback){$(document).on("submit",selector,{callback:submitCallback},ajaxFormSubmitCallback)};$.fn.ajaxForm=function(submitCallback){return this.each(function(){var $this=$(this);$this.attr("data-ajaxForm","true").on("submit",{element:this,callback:submitCallback},function(event,extraParams){ajaxFormSubmitCallback.call(this,event,extraParams)})})};$.fn.isAjaxForm=function(){return $(this).attr(ajaxFormAttr)==="true"}})(this,jQuery);
var FuzzyDate=function(){"use strict";return this};FuzzyDate.prototype.selectors=[".fuzzy-datetime",".wiki-datetime"];FuzzyDate.prototype.initAll=function(){"use strict";$(this.selectors.join(",")).each(function(){var $this=$(this);var $hidden=$this.find('input[type="hidden"]');var state;if($hidden.length){state=parseInt($hidden.val(),10);if(isNaN(state)){state=0}}$this.wikiDatePicker(state)});return this};Phoenix.jQuery.getDocument().ready(function(){"use strict";var api=(new FuzzyDate).initAll();$(this).ajaxComplete(api.initAll.bind(api))});(function($){"use strict";$.fn.wikiDatePicker=function(initialState){return this.each(function(){var $this=$(this);if($this.data("fuzzy-date")){return}var $dateField=$this.find("input.datepicker-input");var $selectFields=$this.find("select");var $hiddenTypeField=$this.find('input[type="hidden"]');var $swapLink=$this.find("a.swap");var $container=$this;var hasDateField=$dateField.length!==0;var hasSelectFields=$selectFields.length===3;var hasHiddenTypeField=$hiddenTypeField.length>=1;var hasSwapLink=$swapLink.length===1&&$swapLink.children("span").length===2;var $monthField;var $yearField;var $quarterField;var STATE_NORMAL_DATE=0;var STATE_FUZZY_DATE=1;var STATE_FUZZY_QUARTER=2;var STATE_FUZZY_YEAR=3;var currentState=initialState===undefined?STATE_NORMAL_DATE:initialState;if(!currentState){currentState=STATE_NORMAL_DATE}var sync=function(date){if(date===undefined){date=new Date($dateField.val())}var month=date.getMonth()+1;var quarter=Math.floor((month-1+3)/3);var year=date.getFullYear();if(currentState===STATE_NORMAL_DATE||currentState===STATE_FUZZY_DATE){$monthField.find("option").prop("selected",false);$monthField.find('option[value="'+month+'"]').prop("selected",true)}if(currentState===STATE_FUZZY_QUARTER){$quarterField.find("option").prop("selected",false);$quarterField.find('option[value="'+quarter+'"]').prop("selected",true)}$yearField.find("option").prop("selected",false);$yearField.find('option[value="'+year+'"]').prop("selected",true)};var setNoDate=function(){var value=parseInt($hiddenTypeField.val(),10);var selectFieldValues=[];if(value===STATE_NORMAL_DATE&&(!$dateField.data().datepicker.date||!$dateField.val())){$selectFields.each(function(){var $this=$(this);$this.find("option").prop("selected",false);$this.find("option:first").prop("selected",true)})}else{$selectFields.each(function(){var selected=parseInt($(this).val(),10);if(selected){selectFieldValues.push(selected)}});if(!selectFieldValues.length){$dateField.val("").prop("value","").attr("value","")}}};var setFuzzyYear=function(){var hasMonth=!!parseInt($monthField.val(),10);var hasQuarter=!!parseInt($quarterField.val(),10);var hasYear=!!parseInt($yearField.val(),10);if(!hasMonth&&!hasQuarter&&hasYear){currentState=STATE_FUZZY_YEAR;$hiddenTypeField.val(STATE_FUZZY_YEAR)}};var makeCallback=function(methodSuffix){return function(){var value=parseInt($(this).val(),10);var date=$dateField.data().datepicker.date;var method="set"+methodSuffix;if(!value){setNoDate();setFuzzyYear();return}if(method!=="setFullYear"){value-=1}if(method==="setFullYear"){setFuzzyYear()}if(method==="setMonth"){currentState=STATE_FUZZY_DATE;$hiddenTypeField.val(currentState);setNoQuarter()}date[method](value);date.setDate(1);$dateField.datepicker("setValue",date);setNoDate()}};var setNoQuarter=function(){$quarterField.find("option").prop("selected",false);$quarterField.find("option:first").prop("selected",true)};var setNoMonth=function(){$monthField.find("option").prop("selected",false);$monthField.find("option:first").prop("selected",true);var date=$dateField.data().datepicker.date;date.setDate(1);$dateField.datepicker("setValue",date)};if(isNaN(initialState)||initialState>STATE_FUZZY_YEAR){currentState=STATE_NORMAL_DATE;$hiddenTypeField.val(STATE_NORMAL_DATE)}if(!(hasDateField&&hasSelectFields&&hasHiddenTypeField&&hasSwapLink)){return}if(typeof $dateField.data().datepicker==="undefined"){$dateField.datepicker()}$selectFields.each(function(){var name=this.getAttribute("name");var $this=$(this);if(/\]\[month\]$/.test(name)){$monthField=$this;$this.on("change",makeCallback("Month"))}else if(/\]\[year\]$/.test(name)){$yearField=$this;$this.on("change",makeCallback("FullYear"))}});$selectFields.filter(function(){var isField=/\]\[quarter\]$/.test(this.getAttribute("name"));if(isField){$quarterField=$(this)}return isField}).on("change",function(){var value=parseInt($(this).val(),10);var date=$dateField.data().datepicker.date;var map={1:1,2:4,3:7,4:10};if(!value){setFuzzyYear();setNoDate();return}date.setDate(1);date.setMonth(map[value]-1);$dateField.datepicker("setValue",date);setNoMonth();setNoDate();currentState=STATE_FUZZY_QUARTER;$hiddenTypeField.val(currentState)});if($dateField.val()){sync()}$dateField.on("changeDate",function(event){sync(event.date)});$this.on("click","a.swap",function(e){var $this=$(this);var currentValue=parseInt($hiddenTypeField.val(),10);var value;if(isNaN(currentValue)){currentValue=STATE_NORMAL_DATE}if(currentValue===STATE_NORMAL_DATE){value=STATE_FUZZY_DATE}else{value=STATE_NORMAL_DATE}$hiddenTypeField.val(value);$this.children("span").toggleClass("hide");$container.find("div").filter(function(){var $this=$(this);var idMatches=!!String($this.attr("id")).match(/_release_date$/);return $this.hasClass("release-date-picker")||idMatches}).toggleAttr("data-hide");if(!$dateField.data().datepicker.date||!$dateField.val()){$selectFields.each(function(){var $this=$(this);$this.find("option").prop("selected",false);$this.find("option:first").prop("selected",true)})}if(value!==STATE_NORMAL_DATE&&parseInt($quarterField.val(),10)){currentState=STATE_FUZZY_QUARTER;setNoMonth();$hiddenTypeField.val(STATE_FUZZY_QUARTER)}if(value!==STATE_NORMAL_DATE&&!parseInt($quarterField.val(),10)&&!parseInt($monthField.val(),10)){currentState=STATE_FUZZY_YEAR;setNoMonth();setNoQuarter();$hiddenTypeField.val(STATE_FUZZY_YEAR)}e.preventDefault();return false});currentState=parseInt(currentState,10);if(currentState!==STATE_NORMAL_DATE&&!!$monthField.parent().attr("data-hide")){$swapLink.trigger("click")}if(currentState===STATE_FUZZY_QUARTER){setNoMonth();$hiddenTypeField.val(STATE_FUZZY_QUARTER)}if(currentState===STATE_FUZZY_DATE){setNoQuarter();$hiddenTypeField.val(STATE_FUZZY_DATE)}if(currentState===STATE_FUZZY_YEAR){setNoMonth();setNoQuarter();$hiddenTypeField.val(STATE_FUZZY_YEAR)}$this.find(".datetime-now-button").remove();$this.data("fuzzy-date",true)})}})(window["jQuery"]);
var scrollToHeader=function(header){"use strict";var scrollPos=header.offset().top;$("html, body").animate({scrollTop:scrollPos-100},1e3)};$(document).ready(function(){"use strict";var generators=$(".js-toc-generate");if(generators.length===0){var container=$(document).find(".js-toc-container");container.parent().find(".toc").remove();container.remove();return}var tagsToReplace={"&":"&amp;","<":"&lt;",">":"&gt;"};function replaceTag(tag){return tagsToReplace[tag]||tag}function safeTagsReplace(str){return str.replace(/[&<>]/g,replaceTag)}generators.each(function(index){var $this=$(this);var tocNumber=index;var $tocContainer=$this.find(".js-toc-container");var $articleContent=$this.find(".js-toc-content");if($articleContent.length===0){$tocContainer.parent().find(".toc").remove();$tocContainer.remove();return}var $headers=$articleContent.find("h2, h3, h4");var $container=$('<ul class="sub-nav-toc"></ul>');var $oldContainers=[];var $curContainer=$container;var inH4=false;var inH3=false;$headers.each(function(index){var $element=$(this);var $link=$('<a href="#toc-'+tocNumber+"-"+index+'">'+safeTagsReplace($element.text())+"</a>");var $itemContainer=$("<li></li>");var $lastContainer=null;var $lastList=null;$link.appendTo($itemContainer);$link.click(function(event){event.preventDefault();scrollToHeader($element);location.hash="toc-"+tocNumber+"-"+index});$element.attr("name","toc-"+tocNumber+"-"+index);if($element.is("h2")){if(inH4){$lastContainer=$oldContainers.pop();$lastList=$lastContainer.find("li:last");if($lastList.length>0){$curContainer.appendTo($lastList)}else{$curContainer.appendTo($lastContainer)}$curContainer=$lastContainer;inH4=false}if(inH3){$lastContainer=$oldContainers.pop();$lastList=$lastContainer.find("li:last");if($lastList.length>0){$curContainer.appendTo($lastList)}else{$curContainer.appendTo($lastContainer)}$curContainer=$lastContainer;inH3=false}}else if($element.is("h3")){if(inH4){$lastContainer=$oldContainers.pop();$lastList=$lastContainer.find("li:last");if($lastList.length>0){$curContainer.appendTo($lastList)}else{$curContainer.appendTo($lastContainer)}$curContainer=$lastContainer;inH4=false}if(!inH3){$oldContainers.push($curContainer);$curContainer=$("<ul></ul>");inH3=true}}else if($element.is("h4")){if(!inH4){$oldContainers.push($curContainer);$curContainer=$("<ul></ul>");inH4=true}}$itemContainer.appendTo($curContainer)});var $oldContainer=null;while(($oldContainer=$oldContainers.pop())!==undefined){if(inH4){var $lastList=$oldContainer.find("li:last");if($lastList.length>0){$curContainer.appendTo($lastList)}else{$curContainer.appendTo($oldContainer)}inH4=false}else if(inH3){var $lastList=$oldContainer.find("li:last");if($lastList.length>0){$curContainer.appendTo($lastList)}else{$curContainer.appendTo($oldContainer)}inH3=false}else{$curContainer.appendTo($oldContainer);$curContainer=$oldContainer}}if($container.html()===""){$tocContainer.parent().find(".toc").remove();$tocContainer.remove()}if($container.is("ul")){$container.children().appendTo($tocContainer)}else{$container.appendTo($tocContainer)}})});$(document).ready(function(){"use strict";$(".js-toc-static-links").click(function(event){event.preventDefault();var target=$(this).attr("href");target=target.slice(1);var $element=$('[name="'+target+'"]');scrollToHeader($element);location.hash=target})});$(window).load(function(){"use strict";var hash=location.hash.slice(1);if(hash.indexOf("toc-")>=0){var el=$("h2, h3, h4").filter("[name="+hash+"]");scrollToHeader(el)}});
(function(context,$){"use strict";var $doc=$(context.document);var $collectionBlocks;var $replyForm;var defaultErrorMsg="Woops! Something happened and we are working on it!";var classAddForm="forum-add-ajax";var classEditForm="forum-edit-ajax";var selectorAddForm="."+classAddForm;var selectorEditForm="."+classEditForm;var selectorEditorTextarea="textarea.js-editor-textarea";var messageKey="messageElement";var messageBodyKey="messageBodyElement";var messageUserKey="messageUserElement";var loadingDivHtml="<div class='loading'></div>";var hasAjaxFormPlugin=function(){return $.fn.ajaxForm!==undefined};var hasRichTextEditorPlugin=function(){return $.fn.richTextEditor!==undefined};var getCollectionBlock=function(){if($collectionBlocks===undefined){$collectionBlocks=$(".js-forum-comments, .js-forum-messages")}return $collectionBlocks};var getReplyForm=function(){if($replyForm===undefined){$replyForm=$("#reply")}return $replyForm};var getEditorTextarea=function($parent){if($parent===undefined){$parent=getReplyForm()}return $parent.find(selectorEditorTextarea)};var getMessage=function($from){var $el=$from.data(messageKey);if($el===undefined){$el=$from.parents(".js-message").first();$from.data(messageKey,$el)}return $el};var getMessageBody=function($from){var $el=$from.data(messageBodyKey);if($el===undefined){$el=getMessage($from).find(".js-message-body").first();var $msg=$el.find(".message");if($msg.length){$el=$msg}$from.data(messageBodyKey,$el)}return $el};var getMessageUser=function($from){var $el=$from.data(messageUserKey);if($el===undefined){var message=getMessage($from);$el=null;if(message.length===0){$el=getMessage($from).find(".js-avatar-user").first()}else{$el=getMessage($from).find(".message-user").first()}$from.data(messageUserKey,$el)}return $el};var isAddForm=function($el){return $el.hasClass(classAddForm)};var isEditForm=function($el){return $el.hasClass(classEditForm)};var initAjaxForm=function($form){if(!hasAjaxFormPlugin()){return}if($form===undefined){$form=$([selectorAddForm,selectorEditForm].join(","))}$.ajaxFormOn([selectorAddForm,selectorEditForm].join(","),function(e){e.preventDefault();var $el=$(e.target),formData=$el.serializeArray(),loadingDiv=$(loadingDivHtml),$messageBody,$richTextEditor;var successCallback=function(){Phoenix.Ui.showSuccessMessage("Saved.")};$el.hide();loadingDiv.insertAfter($el);if(isAddForm($el)){successCallback=function(data){if(data.success==0){if(data.errMessage){Phoenix.Ui.showErrorMessage(data.errMessage)}else{Phoenix.Ui.showErrorMessage(defaultErrorMsg)}loadingDiv.remove();$el.show();return}$richTextEditor=getEditorTextarea($el);if(hasRichTextEditorPlugin()&&$richTextEditor.length>0){$richTextEditor.richTextEditor("remove")}$el.remove();loadingDiv.remove();var messages=getCollectionBlock();messages.append(data.html);destroyReplyQuoteButtons();Phoenix.Ui.showSuccessMessage("Message added.")}}else if(isEditForm($el)){successCallback=function(data){$messageBody=getMessageBody($el);$richTextEditor=getEditorTextarea($el);if(hasRichTextEditorPlugin()&&$richTextEditor.length>0){$richTextEditor.richTextEditor("remove")}$el.parents(".js-message").find(".js-forum-edit").removeClass("hide");$el.remove();loadingDiv.remove();$messageBody.html(data.html);Phoenix.Ui.showSuccessMessage("Message modified.")}}$.ajax({type:"POST",url:$el.attr("action"),data:formData,success:successCallback,error:function(){Phoenix.Ui.showErrorMessage(defaultErrorMsg);$el.parents(".js-message").find(".js-forum-edit").removeClass("hide");loadingDiv.remove();$el.show()},complete:function(){$(document).trigger("image-viewer-rescrape")}})})};var initEditButtons=function(){$(document).on("click",".js-forum-comments .js-forum-edit, .js-forum-messages .js-forum-edit",function(event){var $clicked=$(event.target),requestUrl=$clicked.attr("href");var $this=$(this);if($clicked.is("a")===true&&requestUrl!==""){event.preventDefault();var $messageBody=getMessageBody($clicked);$this.addClass("hide");$.ajax({url:$clicked.attr("href"),success:function(data){var $textarea;$messageBody.html(data.html);$textarea=getEditorTextarea($messageBody);if($textarea.length===1){if(hasRichTextEditorPlugin()){$textarea.richTextEditor()}}},error:function(){Phoenix.Ui.showErrorMessage(defaultErrorMsg)},complete:function(){$(document).trigger("image-viewer-rescrape")}})}})};var initPaginationButtons=function(){var block=getCollectionBlock();if(!block.hasClass("js-ajax-pagination")){return}if(!window.history.pushState){return}var originalUrl=location.href;var paginationInitialized=false;var havePushed=false;$(document).on("click",'.paginate a[href*="page="]',function(e){if(!paginationInitialized){window.history.replaceState({name:"ForumPaginate",url:originalUrl},"",originalUrl);paginationInitialized=true}e.preventDefault();var paginationLink=$(this);var url=paginationLink.attr("href");paginate(url);window.history.pushState({name:"ForumPaginate",url:url},"",url);havePushed=true});var paginate=function(url){var loadingDiv=$(loadingDivHtml);var blockPos=$(".container").offset().top;var $window=$(window);loadingDiv.height(block.height());block.hide();block.after(loadingDiv);if($window.scrollTop()>blockPos){$("html, body").animate({scrollTop:blockPos},300)}$.ajax({cache:false,url:url,success:function(data){var pagination=$(".paginate");if(!data.success){window.location=url;return}else{var $doc=Phoenix.getDocument();$doc.trigger("pre_page_event",["pageLoad"]);$doc.trigger("update_page_event",["pageLoad"]);$doc.trigger("on_page_event",["pageLoad"])}block.html(data.html.list);pagination.html(data.html.pagination);loadingDiv.remove();block.show()},error:function(){loadingDiv.remove();block.show();Phoenix.Ui.showErrorMessage(defaultErrorMsg)},complete:function(){$(document).trigger("image-viewer-rescrape")}})};$(window).on("popstate","",function(event){if(!havePushed){return}var state=event.originalEvent.state;if(state&&state.name==="ForumPaginate"){paginate(state.url)}})};var initPollAjax=function(){var pollForms=$(".js-poll-form");pollForms.ajaxForm(function(e){e.preventDefault();var form=$(e.target);var formData=form.serializeArray();$.ajax({type:"POST",url:form.attr("action"),data:formData,success:function(data){form.parents(".js-message-body").html(data.html)},error:function(){Phoenix.Ui.showErrorMessage(defaultErrorMsg)}})})};var destroyReplyQuoteButtons=function(){$(".js-forum-reply, .js-forum-quote").remove()};var initReplyButtons=function(){getCollectionBlock().on("click",".js-forum-reply",function(event){var $clicked=$(event.target),$messageUser=getMessageUser($clicked),$editor=getEditorTextarea(),replyToUserData={};event.preventDefault();var scrollPos=$editor.parents(".editor").first().offset().top;$("html, body").animate({scrollTop:scrollPos-100},500);if($messageUser.length===1){replyToUserData.slug=$messageUser.data("user-slug");replyToUserData.profile=$messageUser.data("user-profile")}if(hasRichTextEditorPlugin()===false){$editor.val("@"+replyToUserData.slug+": "+$editor.val())}else{$editor.richTextEditor("reply",replyToUserData)}})};var initQuoteButtons=function(){getCollectionBlock().on("click",".js-forum-quote",function(event){var $clicked=$(event.target),$messageBody,$messageUser=getMessageUser($clicked),$editor=getEditorTextarea(),replyToUserData={},quoteData={};event.preventDefault();var scrollPos=$editor.parents(".editor").first().offset().top;$("html, body").animate({scrollTop:scrollPos-100},500);if($messageUser.length===1){replyToUserData.slug=$messageUser.data("user-slug");replyToUserData.profile=$messageUser.data("user-profile")}$messageBody=getMessageBody($clicked);quoteData.user=replyToUserData;quoteData.html=$messageBody.html();$editor.richTextEditor("quote",quoteData)})};var initSpoilerButtons=function(){$(document).on("click",'[data-embed-type="spoiler"] .header',function(){$(this).siblings(".content").toggleClass("hide")})};var initBestAnswerButtons=function(){$(document).on("click",".js-best-answer",function(){var $this=$(this);var remove=false;$(".js-best-answer-header").remove();var container=$this.parents(".js-message");if(container.hasClass("answer")){remove=true}$(".js-message.answer").each(function(){var $this=$(this);var element=$this.find(".js-best-answer");var toggleValue=element.attr("data-toggle-value");element.attr("data-toggle-value"," "+element.text());element.text(toggleValue);$this.removeClass("answer")});if(!remove){container.addClass("answer")}})};var initShowHideButtons=function(){$(document).on("click",".btn-toggle-visibility",function(event){var $this=$(this);event.preventDefault();var label=$this.attr("data-toggle-label");if(label){$this.attr("data-toggle-label",$this.text());$this.text(label)}var targetSelector=$this.attr("data-toggle-target");if(targetSelector){$(targetSelector).toggleClass("hide")}})};$doc.ready(function(){initBestAnswerButtons();initSpoilerButtons();if(hasAjaxFormPlugin()===false){return}initPaginationButtons();initEditButtons();initAjaxForm();initPollAjax();initShowHideButtons();initReplyButtons();if(hasRichTextEditorPlugin()===false){return}initQuoteButtons()})})(this,this.jQuery);
(function(context,$){"use strict";var $doc=$(context.document);var defaultErrorMsg="Woops! Something happened and we are working on it!";var loadingDivHtml="<div class='loading'></div>";var loadingDiv=$(loadingDivHtml);var initCommentSort=function(){$doc.on("click","#comments-block .feed-hdr a",function(event){event.preventDefault();var url=$(this).attr("href");var direction=$(this).data("dir");$.cookie("comment-sort-dir",direction,{path:"/",expires:30});sortComments(url);s.pageName=updatePageName(s.pageName,url);void s.t()});$doc.on("click","#comments-block #paginate-order-switch",function(event){event.preventDefault();var url=$("#comments-block .feed-hdr a:not(.on)").first().attr("href");var direction=$("#comments-block .feed-hdr a:not(.on)").first().data("dir");$.cookie("comment-sort-dir",direction,{path:"/",expires:30});sortComments(url);s.pageName=updatePageName(s.pageName,url);void s.t()});var sortComments=function(url){var $block=$("#comments-block");var blockPos=$block.offset().top;var $window=$(window);loadingDiv.height($block.height());$block.hide();$block.after(loadingDiv);if($window.scrollTop()>blockPos){$("html, body").animate({scrollTop:blockPos},300)}$.ajax({url:url,success:function(data){if(data.success===0){Phoenix.Ui.showErrorMessage(data.errMessage);loadingDiv.remove();$block.show();return}loadingDiv.remove();$block.show();$block.html(data.html)},error:function(){loadingDiv.remove();$block.show();Phoenix.Ui.showErrorMessage(defaultErrorMsg)},complete:function(){$(document).trigger("image-viewer-rescrape")}})};var updatePageName=function(pageName,url){var pageMatches=pageName.match(/:p([0-9]):/i);var pageNumber=pageMatches?pageMatches[1]:null;var newPageNumber=url.split("comment_page=")[1];if(!newPageNumber)newPageNumber=1;if(!pageNumber){return s.pageName}return pageName.split(":p"+pageNumber+":").join(":p"+newPageNumber+":")}};$doc.ready(function(){initCommentSort()})})(this,jQuery);
Phoenix._uploaderButtonAjaxBound=false;Phoenix._uploaderReadyBound=false;Phoenix._uploaderReadyNonAjaxTriggered=false;Phoenix.jQuery.getDocument().ready(function uploaderButton(isAjax){"use strict";var buttonContainerSelector=".image-widget-container";var buttonSelector=[buttonContainerSelector+" .btn",buttonContainerSelector+" .clickable"].join(",");var $container=$(buttonContainerSelector);var $document=$(document);var $hiddenInput,$uploader,$button,$img;var $clonedContainer,$clickedButton;var completeHandler=function(data,cb){if(!$button.hasClass("hide")&&$button.children("img").length===0){$button.addClass("hide")}var $found=$container.find("img");var append=$found.length===0;var $href=$();var imgErrorHandler=function(){Phoenix.Ui.showErrorMessage("Unable to load image");$img.parent().replaceWith($clonedContainer)};var getImageSuccessHandler=function(cb){return function(){if(this.width<10||this.height<10){imgErrorHandler()}if(typeof cb==="function"){cb()}}};if(append){$img=$('<img class="clickable">');$href=$('<a class="image-widget" href="#">').append($img)}else{$img=$($found[0])}if(data["successful"]===undefined){return imgErrorHandler()}var defaultSuccessHandler=function(name,info){$img.bind("error",imgErrorHandler);$img.bind("load",getImageSuccessHandler(cb));$img[0].src=info["url"];if(info["id"]){if($hiddenInput.length===0||!$hiddenInput){$hiddenInput=$container.find("input")}$hiddenInput.val(info["id"])}else{imgErrorHandler()}};$.each(data["successful"],function(name,info){if(Phoenix.UploaderButton._successHandler){info["embargo"]=!!data["image-embargo"];var noappend=Phoenix.UploaderButton._successHandler($clickedButton,name,info);if(noappend===true){append=false}}else{defaultSuccessHandler(name,info)}});if(append){$container.find(".btn-primary").addClass("hide");$href.appendTo($container)}else{$button.removeClass("hide")}for(var selector in Phoenix.UploaderButton._callbackFunctions){if($container.is(selector)||$container.find(selector).length>0||$container.parent().find(selector).length>0){Phoenix.UploaderButton._callbackFunctions[selector].call($img)}}};var errorHandler=function(data){var errors=data["errors"];if(data.crossOriginError){Phoenix.Ui.showErrorMessage("An error occurred while loading the image. The image editor will be closed.");return completeHandler(data)}if($button.hasClass("hide")){$button.removeClass("hide")}if(data.status===413){return Phoenix.Ui.showErrorMessage("Image is too large, please upload a smaller image.")}if(errors!==undefined){if(errors["url"]){return Phoenix.Ui.showErrorMessage(errors["url"])}if(errors["file"]){return Phoenix.Ui.showErrorMessage(errors["file"])}}};var clickHandler=function(event){$clickedButton=$(this);$container=$clickedButton.closest(buttonContainerSelector);$hiddenInput=$container.find("input");$button=$container.find(".image-widget, .btn-primary");$clonedContainer=$button.parent().clone(true);var multiple=$clickedButton.data("multiple");$.uploader({complete:completeHandler,error:errorHandler,type:"image",postURL:"/images/upload",urlPostURL:"/images/url-submit",headerText:"Where does your image live?",multiple:multiple,fileType:["image/jpeg","image/gif","image/png"],drop:true,dropText:"Or drag and drop your image to this window."});$uploader.modal("show");event.preventDefault();return false};var triggerReadyOnAllContainers=function($container){$container.each(function(){var $this=$(this);if($this.data("uploader")){return}$document.trigger("uploaderReady",[$this])})};if(!Phoenix._uploaderButtonAjaxBound){$document.ajaxComplete(function(){uploaderButton(true)});Phoenix._uploaderButtonAjaxBound=true}if(!Phoenix._uploaderReadyBound){$document.on("uploaderReady",function(e,$containerAjax){$uploader=$("#js-uploader");if($containerAjax){$container=$containerAjax}if($container.data("uploader")){return}$document.on("click.uploaderButton",buttonSelector,clickHandler);$container.data("uploader",true)});Phoenix._uploaderReadyBound=true}if(isAjax===true){triggerReadyOnAllContainers($container)}else if(!Phoenix._uploaderReadyNonAjaxTriggered){triggerReadyOnAllContainers($container);Phoenix._uploaderReadyNonAjaxTriggered=true}});Phoenix.UploaderButton=function(){"use strict";return this};Phoenix.UploaderButton._callbackFunctions={};Phoenix.UploaderButton._successHandler=null;Phoenix.UploaderButton.setCallbackFunction=function(selector,callbackFunc){"use strict";Phoenix.UploaderButton._callbackFunctions[selector]=callbackFunc};Phoenix.UploaderButton.setSuccessHandler=function(successFunc){"use strict";Phoenix.UploaderButton._successHandler=successFunc};
$(document).ready(function(){"use strict";var PROMO_COOKIE="_promos_seen";$("a[data-promo-id], .js-video-player[data-promo-id]").on("click",function(){var current=$.cookie(PROMO_COOKIE);var date=new Date;var id=parseInt($(this).attr("data-promo-id"),10);var canBeTopSlot=parseInt($(this).attr("data-top-slot-allowed"),10)===1;var replace=[];var data=$("#promo-id-"+id).children("a").data();if(!id||data&&data.cms===true){return}if(parseInt($(this).parent().attr("data-pinned"),10)===1){return}date.setMonth(date.getMonth()+1);if(current&&current.charAt(0)==="["){current=$.parseJSON(current)}else{current=[]}for(var i=0;i<current.length;i=i+1){if(current[i]===id){continue}for(var j=0,found=false;j<replace.length;j++){if(replace[j]===current[i]){found=true;break}}if(!found){replace.push(current[i])}}replace.push(id);$.cookie(PROMO_COOKIE,JSON.stringify(replace.slice(-20)),{expires:date,path:"/"})})});
var AjaxApiRequest=function(){"use strict";var exports={makeApiRequest:function(url,params,post,completionFn,errorFn){if(typeof params=="undefined"||typeof post=="undefined"){throw"Must specify params, and post or get for makeApiRequest"}makeRequest(url,params,post,completionFn,errorFn)},makeGetApiRequest:function(url,params,completionFn,errorFn){if(typeof params=="function"){errorFn=completionFn;completionFn=params;params=null}makeRequest(url,params,false,completionFn,errorFn)},makePostApiRequest:function(url,params,completionFn,errorFn){if(typeof params=="function"){errorFn=completionFn;completionFn=params;params=null}makeRequest(url,params,true,completionFn,errorFn)},makeAppropriateApiRequest:function(url,params,completionFn,errorFn){if(typeof params=="function"){errorFn=completionFn;completionFn=params;params=null}var paramsJson=JSON.stringify(params);if(paramsJson.length>1800){makeRequest(url,params,true,completionFn,errorFn)}else{makeRequest(url,params,false,completionFn,errorFn)}},eoo:null};(function(){$(document).ready(function(){$(".js-ajax-api-request").click(function(e){e.preventDefault();var $this=$(this);var apiUrl="";var paramFrom=$this.attr("data-api-url-from");if(typeof paramFrom!="undefined"){apiUrl=$(paramFrom).val()}else{apiUrl=$this.attr("href")}if($this.data("add-class")){makeRequest(apiUrl,null,true,function(){$this.toggleClass($this.data("add-class"));$this.attr("href","#null")})}else{makeRequest(apiUrl,null,true)}});$(".js-ajax-api-request-select").change(function(){makeRequest($(this).val())});$(".js-ajax-api-track-anchor").click(function(e){var $this=$(this);if($this.data("api_anchor_event_called")===true){return}var trackingToken=$this.attr("data-tracking-token");if(validateTrackingToken(trackingToken)){$this.data("api_anchor_event_called",true);Phoenix.getDocument().trigger("api_anchor_event",trackingToken);var href=$this.attr("href");if(href.charAt(0)!="#"){e.preventDefault();var target=$this.attr("target");setTimeout(function(){$this.data("api_anchor_event_called",false);if(!target||target===""){window.location=href}else{window.open(href,target)}},1e3)}else{$this.data("api_anchor_event_called",false)}}});$(".js-ajax-api-track-form-submit").click(function(e){var $this=$(this);var trackingToken=$this.attr("data-tracking-token");if(!validateTrackingToken(trackingToken)){return}if($this.data().formPostLatch===undefined){e.preventDefault();Phoenix.getDocument().trigger("api_result_event",trackingToken);$this.prop("disabled",true);$this.data().formPostLatch=true;setTimeout(function(){$this.prop("disabled",false);if(navigator.userAgent.search("Firefox")==-1){$this.trigger("click")}else{var form=$this.parents("form");if(form[0]){if(typeof tinymce!="undefined"){tinymce.triggerSave()}form.submit()}}},250)}else{delete $this.data().formPostLatch}})})})();function validateTrackingToken(trackingToken){return typeof trackingToken!="undefined"&&trackingToken&&trackingToken!==""}function makeRequest(apiUrl,params,post,completionFn,errorFn){if(typeof post=="undefined"){post=false}if(typeof completionFn=="undefined"){completionFn=function(){}}if(typeof errorFn=="undefined"){errorFn=function(){}}var requestFn=post?$.post:$.get;requestFn(apiUrl,params,function(result,textStatus,jqXHR){if(typeof result!="undefined"&&result&&typeof result.trackingToken!="undefined"){Phoenix.getDocument().trigger("api_result_event",[result])}completionFn(result,textStatus,jqXHR)}).error(function(xhr,status,error){errorFn(error,xhr)}).statusCode({0:function(x){},303:function(x){},302:function(x){}})}return exports}();
var UrlMaster=function(){"use strict";var exports={setOrigin:function(origin){m_Origin=origin},setPath:function(path){m_Path=path},addParam:function(param,value){m_Params[param]=value},removeParam:function(param){if(typeof(m_Params[param]!="undefined")){delete m_Params[param]}},hasParam:function(param){return m_Params.hasOwnProperty(param)},getParam:function(param,defaultValue){if(typeof defaultValue=="undefined"){defaultValue=null}if(!m_Params.hasOwnProperty(param)){return defaultValue}if(typeof m_Params[param]=="undefined"){return true}else{return decodeURIComponent(m_Params[param])}},getAllParams:function(){return m_Params},clearParams:function(){m_Params={}},paramExists:function(param){return typeof(m_Params[param]!="undefined")},setHash:function(hash){m_Hash=hash},getHash:function(){return m_Hash},setHashLive:function(hash,silent,andStore){if(typeof silent=="undefined"){silent=false}if(typeof andStore=="undefined"){andStore=false}m_HashChangeSilent=silent;window.location.hash=hash;if(andStore){m_Hash=hash}},getHashLive:function(){var hash=window.location.hash;if(hash===""){return""}return decodeURI(hash.toLowerCase()).substr(1)},getHashParams:function(defaults){if(typeof defaults=="undefined"){defaults={}}var hash=window.location.hash;if(hash===""){return{}}var hashParams=parseParamsString(hash.substr(1));$.extend(defaults,hashParams);return defaults},setHashParams:function(params,silent){var hash="";for(var param in params){if(params.hasOwnProperty(param)){hash+=param+":"+params[param]+";"}}hash=encodeURI(hash.substr(0,hash.length-1));exports.setHash(hash,silent)},updateHashParams:function(params,silent){var currentParams=exports.getHashParams();for(var param in params){if(params.hasOwnProperty(param)){currentParams[param]=params[param]}}exports.setHashParams(currentParams,silent)},bindHashChange:function(fn,callImmediately){if(!m_HashChangeSupport){throw"Hash change support not available."}if(m_HashListeners.indexOf(fn)!=-1){return}m_HashListeners.push(fn);if(typeof callImmediately!="undefined"&&callImmediately){fn()}},unbindHashChange:function(fn){if(!m_HashChangeSupport){throw"Hash change support not available."}var index=m_HashListeners.indexOf(fn);if(index==-1){return}m_HashListeners.splice(index,1)},generateUrl:function(pathOnly){var url="";if(!pathOnly){if(m_Origin!==""){url=m_Origin}else{url=window.location.protocol+"//"+window.location.hostname}if(window.location.port.length){url+=":"+window.location.port}}if(m_Path!==""){url+=m_Path}else{url+=window.location.pathname}if(Object.keys(m_Params).length){url+="?";for(var param in m_Params){if(m_Params.hasOwnProperty(param)){url+=param+"="+encodeURIComponent(m_Params[param])+"&"}}url=url.substr(0,url.length-1)}if(m_Hash!==""){url+="#"+m_Hash}return url},eoo:null};var m_Origin="";var m_Path="";var m_Hash="";var m_Params={};var m_HashChangeSupport=false;var m_HashListeners=[];var m_HashChangeSilent=false;(function(){var params=window.location.search;if(params!==""){params=params.substr(1);params.split("&").forEach(function(e){var parts=e.split("=");m_Params[parts[0]]=parts[1]})}m_Hash=window.location.hash;if(m_Hash!=""){m_Hash=m_Hash.substr(1)}var $win=$(window);if($win.hashchange){m_HashChangeSupport=true;$win.hashchange(function(){if(m_HashChangeSilent){m_HashChangeSilent=false;return}m_HashListeners.forEach(function(fn){fn()})})}})();function parseParamsString(paramString){var params={};if(typeof paramString=="undefined"||!paramString){return params}try{paramString.split(";").forEach(function(e){var parts=e.split(":");if(parts.length==2){var param=parts[0].replace(/\s/g,"");params[param]=parts[1].replace(/^[ \t]+|[ \t]+$ /,"")}else{params[parts[0]]=null}})}catch(e){return[]}return params}return exports};
var PostRender=function(){var exports={getPostRenderData:function(bundle,completionFn,errorFn){if(m_Data){setTimeout(function(){supplyBundleData(bundle,completionFn,errorFn)},0)}else{m_Subscribers.push({bundle:bundle,completionFn:completionFn,errorFn:errorFn})}},eoo:null};$(document).ready(function(){var postRenderParams={};$("[data-post-render-param]").each(function(i,e){var element=$(e);var param=element.attr("data-post-render-param");var value=element.attr("data-post-render-value");var paramIsArray=param.endsWith("[]");if(paramIsArray){param=param.substr(0,param.length-2)}var parts=param.split(".");if(typeof postRenderParams[parts[0]]=="undefined"){postRenderParams[parts[0]]={}}if(paramIsArray){if(typeof postRenderParams[parts[0]][parts[1]]=="undefined"){postRenderParams[parts[0]][parts[1]]=[value]}else{postRenderParams[parts[0]][parts[1]].push(value)}}else{postRenderParams[parts[0]][parts[1]]=value}});var urlMaster=new UrlMaster;var request={page:urlMaster.generateUrl(true),params:postRenderParams};AjaxApiRequest.makePostApiRequest("/postRender",request,function(result){if(result.result!="ok"){m_Data="error";m_Error="server error: "+result.error}else{m_Data=result.data}_broadcastResult()},function(error){m_Data="error";m_Error="network error: "+error;_broadcastResult()});function _broadcastResult(){m_Subscribers.forEach(function(sub){supplyBundleData(sub.bundle,sub.completionFn,sub.errorFn)})}});function supplyBundleData(bundle,completionFn,errorFn){if(m_Data==="error"){if(typeof errorFn=="function"){errorFn(m_Error)}return}if(bundle&&typeof m_Data[bundle]=="undefined"){if(typeof errorFn=="function"){errorFn("bundle does not provide post render data")}return}completionFn(m_Data._common,bundle?m_Data[bundle]:undefined)}var m_Data=null;var m_Error="";var m_Subscribers=[];return exports}();if(!String.prototype.endsWith){Object.defineProperty(String.prototype,"endsWith",{value:function(searchString,position){var subjectString=this.toString();if(position===undefined||position>subjectString.length){position=subjectString.length}position-=searchString.length;var lastIndex=subjectString.indexOf(searchString,position);return lastIndex!==-1&&lastIndex===position}})}
$(document).ready(function(){"use strict";var $forumLayout=$(".js-forum-layout"),hasForumLayout=!!$forumLayout.length;if(!hasForumLayout){return}var target=document.querySelector("#forums #forum-content"),fluidClass="container-fluid",defaultClass="container";var switchForumLayout=function(){var layoutType=$(this).attr("data-type-layout");var forumLayout=$.cookie("forumLayout");if(forumLayout=="container"){classie.remove(target,fluidClass);classie.add(target,defaultClass)}else if(forumLayout=="container-fluid"){classie.remove(target,defaultClass);classie.add(target,fluidClass)}};var setCookie=function(name,type){if(name!==undefined){$.cookie(name,type,{expires:365,path:"/"})}};$(document).on("click",".js-forum-layout",function(e){var layoutType=$(this).attr("data-type-layout");setCookie("forumLayout",layoutType);switchForumLayout()});var $lastSticky=$(".table-forums .is-topic-sticky").last(),hasLastSticky=!!$lastSticky.length;if(!hasLastSticky){return}function init(){if(!$lastSticky.hasClass("is-last-sticky")){$lastSticky.addClass("is-last-sticky")}}init()});
(function(document,$){"use strict";var gamesData;PostRender.getPostRenderData("GameBundle",function(commonData,GameBundleData){gamesData=GameBundleData;PostRender.getPostRenderData("FollowBundle",function(commonData,FollowBundleData){var followButtons=$(".stacks");var count=0;$.each(followButtons,function(key,button){var $button=$(button),gameId=$button.attr("data-post-render-value");if($(".js-game-card-follow").length){var getUnFollowGameReleaseApiUrl="/api/follow/unfollowGameRelease/"+gameId;var userFollowsGame=false;var gameData=gamesData[gameId];if(!gameData){count++;return true}var multiplatform=Object.keys(gameData["platforms"]).length>1;if(multiplatform){var stacksItems=null;$.each(gameData["platforms"],function(name,platform){var platformFollowURL="/api/follow/followGameRelease/"+gameId+"-"+platform["abbreviation"];var platformUnfollowURL="/api/follow/unfollowGameRelease/"+gameId;var isFollowingThisPlatform=FollowBundleData[gameId][platform["name"]];var singleStack=$("<div>").append($button.find(".stacks-list__item").clone()).html().trim();if(isFollowingThisPlatform){userFollowsGame=true;singleStack=singleStack.replace(/%following%/g,"following")}else{singleStack=singleStack.replace(/%following%/g,"")}singleStack=singleStack.replace(/%platformFollowURL%/g,platformFollowURL).replace(/%platformUnfollowURL%/g,platformUnfollowURL).replace(/%isFollowingThisPlatform%/g,isFollowingThisPlatform).replace(/%platformName%/g,platform["name"]);if(stacksItems==null){stacksItems=singleStack}else{stacksItems+=singleStack}})}else{if(Object.keys(gameData["platforms"])[0]!=null){var platformFollowURL="/api/follow/followGameRelease/"+gameId+"-"+gameData["platforms"][Object.keys(gameData["platforms"])[0]]["abbreviation"],$gamecardFollow=$button.find(".js-game-card-follow"),$gamecardFollowToggle=$button.find(".js-game-card-follow-toggle"),stacksEventHierarchy=$gamecardFollow.data("stacks-event-hierarchy");$gamecardFollowToggle.attr("data-follow-url",platformFollowURL);$gamecardFollowToggle.addClass("js-game-follow-event-tracking");$button.find(".js-pop-over-container").remove();if(stacksEventHierarchy){$gamecardFollowToggle.attr("data-event-tracking",stacksEventHierarchy)}userFollowsGame=FollowBundleData[gameId][gameData["platforms"][0]["name"]]}}var htmlButton=$("<div>").append($button.clone()).html().trim();htmlButton=htmlButton.replace(/%isFollowing%/g,userFollowsGame).replace(/%followText%/g,"Follow").replace(/%followingText%/g,"Following").replace(/%multiplatform%/g,multiplatform).replace(/%getUnFollowGameReleaseApiUrl%/g,getUnFollowGameReleaseApiUrl);htmlButton=$(htmlButton);htmlButton.find(".game-card-follow-text").text(userFollowsGame?"Following":"Follow");$button.replaceWith(htmlButton);$(".stacks:eq("+count+")").find(".stacks-list__item").replaceWith(stacksItems);count++}else{var htmlButton=$("<div>").append($button.clone()).html().trim();htmlButton=htmlButton.replace(/%gameName%/g,gamesData[gameId]["game"]["name"]);htmlButton=$(htmlButton);htmlButton.find(".js-game-image").attr("src",gamesData[gameId]["image"]);$button.replaceWith(htmlButton)}});$(".stacks").removeClass("game-card-loading");var initOnAjaxRegistered=false;var initGamecards=function(){var followDisabled=false,$follow=$(".js-game-card-follow"),$toggle=$(".js-game-card-follow-toggle");if($follow.data("gamecard-initialized")){return}$follow.data("gamecard-initialized",1);$toggle.tooltip();var updateFollowText=function(toggles){toggles.each(function(i,e){var $e=$(e),$parent=$e.parent(".js-game-card-follow"),following=$parent.attr("data-following")==="true";$e.tooltip(following?"disable":"enable");$e.find(".game-card-follow-text").text($parent.data(following?"following-text":"follow-text"))})};var followRequest=function(url){if(followDisabled){return false}followDisabled=true;return $.post(url).fail(function(){Phoenix.Ui.showErrorMessage("An error occurred. Please try again later.")}).always(function(){followDisabled=false})};var trackGameFollow=function(){var eventTrackingDataKey="event-tracking";return function($toggle,response){var eventTrackingParams=$toggle.data(eventTrackingDataKey),eventItemHierarchy;if(typeof eventTrackingParams==="string"){eventItemHierarchy=eventTrackingParams;eventTrackingParams=undefined}if(undefined===eventTrackingParams){eventTrackingParams={};if(eventItemHierarchy){eventTrackingParams.event_hierarchy=eventItemHierarchy}if(response.eventTracking){$.extend(eventTrackingParams,response.eventTracking)}if(!$.isEmptyObject(eventTrackingParams)){$toggle.data(eventTrackingDataKey,eventTrackingParams)}}if(undefined!==eventTrackingParams&&!$.isEmptyObject(eventTrackingParams)){$toggle.trigger("gameFollowEventTracking")}}}();$toggle.each(function(){var $this=$(this);if(typeof $this.data("click-registered")==="undefined"){$this.on("click",function(e){e.preventDefault();var $this=$(this),$parent=$this.parent(".js-game-card-follow"),following=$parent.attr("data-following")==="true",game=$this.data("game-id"),$gameToggles=$('[data-game-id="'+game+'"]');if($this.data("multiplatform")){return false}var url=$this.data(following?"unfollow-url":"follow-url");followRequest(url).done(function(response){following=!following;$parent.attr("data-following",""+following);var message=following?"You're now following this game!":"You're no longer following this game.";$gameToggles.each(function(_,tgl){$(tgl).parent(".js-game-card-follow").attr("data-following",""+following)});updateFollowText($gameToggles);Phoenix.Ui.showSuccessMessage(message);if(following){trackGameFollow($this,response)}})});$this.data("click-registered",true)}});$(".js-game-card-follow-platform").each(function(){var $this=$(this);if(typeof $this.data("click-registered")==="undefined"){$this.on("click",function(e){e.preventDefault();var $this=$(this),followingThis=$this.attr("data-following")==="true",followURL=$this.data("follow-url"),unfollowURL=$this.data("unfollow-url"),game=$this.parents(".js-game-follow").data("popover-game-id"),$gamePopovers=$('[data-popover-game-id="'+game+'"]'),$gameToggles=$('[data-game-id="'+game+'"]'),$matchingGamePlatforms=$gamePopovers.find('.js-game-card-follow-platform[data-follow-url="'+followURL+'"]'),requestURL=followingThis?unfollowURL:followURL;followRequest(requestURL).done(function(response){var message;followingThis=!followingThis;$matchingGamePlatforms.attr("data-following",""+followingThis);if(followingThis){message="You're now following this release!";$matchingGamePlatforms.addClass("following")}else{message="You're no longer following this release.";$matchingGamePlatforms.removeClass("following")}$gameToggles.each(function(_,tgl){var followingAny=false;$gamePopovers.find(".js-game-card-follow-platform").map(function(_,e){if($(e).attr("data-following")==="true"){followingAny=true}});$(this).parent(".js-game-card-follow").attr("data-following",""+followingAny)});updateFollowText($gameToggles);Phoenix.Ui.showSuccessMessage(message);if(followingThis){trackGameFollow($this,response)}})});$this.data("click-registered",true)}});$(".js-game-card-follow-form").each(function(i,el){var $el=$(el);if(typeof $el.data("submit-registered")==="undefined"){$el.submit(function(e){var $this=$(this);e.preventDefault();var email=$this.find("input[name=email]").val();if(!/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/.test(email)){$this.find(".error").text("Please enter a valid email address")}AjaxApiRequest.makePostApiRequest($this.attr("action"),{email:email},function(result){if(typeof result!=="undefined"&&!result.success){$this.find(".error").html(result.reason)}else{$this.addClass("hidden");$this.siblings(".js-game-card-follow-others").removeClass("hidden").find("input[name=email]").val(email)}})});$el.data("submit-registered",true)}});$(".js-pop-over-container.js-game-follow").each(function(){var $this=$(this);if(typeof $this.data("popover:shown-registered")==="undefined"){$this.on("popover:shown",function(e,popover){var $this=$(this);if($this.hasClass("js-game-follow-unreg")){$this.css({display:"block"})}else{$this.css({width:popover.toggle.css("width"),display:"block"})}$this.position({my:"center top",at:"center bottom",of:popover.toggle,collision:"fit"})})}});PhoenixPopover.init();if(!initOnAjaxRegistered){$(document).ajaxComplete(initGamecards);initOnAjaxRegistered=true}};initGamecards();$(document).on("on_page_event",initGamecards)},function(err){console.error(err)})})})(document,jQuery);var PhoenixPopover=function(){var exports={init:function(){$(".js-pop-over-toggle").each(function(i,e){var popoverToggle=$(e);if(typeof popoverToggle.data("toggle-init")==="undefined"){for(var parent=popoverToggle.parent();parent[0].nodeName.toLowerCase()!="body";parent=parent.parent()){if(parent.hasClass("js-pop-over-parent")){break}}var container=parent.find(".js-pop-over-container");var popoverContainer={element:container,width:container.width(),height:container.height(),toggle:popoverToggle,clickOffsetX:parseInt(container.attr("data-click-open-offset-X")),clickOffsetY:parseInt(container.attr("data-click-open-offset-Y"))};popoverToggle.data("popOverContainer",popoverContainer);$("body").append(container.detach());container.css({position:"absolute"});popoverToggle.click(function(e){if(m_OpenPopover){hidePopover();return}m_OpenPopover=$(this).data("popOverContainer");if(m_OpenPopover){e.stopPropagation();var left=0;if(e.clientX+m_OpenPopover.width>$(document).width()){m_OpenPopover.element.addClass("popover-position-left");left=e.clientX-m_OpenPopover.width-m_OpenPopover.clickOffsetX}else{m_OpenPopover.element.addClass("popover-position-right");left=e.clientX+m_OpenPopover.clickOffsetX}m_OpenPopover.element.css({top:e.clientY+$(window).scrollTop()+m_OpenPopover.clickOffsetY,left:left});m_OpenPopover.element.show();m_OpenPopover.element.trigger("popover:shown",m_OpenPopover);$("body").bind("click",backgroundClickHandler);$(window).bind("resize",resizeHandler)}});popoverToggle.data("toggle-init",true)}})},hidePopover:function(){if(m_OpenPopover){hidePopover()}},eoo:null};var m_OpenPopover=null;function backgroundClickHandler(e){if(!elementInElement(e,m_OpenPopover.element)){hidePopover()}}function resizeHandler(){if(m_OpenPopover){hidePopover()}}function hidePopover(){m_OpenPopover.element.hide();m_OpenPopover.element.removeClass("popover-position-left");m_OpenPopover.element.removeClass("popover-position-right");m_OpenPopover=null;$("body").unbind("click",backgroundClickHandler);$(window).unbind("resize",backgroundClickHandler)}function getScreenPosition($element){var pos=$element.offset();pos.top-=$(window).scrollTop();pos.left-=$(window).scrollLeft();return pos}function getScreenRect($element){var pos=getScreenPosition($element);return{top:pos.top,left:pos.left,bottom:pos.top+$element.outerHeight(),right:pos.left+$element.outerWidth()}}function elementInElement(e,$element){var rect=getScreenRect($element);return e.clientY>=rect.top&&e.clientY<=rect.bottom&&e.clientX>=rect.left&&e.clientX<=rect.right}return exports}();
var loadDataUserAgentPlatform=function(){"use strict";var b=document.documentElement;b.setAttribute("data-useragent",navigator.userAgent);b.setAttribute("data-platform",navigator.platform)};loadDataUserAgentPlatform();$(document).ready(function(){"use strict";var messageBlock=Phoenix.jQuery.getMessageBlock();if(messageBlock&&$.trim(messageBlock.html())!==""&&!messageBlock.hasClass("transitioning")){var message=$.trim(messageBlock.html());Phoenix.Ui.showMessageBar(message)}var device=$('meta[itemprop="deviceType"]').attr("content");if(device!=="phone"){$(".paginate a").tooltip();$(".tipsy").tooltip()}var autocompleteInit=function(){$(".search-autocomplete").each(function(){var $this=$(this);var indices=$this.data("autocomplete-indexes");var extraParams={};if($this.data("initialized")===true){return}if($(this).data("cms")){extraParams.cms=1}if(indices){$this.autocomplete({autoRedirect:true,searchIndex:indices,selectFirst:true,showNotificationBar:true,extraParams:extraParams})}else{$this.autocomplete({showNotificationBar:true,extraParams:extraParams})}$this.data("initialized",true)})};autocompleteInit();$(document).ajaxStop(autocompleteInit);$(document).on("newAutoCompleteAdded",autocompleteInit);var beingSubmitted=false;$(".js-prevent-mult-submit").on("submit",function(event){$(this).find("button[type=submit]").attr("disabled","disabled");if(beingSubmitted){event.preventDefault();event.stopPropagation()}else{beingSubmitted=true}return true})});
$(document).on("ready ajaxContentLoaded",function(){"use strict";$(".js-load-forever").each(function(){var $moreButton=$(this);if($moreButton.data("loadForeverInitialized")){return}$moreButton.data("loadForeverInitialized",true);var pageName=$moreButton.attr("data-page-name")||"page";var newsContainerSelector=$moreButton.attr("data-target");if(!newsContainerSelector){newsContainerSelector=".js-load-forever-container"}var $loadingDiv=$('<div class="loading"></div>');var endOfTheLine="Sorry that's all folks";var enabled=true;var page=1;var maxPage=false;var noScroll=typeof $moreButton.attr("data-no-scroll")!=="undefined";maxPage=$moreButton.attr("data-max-page");if(!maxPage){maxPage=false}if($moreButton.attr("data-end-of-line-text")){endOfTheLine=$moreButton.attr("data-end-of-line-text")}$moreButton.click(function(event){if(!enabled){return}if(maxPage!==false&&page>=maxPage){return}event.preventDefault();page=page+1;$moreButton.before($loadingDiv);$moreButton.hide();$.get("?"+pageName+"="+page,function(data){var riverHtml="";if(data.river){riverHtml=$("<div>"+data.river+"</div>").find(newsContainerSelector).html()}else{riverHtml=$(data).find(newsContainerSelector).html()}var emptyList=false;if($(riverHtml).filter("ul").html()!=undefined){emptyList=$(riverHtml).filter("ul").html().trim()===""}if(riverHtml===""||emptyList){var link=$moreButton.data("end-of-line");$moreButton.find("a").text(endOfTheLine);$moreButton.find("a").attr("href",link);$moreButton.find("a").attr("target","_blank");$moreButton.hide();enabled=false;return}var riverObj=$(riverHtml);$(newsContainerSelector).append(riverObj);if(!noScroll){$("html, body").animate({scrollTop:riverObj.first().offset().top})}if(maxPage!==false&&page>=maxPage){enabled=false;var link=$moreButton.data("end-of-line");$moreButton.find("a").text(endOfTheLine);$moreButton.find("a").attr("href",link);$moreButton.find("a").attr("target","_blank")}if($(data).find(".js-noPagesRemaining").length==0){$moreButton.show()}}).complete(function(){$loadingDiv.remove()})})})});
$(document).ready(function(){"use strict";var skinSource=$.cookie("skinSource"),defaultSkinSource=$("#skin-switch a:first-child").attr("rel"),rteTheme=$.cookie("richTextEditorTheme"),switchBtn=$("#skin-switch a.skin-switch-btn"),skinName,skinColor;if(skinSource){$.cookie("skinSource",skinSource,{expires:365,path:"/"});skinName=skinSource.split("_");skinColor=skinName[skinName.length-1];$(".switch__item").addClass("switch__item--"+skinColor)}else if(defaultSkinSource){$.cookie("skinSource",defaultSkinSource,{expires:365,path:"/"});skinName=defaultSkinSource.split("_");skinColor=skinName[skinName.length-1];$(".switch__item").addClass("switch__item--"+skinColor)}if(rteTheme){$.cookie("richTextEditorTheme",rteTheme,{expires:365,path:"/"})}switchBtn.click(function(){if($(this).parent().hasClass("switch__item--white")){$(this).parent().removeClass("switch__item--white");$(this).parent().addClass("switch__item--black")}else if($(this).parent().hasClass("switch__item--black")){$(this).parent().removeClass("switch__item--black");$(this).parent().addClass("switch__item--white")}});switchBtn.click(function(event){event.preventDefault();var relName=$(this).attr("rel");if($(this).attr("data-rel-url-critical")){$("link#skin-color").attr("href",$(this).attr("data-rel-url-critical"));$("link#skin-color-non-critical").attr("href",$(this).attr("data-rel-url-noncritical"))}else{$("link#skin-color").attr("href",$(this).attr("data-rel-url"))}$.cookie("skinSource",relName,{expires:365,path:"/"});var rteName=$(this).attr("data-richTextEditorTheme");$.cookie("richTextEditorTheme",rteName,{expires:365,path:"/"});$(document).trigger("updateRichTextEditorTheme",[$(this).attr("data-richTextEditorTheme-url")]);return false})});
(function(contextScope){"use strict";var $doc=$(document);var videoPlayerSelector=".js-video-player";var videoPlayerEventTrackers="meta.js-event-tracking";var eventTrackersKey="event-trackers";var $players;var getCustomEventTrackers=function($player){var trackersByEvent=$player.data(eventTrackersKey),$trackers;if(undefined===trackersByEvent){trackersByEvent={};$trackers=$player.find(videoPlayerEventTrackers);$trackers.each(function(){var $tracker=$(this),eventName=$tracker.attr("itemprop");if(eventName){trackersByEvent[eventName]=$tracker}});$player.data(eventTrackersKey,trackersByEvent)}return trackersByEvent};var getCustomEventTracker=function($player,eventName){var trackersByEvent=getCustomEventTrackers($player);return trackersByEvent[eventName]};var trackPlayerEvent=function(evt){var $player=$(this),eventName=evt.type,$tracker=getCustomEventTracker($player,eventName);if($tracker){$tracker.trigger("customEventTracking")}};var initEventListeners=function(){$players.on("videoReplay postPlayStart postPlayStop",trackPlayerEvent)};$doc.on("ready",function(){$players=$(videoPlayerSelector);if(!$players||$players.length<1){return}initEventListeners()})})(this);
(function(contextScope){"use strict";var $doc=$(document);var videoPlayerSelector=".js-video-player";var postPlaySelector=".js-vid-postplay";var postPlayCountdownSelector=".js-vid-postplay-countdown";var postPlayTimerSelector=".js-vid-postplay-timer";var postPlayCloseControlSelector=".js-vid-postplay-close";var postPlayStopControlSelector=".js-vid-postplay-stop";var postPlayNextControlSelector=".js-vid-postplay-next";var postPlayVideoActionSelector=".js-vid-postplay-action";var postPlayVideoContainerSelector=".js-vid-postplay-videos";var postPlayVideoSelector=".js-vid-postplay-video";var postPlayCountingClass="is-postplay-counting";var postPlayCompleteClass="is-postplay-complete";var showPostPlayClass="is-vid-postplay";var countdownStoppedClass="is-countdown-stopped";var countdownTimeoutIdKey="countdown-timeout-id";var postPlayStartedKey="postplay-started";var postPlayIdKey="postplay-id";var redirTrackingKey="redir-tracking";var eventTrackingKey="event-tracking";var smEnterViewport="enterViewport";var countdownDuration=10;var countdownDelay=1e3;var countdownStartDelay=10;var countdownCompleteDelay=500;var postPlayCount=0;var postPlayDefaults={videoTimeRemaining:0,countdown:{timeValue:0,delayStart:0,delayOverride:0},deferred:false,canceled:false,paused:false};var videoPlayerPostPlay={};var activePostPlay;var initPostPlayNext=function(){var postPlay,$postPlay,$nextControl,$countdown,$videosContainer,$firstVideo,$nextVideo,watchedIds,matchedIds,videoJSON;var getWatchedVideoIds=function(){var cookieName=videoJSON.watchedCookieName,watched;if(!cookieName){return}watched=$.parseJSON($.cookie(cookieName));if(!watched){watched=[]}watchedIds=watched};var setWatchedVideos=function(){var cookieName=videoJSON.watchedCookieName,cookieDays=videoJSON.watchedCookieDays,watchedIdsJsonString;if(undefined===watchedIds){return}try{watchedIdsJsonString=JSON.stringify(watchedIds)}catch(e){watchedIdsJsonString=false}$.cookie(cookieName,watchedIdsJsonString,{path:"/",expires:cookieDays})};var removeMatchedIds=function(){var newWatched=[],videoId,i;for(i=0;i<watchedIds.length;i++){videoId=watchedIds[i];if(0>$.inArray(videoId,matchedIds)){newWatched.push(videoId)}}watchedIds=newWatched};var getNextVideo=function(){var videos=$postPlay[0].querySelectorAll(postPlayVideoSelector),$video,videoId,i;for(i=0;i<videos.length;i++){$video=$(videos[i]);videoId=$video.data("id");if(!$firstVideo){$firstVideo=$video}if(0<=watchedIds.indexOf(videoId)){matchedIds.push(videoId)}else{$nextVideo=$video;break}}};var setNextVideo=function(){var $nextVideoControl,$timer=postPlay.$timer,videoTitle;if($firstVideo!==$nextVideo){$videosContainer=$postPlay.find(postPlayVideoContainerSelector);$videosContainer.prepend($nextVideo)}$nextVideoControl=$nextVideo.find("a");if(false===$.contains($nextVideo[0],$timer[0])){$nextVideoControl.append($timer)}videoTitle=$nextVideoControl.text();$nextControl.text("Next up: "+videoTitle);$nextControl.attr({href:$nextVideoControl.attr("href"),title:videoTitle})};return function($player,targetPostPlay){videoJSON=$player.data("video");postPlay=targetPostPlay;$postPlay=postPlay.$postPlay;$nextControl=postPlay.$nextControl;$countdown=postPlay.$countdown;getWatchedVideoIds();$firstVideo=$nextVideo=null;matchedIds=[];getNextVideo();if(null===$nextVideo){$nextVideo=$firstVideo;removeMatchedIds();setWatchedVideos()}setNextVideo();targetPostPlay.$nextVideo=$nextVideo}}();var initPostPlay=function(playerKey,$player){var $postPlay=$player.find(postPlaySelector),$nextControl=$postPlay.find(postPlayNextControlSelector),$postPlayActions=$postPlay.find(postPlayVideoActionSelector),$stopControls=$postPlay.find([postPlayCloseControlSelector,postPlayStopControlSelector].join(",")),postPlay=$.extend({},postPlayDefaults,{$player:$player,$postPlay:$postPlay,$countdown:$postPlay.find(postPlayCountdownSelector),$nextControl:$nextControl,$nextVideo:null,$timer:$postPlay.find(postPlayTimerSelector),watcher:scrollMonitor.create($player)});postPlay.enterViewportHandler=function(){startCountdown(postPlay)};if($stopControls&&$stopControls.length>0){$stopControls.on("click",function(e){var $clickedControl=$(this);if($postPlay.hasClass(postPlayCountingClass)){e.stopPropagation();e.preventDefault();if($clickedControl.is(postPlayCloseControlSelector)){cancelPostPlay(postPlay)}else{stopCountdown(postPlay)}}})}$nextControl.on("click",function(){completeCountdown(postPlay)});$postPlayActions.on("click",function(){var $nextVideo=$(this).closest(postPlay.$nextVideo);if($nextVideo.length>0){completeCountdown(postPlay)}else{stopCountdown(postPlay)}});$postPlayActions.each(function(index){var $action=$(this),eventTracking=$action.data(eventTrackingKey);if(eventTracking){eventTracking+="|"+(index+1);$action.data(eventTrackingKey,eventTracking)}});initPostPlayNext($player,postPlay);videoPlayerPostPlay[playerKey]=postPlay};var getPostPlayObject=function($player){var playerKey=$player.data(postPlayIdKey);if(!playerKey){postPlayCount++;playerKey=postPlayCount;$player.data(postPlayIdKey,playerKey);initPostPlay(playerKey,$player)}return videoPlayerPostPlay[playerKey]};var autoplayPostPlayVideo=function(postPlay){var $nextVideoControl=postPlay.$nextControl,redirTrackingData=$nextVideoControl.data(redirTrackingKey);if(redirTrackingData){$nextVideoControl.data(eventTrackingKey,redirTrackingData);$nextVideoControl.trigger("customEventTracking")}window.location=$nextVideoControl.attr("href")};var clearCountdownTimeout=function($countdown){var countdownTimeoutId=$countdown.data(countdownTimeoutIdKey);clearTimeout(countdownTimeoutId);countdownTimeoutId=null;$countdown.data(countdownTimeoutIdKey,countdownTimeoutId)};var setCountdownValue=function(postPlay,countdownValue,delayOverride){var $countdown=postPlay.$countdown,videoTimeRemaining=postPlay.videoTimeRemaining,nextCountdownValue,countdownTimeoutId;clearCountdownTimeout($countdown);if(Math.floor(videoTimeRemaining)>countdownValue){countdownValue=Math.floor(videoTimeRemaining);delayOverride=(videoTimeRemaining-countdownValue)*countdownDelay+countdownStartDelay}nextCountdownValue=countdownValue-1;$countdown.text(countdownValue);postPlay.countdown={timeValue:countdownValue,delayStart:Date.now(),delayOverride:null};if(postPlay.paused){return}if(delayOverride){}if(0>=countdownValue){setTimeout(function(){completeCountdown(postPlay,true)},countdownCompleteDelay)}else{countdownTimeoutId=setTimeout(function(){setCountdownValue(postPlay,nextCountdownValue)},delayOverride||countdownDelay);$countdown.data(countdownTimeoutIdKey,countdownTimeoutId)}};var startCountdown=function(postPlay){var $countdown=postPlay.$countdown,countdownTimeoutId;clearCountdownTimeout(postPlay.$countdown);clearEnterViewportHandler(postPlay);postPlay.$postPlay.removeClass(postPlayCompleteClass).addClass(postPlayCountingClass);postPlay.$timer.removeClass(countdownStoppedClass);countdownTimeoutId=setTimeout(function(){setCountdownValue(postPlay,countdownDuration)},countdownStartDelay);$countdown.data(countdownTimeoutIdKey,countdownTimeoutId)};var deferCountdown=function(postPlay){if(!postPlay.deferred){postPlay.deferred=true;postPlay.watcher.on(smEnterViewport,postPlay.enterViewportHandler)}};var clearEnterViewportHandler=function(postPlay){if(postPlay.deferred){postPlay.deferred=false;postPlay.watcher.off(smEnterViewport,postPlay.enterViewportHandler)}};var stopCountdown=function(postPlay){$.extend(postPlay,postPlayDefaults);clearCountdownTimeout(postPlay.$countdown);clearEnterViewportHandler(postPlay);postPlay.$postPlay.removeClass(postPlayCountingClass);postPlay.$timer.addClass(countdownStoppedClass)};var pauseCountdown=function(postPlay){if(!postPlay.paused&&postPlay.countdown.timeValue>0){var now=Date.now(),delayOverride=now-postPlay.countdown.delayStart;clearCountdownTimeout(postPlay.$countdown);clearEnterViewportHandler(postPlay);postPlay.paused=true;postPlay.countdown.delayOverride=delayOverride}};var resumeCountdown=function(postPlay){if(postPlay.paused){postPlay.paused=false;setCountdownValue(postPlay,postPlay.countdown.timeValue,postPlay.countdown.delayOverride)}};var completeCountdown=function(postPlay,redirect){stopCountdown(postPlay);postPlay.$postPlay.addClass(postPlayCompleteClass);if(redirect){autoplayPostPlayVideo(postPlay)}};var hidePostPlay=function(postPlay){stopCountdown(postPlay);postPlay.$player.removeClass(showPostPlayClass)};var showPostPlay=function(postPlay){postPlay.$player.addClass(showPostPlayClass)};var cancelPostPlay=function(postPlay){hidePostPlay(postPlay);postPlay.canceled=true};var startPostPlay=function($player){var postPlay;if(true===$player.data(postPlayStartedKey)){return}$player.trigger("postPlayStart");activePostPlay=postPlay=getPostPlayObject($player);$player.data(postPlayStartedKey,true);showPostPlay(postPlay);if(postPlay){postPlay.canceled=false;if(postPlay.watcher.isInViewport){startCountdown(postPlay)}else{deferCountdown(postPlay)}}};var stopPostPlay=function($player){var postPlay;if(!$player.data(postPlayStartedKey)){return}postPlay=getPostPlayObject($player);$player.data(postPlayStartedKey,false);if(postPlay){hidePostPlay(postPlay)}};var setupPostPlayCountdown=function(){$doc.on({contentPause:function(){pauseCountdown(getPostPlayObject($(this)))},contentProgress:function(e,playerStates){if(playerStates){var $player=$(this),postPlay=getPostPlayObject($player),timeRemaining=playerStates.duration-playerStates.currentTime;postPlay.videoTimeRemaining=timeRemaining;if(countdownDuration<timeRemaining){stopPostPlay($player)}else{if(false===playerStates.adPlaying&&true===playerStates.playing){startPostPlay($player,playerStates)}}}},contentResume:function(){var postPlay=getPostPlayObject($(this));if(postPlay.paused){resumeCountdown(postPlay)}}},videoPlayerSelector)};var setupPostPlayContentEnd=function(){$doc.on({contentEnd:function(){startPostPlay($(this))},videoStart:function(){stopPostPlay($(this))}},videoPlayerSelector)};var setupVideoPostPlay=function($videoPostPlay){var postPlayStart=$videoPostPlay.data("postplay-start");if(0===postPlayStart){setupPostPlayContentEnd()}else{setupPostPlayCountdown()}$doc.on({rteBlur:function(){if(activePostPlay&&!activePostPlay.canceled){deferCountdown(activePostPlay)}},rteTyping:function(){if(activePostPlay){stopCountdown(activePostPlay)}}},".js-editor-textarea")};$doc.on("ready",function(){var $videoPostPlay=$(postPlaySelector);if($videoPostPlay&&0<$videoPostPlay.length){setupVideoPostPlay($videoPostPlay)}})})(this);
(function(contextScope){"use strict";var $doc=$(document);var videoPlayerSelector=".js-video-player";var videoDataKey="video";var videoStatesKey="states";var saveTimeExpires=5;var videoSettings={};var getSettings=function($videoPlayer){var states=$videoPlayer.data(videoStatesKey),videoId=states.videoId,settings=videoSettings[videoId],videoJSON;if(undefined===settings){videoJSON=$videoPlayer.data(videoDataKey);settings=videoJSON.savePosition;if(undefined===settings){settings=null}else{settings["videoId"]=videoId}videoSettings[videoId]=settings}return settings};var deletePositionForUser=function(settings){if(!settings.api){return}$.ajax({type:"POST",url:settings.api.deleteSavedTime,data:{video_id:settings.videoId}})};var savePositionForUser=function(settings,currentTime){if(!settings.api){return}$.ajax({type:"POST",url:settings.api.setSavedTime,data:{video_id:settings.videoId,time_to_save:currentTime},async:false})};var deletePositionCookie=function(settings){$.removeCookie(settings.cookieName,{path:"/"})};var savePositionCookie=function(settings,currentTime){$.cookie(settings.cookieName,currentTime,{path:"/",expires:saveTimeExpires})};var deletePosition=function(settings){deletePositionForUser(settings);deletePositionCookie(settings)};var savePosition=function(settings,videoPlayerStates){var currentTime=videoPlayerStates.currentTime,videoEnded=Math.floor(currentTime)>=Math.floor(videoPlayerStates.duration);if(videoEnded){deletePosition(settings)}else{savePositionForUser(settings,currentTime);savePositionCookie(settings,currentTime)}};var savePositionHandler=function(evt,timeToSave){var $videoPlayer=$(this),states=$videoPlayer.data(videoStatesKey),settings=getSettings($videoPlayer);if(!settings){return}if(states.adPlaying||!(states.playing||states.paused)){return}if(timeToSave){states.currentTime=timeToSave}savePosition(settings,states)};$doc.on("videoPlayerReady",function(evt,$videoPlayers){var videoJSON=$videoPlayers.data(videoDataKey);if(!videoJSON||!videoJSON.savePosition){return}$doc.on("contentEnd contentPause contentSeek unloadVideoplayer",videoPlayerSelector,savePositionHandler)})})(this);
(function(contextScope){"use strict";var metisVideoPlayer={version:"v.2013.07.31",ageMessage:"Sorry you cannot access this content."};var eventNamespace=".metisVideoPlayer";var undef,$doc,$docRoot,$win;var getPhoenix=function(){var localPhoenix;return function(){if(undef===localPhoenix){localPhoenix=contextScope.Phoenix||{}}return localPhoenix}}();var getWindow=function(){if(undef===$win){var p=getPhoenix();if(!!p.jQuery&&!!p.jQuery.getWindow){$win=p.jQuery.getWindow()}else{$win=$(window)}}return $win};var getDocument=function(){if(undef===$doc){var p=getPhoenix();if(!!p.jQuery&&!!p.jQuery.getDocument){$doc=p.jQuery.getDocument()}else{$doc=$(document)}}return $doc};var getDocumentContentRoots=function(){if(undef===$docRoot){$docRoot=$("html, body")}return $docRoot};var stopEvent=function(e){if(!!e){if(!!e.preventDefault){e.preventDefault()}}};var jsonEncode=function(obj){var returnVal,jsonStringified=false;if(!!JSON&&!!JSON.stringify){try{returnVal=JSON.stringify(obj);jsonStringified=true}catch(e){jsonStringified=false}}if(!jsonStringified){returnVal=false}return returnVal};var showSuccessMessage=function(msg){var p=getPhoenix();if(!!p.Ui&&!!p.Ui.showSuccessMessage){p.Ui.showSuccessMessage(msg)}};var getEventInContainerRatio=function(e,$container){if(!e||!$container){return}var xMin=0,xMax=$container.width(),offset=$container.offset(),x=e.pageX-offset.left,ratio;if(x<xMin){x=xMin}else if(x>xMax){x=xMax}ratio=x/xMax;return ratio};var ratioToPercentString=function(ratio){var ratioStr=(100*ratio).toFixed(2),dotZeroIndex=ratioStr.indexOf(".00");if(dotZeroIndex>0){ratioStr=ratioStr.substr(0,dotZeroIndex)}return ratioStr+"%"};var secondsPerMinute=60,minutesPerHour=60,secondsPerHour=3600,zeroString="0",timeUnitToken=":";var convertTime=function(time){var seconds,minutes,hours,secondsPrefix="",minutesPrefix="",converted="";if(!time){time=0}if(time<0||isNaN(time)){time=0}seconds=Math.floor(time%secondsPerMinute);minutes=Math.floor(time/secondsPerMinute%minutesPerHour);hours=Math.floor(time/secondsPerHour);if(seconds<10){secondsPrefix=zeroString}if(minutes<10){minutesPrefix=zeroString}converted=minutesPrefix+minutes.toString()+timeUnitToken+secondsPrefix+seconds.toString();if(time>=secondsPerHour){converted=hours.toString()+timeUnitToken+converted}return converted};var logWindow=false;var metisLogging=false,metisLogger=[],metisLog=function(){var logFn=metisLogger.push;if(!!logFn.apply){logFn.apply(metisLogger,[arguments])}else{logFn(Array.prototype.slice.call([arguments]))}};var enableMetisLogging=function(){var metisConsole=contextScope.console||{},logged=metisLogger,i;metisLogging=true;if(!!metisConsole.log){metisLogger={push:function(){var logFn=metisConsole.log,logType="",logPrefix="",logArgs=arguments[0],firstArgument=logArgs[0];if("error"===firstArgument||"warn"===firstArgument||"info"===firstArgument){logType=firstArgument;if(!!metisConsole[logType]){logFn=metisConsole[logType]}else{logPrefix=logType.toUpperCase()+": "}logArgs[0]=logPrefix}logArgs[0]="[METIS] "+logArgs[0];if(!!logFn.apply){logFn.apply(metisConsole,logArgs)}else{logFn(Array.prototype.slice.call(logArgs))}}};metisLog("Enable metis logging");for(i=0;i<logged.length;i++){metisLogger.push(logged[i])}}};if(true===metisLogging){enableMetisLogging()}var invalidVideoClassName="is-vid-disabled";var browserIs,browserIsValid,isValidBrowser=function(){if(undefined===browserIsValid){var navi=navigator||{},ua=navi.userAgent||"";browserIsValid=false;if(ua.indexOf("Safari")>=0&&ua.indexOf("Chrome")<0){browserIsValid=true;browserIs="Safari"}else if(ua.indexOf("Android 4")>=0||ua.indexOf("Android 5")>=0){browserIsValid=true;browserIs="Android 4+"}metisLog("Browser is Valid? "+(browserIsValid?"yes: "+browserIs:"no"))}return browserIsValid};var supportsFlash,requiredFlashVersion="10",flashControlClassName="js-vid-flash",hasFlashSupport=function(){if(undefined===supportsFlash){if(!swfobject||!swfobject.hasFlashPlayerVersion||!swfobject.hasFlashPlayerVersion(requiredFlashVersion)){supportsFlash=false}else{supportsFlash=true}metisLog("Browser supports flash? "+(supportsFlash?"yes":"no"))}return supportsFlash},flashControlCheck=function($videoPlayers){var $flashControls;if(false===hasFlashSupport()){$flashControls=$videoPlayers.find("."+flashControlClassName);$flashControls.remove()}};var supportsM3u8,m3u8ControlSelector=".js-vid-m3u8",hasM3u8Support=function(){if(undefined===supportsM3u8){if(true===isValidBrowser()&&true===hasH264Support()){supportsM3u8=true}else{supportsM3u8=false}metisLog("Browser supports m3u8? "+(supportsM3u8?"yes":"no"))}return supportsM3u8},m3u8ControlCheck=function($videoPlayers){var $m3u8Controls=$videoPlayers.find(m3u8ControlSelector);if(true===hasM3u8Support()){showControls($m3u8Controls)}else{$m3u8Controls.remove()}};var supportsH264,h264ControlClassName="js-vid-h264",h264ControlSelector="."+h264ControlClassName,hasH264Support=function(){if(undefined===supportsH264){supportsH264=false;if(!!Modernizr){if(!!Modernizr.video&&Modernizr.video.h264){supportsH264=true}metisLog("Browser supports H264? "+(supportsH264?"yes":"no"))}else{metisLog("error","hasH264Support(): Modernizr not found")}}return supportsH264},h264ControlCheck=function($videoPlayers){var $h264Controls=$videoPlayers.find(h264ControlSelector);if(false===hasH264Support()){$h264Controls.remove()}if(!$h264Controls||$h264Controls.length<1){supportsH264=false}};var swfDomContainer,getSwfDomContainer=function(){if(undefined===swfDomContainer){if(navigator.appName.indexOf("Microsoft")!==-1){swfDomContainer=window}else{swfDomContainer=document}}return swfDomContainer};var getMetisVideoJSON=function($dataEl){var videoJSON=$dataEl.data("video");if(!videoJSON){return}metisLog("getMetisVideoJSON() videoJSON:\n",$.extend({},videoJSON));return videoJSON};var getVideoAdCall=function(){var logPrefix="[AD CALL] ";var getCampaignParams=function(custParams){var Phoenix=getPhoenix(),campaignParams=Phoenix.CampaignParams&&Phoenix.CampaignParams.getParams&&Phoenix.CampaignParams.getParams()||null;if(custParams&&campaignParams){metisLog(logPrefix+"campaignParams: ",jsonEncode(campaignParams));custParams=$.extend(custParams,campaignParams);metisLog(logPrefix+"updated custParams: ",jsonEncode(custParams))}return custParams};return function(){var playerUi=playerManager.video,adPlayed=playerUi.states.adPlayed,adCallUrl=playerUi.videoJSON.adCall,adCallParams={},custParams={},adCallUrlParts,session;if(!adCallUrl||true===adPlayed){return}metisLog(logPrefix+"Get adCallUrl");adCallUrl=decodeURIComponent(adCallUrl);metisLog(logPrefix+"Initial adCallUrl: ",adCallUrl);adCallUrlParts=adCallUrl.split("?");if(adCallUrlParts.length>1){adCallUrl=adCallUrlParts[0];adCallParams=$.deparam(adCallUrlParts[1]);if(adCallParams.cust_params){custParams=$.deparam(adCallParams.cust_params);metisLog(logPrefix+"custParams: ",jsonEncode(custParams))}}session=$.cookie("AD_SESSION");if(!!session){if(custParams.session){custParams.session=session}else{custParams=$.extend({session:session},custParams)}}custParams=getCampaignParams(custParams);if(!$.isEmptyObject(custParams)){adCallParams.cust_params=$.param(custParams)}if(!$.isEmptyObject(adCallParams)){adCallUrl=adCallUrl+"?"+$.param(adCallParams)}metisLog(logPrefix+"Final adCallUrl: ",adCallUrl);return adCallUrl}}();var basePlayerMethods={name:"basePlayer",logPrefix:"",initialized:false,playerReady:false,contentLoading:false,load:function(){},init:function(){this.initialized=true},detach:function(){},play:function(){},pause:function(){},resume:function(){},stop:function(){},mute:function(){},unmute:function(){},setVolume:function(){},seekTo:function(){},seekToLive:function(){},getCurrentTime:function(){return 0},getDuration:function(){},isInitialized:function(){return this.initialized},isReady:function(apiMethod){return this.playerReady},setPlayerReady:function(ready){var self=this,logPrefix=self.logPrefix;if(self.playerReady!==ready){metisLog(logPrefix+"Set playerReady to ["+(ready?"TRUE":"FALSE")+"]");self.playerReady=ready}if(ready){playerManager.onPlayerReady()}},isContentLoading:function(){return this.contentLoading},setContentLoading:function(loading){var self=this,logPrefix=self.logPrefix;if(self.contentLoading!==loading){metisLog(logPrefix+"set contentLoading to ["+(loading?"TRUE":"FALSE")+"]");self.contentLoading=loading;playerManager.contentLoading(loading)}if(!loading){playerManager.onPlayerReady()}},getAdCall:getVideoAdCall};var extendBasePlayerMethods=function(overrideMethods){return $.extend({},basePlayerMethods,overrideMethods)};var flashPlayer=function(){var playerType="flash";var logPrefix="[FLASH] ";var flashObjectBaseId="gamesVideoSwf_";var flashCallbacksKey="__gamesVideoPlayer";var flashElementTag="object";var $player;var getPlayer=function(){return $player};var setPlayer=function($el){$player=$el};var flashCallbacks={flashPlayerStarted:function(){metisLog(logPrefix+" flashPlayerStarted()");isApiAlive(true)},adError:function(value){metisLog("error",logPrefix+"AD ERROR: "+value)},adInfo:function(value){metisLog("info",logPrefix+"AD : "+value)},adProgress:function(){var playerApi=getPlayerApi(playerMethods.playerApiId);playerManager.videoProgress({currentTime:playerApi.getCurrentTime_js(),duration:playerApi.getDuration_js()});playerMethods.setContentLoading(false)},contentProgress:function(){var playerApi=getPlayerApi(playerMethods.playerApiId),timeData={currentTime:playerApi.getCurrentTime_js(),duration:playerApi.getDuration_js(),bytesLoaded:playerApi.bytesLoaded_js(),bytesTotal:playerApi.bytesTotal_js()};playerMethods.setContentLoading(false);playerManager.videoProgress(timeData)},loadMinder:function(){},onAdStart_flash:function(){metisLog(logPrefix+"onAdStart_flash()");playerManager.adStart()},onAdEnd_flash:function(){metisLog(logPrefix+"onAdEnd_flash()");playerManager.adEnd()},onCBSIPlayerReady:function(){metisLog(logPrefix+"onCBSIPlayerReady()")},onContentEnd_flash:function(){var playerApi=getPlayerApi(playerMethods.playerApiId);metisLog(logPrefix+"onContentEnd_flash()");metisLog(logPrefix+"currentTime: ",playerApi.getCurrentTime_js());playerManager.contentEnd(playerType)},onContentStart_flash:function(){metisLog(logPrefix+"onContentStart_flash() ===== ");playerManager.contentStart()},onPlaylistEnd:function(){metisLog(logPrefix+"onPlaylistEnd() =====>");playerManager.playlistEnd(playerType)},onPlaylistStart:function(){metisLog(logPrefix+"onPlaylistStart() =====>")},userPause:function(){metisLog(logPrefix+"userPause() =====>");playerManager.toggleUiPlayPause()},videoHasEnded:function(){metisLog(logPrefix+"VIDEO END =====>")}};var flashBuildOptions=function(video){var playerId=video.playerId,flashOptions,videoJSON=video.videoJSON;var flashConfig={uvpUri:videoJSON.uvp,uvpThird:videoJSON.uvpThird,imaUri:videoJSON.ima3,uvpcUri:videoJSON.uvpc};flashOptions={id:flashObjectBaseId+playerId,swf:videoJSON.swfLocation,width:"100%",height:"100%",allowFullScreen:true,allowScriptAccess:"always",flashvars:{id:videoJSON.id,title:videoJSON.title,duration:videoJSON.lengthSeconds,mapp:videoJSON.mapp,autoPlay:"true",config:jsonEncode(flashConfig),guid:videoJSON.guid}};return flashOptions};var initFlashUvpObject=function(video){metisLog(logPrefix+"BEG initFlashUvpObject() =====>");var $videoContainer,$video;if(!!video){playerMethods.setContentLoading(true);$videoContainer=playerManager.getVideoContainer(playerType);$video=$videoContainer.find(flashElementTag);if($video.length<=0){metisLog(logPrefix+"initFlashUvpObject(): Build new flash object tag");$videoContainer.flash(flashBuildOptions(video));$video=$videoContainer.find(flashElementTag);if($video.length<=0){$video=undefined;metisLog("error",logPrefix+"initFlashUvpObject(): unable to create video embed")}}}else{metisLog("error",logPrefix+"initFlashUvpObject(): undefined video")}metisLog(logPrefix+"END initFlashUvpObject() =====>");setPlayer($video);return $video};var getPlayerApi=function(playerApiId){var playerApiInstance,playerApiHolder=getSwfDomContainer();playerApiInstance=playerApiHolder[playerApiId];return playerApiInstance};var isApiAlive=function(){var flashIsAliveDelay=1e3;var isSwfAliveTimeoutId=null;return function(poll){var isAlive=true,playerApi=getPlayerApi(playerMethods.playerApiId);if(null!==isSwfAliveTimeoutId){metisLog(logPrefix+"isApiAlive() > clear timeout id: ",isSwfAliveTimeoutId);clearTimeout(isSwfAliveTimeoutId);isSwfAliveTimeoutId=null}try{metisLog(logPrefix+"isApiAlive()?");isAlive=playerApi.isAPIAlive_js();if(false===playerMethods.playerReady){metisLog(logPrefix+"isApiAlive > setPlayerReady(true)");playerMethods.setPlayerReady(true)}}catch(e){metisLog("error",logPrefix+e.message);isAlive=false;if(true===playerMethods.playerReady){metisLog(logPrefix+"isApiAlive > setPlayerReady(false)");playerMethods.setPlayerReady(false)}}if(false===isAlive&&true===poll){metisLog(logPrefix+"isApiAlive > NO -- check again in "+flashIsAliveDelay+"ms");isSwfAliveTimeoutId=setTimeout(function(){isApiAlive(true)},flashIsAliveDelay);metisLog(logPrefix+"isApiAlive() > timeout id: ",isSwfAliveTimeoutId)}if(true===isAlive){metisLog(logPrefix+"isApiAlive > YES")}return isAlive}}();var playerMethods=extendBasePlayerMethods({name:"flashPlayer",logPrefix:logPrefix,playerApi:null,playerApiId:null,load:function(){if(!contextScope[flashCallbacksKey]){contextScope[flashCallbacksKey]=flashCallbacks}},init:function(){var self=this,video=playerManager.getVideoUi(),$video=getPlayer(),playerApiId;if(self.isInitialized()){return}metisLog(logPrefix+"Init Player API");if(!!video){if(!$video){$video=initFlashUvpObject(video)}if(undefined!==$video){self.initialized=true;playerApiId=$video.attr("id");if(playerApiId!==self.playerApiId){self.playerApiId=playerApiId;self.playerApi=getPlayerApi(playerApiId)}}}else{metisLog(logPrefix+"Player API init failed :: no video")}},loadVideo:function(){var self=this,video=playerManager.getVideoUi(),videoStates=video.states,paramsJSON,params,adCall,cuePoints;self.setContentLoading(true);paramsJSON={playback:videoStates.playback,streamToPlay:video.getVideoUrl(),mute:videoStates.mute,volume:videoStates.volume};adCall=self.getAdCall();cuePoints=video.getCuePoints();if(adCall){paramsJSON.adCall=adCall;paramsJSON.cuePoints=cuePoints}params=jsonEncode(paramsJSON);metisLog(logPrefix+"loadVideo() params: ",paramsJSON);self.playerApi.newContentRequest_js(params)},mute:function(){metisLog(logPrefix+"mute()");this.playerApi.mute_js()},pause:function(){metisLog(logPrefix+"pause()");this.playerApi.pauseButton_js()},play:function(){var self=this,video=playerManager.getVideoUi(),initialized=false;if(!video){return}initialized=self.isInitialized();if(true===initialized){self.loadVideo()}},replay:function(){metisLog(logPrefix+"replay()");this.playerApi.replay_js()},resume:function(){metisLog(logPrefix+"resume()");this.playerApi.playButton_js()},setVolume:function(volume){metisLog(logPrefix+"setVolume("+volume+")");this.playerApi.setVolume_js(volume)},seekTo:function(value){metisLog(logPrefix+"seekTo: "+value);this.setContentLoading(true);this.playerApi.seekTo_js(value)},seekToLive:function(){metisLog(logPrefix+"seekToLive");this.setContentLoading(true);this.playerApi.seekToLive_js()},stop:function(){metisLog(logPrefix+"stopVideo");this.setContentLoading(false);this.playerApi.stopVideo_js()},unmute:function(){metisLog(logPrefix+"unMute()");this.playerApi.unMute_js()},fullscreenOn:function(){metisLog(logPrefix+"fullscreenOn");this.playerApi.userFullscreen_js(1)},fullscreenOff:function(){metisLog(logPrefix+"fullscreenOff");this.playerApi.userFullscreen_js(0)},getCurrentTime:function(){var self=this,currentTime;currentTime=self.playerApi.getCurrentTime_js();return currentTime},getDuration:function(){var self=this,duration;duration=self.playerApi.getDuration_js();return duration},isLive:function(){var self=this,isLive=self.playerApi.getIsLive_js();return isLive},detach:function(){var self=this;if(!!self.playerApi){metisLog("stop flash player");self.stop()}},isReady:function(){var self=this,isAlive=isApiAlive();return isAlive&&self.playerReady}});return playerMethods}();var html5Player=function(){var playerType="html5";var logPrefix="[HI5] ";var hi5Loaded=false;var hi5Loading=false;var hi5ImaLoaded=false;var clickedImaAd=false;var hi5ClickEvent="click.hi5Player";var $hi5VideoTag;var setPlayer=function($el){$hi5VideoTag=$el};var getImaVideoElement=function(){var $imaAdDiv=playerManager.video.els.$imaAdDiv,$videoElement;if($imaAdDiv){$videoElement=$imaAdDiv.find("video");if(!$videoElement||$videoElement.length<1){$videoElement=undefined}}return $videoElement};var needImaVideoElementControls=function(){var $videoElement=getImaVideoElement(),needControls=false;if(undefined!==$videoElement&&undefined===$videoElement.attr("controls")){needControls=true}return needControls};var hi5DefaultVideoOptions={isAd:false,profile:"prog",startTime:0,endTime:-1,mapp:"Hi5",contentVO:{chapterStartTimes:[],assetURLs:[]}};var hi5PlayerApi,setPlayerApi=function(api){hi5PlayerApi=api},getPlayerApi=function(){return hi5PlayerApi};var hi5UvpCallbacks={onPlayerLoaded_cbsi:function(){var video=playerManager.getVideoUi(),$videoContainer=playerManager.getVideoContainer(playerType),$video=$videoContainer.find("video"),videoJSON=video.videoJSON;if(!video||!videoJSON){return}$video.removeAttr("controls");metisLog(logPrefix+"PLAYER LOADED =====>\n",$video)},onPlayerDataLoaded_cbsi:function(){metisLog(logPrefix+"PLAYER DATA LOADED =====>")},onPlaylistStart_cbsi:function(){metisLog(logPrefix+"PLAYLIST START =====>")},onPlayListEnd_cbsi:function(){metisLog(logPrefix+"PLAYLIST END =====>");playerManager.playlistEnd(playerType)},onContentStart_cbsi:function(){metisLog(logPrefix+"CONTENT START =====>");playerManager.contentStart()},onContentEnd_cbsi:function(){metisLog(logPrefix+"CONTENT END =====>");playerManager.contentEnd(playerType)},onAdSlotStart_cbsi:function(){metisLog(logPrefix+"AD SLOT START =====>")},onAdStart_cbsi:function(){metisLog(logPrefix+"AD START =====>");clickedImaAd=false;playerManager.adStart()},onAdEnd_cbsi:function(){metisLog(logPrefix+"AD END =====>");playerManager.adEnd();playerMethods.setContentLoading(true);hi5PlayerApi.showIMAadAndEventCatcherDivs(false)},onStateChange_cbsi:function(state){metisLog(logPrefix+"STATE CHANGE =====>\nstate: ",state);if(2===state&&true===clickedImaAd){var needVideoAdControls=needImaVideoElementControls(),$videoElement;if(needVideoAdControls){$videoElement=getImaVideoElement();metisLog(logPrefix+"video element: ",$videoElement);$videoElement.attr("controls","controls")}}},onVideoProgress:function(uvpRef){if(true===playerManager.isAdPlaying()||true===playerManager.isContentStarted()){playerMethods.setContentLoading(false)}playerManager.videoProgress({currentTime:uvpRef.getCurrentTime(),duration:uvpRef.getDuration()})},onVideoDone:function(){metisLog(logPrefix+"VIDEO DONE =====>")},onNoAdContent:function(){metisLog(logPrefix+"NO AD CONTENT =====>")}};var hi5Globals={jsReady:false,setJSReady:function(){this.jsReady=true},isJSReady:function(){return this.jsReady},onCBSIPlayerReady:function(uvpRef){var playerApi;if(!uvpRef){return}metisLog(logPrefix+"onCBSIPlayerReady!");setPlayerApi(uvpRef);playerApi=getPlayerApi();$.each(hi5UvpCallbacks,function(eventName,eventCallback){playerApi.addEventJSCallback(eventName,eventCallback)});playerMethods.setPlayerReady(true)}};var hi5ClickHandler=function(){metisLog("hi5 video click > togglePlay");playerManager.toggleUiPlayPause()};var hi5BuildVideoTag=function(){var playerApi=getPlayerApi(),video=playerManager.video,containerDivId,videoDivId,imaAdDivId,imaAdClickthruId,$videoContainerParent,$videoContainer=playerManager.getVideoContainer(playerType),$imaAdDiv,$imaAdClickthru,$video;if(!!playerApi&&!!$videoContainer){$video=$videoContainer.find("video");if($video.length<=0){videoDivId=$videoContainer.attr("id");if(hi5ImaLoaded){$videoContainerParent=$videoContainer.parent();containerDivId=$videoContainerParent.attr("id");if(!containerDivId){containerDivId=videoDivId+"-wrap";$videoContainerParent.attr("id",containerDivId)}$imaAdDiv=video.els.$imaAdDiv;if($imaAdDiv){imaAdDivId=$imaAdDiv.attr("id")}$imaAdClickthru=video.els.$imaAdClickthru;if($imaAdClickthru){imaAdClickthruId=$imaAdClickthru.attr("id")}}if(imaAdDivId){metisLog(logPrefix+"Initialize UVP_IMA >\n- videoDivId: "+videoDivId+"\n- containerDivId: "+containerDivId+"\n- imaAdDivId: "+imaAdDivId+"\n- imaAdClickthruId: "+imaAdClickthruId);playerApi.initialize(videoDivId,containerDivId,imaAdDivId,imaAdClickthruId)}else{metisLog(logPrefix+"Initialize basic UVP > \nvideoDivId: ",videoDivId);playerApi.initialize(videoDivId)}$video=$videoContainer.find("video");$video.attr("poster","/bundles/phoenixsite/images/core/loose/clear.gif");$video.on(hi5ClickEvent,hi5ClickHandler);if($imaAdClickthru){$imaAdClickthru.on(hi5ClickEvent,function(){clickedImaAd=true;metisLog(logPrefix+"Clicked IMA Ad Clickthru")})}setPlayer($video)}}};var mapUvpSessionOptions=function(videoJSON){var sessionOptions,nativeControls=videoJSON.nativeControls||false,autoHide=videoJSON.autoHide||false;sessionOptions={partner:videoJSON.partner,nativeControls:nativeControls,autoHide:autoHide,uvpc:videoJSON.uvpc,loadAnimation:"",logWindow:logWindow};return sessionOptions};var setUvpSessionOptions=function(videoOptions){metisLog("!!!!!!!!!! SETTING GLOBAL uvp_sOpts AS: ",videoOptions);contextScope.uvp_sOpts=videoOptions};var initUvpSessionOptions=function(videoJSON){var sessionOptions=mapUvpSessionOptions(videoJSON);setUvpSessionOptions(sessionOptions)};var playerMethods=extendBasePlayerMethods({name:"html5Player",logPrefix:logPrefix,load:function(video){var self=this,videoJSON=video.videoJSON,hi5JsUrl=videoJSON.uvpHi5,hi5ImaJsUrl=videoJSON.uvpHi5Ima;if(true===hi5Loaded||true===hi5Loading){if(true===hi5Loaded){metisLog(logPrefix+"already loaded")}else if(true===hi5Loading){metisLog(logPrefix+"already loading")}return}hi5Loading=true;initUvpSessionOptions(videoJSON);$.each(hi5Globals,function(key,val){if(undefined===contextScope[key]){contextScope[key]=val}});if(video.els.$imaAdDiv&&hi5ImaJsUrl){metisLog(logPrefix+"Load IMA js");$.ajax({url:hi5ImaJsUrl,dataType:"script",error:function(){metisLog(logPrefix+"IMA script failed to load")},success:function(){metisLog(logPrefix+"IMA script successfully loaded");hi5ImaLoaded=true}})}metisLog(logPrefix+"Load hi5 js: "+hi5JsUrl);$.ajax({url:hi5JsUrl,dataType:"script",beforeSend:function(){metisLog(logPrefix+"load start: ",hi5JsUrl)},complete:function(){metisLog(logPrefix+"load complete");hi5Loading=false},error:function(){metisLog("error",logPrefix+"load failure");self.playerApi=false},success:function(){metisLog(logPrefix+"load success");hi5Loaded=true}})},init:function(){var self=this;if(self.isInitialized()){return}hi5BuildVideoTag();self.playerApi=getPlayerApi();self.initialized=true},play:function(){var self=this,video=playerManager.getVideoUi(),initialized=false,playerApi,videoJSON,videoUrl,videoOptions,adList,jsAdCall;if(!video){return}initialized=self.isInitialized();if(!initialized){metisLog(logPrefix+"player is not initialized, quitting");return}metisLog(logPrefix+"BEG play() =====>");playerApi=getPlayerApi();videoJSON=video.videoJSON;videoUrl=video.getVideoUrl();if(undefined===videoUrl){return}videoOptions=$.extend({},hi5DefaultVideoOptions,{partner:videoJSON.partner,mediaId:videoJSON.id,cmsRefId:videoJSON.guid,videoTitle:decodeURIComponent(videoJSON.title),assetURL:videoUrl});metisLog("- Video Url: ",videoUrl);self.setContentLoading(true);jsAdCall=self.getAdCall();if(undefined===jsAdCall){metisLog("- load video url");playerApi.loadVideoByUrl(videoUrl,videoOptions)}else{adList={pre_0:jsAdCall};metisLog("- loadContentWithAds: ",adList);playerApi.loadContentWithAds(adList,videoOptions)}metisLog(logPrefix+"END play() =====>")},pause:function(){var self=this;metisLog(logPrefix+"pause video");self.playerApi.pauseVideo();metisLog(logPrefix+"paused video")},resume:function(){metisLog(logPrefix+"resume video");this.playerApi.playVideo()},replay:function(){metisLog("seek to 0");this.playerApi.seekTo(0);metisLog("replay video");this.playerApi.playVideo()},stop:function(){this.playerApi.stopVideo()},mute:function(){metisLog(logPrefix+"fire playerApi.mute()");this.playerApi.mute()},unmute:function(){metisLog(logPrefix+"fire playerApi.unMute()");this.playerApi.unMute()},setVolume:function(volume){metisLog("setting html volume");this.playerApi.setVolume(volume)},seekTo:function(seconds){this.setContentLoading(true);this.playerApi.seekTo(seconds)},seekToLive:function(){},getCurrentTime:function(){return this.playerApi.getCurrentTime()},getDuration:function(){return this.playerApi.getDuration()},detach:function(){metisLog(logPrefix+"stop player");this.stop()}});return playerMethods}();var youtubePlayer=function(){var logPrefix="[YT]";var $youtubePlayer;var youtubePlayerHtml="<iframe webkitAllowFullScreen mozallowfullscreen allowFullScreen/>";var youtubeBaseEmbedUrl="http://www.youtube.com/embed/";var youtubeBaseEmbedParams={wmode:"transparent",autoplay:"1"};var youtubeApi="https://gdata.youtube.com/feeds/api/videos/",youtubeApiQs="?v=2&alt=json",youtubeControlSelector=".js-vid-youtube";var youtubeCheck=function($element,videoJSON,callbacks){var youtubeID=videoJSON.youtubeID,onErrorCallback,requestOptions;callbacks=callbacks||{};onErrorCallback=callbacks.error;if(undefined===$element){youtubeID=null}if(!youtubeID){metisLog("error","Invalid youtubeID");if($element&&$element.length){$element.remove()}if(onErrorCallback){onErrorCallback()}}else{requestOptions={url:youtubeApi+youtubeID+youtubeApiQs,beforeSend:function(){metisLog("Checking youtubeID "+youtubeID+" against API")},error:function(jqXHR,textStatus){if("error"===textStatus){videoJSON.youtubeID=null;youtubeCheck($element,videoJSON,callbacks)}}};if(callbacks.success){requestOptions.success=callbacks.success}$.ajax(requestOptions)}};var getVideoEmbedUrl=function(videoId){var embedUrl;if(!videoId){return}embedUrl=youtubeBaseEmbedUrl+videoId+"?"+$.param(youtubeBaseEmbedParams,true);metisLog("youtube embed url: ",embedUrl);return embedUrl};var getPlayer=function(){if(undefined===$youtubePlayer){$youtubePlayer=$(youtubePlayerHtml,{frameborder:"0"})}return $youtubePlayer};var playerMethods=extendBasePlayerMethods({name:"youtubePlayer",logPrefix:logPrefix,playerApi:null,load:function(video){var self=this,els=video.els,$playbackButtons=els.$playbackButtons,$youtubeButton,youtubeCheckCallbacks;self.setPlayerReady(false);if($playbackButtons){$youtubeButton=$playbackButtons.filter(youtubeControlSelector)}if($youtubeButton.length){youtubeCheckCallbacks={error:function(){var $defaultPlayback=getDefaultControl($playbackButtons);metisLog(logPrefix+"youtubeCheck error");video.setPlayback($defaultPlayback.data(cmdValueDataKey));self.setPlayerReady(true)},success:function(){metisLog(logPrefix+"youtubeCheck success");self.setPlayerReady(true)}};youtubeCheck($youtubeButton,video.videoJSON,youtubeCheckCallbacks)}},play:function(){var $videoContainer=playerManager.getVideoContainer("youtube"),$player=getPlayer(),video=playerManager.getVideoUi(),embedUrl,videoId;if(video&&video.videoJSON){videoId=video.videoJSON.youtubeID}if(!videoId){return}metisLog(this.name+" > play");metisLog(logPrefix+"play() > videoId: "+videoId);embedUrl=getVideoEmbedUrl(videoId);metisLog(logPrefix+"play() > embedUrl: "+embedUrl);$player.attr("src",embedUrl);$videoContainer.append($player);playerManager.contentStart()},detach:function(){var $player=getPlayer();$player.attr("src","").detach()},isContentLoading:function(){return true}});return playerMethods}();var playerManager=function(){var logPrefix="[SWITCH] ";var playerTypes={flash:flashPlayer,html5:html5Player,youtube:youtubePlayer};metisLog(logPrefix+"playerTypes: ",playerTypes);var playerTypesLoaded=false;var isSameVideo=function(currentVideo,newVideo){var isSame=false;if(!!currentVideo){isSame=currentVideo.videoJSON.id===newVideo.videoJSON.id}return isSame};var playerRelay=function(){var logPrefix="[RELAY] ";var queueMethodArgs={};var preContentReadyQueue=[],contentReadyQueue=[];var methodNamePause="pause",methodNamePlay="play",methodNameResume="resume",methodNameStop="stop",methodNameMute="mute",methodNameUnmute="unmute";var preContentReadyMethods=[methodNamePlay,methodNameStop];var isPreContentReadyMethod=function(methodName){return 0<=$.inArray(methodName,preContentReadyMethods)};var activePlayer;var setPlayer=function(player){activePlayer=player};var getPlayer=function(){return playerManager.player};var runPlayerMethod=function(methodName,methodArgs){var player=getPlayer();if(!player){metisLog(logPrefix+"runPlayerMethod() failed :: undefined player");return}try{metisLog(logPrefix+"runPlayerMethod() >\n- methodName: "+methodName+"\n- methodArgs: ",methodArgs);if(!!methodArgs&&methodArgs.length>0){player[methodName](methodArgs)}else{player[methodName]()}}catch(e){metisLog("error",logPrefix+"runPlayerMethod(): ",e.message)}};var getQueueToUse=function(methodName){var queueToUse,logMsg=logPrefix+"Use ";if(isPreContentReadyMethod(methodName)){logMsg+="preContentReadyQueue";queueToUse=preContentReadyQueue}else{logMsg+="contentReadyQueue";queueToUse=contentReadyQueue}logMsg+=" for ["+methodName+"]";return queueToUse};var hasQueuedMethods=function(){return 0<preContentReadyQueue.length||0<contentReadyQueue.length};var removeQueuedMethod=function(methodName){var queueToUse=getQueueToUse(methodName),queueIndex=$.inArray(methodName,queueToUse),removed=false;if(queueIndex>=0){queueToUse.splice(queueIndex,1);if(queueMethodArgs[methodName]){delete queueMethodArgs[methodName]}metisLog(logPrefix+"removeQueueMethod() methodName removed: ",methodName);removed=true}return removed};var queuePlayerMethod=function(){var args=Array.prototype.slice.call(arguments),playerMethodArgs=args.shift(),playerMethod,preventQueue=false,queueToUse;if(playerMethodArgs.length===0){return}playerMethod=playerMethodArgs.shift(playerMethodArgs);queueToUse=getQueueToUse(playerMethod);metisLog(logPrefix+"BEG queuePlayerMethod() queued methods: ",queueToUse.join(", "));switch(playerMethod){case methodNamePlay:removeQueuedMethod(methodNameResume);removeQueuedMethod(methodNamePause);break;case methodNameResume:removeQueuedMethod(methodNamePause);preventQueue=true;break;case methodNamePause:removeQueuedMethod(methodNameResume);break;case methodNameMute:removeQueuedMethod(methodNameUnmute);break;case methodNameUnmute:removeQueuedMethod(methodNameMute);preventQueue=true;break}removeQueuedMethod(playerMethod);if(false===preventQueue){queueToUse.push(playerMethod);if(playerMethodArgs.length>0){queueMethodArgs[playerMethod]=playerMethodArgs}metisLog(logPrefix+"queuePlayerMethod() new queued method: ",playerMethod)}metisLog(logPrefix+"END queuePlayerMethod() queued methods: ",queueToUse.join(", "))};var runQueue=function(){var player=getPlayer(),preContentReadyQueueLength=preContentReadyQueue.length,contentReadyQueueLength=contentReadyQueue.length,queueLength=0,queueToRun,methodName,methodArgs;if(!player){metisLog(logPrefix+"runQueue() failed :: undefined player");return}if(preContentReadyQueueLength>0){queueLength=preContentReadyQueueLength;queueToRun=preContentReadyQueue}else if(contentReadyQueueLength>0){if(player.isContentLoading()){metisLog(logPrefix+"runQueue() prevented :: content is still loading");return}else{queueLength=contentReadyQueueLength;queueToRun=contentReadyQueue}}metisLog(logPrefix+"BEG runQueue() >\n- preContentReadyQueueLength: "+preContentReadyQueueLength+"\n- contentReadyQueueLength: "+contentReadyQueueLength+"\n- queueLength: "+queueLength+"\n- queueToRun: ",queueToRun);if(queueLength>0){while(queueLength>0){methodName=queueToRun.shift();methodArgs=queueMethodArgs[methodName];queueLength=queueToRun.length;runPlayerMethod(methodName,methodArgs)}}metisLog(logPrefix+"END runQueue()")};var relay={setPlayer:function(player){setPlayer(player)},run:function(){var player=getPlayer(),args=Array.prototype.slice.call(arguments),hasArguments=0<args.length,hasRun=false,methodName,methodArgs,isReady;
if(!player){return}metisLog(logPrefix+"BEG run() >\n- arguments: ",arguments);if(!player.isInitialized()){metisLog(logPrefix+"player.init()");player.init()}isReady=player.isReady();metisLog(logPrefix+"run() >\nisReady: "+isReady+"\nhasQueuedMethods: "+hasQueuedMethods()+"\nhasArguments: "+hasArguments);if(true===isReady&&false===hasQueuedMethods()&&true===hasArguments){methodName=args.shift();methodArgs=args;metisLog(logPrefix+"Player API is ready without any queued methods");if(isPreContentReadyMethod(methodName)||!player.isContentLoading()){metisLog(logPrefix+"Running ["+methodName+"] player method.");runPlayerMethod(methodName,methodArgs);hasRun=true}else{metisLog(logPrefix+"Restore args with ["+methodName+"] for queuing.");args.unshift(methodName)}}if(!hasRun){if(true===hasArguments){metisLog(logPrefix+"Queuing player method: ",args);queuePlayerMethod(args)}metisLog(logPrefix+"player API is"+(isReady?"":" not")+" ready, "+(isReady?"":" don't ")+"run the queue");metisLog(logPrefix+"isReady: "+isReady);if(true===isReady){runQueue()}}metisLog(logPrefix+"END run()")},clear:function(){preContentReadyQueue=[];contentReadyQueue=[];queueMethodArgs={}},hasQueuedMethods:function(){return hasQueuedMethods()}};return relay}();var playerManager={player:null,video:null,states:{},loadPlayerTypes:function(availablePlayerTypes,video){if(true===playerTypesLoaded||!availablePlayerTypes||availablePlayerTypes.length<1){return}var i,playerType,playerObject;metisLog(logPrefix+"Load Player Types: ",availablePlayerTypes);for(i=0;i<availablePlayerTypes.length;i++){playerType=availablePlayerTypes[i];playerObject=playerTypes[playerType];if(!!playerObject&&!!playerObject.load){playerObject.load(video)}}playerTypesLoaded=true},isPlaying:function(){var video=this.video,returnVal=false;if(!!video){returnVal=video.states.playing}return returnVal},getPlayer:function(video){var self=this,states=video.states,playerType=states.playerType,player=playerTypes[playerType],currentPlayer,hasNewPlayer=false,hasCurrentPlayer=false;metisLog(logPrefix+"getPlayer() playerType: "+playerType);if(undefined===player){metisLog("error",logPrefix+"Undefined player type ["+playerType+"]")}currentPlayer=self.player||{};hasCurrentPlayer=!!currentPlayer.name;if(currentPlayer.name!==player.name){hasNewPlayer=true}if(true===hasNewPlayer){metisLog(logPrefix+"newPlayer: ",player.name);metisLog(logPrefix+"currentPlayer: ",currentPlayer.name);if(true===hasCurrentPlayer){metisLog(logPrefix+"Switch to ["+playerType+"] player");self.setPlayer(currentPlayer,player)}else{self.player=player;metisLog(logPrefix+"new player: ",player)}}else{metisLog(logPrefix+"player is ["+playerType+"]")}},setPlayer:function(currentPlayer,newPlayer){var self=this;if(self.video){var states=self.video.states,playerType=states.playerType,player=playerTypes[playerType];metisLog(logPrefix+"setPlayer()");metisLog(logPrefix+"currentPlayer: ",currentPlayer);metisLog(logPrefix+"newPlayer: ",newPlayer);if(!currentPlayer){currentPlayer=self.player;metisLog(logPrefix+"Using self.player as currentPlayer: ",currentPlayer)}if(!newPlayer){newPlayer=player;metisLog(logPrefix+"Using playerTypes[playerType] as newPlayer: ",newPlayer)}if(newPlayer){if(currentPlayer){metisLog(logPrefix+"UNSET CURRENT PLAYER");currentPlayer.detach()}metisLog(logPrefix+"SET NEW PLAYER");self.player=newPlayer;metisLog(logPrefix+"Updated player to ["+newPlayer.name+"]")}return true}return false},changePlayerState:function(newVideo,forceUpdateStates){var self=this,currentVideo=self.video,currentStates=self.states,newStates=newVideo.states,updateStates=true,stateKey,newStateValue,stateChanges=0,changedStates={},isNewVideo=false;if(false===isSameVideo(currentVideo,newVideo)){isNewVideo=true;if(false===newStates.playing){updateStates=false}}if(false===updateStates){return}metisLog(logPrefix+"!!!!! CHANGE PLAYER STATE !!!!!\n",newVideo.states);if(!forceUpdateStates){forceUpdateStates=[]}else{metisLog(logPrefix+"forcing state updates for: "+forceUpdateStates.join(", "))}for(stateKey in newStates){if(newStates.hasOwnProperty(stateKey)){newStateValue=newStates[stateKey];if(newStateValue!==currentStates[stateKey]||0<=$.inArray(stateKey,forceUpdateStates)){stateChanges+=1;changedStates[stateKey]=newStateValue}}}if(changedStates.playerType){metisLog(logPrefix+"changedStates.playerType > getPlayer");self.getPlayer(newVideo)}if(changedStates.volume){metisLog(logPrefix+"changedStates.volume > setVolume");self.setVolume(changedStates.volume)}if(changedStates.mute===true){metisLog(logPrefix+"changedStates.mute > mute");self.mute()}else if(changedStates.mute===false){metisLog(logPrefix+"changedStates.mute > unmute");self.unmute()}if(0<stateChanges){metisLog("changedStates: ",changedStates);$.extend(self.states,newStates)}},play:function(video){var self=this,currentVideo=self.video||{},states,hasChange=false,player;metisLog("playerManager.play()");if(!video){metisLog("error","playerManager.play() > undefined video")}if(null===self.player){metisLog("playerManager.play() > BEFORE get player");self.getPlayer(video);metisLog("playerManager.play() > AFTER get player")}player=self.player;self.video=video;video.setVideoProgress("","0%");if(currentVideo.playerId!==video.playerId){hasChange=true}playerRelay.run("play");metisLog("playerManager.play() > update states: ",states);self.changePlayerState(video,["volume","mute"])},pause:function(){playerRelay.run("pause")},resume:function(){playerRelay.run("resume")},replay:function(){playerRelay.run("replay")},mute:function(){playerRelay.run("mute")},unmute:function(){playerRelay.run("unmute")},setVolume:function(volume){playerRelay.run("setVolume",volume)},seekTo:function(seconds){playerRelay.run("seekTo",seconds)},seekToLive:function(){playerRelay.run("seekToLive")},onPlayerReady:function(){if(playerRelay.hasQueuedMethods()){playerRelay.run()}},getCurrentTime:function(){var player=this.player,currentTime=0;if(!!player){currentTime=player.getCurrentTime()}return currentTime},getDuration:function(){var player=this.player,duration;if(!!player){duration=player.getDuration()}return duration},savePosition:function(timeInSeconds){var video=this.video;if(!!video&&!!video.savePosition){video.savePosition(timeInSeconds)}},getVideoUi:function(){return this.video},getVideoContainer:function(playerType,video){var self=this,$videoContainer;if(!video){video=self.video}if(video){$videoContainer=video.getVideoContainer(playerType);return $videoContainer}else{metisLog("error","unable to run getVideoContainer on undefined video")}},isAdPlaying:function(){var self=this,returnValue=false;if(self.video&&self.video.states){returnValue=!!self.video.states.adPlaying}return returnValue},isContentStarted:function(){var self=this,returnValue=false;if(self.video&&self.video.states){returnValue=!!self.video.states.contentStarted}return returnValue},isActivePlayerType:function(playerType){var self=this,video=self.video,returnValue=false,states;if(video){states=video.states;returnValue=playerType===states.playerType}return returnValue},adEnd:function(){var self=this;if(self.video){self.video.adEnd()}},adStart:function(){var self=this;if(self.video){self.video.adStart()}},contentEnd:function(playerType){var self=this;if(self.isActivePlayerType(playerType)){self.video.contentEnd()}else{metisLog(logPrefix+"contentEnd ignored :: playerType is not active")}},contentLoading:function(loading){var self=this;if(self.video){self.video.contentLoading(loading)}},contentStart:function(){var self=this;if(self.video){self.video.contentStart()}},playlistEnd:function(playerType){var self=this;if(self.isActivePlayerType(playerType)){self.video.playlistEnd()}else{metisLog(logPrefix+"playlistEnd ignored :: playerType is not active")}},toggleUiPlayPause:function(){var self=this,$playPauseButtons;if(self.video){metisLog(logPrefix+"play/pause from player api");$playPauseButtons=self.video.els.$playPauseButtons;$playPauseButtons.first().trigger("click")}},videoProgress:function(timeData){var self=this;if(self.video){self.video.videoProgress(timeData)}}};return playerManager}();var cmdValueDataKey="cmd-value",hideControlsClassName="dn",activateControlsClassName="on";var isAvailableControl=function($controlEl){return!!$controlEl&&$controlEl.length>0&&$controlEl.closest("html").length>0&&!$controlEl.hasClass(hideControlsClassName)};var isActivatedControl=function($controlEl){return!!$controlEl&&$controlEl.hasClass(activateControlsClassName)};var hasControlValue=function($controlEl,controlValue){return $controlEl.data(cmdValueDataKey)===controlValue};var getDefaultControl=function($controls){var $defaultControls=$controls.filter(".js-vid-default"),$defaultControl;$defaultControls=$defaultControls.not("."+hideControlsClassName);$defaultControl=$defaultControls.first();if($defaultControl.length<1||$defaultControl.closest("body").length<1){$defaultControl=$controls.first()}return $defaultControl};var getControlForValue=function($controls,controlValue){var $control=$controls.filter(function(){var $this=$(this);return true===isAvailableControl($this)&&true===hasControlValue($this,controlValue)});return $control};var toggleControls=function($controlEls,isAdd,className){if(!$controlEls||0===$controlEls.length){return}if(true===isAdd){$controlEls.addClass(className)}else if(false===isAdd){$controlEls.removeClass(className)}};var hideControls=function($controlEls){deactivateControls($controlEls);toggleControls($controlEls,true,hideControlsClassName)};var showControls=function($controlEls){toggleControls($controlEls,false,hideControlsClassName)};var activateControls=function($controlEls){toggleControls($controlEls,true,activateControlsClassName)};var deactivateControls=function($controlEls){toggleControls($controlEls,false,activateControlsClassName)};var playerUi_Core=function(){var logPrefix="[UI CORE] ";var playerUiMap_Core={$videoPlayerDiv:null,$videoContainer:{selector:".js-vid-player-holder"},$playerChrome:{selector:".js-vid-player-chrome"},$ageGate:{selector:".js-vid-age-gate"},$ageMonth:{selector:".js-vid-age-gate-month"},$ageDay:{selector:".js-vid-age-gate-day"},$ageYear:{selector:".js-vid-age-gate-year"},$ageDate:{selector:".js-vid-age-gate-date"},$playPauseButtons:{selector:".js-vid-play",events:{click:"togglePlay"}},$qualityButtons:{selector:".js-vid-quality",events:{click:"setQuality"}},$timeDisplay:{selector:".js-vid-time"},$kubrickLead:{selector:"#kubrick-lead",unique:true},$countdown:{selector:".js-vid-countdown"},$imaAdDiv:{selector:".js-vid-ima-ad"},$imaAdClickthru:{selector:".js-vid-ima-clickthru"}};var ui={type:"wtfbbq",playerId:null,videoJSON:null,adMessagePrefix:"This ad ends in: ",els:{},states:{videoId:null,playback:null,playerType:null,quality:null,adPlayed:false,contentLoading:false,contentStarted:false,played:false,paused:false,started:false,ended:false,contentEndTimeoutId:null,counting:false,adPlaying:false,gated:false,hasGate:false,showAgeGate:false,loading:true,playing:false,volume:1,embiggened:false,mute:false,share:false,stickied:false,fullscreen:false,windowed:false,currentTime:0,duration:0,hasTimeChange:false,isAtEndTime:false,isLive:false,isOffAir:false,isRewound:false,isSeekDisabled:true,customStartTime:0,restoredFromSavedTime:false,liveStartTime:0,liveSeekDelay:10,liveSeekDelayLeft:null,stowControls:false},classNames:{contentLoading:"is-vid-content-loading",contentStarted:"is-vid-content-started",played:"is-vid-played",started:"is-vid-started",ended:"is-vid-ended",counting:"has-vid-countdown",adPlaying:"is-vid-ad-playing",gated:"has-vid-invalid-age",hasGate:"has-vid-age-gated",showAgeGate:"is-vid-age-gate",disabled:"is-vid-disabled",loading:"is-vid-loading",playing:"is-vid-playing",embiggened:"is-vid-embiggened",mute:"is-vid-muted",share:"has-vid-share",stickied:"is-vid-stickied",fullscreen:"is-vid-fullscreen",windowed:"is-vid-fullscreen",isLive:"is-vid-live",isOffAir:"is-vid-offair",isRewound:"is-vid-rewound",isSeekDisabled:"is-vid-noseek",stowControls:"is-vid-stow-controls"},kubrickClassNames:{played:"video-active",playing:"video-playing"}};ui.initialize=function(options){var self=this,els=self.els;metisLog("Player type: "+self.type);self.playerId=options.playerId;self.videoJSON=options.videoJSON;self.states.videoId=options.videoJSON.id;if(!!options.els){$.extend(els,options.els)}if(false===self.isOfAge()){self.gate();return}self.initElements();if(undefined===els.$playerChrome){metisLog(logPrefix+"Quitting -- player chrome is missing.");return}self.initStates();self.initComplete()};ui.initElements=function(){var self=this,uiMap=self.getUiMap(),els=self.els,$element,elementName,elementData;for(elementName in uiMap){if(uiMap.hasOwnProperty(elementName)){$element=undefined;elementData=uiMap[elementName];if(!!elementData){$element=self.getUiElement(elementName,elementData)}metisLog("UI Elements ["+elementName+"]: ",!!$element?$element.length:0);if(undefined!==$element){els[elementName]=$element;if(!!elementData.events){self.addElementEvents($element,elementData)}}}}self.initCountdown()};ui.initStates=function(){};ui.initComplete=function(){var self=this,videoJSON=self.videoJSON;metisLog(logPrefix+"initComplete");self.setStates({loading:false});if(videoJSON.startTime){self.setStates({customStartTime:videoJSON.startTime,restoredFromSavedTime:!!(videoJSON.restoredFromSavedTime||0)})}};ui.getUiMap=function(){return $.extend({},playerUiMap_Core)};ui.getUiElement=function(elementName,elementData){var self=this,els=self.els,playerId=self.playerId,selector=elementData.selector,selectorSuffix="",$element;$element=els[elementName];if(undefined===$element){if(!!selector&&selector.indexOf("#")===0&&!elementData.unique){selectorSuffix=playerId}if(!!selector){if(""!==selectorSuffix){selector+=selectorSuffix}if(selector.indexOf("#")===0){$element=$(selector)}else{$element=els.$videoPlayerDiv.find(selector)}}}if(!$element||$element.length<1){$element=undefined}return $element};ui.handleUserAction=function(){};ui.getEventFunction=function($element,eventName,callbackName,elementData){if(!$element||$element.length<=0||!eventName){return}var self=this,eventFunction,callback;if(callbackName){callback=self[callbackName]}if(!callback){metisLog("Unable to find callback for ["+callbackName+"]");return}if("click"===eventName){eventFunction=function(e){var $eventElement=$(this),hasChange=false,callbackData=$eventElement.data(cmdValueDataKey);stopEvent(e);hasChange=callback.call(self,callbackData);if(true===hasChange){metisLog("CHANGED!!!\n",self.states);self.handleUserAction($eventElement,elementData);if(true===self.states.started){metisLog("!!! Change occured during playback !!!");playerManager.changePlayerState(self)}}}}else{eventFunction=function(e){callback.call(self,e,$(this).data(cmdValueDataKey))}}return eventFunction};ui.addElementEvents=function($element,elementData){var self=this,events=elementData.events,eventName,callbackName,eventFunction,eventsMap={},hasEvents=false;if(!$element||$element.length<=0||!events){return}for(eventName in events){if(events.hasOwnProperty(eventName)){callbackName=events[eventName];if(!!callbackName){eventFunction=self.getEventFunction($element,eventName,callbackName,elementData);if(undefined!==eventFunction){eventsMap[eventName]=eventFunction;hasEvents=true}}}}if(true===hasEvents){metisLog("- adding eventsMap: ",eventsMap);$element.on(eventsMap)}};ui.initCountdown=function(){var self=this,videoJSON=self.videoJSON,currentTime=Date.now(),countdownTime=parseInt(videoJSON.countdownTime,10)*1e3,$countdown=self.els.$countdown,counting=false;if(!$countdown){metisLog("No countdown");return $countdown}metisLog("Initializing countdown");counting=!$countdown.data("complete")&&(countdownTime>0&&currentTime<countdownTime);if(counting){$countdown.on("complete",function(){self.setStates({counting:false})});self.setStates({counting:true})}return $countdown};ui.getVideoContainer=function(playerType){var self=this,$videoContainer=self.els.$videoContainer,divId=$videoContainer.attr("id");if(!divId){$videoContainer.attr("id","js-vid-"+playerType+"-player"+self.playerId)}return $videoContainer};ui.togglePlay=function(){var self=this,states=self.states,playing=states.playing,hasChange=false;metisLog(logPrefix+"togglePlay > states: ",states);if(true===playing){hasChange=self.pause()}else if(true===states.started){hasChange=self.resume()}else{hasChange=self.play()}if(true===hasChange){states.playing=!playing}return hasChange};var getWatchedVideos=function(videoJSON){var cookieName=videoJSON.watchedCookieName,watched;if(!cookieName){return}watched=$.parseJSON($.cookie(cookieName));if(!watched){watched=[]}return watched};var setWatchedVideos=function(videoJSON){var videoId=videoJSON.id,cookieName=videoJSON.watchedCookieName,cookieDays=videoJSON.watchedCookieDays,watched=getWatchedVideos(videoJSON);if(undefined===watched){return}if(0>$.inArray(videoId,watched)){watched.push(videoId)}$.cookie(cookieName,jsonEncode(watched),{path:"/",expires:cookieDays})};var logVideoPlay=function(videoJSON){var disableTracking=!!$("#VideoDisableTracking").attr("content"),videoId=videoJSON.id;metisLog(logPrefix+"Disable Tracking? ",disableTracking);if(disableTracking||!videoId){return}$.ajax({url:"/api/video/played/"+videoId+"/",type:"GET",success:function(data){if(data.success===0){metisLog(logPrefix+"Error logging view")}else if(data.success===1){metisLog(logPrefix+"View logged successfully")}}});setWatchedVideos(videoJSON)};ui.play=function(){var self=this,states=self.states,isAgeGated=self.isAgeGated(),hasChange=false,videoJSON=self.videoJSON,videoID=videoJSON["id"];metisLog("[UI] ui.play");if(true===isAgeGated){self.gate()}else if(false!==isAgeGated&&"string"===typeof isAgeGated){if("prompt"===isAgeGated){self.promptAgeGate()}else{alert(isAgeGated)}}else{hasChange=true;if(false===states.playing){metisLog(logPrefix+"video is not playing > play")}if(false===states.played&&!!videoID){metisLog(logPrefix+"video has not played > log view");logVideoPlay(videoJSON)}if(false===states.started){self.els.$videoPlayerDiv.trigger("videoStart")}if(true===states.ended){self.els.$videoPlayerDiv.trigger("videoReplay")}self.setStates({played:true,playing:true,paused:false,started:true,ended:false});playerManager.play(self);getDocument().trigger("video_play")}};ui.pause=function(){var self=this;self.setStates({paused:true,playing:false});metisLog(logPrefix+"Tell playerManager to pause");playerManager.pause(self);self.els.$videoPlayerDiv.trigger("contentPause");return true};ui.resume=function(){var self=this;self.setStates({paused:false,playing:true});playerManager.resume(self);self.els.$videoPlayerDiv.trigger("contentResume");return true};ui.replay=function(){var self=this;self.setStates({playing:true,started:true,ended:false});playerManager.replay(self)};ui.seekToCustomStartTime=function(){var self=this,states=self.states,startTime=states.customStartTime,restoredFromSavedTime=states.restoredFromSavedTime,videoJSON=self.videoJSON,seekablePlaybacks=videoJSON.seekablePlaybacks,duration;if(!states.adPlaying&&states.started&&0<startTime){duration=playerManager.getDuration();if(undefined===duration||0===duration||true===isNaN(duration)){metisLog("wait until we have a legit duration");return}self.setStates({customStartTime:0,restoredFromSavedTime:false});if(0>$.inArray(states.playback,seekablePlaybacks)){return}if(Math.floor(startTime)<Math.floor(duration)){playerManager.seekTo(startTime);if(restoredFromSavedTime){showSuccessMessage("Resuming video from saved position")}}}};ui.adStart=function(){metisLog(logPrefix+"start video ad");var self=this,states=self.states,paused=states.paused;self.cancelConfirmContentEnd();self.setStates({adPlayed:true,adPlaying:true,paused:paused,playing:!paused,started:true,ended:false})};ui.adEnd=function(){var self=this;metisLog(logPrefix+"end video ad");self.setStates({adPlaying:false})};ui.contentStart=function(){var self=this,states=self.states,paused=states.paused;self.cancelConfirmContentEnd();self.setStates({adPlaying:false,paused:paused,playing:!paused,started:true,ended:false,contentStarted:true})};ui.contentEnd=function(){var self=this,states=self.states,newStates={contentStarted:false},isLive=states.isLive,isAtEndTime=false,currentTime=Math.floor(states.currentTime),duration=Math.floor(states.duration),timeDiff=Math.abs(duration-currentTime);if(1>=timeDiff||currentTime>=duration){isAtEndTime=true}newStates.isAtEndTime=isAtEndTime;metisLog(logPrefix+"[CONTENT END]");metisLog("- isLive: "+(isLive?"yes":"no"));metisLog("- isAtEndTime: "+(isAtEndTime?"yes":"no"));if(!isLive&&isAtEndTime){newStates.playing=false;newStates.started=false;newStates.ended=true;metisLog(logPrefix+"We are contentEnd!");self.els.$videoPlayerDiv.trigger("contentEnd")}this.setStates(newStates);if(states.playing){metisLog(logPrefix+"contentEnd was ignored, check again in a second");self.confirmContentEnd()}};ui.confirmContentEnd=function(){var self=this,confirmDuration=4e3,states=self.states,timeoutId;self.cancelConfirmContentEnd();if(true===states.isLive){confirmDuration=1e4}timeoutId=setTimeout(function(){metisLog(logPrefix+"confirmContentEnd");self.setStates({isLive:false,currentTime:states.duration});self.cancelConfirmContentEnd();self.contentEnd()},confirmDuration);states.contentEndTimeoutId=timeoutId};ui.cancelConfirmContentEnd=function(){var states=this.states,timeoutId=states.contentEndTimeoutId;if(timeoutId){metisLog(logPrefix+"clear confirmContentEnd timeout");clearTimeout(timeoutId);states.contentEndTimeoutId=null}};ui.playlistEnd=function(){this.setStates({contentStarted:false,playing:false,started:false,ended:true})};var liveDurationBuffer=[],liveDurationBufferLimit=4,newDurationCheckVal=true,hasNewDuration=function(newDuration){liveDurationBuffer.push(newDuration);if(liveDurationBuffer.length===liveDurationBufferLimit){if(liveDurationBuffer[0]===liveDurationBuffer[liveDurationBufferLimit-1]){newDurationCheckVal=false}else{newDurationCheckVal=true}liveDurationBuffer=liveDurationBuffer.slice(liveDurationBufferLimit-1)}return newDurationCheckVal};ui.liveStreamCheck=function(timeData){var self=this,states=self.states,isOffAir=false,isLive=false,isRewound=false,currentTime=timeData.currentTime,duration=timeData.duration,seekDelay=states.liveSeekDelay,delayLeft=states.liveSeekDelayLeft,durationExtended,startTime;if(!self.videoJSON.isLiveStream){return}if(states.duration===0){return}if(states.currentTime===currentTime){return}durationExtended=hasNewDuration(duration);if(delayLeft===null){states.liveStartTime=currentTime}if(delayLeft!==false){startTime=states.liveStartTime;delayLeft=seekDelay-currentTime+startTime}if(delayLeft>0){states.liveSeekDelayLeft=delayLeft;timeData.isSeekDisabled=true;return}else if(false!==states.liveSeekDelayLeft){states.liveSeekDelayLeft=false;timeData.isSeekDisabled=false}if(true===durationExtended){if(currentTime<duration-2){isRewound=true}else{isLive=true}}else{isOffAir=true}if(states.isOffAir!==isOffAir){timeData.isOffAir=isOffAir}if(states.isLive!==isLive){timeData.isLive=isLive}if(states.isRewound!==isRewound){timeData.isRewound=isRewound}};ui.videoProgress=function(timeData){var self=this,states=self.states,hasTimeChange=false;self.cancelConfirmContentEnd();if(false===states.adPlaying){if(true===self.videoJSON.isLiveStream){self.liveStreamCheck(timeData)}else{if(false!==states.isSeekDisabled){timeData.isSeekDisabled=false}if(self.states.customStartTime){self.seekToCustomStartTime()}}if(Math.floor(timeData.currentTime)!==Math.floor(self.states.currentTime)){hasTimeChange=true}timeData.hasTimeChange=hasTimeChange;self.setStates(timeData);if(hasTimeChange){self.els.$videoPlayerDiv.trigger("contentProgress",states)}}};ui.getCuePoints=function(){var self=this,videoJSON=self.videoJSON,cuePoints;cuePoints=videoJSON.cuePoints;return cuePoints};ui.getVideoUrl=function(){var self=this,quality=self.states.quality,videoJSON=self.videoJSON,videoUrl;videoUrl=videoJSON.videoStreams[quality];metisLog(logPrefix+"getVideoUrl() =====>"+videoUrl);if(!videoUrl){metisLog("error",logPrefix+"Playback quality unavailable: ",quality)}return videoUrl};ui.setStates=function(states){var self=this,$videoPlayerDiv=self.els.$videoPlayerDiv,classNames=self.classNames,addClassNames=[],removeClassNames=[],$kubrickLead=self.els.$kubrickLead,kubrickClassNames=self.kubrickClassNames,kubrickAddClassNames=[],kubrickRemoveClassNames=[],className,oldClassName;$.each(states,function(state,stateValue){className=classNames[state];if(state==="playerType"&&stateValue!==self.states[state]){className="is-vid-"+stateValue+"-player";if(self.states[state]){oldClassName="is-vid-"+self.states[state]+"-player";if(oldClassName){removeClassNames.push(oldClassName)}}stateValue=true}if(undefined!==className){if(true===stateValue){addClassNames.push(className)}else{removeClassNames.push(className)}}if($kubrickLead){className=kubrickClassNames[state];if(undefined!==className){if(true===stateValue){kubrickAddClassNames.push(className)}else{kubrickRemoveClassNames.push(className)}}}});$.extend(self.states,states);$videoPlayerDiv.data("states",self.states);if(addClassNames.length>0){addClassNames=addClassNames.join(" ");metisLog(logPrefix+"setStates addClass: ",addClassNames);$videoPlayerDiv.addClass(addClassNames)}if(removeClassNames.length>0){removeClassNames=removeClassNames.join(" ");metisLog(logPrefix+"setStates removeClass: ",removeClassNames);$videoPlayerDiv.removeClass(removeClassNames)}if(kubrickAddClassNames.length>0){kubrickAddClassNames=kubrickAddClassNames.join(" ");metisLog(logPrefix+"setStates $kubrickLead.addClass: ",kubrickAddClassNames);$kubrickLead.addClass(kubrickAddClassNames)}if(kubrickRemoveClassNames.length>0){kubrickRemoveClassNames=kubrickRemoveClassNames.join(" ");metisLog(logPrefix+"setStates $kubrickLead.removeClass: ",kubrickRemoveClassNames);$kubrickLead.removeClass(kubrickRemoveClassNames)}};ui.setControl=function($controls,newValue){var hasChange=false,$newValueControl;$newValueControl=getControlForValue($controls,newValue);if($newValueControl.length>0&&false===isActivatedControl($newValueControl)){metisLog(logPrefix+"New Value Control for ["+newValue+"]: ",$newValueControl);hasChange=true;activateControls($newValueControl);deactivateControls($controls.not($newValueControl))}return hasChange};ui.setQuality=function(newValue,preventPlay){var self=this,states=self.states,$controls=self.els.$qualityButtons,hasChange=self.setControl($controls,newValue);if(true===hasChange){metisLog(logPrefix+"setQuality newValue: "+newValue);states.quality=newValue;if(states.started&&!preventPlay){self.play()}}return hasChange};ui.setVideoProgress=function(){};ui.contentLoading=function(stateValue){this.setStates({contentLoading:stateValue})};(function(){ui.isOfAge=function(birthDate){var videoJSON=this.videoJSON,gateValue=videoJSON.contentRating,ofAgeState;if(!gateValue){ofAgeState=true}else{if(!birthDate){birthDate=$.cookie(videoJSON.ageGateCookieName)}if(birthDate){var today=new Date,dateParts=birthDate.split("-"),birthday,age;try{birthday=new Date(dateParts[0],dateParts[1],dateParts[2]);if(isNaN(birthday.getTime())){birthday=today}}catch(e){birthday=today}age=Math.floor((today-birthday)/31536e6);if(age>=gateValue){ofAgeState=true}else{ofAgeState=false}}}return ofAgeState};ui.hasAgeGate=function(){var self=this,$gate=self.els.$ageGate,videoJSON=self.videoJSON,gateValue=videoJSON.contentRating,gated=true;if(!$gate||!gateValue||true===self.isOfAge()){metisLog("[AGE GATE] not gated");gated=false}else{metisLog("[AGE GATE] gated")}return gated};ui.promptAgeGate=function(){this.setStates({showAgeGate:true})};ui.isAgeGated=function(){var self=this,els=self.els,$gate=els.$ageGate,$ageYear=els.$ageYear,videoJSON=self.videoJSON,ageGateCookieName=videoJSON.ageGateCookieName,birthDate,day,month,year,isGated=false;metisLog("[AGE GATE] Checking...");if(true===self.hasAgeGate()){if(false===self.isOfAge()){isGated=true}else if(false===self.states.showAgeGate){isGated="prompt"}else{year=$ageYear.val();metisLog("[AGE GATE] Year selected: "+year);if("year"===year){metisLog("warning","[AGE GATE] missing year value");isGated="Please select a year value to validate your age!"}else{month=els.$ageMonth.val();day=els.$ageDay.val();birthDate=[year,month,day].join("-");if(!!ageGateCookieName){$.cookie(ageGateCookieName,birthDate,{path:"/",expires:2e3})}if(!self.isOfAge(birthDate)){metisLog("[AGE GATE] User is not old enough");isGated=true}}}}if(false===isGated){metisLog("[AGE GATE] User is old enough");self.setStates({hasGate:false,showAgeGate:false});if(!!$gate&&$gate.length>0){$gate.remove();delete els.$ageGate}}return isGated};ui.gate=function(){var self=this,els=self.els,$videoPlayerDiv=els.$videoPlayerDiv;self.setStates({disabled:true,gated:true});els.$playerChrome.remove();$videoPlayerDiv.off(eventNamespace)}})();return ui}();var playerUi_Mobile=function(){var logPrefix="[UI MOBILE] ";var playerUiMap_Mobile={$deviceAdMessage:{selector:".js-vid-ad-message"}};var ui={type:"mobile",states:{playback:"html5",playerType:"html5",quality:null}};ui=$.extend(true,{},playerUi_Core,ui);ui.initialize=function(options){var videoJSON=options.videoJSON;$.extend(videoJSON,{nativeControls:true,autoHide:true});playerUi_Core.initialize.call(this,options)};ui.initStates=function(){var self=this,$defaultQuality=getDefaultControl(self.els.$qualityButtons),defaultQuality=$defaultQuality.data(cmdValueDataKey);metisLog(logPrefix+"initStates");self.setQuality(defaultQuality)};ui.initComplete=function(){var self=this;playerManager.loadPlayerTypes([self.states.playerType],self);playerUi_Core.initComplete.call(self)};ui.getUiMap=function(){var uiMap=$.extend(true,playerUi_Core.getUiMap(),playerUiMap_Mobile);return uiMap};ui.videoProgress=function(timeData){var self=this,states=self.states,adPlaying=states.adPlaying,progressMsg="",currentTime,duration;playerUi_Core.videoProgress.call(self,timeData);if(!timeData.hasTimeChange){return}currentTime=Math.floor(timeData.currentTime);duration=Math.floor(timeData.duration);if(true===adPlaying){progressMsg=self.adMessagePrefix+convertTime(duration-currentTime)}self.setVideoProgress(progressMsg)};ui.setVideoProgress=function(progressMsg){var els=this.els,$timeDisplay=els.$timeDisplay;if(!!$timeDisplay){$timeDisplay.html(progressMsg)}};return ui}();var playerUi_Desktop=function(){var logPrefix="[UI DESKTOP] ";var playerUiMap_Desktop={$videoPlayerDiv:{events:{keydown:"spacebarToggle",selectstart:"stopSelect"}},$videoMaxWidth:{selector:".js-vid-max-width"},$avBox:{selector:".js-vid-box"},$kubrickLead:{external:true,parentOf:"$videoPlayerDiv"},$kubrickInfo:{selector:".kubrick-info",external:true,childOf:"$kubrickLead"},$kubrickInfoParent:{selector:".row",external:true,childOf:"$kubrickLead"},$kubrickRelated:{selector:"#js-kubrick-pod",external:true,childOf:"$kubrickLead"},$embiggenContainer:{selector:".js-video-embiggen",external:true,parentOf:"$videoPlayerDiv"},$embiggenVidSize:{selector:".js-video-size",external:true,parentOf:"$videoPlayerDiv"},$stickyContainer:{selector:".js-video-sticky",external:true,parentOf:"$videoPlayerDiv"},$videoSpacer:{selector:"#video-spacer",external:true,dependsOn:"$kubrickLead"},$playPauseButtons:{selector:".js-vid-play, .js-vid-play-pause"},$volume:{selector:".js-vid-volume"},$volumeBar:{selector:".js-vid-volume-bar",events:{mousedown:"volumeChange","mousedown.volumeSlide":"volumeSlideStart","mouseup.volumeSlide":"volumeSlideStop"}},$volumeHandle:{selector:".js-vid-volume-handle"},$muteButton:{selector:".js-vid-mute",events:{click:"toggleMute"},cookieType:"state",state:"mute"},$fullscreenButton:{selector:".js-vid-fullscreen",events:{click:"toggleFullscreen"}},$fullWinButton:{selector:".js-vid-windowed",events:{click:"toggleWindowed"}},$playbackButtons:{selector:".js-vid-playback",events:{click:"setPlayback"},cookieType:"state",state:"playback"},$qualityButtons:{cookieType:"state",state:"quality"},$embiggenButtonContainer:{selector:".js-vid-embiggen-wrap",dependsOn:"$embiggenVidSize"},$embiggenButton:{selector:".js-vid-embiggen",events:{click:"toggleEmbiggen"},cookieType:"state",state:"embiggen",dependsOn:"$embiggenVidSize"},$stickyPinButtonContainer:{selector:".js-vid-pin-wrap",dependsOn:"$stickyContainer"},$stickyPinButton:{selector:".js-vid-pin",events:{click:"toggleSticky"},state:"sticky",dependsOn:"$stickyContainer"},$shareButton:{selector:".js-vid-share",events:{click:"toggleShare"}},$shareModal:{selector:".js-vid-modal-share",ui:{sizes:".js-vid-share-sizes",markup:".js-vid-share-size-markup"}},$seeker:{selector:".js-vid-buffer",cookieType:"position",events:{click:"seekTo",mouseenter:"seekDisplayStart",mouseleave:"seekDisplayStop"}},$seekDisplay:{selector:".js-vid-seek-display"},$seekText:{selector:".js-vid-seek-text"},$seekPointer:{selector:".js-vid-seek-pointer"},$seekToLive:{selector:".js-vid-seektolive",events:{click:"seekToLive"}},$progress:{selector:".js-vid-position"},$loader:{selector:".js-vid-loaded"}};
var cookieTypeHandlers={state:"saveState",position:"savePosition"};var isFrontdoor=function(){return location.pathname==="/"};var cookieKeySavedState="__gamesVideoPlayer";var ui={type:"desktop",stateJSON:{},seekTime:0,playbacks:null};ui=$.extend(true,{},playerUi_Core,ui);ui.initStates=function(){var self=this,hasPlaybacks;hasPlaybacks=self.initPlaybackQualities();metisLog(logPrefix+"hasPlaybacks? ",hasPlaybacks);if(!hasPlaybacks){metisLog(logPrefix+"no playbacks");return}self.loadSavedState()};ui.initPlaybackQualities=function(){var self=this,$playbacks=self.els.$playbackButtons,$qualities=self.els.$qualityButtons,playbacks={},qualities={},i,hasPlaybacks=false,availablePlayerTypes=[];if($qualities){metisLog(logPrefix+"$qualities: ",$qualities);$qualities.each(function(){var $quality=$(this),quality=$quality.data(cmdValueDataKey);qualities[quality]=this})}else{metisLog("error",logPrefix+"No qualities defined!");$playbacks=undefined}if(!!$playbacks){$playbacks.each(function(){var $playback=$(this),playback=$playback.data(cmdValueDataKey),isAvailablePlayerType=isAvailableControl($playback),playbackQualities=$playback.data("qualities").split(","),processedQualities=[],playbackQualityEl,playbackQualityEls=[],playerTypeKey;for(i=0;i<playbackQualities.length;i++){playbackQualityEl=qualities[playbackQualities[i]];if(undefined!==playbackQualityEl){playbackQualityEls.push(playbackQualityEl);processedQualities.push(playbackQualities[i])}}playerTypeKey=$playback.data("player");if(0>$.inArray(playerTypeKey,availablePlayerTypes)){availablePlayerTypes.push(playerTypeKey)}playbacks[playback]={isAvailable:isAvailablePlayerType,playerType:playerTypeKey,qualities:processedQualities,$button:$playback,$qualities:$(playbackQualityEls)};metisLog(logPrefix+"Playback Quality Elements for ["+playback+"]: ",playbacks[playback])});if(availablePlayerTypes.length>0){self.playbacks=playbacks;hasPlaybacks=true;playerManager.loadPlayerTypes(availablePlayerTypes,self)}}return hasPlaybacks};ui.initShareModal=function(){var self=this,$modal=self.els.$shareModal,ui=playerUiMap_Desktop.$shareModal.ui,$sizeOptions,$sizeMarkupElements,sizeMarkupMap={},defaultSize;if(!$modal){return}$sizeOptions=$modal.find(ui.sizes);$sizeMarkupElements=$modal.find(ui.markup);defaultSize=$sizeMarkupElements.data("size");metisLog(logPrefix+"===== BEG ui.initShareModal =====>");metisLog(logPrefix+"Default share size is: ",defaultSize);$sizeMarkupElements.each(function(){var $el=$(this);sizeMarkupMap[$el.data("size")]=$el});showControls(sizeMarkupMap[defaultSize]);$sizeOptions.on("change",function(){var selectEl=this,$selectEl=$(selectEl),currentSize=$selectEl.data("size")||defaultSize,selectedSize=selectEl[selectEl.selectedIndex].value||defaultSize;if(currentSize!==selectedSize){$selectEl.data("size",selectedSize);hideControls(sizeMarkupMap[currentSize]);showControls(sizeMarkupMap[selectedSize])}});metisLog(logPrefix+"===== END ui.initShareModal =====>")};ui.initComplete=function(){var self=this,stateJSON=self.stateJSON,activePlayback=stateJSON.playback,sticky=stateJSON[self.getStateKey("sticky")],embiggen=stateJSON[self.getStateKey("embiggen")],volume=stateJSON["volume"],mute=stateJSON["mute"],$win=getWindow(),els=self.els,$playbackButtons=els.$playbackButtons,$activePlayback;self.initShareModal();$activePlayback=getControlForValue($playbackButtons,activePlayback);if(0===$activePlayback.length){metisLog(logPrefix+"invalid playback ["+activePlayback+"]");activePlayback=undefined}if(undefined===activePlayback){$activePlayback=getDefaultControl($playbackButtons);activePlayback=$activePlayback.data(cmdValueDataKey);metisLog(logPrefix+"using default playback ["+activePlayback+"]")}self.setPlayback(activePlayback);if(!!els.$stickyPinButton&&true===sticky){self.setSticky(true)}if(!!els.$embiggenButton&&true===embiggen){self.setEmbiggen(true)}if(undefined!==volume){self.setVolume(volume,true)}if(true===mute){self.setMute(true)}self.adjustWidth();$win.on("resize",function(){self.adjustWidth()});playerUi_Core.initComplete.call(self);if(self.hasAutoplay()){self.autoplay()}};ui.getUiMap=function(){var uiMap=$.extend(true,playerUi_Core.getUiMap(),playerUiMap_Desktop);metisLog(logPrefix+"uiMap: ",uiMap);return uiMap};ui.getUiElement=function(elementName,elementData){var self=this,els=self.els,selector=elementData.selector,referenceElementKey,elementFilterFunction,$referenceElement,$element;if(!!elementData.external){if(!!elementData.parentOf){referenceElementKey=elementData.parentOf;elementFilterFunction="parents"}else if(!!elementData.childOf){referenceElementKey=elementData.childOf;elementFilterFunction="find"}if(!!referenceElementKey){$referenceElement=els[referenceElementKey]}if(!!$referenceElement&&!!elementFilterFunction){$element=$referenceElement[elementFilterFunction](selector)}else if(selector.indexOf("#")===0){$element=$(selector)}if(!$element||$element.length<1){$element=undefined}metisLog(logPrefix+"external element ["+elementName+"]: ",$element)}else{$element=playerUi_Core.getUiElement.call(self,elementName,elementData)}if(!!elementData.dependsOn&&!!$element){$referenceElement=els[elementData.dependsOn];if(undefined===$referenceElement){metisLog("warn",logPrefix+"- ["+elementName+"] depends on an element that does not exist. Removing from player.");$element.remove();$element=undefined}}return $element};ui.initCountdown=function(){var self=this,$countdown=playerUi_Core.initCountdown.call(self);if($countdown&&$countdown.length){$countdown.on("complete",function(){if(self.hasAutoplay()){self.autoplay()}})}return $countdown};ui.handleUserAction=function($element,elementData){metisLog(logPrefix+"handleUserAction > elementData: ",elementData);var self=this,cookieType=elementData.cookieType,cookieHandler=self[cookieTypeHandlers[cookieType]],handlerArgument;if(!cookieHandler){metisLog("warn",logPrefix+"Not a cookie action");return}switch(cookieType){case"state":handlerArgument=elementData.state;if(!!handlerArgument){cookieHandler.call(self,handlerArgument,$element.data(cmdValueDataKey))}else{metisLog(logPrefix+"Invalid data detected, not saving.")}break;default:break}};ui.getVideoContainer=function(playerType){var self=this,containers=self.els.containers,$videoContainer=self.els.$videoContainer,$returnContainer;if(!containers){self.els.containers=containers={}}$returnContainer=containers[playerType];if(!$returnContainer){$returnContainer=$('<div id="js-vid-'+playerType+"-player"+self.playerId+'" class="av-player-type-holder av-'+playerType+'-player-holder"/>');$videoContainer.append($returnContainer);containers[playerType]=$returnContainer}return $returnContainer};ui.spacebarToggle=function(e){if(e.which===32){e.preventDefault();this.togglePlay()}};ui.stopSelect=function(e){if(!$(e.target).data("enable-select")){stopEvent(e)}return false};ui.adjustWidth=function(){metisLog(logPrefix+"========== BEG ui.adjustWidth ==========");var self=this,els=self.els,$videoPlayerDiv=els.$videoPlayerDiv,$videoMaxWidth=els.$videoMaxWidth,$videoContainer=els.$videoContainer,aspectRatio=16/9,adjustedWidth="100%",widthAttr="width",viewportHeight,playerHeight;$videoMaxWidth.css(widthAttr,adjustedWidth);viewportHeight=$videoPlayerDiv.height();playerHeight=$videoContainer.height();metisLog(logPrefix+"viewport height: ",viewportHeight);metisLog(logPrefix+"player height: ",playerHeight);if(viewportHeight<playerHeight){adjustedWidth=aspectRatio*viewportHeight}metisLog(logPrefix+"adjust max width to: ",adjustedWidth);metisLog(logPrefix+"maxWidth.css(width): ",$videoMaxWidth.css(widthAttr));$videoMaxWidth.css(widthAttr,adjustedWidth);metisLog(logPrefix+"========== END ui.adjustWidth ==========")};ui.hasAutoplay=function(){var self=this;return self.videoJSON.autoplay&&!self.states.counting};ui.autoplay=function(){var self=this;if(!self.states.playing){metisLog("!!! AUTOPLAY !!!");self.els.$playPauseButtons.first().trigger("click")}};ui.stashCurrentTime=function(){var self=this,states=self.states,newStates={},currentTime;if(!self.videoJSON.isLiveStream&&0===states.customStartTime&&states.started){try{currentTime=playerManager.getCurrentTime()}catch(e){currentTime=0}newStates.customStartTime=currentTime;metisLog(logPrefix+"stashCurrentTime() time: "+currentTime);if(true===states.restoredFromSavedTime){newStates.restoredFromSavedTime=false}self.setStates(newStates)}};ui.setPlayback=function(newValue){var self=this,els=self.els,$qualities=els.$qualityButtons,hasChange=self.setControl(els.$playbackButtons,newValue),playbackQualities,$playbackQualities,$notPlaybackQualities,$activeQuality,activeQuality=self.stateJSON.quality,states=self.states,switched=false;var playbackSettings=self.playbacks[newValue];if(true===hasChange){metisLog(logPrefix+"setPlayback to: ",newValue);self.setStates({playback:newValue,playerType:playbackSettings.playerType});self.stashCurrentTime();$playbackQualities=playbackSettings["$qualities"];$notPlaybackQualities=$qualities.not($playbackQualities);hideControls($notPlaybackQualities);showControls($playbackQualities);playbackQualities=playbackSettings["qualities"];metisLog(logPrefix+"> available qualities for playback: ",playbackQualities);metisLog(logPrefix+"> current activeQuality: ",activeQuality);if(!activeQuality||0>$.inArray(activeQuality,playbackQualities)){metisLog(logPrefix+"> activeQuality not found for playback");$activeQuality=getDefaultControl($playbackQualities);activeQuality=$activeQuality.data(cmdValueDataKey);metisLog(logPrefix+"> setting new activeQuality to: ",activeQuality)}if(states.started){self.pause();switched=playerManager.setPlayer()}self.setQuality(activeQuality,true);if(switched&&states.started){metisLog(logPrefix+"> player has started, play video with new player");self.play()}}return hasChange};ui.setQuality=function(newValue,preventPlay){var self=this,states=self.states,hasChange=playerUi_Core.setQuality.call(self,newValue,true);if(hasChange){self.stashCurrentTime();if(states.started&&!preventPlay){self.play()}}return hasChange};ui.adStart=function(){var self=this;playerUi_Core.adStart.call(self);self.setVideoProgress("A word from our sponsors...")};ui.contentEnd=function(){var self=this,states=self.states,isLive=states.isLive,isAtEndTime;playerUi_Core.contentEnd.call(self);isAtEndTime=states.isAtEndTime;if(!isLive&&isAtEndTime){metisLog(logPrefix+"reset progress width to 0");self.setVideoProgress("",0)}};ui.videoProgress=function(timeData){var self=this,states=self.states,adPlaying=states.adPlaying,contentStarted=states.contentStarted,isLiveStream=self.videoJSON.isLiveStream,zeroProgressPercent=ratioToPercentString(0),progressPercent=zeroProgressPercent,loadedPercent=zeroProgressPercent,progressMsg="",currentTime,duration,bytesLoaded,bytesTotal,isLive,isOffAir,isRewound,i;playerUi_Core.videoProgress.call(self,timeData);if(!timeData.hasTimeChange){return}currentTime=Math.floor(timeData.currentTime);duration=Math.floor(timeData.duration);bytesLoaded=timeData.bytesLoaded||0;bytesTotal=timeData.bytesTotal||0;isLive=states.isLive;isOffAir=states.isOffAir;isRewound=states.isRewound;if(true===adPlaying){progressMsg=self.adMessagePrefix+convertTime(duration-currentTime)}else if(true===contentStarted){progressMsg=convertTime(currentTime);progressPercent=ratioToPercentString(currentTime/duration);if(0<=bytesLoaded&&0<bytesTotal){loadedPercent=ratioToPercentString(bytesLoaded/bytesTotal)}if(!isLive){progressMsg+=" / "+convertTime(duration)}if(true===isLiveStream){if(!isLive&&!isOffAir&&!isRewound){progressMsg="Loading stream data";for(i=0;i<=(currentTime+1)%3;i++){progressMsg+="."}progressPercent=zeroProgressPercent}if(isLive){progressPercent=ratioToPercentString(1)}}}self.setVideoProgress(progressMsg,progressPercent,loadedPercent)};ui.setVideoProgress=function(progressMsg,progressPercent,loadedPercent){var els=this.els,$timeDisplay=els.$timeDisplay,$progress=els.$progress,$loader=els.$loader,currentProgressMsg,currentProgressPercent,currentLoadedPercent;if(!!$timeDisplay){currentProgressMsg=$timeDisplay.data("progress-msg");if(currentProgressMsg!==progressMsg){$timeDisplay.html(progressMsg);$timeDisplay.data("progress-msg",progressMsg)}}if(undefined!==progressPercent&&!!$progress){currentProgressPercent=$progress.data("width");if(currentProgressPercent!==progressPercent){$progress.css("width",progressPercent);$progress.data("width",progressPercent)}}if(!!loadedPercent&&!!$loader){currentLoadedPercent=$loader.data("width");if(currentLoadedPercent!==loadedPercent){$loader.css("width",loadedPercent);$loader.data("width",loadedPercent)}}};ui.toggleState=function(stateType){var self=this,hasChange=false,stateJSON=self.stateJSON,stateKey=self.getStateKey(stateType),stateValue,setStateMethod;switch(stateType){case"embiggen":setStateMethod=self.setEmbiggen;break;case"mute":setStateMethod=self.setMute;break;case"sticky":setStateMethod=self.setSticky;break}if(!!setStateMethod){stateValue=stateJSON[stateKey];metisLog(logPrefix+"toggleState stateJSON stateValue: ",stateValue);if(undefined===stateValue){stateValue=true}else{stateValue=!stateValue}hasChange=setStateMethod.call(self,stateValue);metisLog(logPrefix+"Toggle "+stateType+": ",stateValue)}return hasChange};var seekDisplayEvent="mousemove.seekDisplay",seekPositionAttr="left",seekPositionDataKey="position";var getLimitDifference=function($target,limits){var targetOffset,diff=0;targetOffset=$target.offset();targetOffset.right=targetOffset.left+$target.outerWidth();if(targetOffset.left<limits.left){diff=limits.left-targetOffset.left}else if(targetOffset.right>limits.right){diff=limits.right-targetOffset.right}return diff};var limitSeekTextPosition=function($target,limits){var originalValues,diff;$target.css("left","-50%");originalValues=$target.position();diff=getLimitDifference($target,limits);if(diff!==0){$target.css(seekPositionAttr,originalValues.left+diff)}};var limitSeekPointerPosition=function($target,limits){var originalValues=$target.data(seekPositionDataKey),limitClass=$target.data("limitClass"),diff,limitDirection,resetValues={},newCssValues={};if(undefined===originalValues){originalValues=$target.position();originalValues.width=$target.outerWidth();$target.data(seekPositionDataKey,originalValues)}resetValues={left:originalValues.left,width:originalValues.width};$target.css(resetValues);if(!!limitClass){$target.removeClass(limitClass)}diff=getLimitDifference($target,limits);if(diff>0){limitDirection="left"}else if(diff<0){limitDirection="right"}if(diff!==0){newCssValues["width"]=originalValues.width-Math.abs(diff);if(diff>0){newCssValues["left"]=originalValues.left+diff}limitClass="limit-"+limitDirection;$target.addClass(limitClass);$target.data("limitClass",limitClass);$target.css(newCssValues)}};ui.seekTo=function(){var self=this,states=self.states,seekTime=self.seekTime,hasChange=false;if(true===states.started&&false===states.adPlaying){metisLog(logPrefix+"seekTo: ",seekTime);hasChange=true;playerManager.seekTo(seekTime);if(false===states.playing){metisLog(logPrefix+"not playing, so don't let seekto play");playerManager.pause();self.videoProgress({currentTime:seekTime,duration:playerManager.getDuration()})}self.seekTime=0;self.els.$videoPlayerDiv.trigger("contentSeek",[seekTime])}return hasChange};ui.seekToLive=function(){var self=this,states=self.states,hasChange=false;if(true===states.started&&false===states.adPlaying){metisLog(logPrefix+"seekToLive()");hasChange=true;playerManager.seekToLive();if(false===states.playing){metisLog(logPrefix+"not playing, so don't let seekToLive play");playerManager.pause();self.videoProgress({currentTime:playerManager.getDuration(),duration:playerManager.getDuration()})}}return hasChange};ui.updateSeekDisplay=function(seekText,seekPosition){var self=this,els=self.els,$videoPlayerDiv=els.$videoPlayerDiv,$seekText=els.$seekText,$seekPointer=els.$seekPointer,playerOffset;if(!seekText){seekText="loading..."}$seekText.text(seekText);els.$seekDisplay.css(seekPositionAttr,seekPosition);playerOffset=$videoPlayerDiv.offset();playerOffset.right=playerOffset.left+$videoPlayerDiv.width();limitSeekTextPosition($seekText,playerOffset);limitSeekPointerPosition($seekPointer,playerOffset)};ui.setSeekDisplay=function(e){var self=this,els=self.els,$seekText=els.$seekText,ratio=getEventInContainerRatio(e,els.$seeker),videoDuration=playerManager.getDuration(),seekTime=0,seekPosition=0,seekText="";if(undefined===videoDuration){videoDuration=0}if(0<=ratio&&0<videoDuration){seekTime=Math.round(ratio*videoDuration);seekText=convertTime(seekTime);seekPosition=ratioToPercentString(seekTime/videoDuration)}if(seekTime!==self.seekTime||seekText!==$seekText.text()){self.seekTime=seekTime;self.updateSeekDisplay(seekText,seekPosition)}};ui.seekDisplayStart=function(){var self=this,states=self.states;if(true===states.started&&false===states.adPlaying){self.els.$seeker.on(seekDisplayEvent,function(e){self.setSeekDisplay(e)})}};ui.seekDisplayStop=function(){this.els.$seeker.off(seekDisplayEvent)};ui.toggleShare=function(){var self=this,newState=!self.states.share;self.setStates({share:newState})};(function(){var stickyClassName="sticky",stickySettings={zIndex:5000050,noStop:true,unstickyOnAjax:false},toggleStickyCallback=function(els,sticky){var $stickyContainer=els.$stickyContainer,$videoSpacer=els.$videoSpacer,hasVideoSpacer=!!$videoSpacer;if(true===sticky){metisLog(logPrefix+"add sticky");$stickyContainer.addClass(stickyClassName);if(hasVideoSpacer){$videoSpacer.height($stickyContainer.outerHeight(true))}}else{metisLog(logPrefix+"remove sticky");$stickyContainer.removeClass(stickyClassName);if(hasVideoSpacer){$videoSpacer.height("auto")}}};ui.setSticky=function(newState){var hasChange=false,self=this,els=self.els,$stickyContainer=els.$stickyContainer,$stickyPinButton=els.$stickyPinButton,currentState=$stickyPinButton.data(cmdValueDataKey)||false;if(!!$stickyContainer&&currentState!==newState){hasChange=true;if(true===newState){$.sticky($stickyContainer,stickySettings,function(){toggleStickyCallback(els,true)},function(){toggleStickyCallback(els,false)})}else{$.destroySticky($stickyContainer);toggleStickyCallback(els,false)}$stickyPinButton.data(cmdValueDataKey,newState);self.setStates({stickied:newState})}return hasChange};ui.toggleSticky=function(){metisLog(logPrefix+"toggle sticky!");var self=this,cookieType=playerUiMap_Desktop.$stickyPinButton.cookieType,newState,returnVal;if(undefined===cookieType){newState=!self.els.$stickyPinButton.data(cmdValueDataKey);returnVal=self.setSticky(newState)}else{returnVal=self.toggleState("sticky")}return returnVal}})();(function(){var kubrickRelatedInitialized=false,kubrickPodEmbiggenClass="pod-recirc--horizontal",kubrickPodDebiggenClasses=["align-vertical--child","align-vertical--contain"],kubrickRelatedEmbiggenClass,kubrickRelatedDebiggenClass,$kubrickRelatedPod,kubrickRelatedAlignEls=[];var handleKubrickRelated=function(els,embiggen){var $kubrickRelated=els.$kubrickRelated;if(!$kubrickRelated){return}if(false===kubrickRelatedInitialized){kubrickRelatedInitialized=true;kubrickRelatedEmbiggenClass=$kubrickRelated.data("embiggen-class");kubrickRelatedDebiggenClass=$kubrickRelated.data("debiggen-class");$kubrickRelatedPod=$kubrickRelated.find(".pod");$.each(kubrickPodDebiggenClasses,function(index,value){kubrickRelatedAlignEls.push($kubrickRelatedPod.find("."+value))})}if(embiggen){$kubrickRelated.addClass(kubrickRelatedEmbiggenClass).removeClass(kubrickRelatedDebiggenClass);$kubrickRelatedPod.addClass(kubrickPodEmbiggenClass);$.each(kubrickRelatedAlignEls,function(index,$elements){$elements.removeClass(kubrickPodDebiggenClasses[index])})}else{$kubrickRelated.addClass(kubrickRelatedDebiggenClass).removeClass(kubrickRelatedEmbiggenClass);$kubrickRelatedPod.removeClass(kubrickPodEmbiggenClass);$.each(kubrickRelatedAlignEls,function(index,$elements){$elements.addClass(kubrickPodDebiggenClasses[index])})}};ui.setEmbiggen=function(newState){var hasChange=false,self=this,els=self.els,$embiggenContainer=els.$embiggenContainer,$embiggenButton=els.$embiggenButton,$embiggenVidSize=els.$embiggenVidSize,$vidInfo=els.$kubrickInfo,$vidInfoParent=els.$kubrickInfoParent,$videoSpacer=els.$videoSpacer,currentState=$embiggenButton.data(cmdValueDataKey)||false,rewrapperSelector=".container",rewrapperHtml='<div class="container"></div>',nostickyClassName="no-sticky",$vidInfoChildren,$vidInfoRewrapper,embiggenSizeClassName=$embiggenVidSize.data("embiggen-class"),debiggenSizeClassName=$embiggenVidSize.data("debiggen-class");if(currentState!==newState){hasChange=true;if(true===newState){$embiggenVidSize.removeClass(debiggenSizeClassName).addClass(embiggenSizeClassName);$embiggenContainer.addClass("large").removeClass("small medium");if(!!$vidInfo){$vidInfo.children().wrap(rewrapperHtml);$vidInfo.addClass(nostickyClassName);if(!!$videoSpacer){$videoSpacer.after($vidInfo)}}}else{$embiggenVidSize.removeClass(embiggenSizeClassName).addClass(debiggenSizeClassName);$embiggenContainer.addClass("small").removeClass("medium large");if(!!$vidInfo){$vidInfoRewrapper=$vidInfo.find(rewrapperSelector);$vidInfoChildren=$vidInfoRewrapper.children();if($vidInfoRewrapper.length>0){$vidInfoChildren.unwrap()}$vidInfo.removeClass(nostickyClassName);$vidInfoParent.prepend($vidInfo)}}handleKubrickRelated(els,newState);getWindow().trigger("resize");$embiggenButton.data(cmdValueDataKey,newState);self.setStates({embiggened:newState})}return hasChange};ui.toggleEmbiggen=function(){return this.toggleState("embiggen")}})();(function(){var stowControlsEventMousemove="mousemove"+eventNamespace,stowControlsEventMouseleave="mouseleave"+eventNamespace,stowControlsTimeoutId=null,stowControlsDelay=1500,previousClientX=null,previousClientY=null;var hasMousemove=function(event){if(event.clientX===previousClientX&&event.clientY===previousClientY){return false}previousClientX=event.clientX;previousClientY=event.clientY;return true};ui.toggleStowControls=function(stow){var self=this;if(null!==stowControlsTimeoutId){clearTimeout(stowControlsTimeoutId);stowControlsTimeoutId=null}if(self.states.stowControls!==stow){self.setStates({stowControls:stow})}};ui.cancelStowControls=function(){this.toggleStowControls(false)};ui.delayStowControls=function(){var self=this;self.cancelStowControls();stowControlsTimeoutId=setTimeout(function(){self.toggleStowControls(true)},stowControlsDelay)};ui.setStowControls=function(stow){var self=this,$videoPlayerDiv=self.els.$videoPlayerDiv;metisLog(logPrefix+"===== setStowControls: ",stow);self.cancelStowControls();if(true===stow){$videoPlayerDiv.on(stowControlsEventMousemove,function(event){if(hasMousemove(event)){self.delayStowControls()}});$videoPlayerDiv.on(stowControlsEventMouseleave,function(){self.toggleStowControls(true)})}else{self.toggleStowControls(false);previousClientX=null;previousClientY=null;$videoPlayerDiv.off(stowControlsEventMousemove);$videoPlayerDiv.off(stowControlsEventMouseleave)}}})();(function(){var fullscreenClassName="body-fullscreen",windowedClassName="body-fauxscreen",fullscreenEventKeyup="keyup"+eventNamespace,exitFullscreenKeycode=27;ui.isFullscreen=function(){var self=this,states=self.states;return true===states.windowed||true===states.fullscreen};ui.exitFullscreen=function(){var self=this,$d=getDocument();if(self.isFullscreen()){metisLog(logPrefix+"exit full screen");$d.off(fullscreenEventKeyup);self.setStowControls(false);self.setFullscreen(false);self.setWindowed(false)}};ui.enterFullscreen=function(fullscreenType){var self=this,$d=getDocument(),windowedExitHandler=function(e){metisLog(logPrefix+"exit fullscreen callback");if(e.keyCode===exitFullscreenKeycode){self.exitFullscreen()}};if(false===self.isFullscreen()){self.setStowControls(true);switch(fullscreenType){case"fullscreen":self.setFullscreen(true);break;case"windowed":metisLog(logPrefix+"attach esc from fullscreen event listener");$d.on(fullscreenEventKeyup,windowedExitHandler);self.setWindowed(true);break}}};ui.setFullscreen=function(newState){var hasChange=false,self=this,videoPlayer=self.els.$videoPlayerDiv[0],currentState=self.states.fullscreen||false,$root=getDocumentContentRoots(),fullscreenChangeHandler=function(){metisLog(logPrefix+"[FULLSCREEN CHANGE HANDLER]");if(false===screenfull.isFullscreen){metisLog(logPrefix+"screenfull.isFullscreen is false, exit");self.exitFullscreen(false);screenfull.onchange=function(){};metisLog(logPrefix+"[FULLSCREEN EXIT] adjustWidth");self.adjustWidth()}};metisLog(logPrefix+"ui.setFullscreen newState: ",newState);metisLog(logPrefix+"- documentContentRoots: ",$root);if(!screenfull){return self.setWindowed(newState,true)}if(currentState!==newState){hasChange=true;self.setWindowed(false);if(true===newState){screenfull.onchange=fullscreenChangeHandler;screenfull.request(videoPlayer);$root.addClass(fullscreenClassName)}else{$root.removeClass(fullscreenClassName);screenfull.exit()}self.setStates({fullscreen:newState})}return hasChange};ui.setWindowed=function(newState,noResize){var hasChange=false,self=this,currentState=self.states.windowed||false,$root=getDocumentContentRoots();if(currentState!==newState){hasChange=true;if(!!screenfull){self.setFullscreen(false)}if(true===newState){$root.addClass(windowedClassName)}else{$root.removeClass(windowedClassName)}if(!noResize){metisLog(logPrefix+"ui.setWindowed adjustWidth");self.adjustWidth()}self.setStates({windowed:newState})}return hasChange};ui.toggleFullscreen=function(){var self=this;if(true===self.isFullscreen()){self.exitFullscreen()}else{self.enterFullscreen("fullscreen")}};ui.toggleWindowed=function(){var self=this,newState=!self.states.windowed;if(true===newState){self.enterFullscreen("windowed")}else{self.exitFullscreen()}}})();(function(){var volumeSlideEvent="mouseleave.volumeSlide",volumeBarSlideEvent="mousemove.volumeSlide";ui.setVolume=function(volume){var self=this,els=self.els,$volumeHandle=els.$volumeHandle;metisLog(logPrefix+"setVolume: ",volume);metisLog(logPrefix+"states: ",self.states);self.moveVolumeHandle(volume);$volumeHandle.data(cmdValueDataKey,volume);if(0>=volume){self.setMute(true)}else if(true===self.states.mute){metisLog(logPrefix+"setVolume states muted > unmute");self.setMute(false)}self.saveState("volume",volume);self.setStates({volume:volume});playerManager.changePlayerState(self);if(true===self.states.playing){playerManager.setVolume(volume)}};ui.setMute=function(newState){var hasChange=false,self=this,els=self.els,$muteButton=els.$muteButton,$volumeHandle=els.$volumeHandle,currentState=$muteButton.data(cmdValueDataKey)||false,volumeValue=$volumeHandle.data(cmdValueDataKey);if(currentState!==newState){hasChange=true;metisLog(logPrefix+"setMute > hasChange!");if(true===newState){volumeValue=0}else{if(volumeValue===0||volumeValue==="0.00"){metisLog(logPrefix+"setMute > volume is 0, do not unmute");return}}self.moveVolumeHandle(volumeValue);$muteButton.data(cmdValueDataKey,newState);self.setStates({mute:newState});self.saveState("mute",newState);if(true===self.states.playing){if(true===newState){playerManager.mute()}else{playerManager.unmute()}}}return hasChange};ui.toggleMute=function(){metisLog(logPrefix+"toggle mute!");return this.toggleState("mute")};ui.moveVolumeHandle=function(volume){volume=Math.round(volume*100).toString()+"%";this.els.$volumeHandle.css("left",volume)};ui.volumeChange=function(e){var self=this,$volumeBar=self.els.$volumeBar,volume=getEventInContainerRatio(e,$volumeBar);self.setVolume(volume.toFixed(2))};ui.volumeSlideStart=function(){var self=this,els=self.els;els.$volume.on(volumeSlideEvent,function(){self.volumeSlideStop()});els.$volumeBar.on(volumeBarSlideEvent,function(e){self.volumeChange(e)})};ui.volumeSlideStop=function(){var els=this.els;els.$volume.off(volumeSlideEvent);els.$volumeBar.off(volumeBarSlideEvent)}})();(function(){var frontdoorStates=["sticky","embiggen"];var frontdoorStatePrefix="frontdoor",oldFrontdoorStatePrefix="frontDoor";var prependStatePrefix=function(prefix,state){return prefix+state.slice(0,1).toUpperCase()+state.slice(1)};ui.getStateKey=function(state){if(0<=$.inArray(state,frontdoorStates)&&true===isFrontdoor()){state=prependStatePrefix(frontdoorStatePrefix,state)}return state};var checkSavedState=function(stateKey,states){var stateValue=states[stateKey],hasCorrection=false,stickyStateSaveable=false;metisLog(logPrefix+"[CHECK SAVED STATE] "+stateKey+" is "+stateValue);if(undefined!==stateValue&&("sticky"===stateKey||0<stateKey.indexOf("Sticky"))){stickyStateSaveable=playerUiMap_Desktop.$stickyPinButton.cookieType!==undefined;if(!stickyStateSaveable){stateValue=""}}if(0===stateKey.indexOf(oldFrontdoorStatePrefix)){delete states[stateKey];stateKey=stateKey.replace(oldFrontdoorStatePrefix,frontdoorStatePrefix)}if(""===stateValue){delete states[stateKey];stateValue=undefined;hasCorrection=true}else if(!(undefined===stateValue||true===stateValue)){stateValue=true;hasCorrection=true}if(true===hasCorrection&&undefined!==stateValue){states[stateKey]=stateValue}if(hasCorrection){metisLog(logPrefix+"[CORRECTED STATE] "+stateKey+" as "+stateValue)}return hasCorrection};var checkSavedStates=function(states){var hasInvalid=false;metisLog(logPrefix+"[CHECK SAVE STATES] original states: \n"+jsonEncode(states));metisLog(logPrefix+"states to check: ",frontdoorStates);$.each(frontdoorStates,function(i,stateKey){hasInvalid=checkSavedState(stateKey,states)||hasInvalid;hasInvalid=checkSavedState(prependStatePrefix(oldFrontdoorStatePrefix,stateKey),states)||hasInvalid;hasInvalid=checkSavedState(prependStatePrefix(frontdoorStatePrefix,stateKey),states)||hasInvalid});if(states.playback==="html5Progressive"){states.playback="html5";hasInvalid=true}metisLog(logPrefix+"[CHECK SAVE STATES] corrected states: \n"+jsonEncode(states));metisLog(logPrefix+" hasInvalidSavedStates: ",hasInvalid);return hasInvalid};var saveStates=function(stateJSON){var stateJSONString=jsonEncode(stateJSON);metisLog(logPrefix+"Save state cookie value: "+stateJSONString);$.cookie(cookieKeySavedState,stateJSONString,{path:"/",expires:30})};ui.loadSavedState=function(){var self=this,cookie=$.cookie(cookieKeySavedState),stateJSON,playback,playbackSettings,playbackAvailable=null,$playback,quality,qualities,hasInvalidSavedStates;if(cookie){stateJSON=$.parseJSON(cookie)}if(undefined===stateJSON){return}hasInvalidSavedStates=checkSavedStates(stateJSON);if(hasInvalidSavedStates){saveStates(stateJSON);hasInvalidSavedStates=false}playback=stateJSON.playback;if(!!playback){playbackSettings=self.playbacks[playback]||{};playbackAvailable=!!playbackSettings.isAvailable;if(playbackAvailable){qualities=playbackSettings.qualities}}quality=stateJSON.quality;if(undefined===qualities){$playback=getDefaultControl(self.els.$playbackButtons);playback=$playback.data(cmdValueDataKey);playbackSettings=self.playbacks[playback];qualities=playbackSettings.qualities;if(!!stateJSON.playback){if(null===playbackAvailable){hasInvalidSavedStates=true;delete stateJSON.playback}}}if(!!quality&&0>$.inArray(quality,qualities)){hasInvalidSavedStates=true;delete stateJSON.quality}if(hasInvalidSavedStates){saveStates(stateJSON)}self.stateJSON=$.extend({},stateJSON);metisLog(logPrefix+"[LOADED SAVED STATES]:",stateJSON)};ui.saveState=function(state,stateValue){var self=this,stateKey=self.getStateKey(state),stateJSON=self.stateJSON;if(!stateValue){metisLog(logPrefix+"Delete state for: "+stateKey);delete stateJSON[stateKey]}else{stateJSON[stateKey]=stateValue}saveStates(stateJSON)}})();return ui}();var updatePlayer=function(){var logPrefix="[UPDATE PLAYER] ",playerXHR,$playerHolder;var getUpdateSettings=function($playerToUpdate){var requestUrl=window.location.pathname;var xhrSettings={async:true,data:{updatePlayer:1},dataType:"json",cache:true,type:"GET",url:requestUrl,beforeSend:function(){metisLog(logPrefix+"sending request for player update")},success:function(data){metisLog(logPrefix+"Success data: ",data);if(undefined===$playerToUpdate){metisLog(logPrefix+"Unable to find player to update");return}if(undefined===data||undefined===data.html){metisLog(logPrefix+"No player update provided");return}if(undefined===$playerHolder){$playerHolder=$("<div/>")
}var $newPlayer;$playerHolder.html(data.html);$newPlayer=$playerHolder.children();$playerToUpdate.replaceWith($newPlayer);initPlayer.call($newPlayer[0]);playersReady($newPlayer);setUnloadHander($newPlayer)},error:function(){metisLog(logPrefix+"player update request failed")}};metisLog(logPrefix+"updatePlayer settings: ",xhrSettings);return xhrSettings};return function($playerToUpdate){if(undefined===$playerToUpdate){return}if(undefined!==playerXHR){metisLog(logPrefix+"abort previous player update request");playerXHR.abort()}playerXHR=$.ajax(getUpdateSettings($playerToUpdate));metisLog(logPrefix+"request sent: ",playerXHR)}}();var playersReady=function($videoPlayers){getDocument().trigger("videoPlayerReady",[$videoPlayers])};var setUnloadHander=function($videoPlayers){getWindow().on("unload",function(){$videoPlayers.trigger("unloadVideoplayer")})};var initPlayer=function(){var $videoDiv=$(this),playerId=$videoDiv.data("id"),videoJSON,uiType,uiOptions,ui;if(!playerId){return}videoJSON=getMetisVideoJSON($videoDiv);metisLog(videoJSON);if(undefined===videoJSON){metisLog("error","Video JSON missing for: ",$videoDiv);return}if(true===videoJSON.isDevice){uiType=playerUi_Mobile}else{uiType=playerUi_Desktop}uiOptions={playerId:playerId,videoJSON:videoJSON,els:{$videoPlayerDiv:$videoDiv}};ui=$.extend(true,{},uiType);ui.initialize(uiOptions);if(!ui.els.$playerChrome&&ui.els.$countdown){ui.els.$countdown.on("complete",function(){updatePlayer($videoDiv)})}};var initPlayers=function(){var $videoPlayers=$(".js-video-player"),$noPlayerMsg;if(!!$videoPlayers.data("debug")){enableMetisLogging()}metisLog("Initializing metis version: ",metisVideoPlayer.version);flashControlCheck($videoPlayers);h264ControlCheck($videoPlayers);m3u8ControlCheck($videoPlayers);$noPlayerMsg=$videoPlayers.find(".js-vid-invalid-reqs");if(!(true===hasFlashSupport()||true===hasH264Support())){$videoPlayers.addClass(invalidVideoClassName+" has-vid-invalid-reqs");$videoPlayers.find(".js-vid-player-chrome").remove()}else{$videoPlayers.each(initPlayer);$noPlayerMsg.remove();playersReady($videoPlayers)}setUnloadHander($videoPlayers)};var adsInitialized=false;var trackingInitialized=false;var playersInitialized=false;getDocument().on({ads_initialized:function(){adsInitialized=true;if(adsInitialized&&trackingInitialized&&!playersInitialized){initPlayers();playersInitialized=true}},tracking_initialized:function(){trackingInitialized=true;if(adsInitialized&&trackingInitialized&&!playersInitialized){initPlayers();playersInitialized=true}}});getWindow().on("load",function(){if(!playersInitialized){initPlayers();playersInitialized=true}})})(this);
(function(){"use strict";window.PhoenixDatePicker={initializeDatePickers:function(){$(".datepicker-input").each(function(){var $this=$(this);if($this.data("initialized")){return}var initialized=false;var val=$this.val();if(val){initialized=true}$this.datepicker().on("changeDate",function(){$(this).datepicker("hide")}).on("show",function(){if(initialized){return}initialized=true;$this.datepicker("setValue",new Date)});$this.data("initialized",true)});$(".timepicker").each(function(){var $this=$(this);if($this.data("initialized")){return}$this.timepicker({step:15,timeFormat:"H:i"});$this.data("initialized",true)});$(".datetime-now-button").click(function(event){event.preventDefault();var $this=$(this);var datePicker=$this.parent().find(".datepicker-input");var timePicker=$this.parent().find(".timepicker");var now=new Date;var dateStr=getDateStr(now);var timeStr=getTimeStr(now);datePicker.attr("value",dateStr);timePicker.attr("value",timeStr)})}};$(document).ready(function(){PhoenixDatePicker.initializeDatePickers();$(document).ajaxStop(PhoenixDatePicker.initializeDatePickers())});function getDateStr(datetime){var month=datetime.getMonth()+1;var date=datetime.getDate();var year=datetime.getFullYear();if(month.toString().length<2){month="0"+month}if(date.toString().length<2){date="0"+date}return month+"/"+date+"/"+year}function getTimeStr(datetime){var hours=datetime.getHours();var minutes=datetime.getMinutes();if(minutes<10){minutes="0"+minutes}return hours+":"+minutes}})();
$(document).ready(function(){"use strict";var toggleElement=function(element){if(element.attr("data-remove-parent")){element.closest(element.attr("data-remove-parent")).remove();return}var $icons=element.children("i.icon");var toggleValue=element.attr("data-toggle-value");element.attr("data-toggle-value",element.text());element.text(toggleValue);element.prepend($icons);if(element.attr("data-toogle-tooltip")){var tooltip=element.attr("data-tooltip-toggle-value");var title=element.attr("data-tooltip-title");element.attr("data-tooltip-toggle-value",title);element.attr("data-tooltip-title",tooltip);element.data("tooltip").options.title=tooltip;element.attr("data-original-title",tooltip)}};var trackToggle=function(){var eventTrackingDataKey="event-tracking";return function($toggle,response){var eventTrackingParams=$toggle.data(eventTrackingDataKey),eventItemHierarchy;if("string"===typeof eventTrackingParams){eventItemHierarchy=eventTrackingParams;eventTrackingParams=undefined}if(undefined===eventTrackingParams){eventTrackingParams={};if(eventItemHierarchy){eventTrackingParams.event_hierarchy=eventItemHierarchy}if(response.eventTracking){$.extend(eventTrackingParams,response.eventTracking)}if(!$.isEmptyObject(eventTrackingParams)){$toggle.data(eventTrackingDataKey,eventTrackingParams)}}if(undefined!==eventTrackingParams&&!$.isEmptyObject(eventTrackingParams)){$toggle.trigger("followEventTracking")}}}();var setupButtonEvents=function(){$(".btn-toggle").each(function(){var $this=$(this);if($this.data("btn-toggle-initialized")){return}$this.on("click",function(event){if($(this).is("a")===true&&$(this).attr("href")!==""){var $el=$(this);if($el.hasClass("super-action")){$el.siblings(".super-action").toggleClass("active",false);$el.siblings(".sub-action:not('."+$el.attr("rel")+"')").toggleClass("hide",true);$el.toggleClass("active");$el.siblings("."+$el.attr("rel")).toggleClass("hide");return false}else if($el.hasClass("has-input")&&$el.attr("rel").length&&$el.siblings(":input[name='"+$el.attr("rel")+"']").val().length){$el.attr("href",jQuery.param.querystring($el.attr("href"),"reason="+encodeURIComponent($el.siblings(":input[name='"+$el.attr("rel")+"']").val())))}else if($el.parents(".sub-action").find("a:contains('Flagged')").length>0){return false}var verifyStatement=$el.attr("data-verify-statement");if(typeof verifyStatement!="undefined"&&verifyStatement){if(!confirm(verifyStatement)){return false}}AjaxApiRequest.makeApiRequest($(this).attr("href"),null,true,function(success){if(success.hasOwnProperty("redirect")){Phoenix.Ui.showErrorMessage(success.error);window.location.href=success.redirect+"?redirect_url="+document.URL}else{trackToggle($el,success);var message=success.message||"Setting saved.";Phoenix.Ui.showSuccessMessage(message);toggleElement($el)}},function(){Phoenix.Ui.showErrorMessage("Woops! Something happened and we are working on it!")});event.preventDefault()}});$this.data("btn-toggle-initialized",true)})};setupButtonEvents();$(document).ajaxStop(function(){setupButtonEvents()})});
$(document).ready(function(){"use strict";$(".board-selector a").on("click",function(){var $this=$(this);var $currentLi=$this.parent().parent();var $ol=$currentLi.parent();var $otherLi=$ol.find(".board-autocomplete-li");$currentLi.addClass("hide");$currentLi.find(":input").attr("disabled","disabled");if($currentLi.hasClass("board-main-li")){$otherLi.removeClass("hide");$otherLi.find(":input").removeAttr("disabled")}else{$otherLi=$ol.find(".board-main-li");$otherLi.removeClass("hide");$otherLi.find(":input").removeAttr("disabled")}return false})});
$(document).ready(function(){"use strict";$(".btn-ban").on("click",function(){if($(this).is("a")===true&&$(this).attr("href")!==""){var $el=$(this);AjaxApiRequest.makePostApiRequest($el.attr("href"),function(){$el.addClass("active");var $btnGroup=$el.closest(".btn-group");$btnGroup.children(".btn-unban").first().removeClass("hide");$btnGroup.children(".btn-ban-parent").first().addClass("hide");Phoenix.Ui.showSuccessMessage("User banned");$el.parents(".js-avatar-user").first().addClass("banned")},function(){Phoenix.Ui.showErrorMessage("Woops! Something happened and we are working on it!")});return false}});$(".btn-unban").on("click",function(){if($(this).is("a")===true&&$(this).attr("href")!==""){var $el=$(this);AjaxApiRequest.makePostApiRequest($el.attr("href"),function(){$el.addClass("hide");$el.next(".btn-ban-parent").removeClass("hide");Phoenix.Ui.showSuccessMessage("User unbanned");$el.parents(".js-avatar-user").first().removeClass("banned")},function(){Phoenix.Ui.showErrorMessage("Woops! Something happened and we are working on it!")});return false}});$(".js-ban-widget .btn-ban, .js-ban-widget .btn-unban").on("click",function(){var $el=$(this);AjaxApiRequest.makePostApiRequest($el.attr("href"),function(){if($el.hasClass("btn-unban")){Phoenix.Ui.showSuccessMessage("User unbanned")}else{Phoenix.Ui.showSuccessMessage("User banned")}},function(){Phoenix.Ui.showErrorMessage("Woops! Something happened and we are working on it!")});return false});$(".js-ban-time-widget button").on("click",function(event){var val=$.trim($(".js-ban-widget input").val());if(!val){Phoenix.Ui.showErrorMessage("Must enter ban value.")}else{var parts=val.split(" ");var totalTime=0;var error=false;$.each(parts,function(){var timePart=this;if(timePart.length>1){var end=timePart[timePart.length-1];var num=parseInt(timePart.slice(0,timePart.length-1),10);if(isNaN(num)){Phoenix.Ui.showErrorMessage("Format string weird, should be like 1w 2d 3h");error=true;return false}switch(end){case"mo":totalTime=totalTime+num*44640;break;case"w":totalTime=totalTime+num*10080;break;case"d":totalTime=totalTime+num*1440;break;case"h":totalTime=totalTime+num*60;break;case"m":totalTime=totalTime+num*1;break;default:Phoenix.Ui.showErrorMessage("Format string weird, should be like 1w 2d 3h");error=true;return false}}});var self=$(this);if(!error&&totalTime!==0){var href=self.attr("href");href=href.replace("REPLACEME",totalTime);AjaxApiRequest.makePostApiRequest(href,function(){Phoenix.Ui.showSuccessMessage("User banned for "+val)},function(){Phoenix.Ui.showErrorMessage("Woops! Something happened and we are working on it!")})}}event.preventDefault();event.preventPropagation()});$(".btn-nuke").on("click",function(){var confirm=window.confirm("With great power comes great responsibility.  This will ban the user and delete all their messages and topics.  Are you sure you want to nuke this user?");if(confirm){var confirm2=window.confirm("Are you really sure?  Also, this process will take a while (Up to 2 minutes).  Just sit and wait after clicking for the status message bar to appear.");if(!confirm2){return false}}else{return false}if($(this).is("a,button")===true&&$(this).attr("href")!==""){var $el=$(this);AjaxApiRequest.makePostApiRequest($el.attr("href"),function(){$el.addClass("active");var $btnGroup=$el.closest(".btn-group");$btnGroup.children(".btn-unban").first().removeClass("hide");$btnGroup.children(".btn-ban-parent").first().addClass("hide");Phoenix.Ui.showSuccessMessage("User nuked!")},function(){Phoenix.Ui.showErrorMessage("Woops! Something happened and we are working on it!")});return false}})});
$(document).ready(function(){"use strict";var $textAreas=$(".editor > textarea");$(document).on("submit","form",function(){window.onbeforeunload=null});window.onbeforeunload=function(){if($.fn.richTextEditor!==undefined&&$textAreas.richTextEditor("isDirty")){return"You have unsaved content in the text editor. Are you sure you wish to leave?"}}});
$(document).ready(function(){"use strict";var paginationInitialized=false;var havePushed=false;var containerNumber=0;$(document).on("click",".js-simple-paginator a",function(event){event.preventDefault();var warning=$(this).parents(".js-simple-paginator").data("warning");if(warning){$(this).data("warning","");if(!confirm(warning)){return}}var $this=$(this);var container=$this.parents(".js-simple-paginator-container").first();if(container.attr("data-paginator-number")===null){container.attr("data-paginator-number",containerNumber);containerNumber=containerNumber+1}var localContainerNumber=container.attr("data-paginator-number");if(!paginationInitialized&&window.history.pushState){window.history.replaceState({name:"SimplePaginate",url:location.href},"",location.href);paginationInitialized=true}var href=$this.attr("href");paginate($this,href);if(window.history.pushState){window.history.pushState({name:"SimplePaginate",href:href},"",href);havePushed=true}});var paginate=function(paginator,href){var loading=$('<div class="loading"></div>');paginator.parents(".js-simple-paginator-container").children().addClass("hide");paginator.parents(".js-simple-paginator-container").append(loading);AjaxApiRequest.makeGetApiRequest(href,function(data){var $parent=paginator.parents(".js-simple-paginator-container").first();loading.remove();$parent.html(data.html)})};if(window.history.pushState){$(window).on("popstate","",function(event){if(!havePushed){return}var state=event.originalEvent.state;if(state&&state.name==="SimplePaginate"){console.log("popping");console.log('.js-simple-paginator a[href="'+state.url+'"]');console.log(state.url);paginate($('.js-simple-paginator a[href="'+state.url+'"]'),state.url)}})}});
$(document).ready(function(){"use strict";$(document).on("click",".js-slider a.js-slide-button",function(event){event.preventDefault();var $this=$(this);var href=$this.attr("href");var loading=$('<div class="loading"></div>');$this.parents(".js-slider").children().addClass("hide");$this.parents(".js-slider").append(loading);AjaxApiRequest.makeGetApiRequest(href,function(data){var $parent=$this.parents(".js-slider").first();loading.remove();$parent.html(data.html)})})});
$(document).ready(function(){"use strict";var expandableClassName="expandable__show-less";var expandedClassName="expandable__show-more";var expandableSelector=".js-expandable";var expandButtonSelector=".js-expand";var expand=function($expandBtn){$expandBtn.siblings(expandableSelector).removeClass(expandableClassName).addClass(expandedClassName);$expandBtn.addClass("hide")};var checkExpandables=function(){$(expandableSelector).each(function(){var $expandable=$(this),$expandBtn=$expandable.siblings(expandButtonSelector);if(parseInt($expandable.css("height"),10)<parseInt($expandable.css("max-height"),10)){expand($expandBtn)}})};checkExpandables();$(document).on("click",expandButtonSelector,function(event){event.preventDefault();expand($(this))})});
$(document).ready(function(){"use strict";$(document).on("click",".js-unhide-list",function(event){event.preventDefault();var $parent=$(this).parents("ul").first();var $children=$parent.find("li.hide");$children.removeClass("hide");$(this).addClass("hide")});$(document).on("click",".js-replace-list",function(event){event.preventDefault();var $parent=$(this).parents("ul").first();var $children=$parent.find("li:not(.hide)");var $childrenHidden=$parent.find("li.hide");$childrenHidden.removeClass("hide");$children.addClass("hide");$(this).addClass("hide")})});
$(document).ready(function(){"use strict";var body=$("body"),input=$(".search-input");$("#js-btn-mobile-nav").click(function(e){if(body.hasClass("mobile-slide-search")){body.removeClass("mobile-slide-search");body.addClass("mobile-slide-nav")}else if(body.hasClass("mobile-slide")){body.removeClass("mobile-slide");body.removeClass("mobile-slide-nav");body.removeClass("mobile-slide-search")}else if(body.hasClass("mobile-nav-user")){body.removeClass("mobile-nav-user");body.addClass("mobile-slide");body.addClass("mobile-slide-nav")}else{body.addClass("mobile-slide");body.addClass("mobile-slide-nav")}e.preventDefault()});$("#js-btn-mobile-search").click(function(e){if(body.hasClass("mobile-slide-nav")){body.removeClass("mobile-slide-nav");body.addClass("mobile-slide-search");input.focus()}else if(body.hasClass("mobile-slide")){body.removeClass("mobile-slide");body.removeClass("mobile-slide-nav");body.removeClass("mobile-slide-search");input.blur()}else{body.addClass("mobile-slide");body.addClass("mobile-slide-search");input.focus()}e.preventDefault()});$("#js-btn-mobile-user").click(function(e){if(body.hasClass("mobile-slide-nav")){body.removeClass("mobile-slide");body.removeClass("mobile-slide-nav")}body.toggleClass("mobile-nav-user");var userBox=$(".masthead-userBox");userBox.toggleClass("show")});$(".js-dropnav-toggle").click(function(e){$(this).toggleClass("is-active");var ul=$(this).siblings("ul");if(ul.length===0){ul=$(this).siblings().children("ul")}var parent=$(this).parents(".subnav");ul.toggleClass("show");parent.toggleClass("menu-open")});$(".js-sidenav-toggle").click(function(){var $this=$(this);$this.toggleClass("is-active");var ul=$this.siblings("ul");ul.toggleClass("show");ul.find("li a").on("click",function(){ul.removeClass("show");$this.removeClass("is-active")})});$("#nav-main .dropdown-toggle").click(function(){$("html, body").animate({scrollTop:$(this).offset().top},300)});var isIpad=navigator.userAgent.match(/iPad/i)!=null;if(isIpad){$("ul.masthead-userBox li.dropnav",".masthead-container").on("click",function(e){if($(".dropnav-menu",this).is(":visible")){return $(this)}e.preventDefault();$("li","nav.masthead-nav").removeClass("hover");$("ul.masthead-userBox li .dropnav-menu",".masthead-container").hide();$(".dropnav-menu",this).toggle();return false});$("li.dropnav-submenu__item","nav.masthead-nav").on("click",function(){window.location.href=$(this).children("a").attr("href")});$("li:has(ul),li:has(dl)","nav.masthead-nav,nav#nav-main").doubleTapToGo();$(".dropnav",".header-section").doubleTapToGo()}});(function($,window,document,undefined){$.fn.doubleTapToGo=function(params){if(!("ontouchstart"in window)&&!navigator.msMaxTouchPoints&&!navigator.userAgent.toLowerCase().match(/windows phone os 7/i))return false;this.each(function(){var curItem=false;$(this).unbind("mouseover mouseout");$(this).on("click",function(e){e.stopPropagation();e.preventDefault();var item=$(this);var target=$(e.target);$("ul.masthead-userBox li .dropnav-menu",".masthead-container").hide();if(item[0]!=curItem[0]){item.siblings("li").removeClass("dropnav-menu__active");if(item.hasClass("dropnav-menu__item")){item.addClass("dropnav-menu__active")}else{item.siblings("li").removeClass("hover");item.addClass("hover")}curItem=item;return false}else{curItem=false;if(target&&target.attr("href")&&target.attr("href").length){window.location.href=target.attr("href")}else{return target}return false}});$(document).on("click touchstart MSPointerDown",function(e){var resetItem=true,parents=$(e.target).parents();for(var i=0;i<parents.length;i++){if(parents[i]==curItem[0]){resetItem=false}}if(resetItem)curItem=false})});return this}})(jQuery,window,document);
$(document).ready(function(){"use strict";$(".js-ajax-button-loader").on("click",function(event){event.preventDefault();var $this=$(this);var href=$this.data("ajax-href");var loading=$('<div class="loading"></div>');var showHide=$this.data("show-hide-button");if(showHide==="yes"){$this.text("Hide")}else{$this.hide()}$this.parent().append(loading);AjaxApiRequest.makeApiRequest(href,null,false,function(data){var parent=$this.parent();if(showHide==="yes"){$this.show();var $container=$("<div></div>").html(data.html);$container.addClass($this.data("show-hide-container-class"));parent.append($container);$this.text("Hide");var hidden=false;loading.remove();$this.unbind();$this.click(function(event){if(hidden){$container.show();$this.text("Hide");hidden=false}else{$container.hide();$this.text("Show");hidden=true}event.stopPropagation();event.preventDefault()})}else{parent.html(data.html)}})})});
(function(){"use strict";var header=document.querySelector(".masthead"),hasScrolledClassName="has-scrolled",hasScrolledToTop="has-scrolled-top",showScrollDirClassName="js-show-scroll-dir";if(!header){return}var initScrollDirectionCheck=function(){var position;var wasScrollUp=false;var wasScrollDown=false;var upScrollClassName="is-scroll-up";var downScrollClassName="is-scroll-down";var getScrollTop=function(){return window.pageYOffset!==undefined?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop};var toggleHeaderDirection=function(up){var classToAdd,classToRemove;if(up){classToAdd=upScrollClassName;classToRemove=downScrollClassName}else{classToAdd=downScrollClassName;classToRemove=upScrollClassName}classie.add(header,classToAdd);classie.remove(header,classToRemove)};var checkScroll=function(){var scrollTop=getScrollTop(),isScrollUp=wasScrollUp,isScrollDown=wasScrollDown;if(position>scrollTop){isScrollUp=true;isScrollDown=false}else{isScrollUp=false;isScrollDown=true}if(isScrollUp!==wasScrollUp||isScrollDown!==wasScrollDown){toggleHeaderDirection(isScrollUp)}position=scrollTop;wasScrollUp=isScrollUp;wasScrollDown=isScrollDown};return function(){position=getScrollTop();$(window).on("scroll",checkScroll)}}();var initWatcher=function(){var headerWatcher;var scrollHandler=function(){if(headerWatcher.isFullyInViewport){classie.remove(header,hasScrolledClassName)}else{classie.add(header,hasScrolledClassName)}};return function(){var watcher=scrollMonitor.create(header);headerWatcher=watcher;watcher.lock();watcher.partiallyExitViewport(scrollHandler);watcher.fullyEnterViewport(scrollHandler);if(classie.has(header,showScrollDirClassName)){initScrollDirectionCheck()}}}();$(document).ready(initWatcher)})();
var ajax=new XMLHttpRequest;ajax.open("GET","/bundles/phoenixsite/images/core/sprites/icons/svg/icons-sprite-min.svg",true);ajax.send();ajax.onload=function(e){var div=document.createElement("div");div.innerHTML=ajax.responseText;div.setAttribute("id","js-svgDef-icons");div.setAttribute("style","displaY: none");document.body.insertBefore(div,document.body.lastChild.nextSibling)};
$(document).ready(function(){"use strict";var loadingMessages=false;var $notificationLi=$("li.js-notification");var sharedXHR=null;var loadRecentCallback=function(url,unreadSelector,messageContainerSelector,successCallback){return function(){if(loadingMessages){return}var self=this;loadingMessages=true;var $loadingInbox=$(unreadSelector);var $loadingMessage=$loadingInbox.parent().find(".loading");if($loadingMessage.length===0){$loadingMessage=$('<div class="loading"></div>')}$(self).find(messageContainerSelector).remove();$loadingInbox.after($loadingMessage);sharedXHR=$.get(url,function(data,textStatus,jqXHR){if(!data.success){return}var threads=data.messages;$loadingInbox.after(threads);sharedXHR=jqXHR;if(typeof successCallback==="function"){successCallback($(self).find(messageContainerSelector))}}).fail(function(xhr,textStatus,errorThrown){sharedXHR=xhr;loadingMessages=false;if(textStatus==="abort"||xhr.readyState===0){return}Phoenix.Ui.showErrorMessage("There was a problem displaying recent messages, try again later.")}).done(function(data,textStatus,xhr){sharedXHR=xhr;loadingMessages=false;$loadingInbox.parent().find(".loading").remove()})}};$("li.pm").mouseenter(function(event){loadRecentCallback("/pm/unread/",".js-unread-messages",".js-inbox-message").call(this)}).mouseleave(function(){if(sharedXHR&&typeof sharedXHR.abort==="function"){sharedXHR.abort()}});$notificationLi.mouseenter(function(event){$(this).find(".js-notification-show-more").remove();loadRecentCallback("/notifications/unread/",".js-unread-notifications",".js-notification-message",function($threads){$notificationLi.children("a:first .bubble-count").text("0");setTimeout(function(){$threads.each(function(){$(this).removeClass("unread").addClass("read")})},5e3)}).call(this,event)}).mouseleave(function(){if(sharedXHR&&typeof sharedXHR.abort==="function"){sharedXHR.abort()}});var $doc=$(this);var timeoutMS=6e4;var intervalMS=6e5;var interval});
(function($,flash,Plugin){var OBJECT="object",ENCODE=true;function _compareArrayIntegers(a,b){var x=(a[0]||0)-(b[0]||0);return x>0||!x&&a.length>0&&_compareArrayIntegers(a.slice(1),b.slice(1))}function _objectToArguments(obj){if(typeof obj!=OBJECT){return obj}var arr=[],str="";for(var i in obj){if(typeof obj[i]==OBJECT){str=_objectToArguments(obj[i])}else{str=[i,ENCODE?encodeURI(obj[i]):obj[i]].join("=")}arr.push(str)}return arr.join("&")}function _objectFromObject(obj){var arr=[];for(var i in obj){if(obj[i]){arr.push([i,'="',obj[i],'"'].join(""))}}return arr.join(" ")}function _paramsFromObject(obj){var arr=[];for(var i in obj){arr.push(['<param name="',i,'" value="',_objectToArguments(obj[i]),'" />'].join(""))}return arr.join("")}var flashVersion;try{flashVersion=Plugin.description||function(){return new Plugin("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}()}catch(e){flashVersion="Unavailable"}var flashVersionMatchVersionNumbers=flashVersion.match(/\d+/g)||[0];$[flash]={available:flashVersionMatchVersionNumbers[0]>0,activeX:Plugin&&!Plugin.name,version:{original:flashVersion,array:flashVersionMatchVersionNumbers,string:flashVersionMatchVersionNumbers.join("."),major:parseInt(flashVersionMatchVersionNumbers[0],10)||0,minor:parseInt(flashVersionMatchVersionNumbers[1],10)||0,release:parseInt(flashVersionMatchVersionNumbers[2],10)||0},hasVersion:function(version){var versionArray=/string|number/.test(typeof version)?version.toString().split("."):/object/.test(typeof version)?[version.major,version.minor]:version||[0,0];return _compareArrayIntegers(flashVersionMatchVersionNumbers,versionArray)},encodeParams:true,expressInstall:"expressInstall.swf",expressInstallIsActive:false,create:function(obj){var instance=this;if(!obj.swf||instance.expressInstallIsActive||!instance.available&&!obj.hasVersionFail){return false}if(!instance.hasVersion(obj.hasVersion||1)){instance.expressInstallIsActive=true;if(typeof obj.hasVersionFail=="function"){if(!obj.hasVersionFail.apply(obj)){return false}}obj={swf:obj.expressInstall||instance.expressInstall,height:137,width:214,flashvars:{MMredirectURL:location.href,MMplayerType:instance.activeX?"ActiveX":"PlugIn",MMdoctitle:document.title.slice(0,47)+" - Flash Player Installation"}}}attrs={data:obj.swf,type:"application/x-shockwave-flash",id:obj.id||"flash_"+Math.floor(Math.random()*999999999),width:obj.width||320,height:obj.height||180,style:obj.style||""};ENCODE=typeof obj.useEncode!=="undefined"?obj.useEncode:instance.encodeParams;obj.movie=obj.swf;obj.wmode=obj.wmode||"opaque";delete obj.fallback;delete obj.hasVersion;delete obj.hasVersionFail;delete obj.height;delete obj.id;delete obj.swf;delete obj.useEncode;delete obj.width;var flashContainer=document.createElement("div");flashContainer.innerHTML=["<object ",_objectFromObject(attrs),">",_paramsFromObject(obj),"</object>"].join("");return flashContainer.firstChild}};$.fn[flash]=function(options){var $this=this.find(OBJECT).andSelf().filter(OBJECT);if(/string|object/.test(typeof options)){this.each(function(){var $this=$(this),flashObject;options=typeof options==OBJECT?options:{swf:options};options.fallback=this;flashObject=$[flash].create(options);if(flashObject){$this.children().remove();$this.html(flashObject)}})}if(typeof options=="function"){$this.each(function(){var instance=this,jsInteractionTimeoutMs="jsInteractionTimeoutMs";instance[jsInteractionTimeoutMs]=instance[jsInteractionTimeoutMs]||0;if(instance[jsInteractionTimeoutMs]<660){if(instance.clientWidth||instance.clientHeight){options.call(instance)}else{setTimeout(function(){$(instance)[flash](options)},instance[jsInteractionTimeoutMs]+66)}}})}return $this}})(jQuery,"flash",navigator.plugins["Shockwave Flash"]||window.ActiveXObject);
$(document).ready(function(){"use strict";$(document).on("click",".js-table-paginator a",function(event){event.preventDefault();var $this=$(this);var href=$this.attr("href");var $loadingDiv=$('<div class="loading"></div>');var $container=$this.parents(".js-table-pagintor-table");$container.hide();$container.after($loadingDiv);$.ajax({url:href,type:"GET",dataType:"html",success:function(data){$container.html(data);$loadingDiv.remove();$container.show();$("html, body").animate({scrollTop:$container.offset().top},300)},complete:function(){$loadingDiv.remove();$container.show()}})})});
Phoenix.jQuery.getDocument().ready(function(){"use strict";if(!window.history||!window.history.pushState){return}var $window=$(window);var refreshResultsText=["Refreshing results...","Working...","We'll be right back...","Contemplate your navel for a bit while we work this out...","Do your chair exercises while we grab your stuff...","Don't go away! It's coming...","A GameSpot slave is toiling away finding your stuff. Be cool...","You kids and your instant gratification culture! Chill...","Scouring our internets to find your stuff. Hang tight...","You have encountered a level 3 ogre. Play with him for a bit...","Of course the stuff you want is on the server in the basement. Hang on...","Look at you! All getting fancy with sorting! BRB...","Relax, the sorting elves are working...","Hang on while we remember the order of the alphabet...","Why u make us work so hard?","What is this? Burger King&reg;? Are we supposed to do it Your Way&reg;?","I like turtles...","Usermon uses Sort. It was very effective...","Hey! That tickles!","Settle down Beavis..."];var originalUrl=location.href;var paginationInitialized=false;var pushedState;var replaceState=window.replaceState;var refreshText=$('meta[name="js-sort-filter-text"]').attr("content");function triggerPageLoadTracking(eventName,trackingParams){var $doc=Phoenix.getDocument();if(!eventName){eventName="pageLoad"}$doc.trigger("pre_page_event",[eventName,trackingParams]);$doc.trigger("update_page_event",[eventName]);$doc.trigger("on_page_event",[eventName])}function setPushState(url){window.history.pushState({name:"FilterSort",url:url},"",url);pushedState=true}function checkHistoryInitialized(url){if(!paginationInitialized){if(window.history.replaceState&&replaceState){window.history.replaceState({name:"FilterSort",url:url},"",url);paginationInitialized=true;pushedState=true}}}function refreshResults(url){var resultsContainer=$("#js-sort-filter-results");if(!resultsContainer[0]){window.location=url;return}var waitText=refreshResultsText[rand(0,refreshResultsText.length-1)];if(refreshText==="no"){waitText="Refreshing results..."}resultsContainer.html("<div class='loading'>"+waitText+"</div>").load(url+" #js-sort-filter-results > *",function(){setPushState(url);triggerPageLoadTracking()})}function refreshResultsWithOverlay(url){var resultsContainer=$("#js-sort-filter-results");if(!resultsContainer[0]){window.location=url;return}resultsContainer.addClass("loading-overlay").load(url+" #js-sort-filter-results > *",function(){window.history.pushState({name:"FilterSort",url:url},"",url);pushedState=true;resultsContainer.removeClass("loading-overlay");Phoenix.getDocument().trigger("pre_page_event",["pageLoad"]);Phoenix.getDocument().trigger("update_page_event",["pageLoad"]);Phoenix.getDocument().trigger("on_page_event",["pageLoad"])})}$window.on("popstate.FilterSort",function(event){if(!pushedState){return}var state=event.originalEvent.state;if(state&&state.name==="FilterSort"){refreshResults(state.url)}});$("select.js-filter").on("change",function(){if(!paginationInitialized){window.history.pushState({name:"FilterSort",url:originalUrl},"",originalUrl);paginationInitialized=true;pushedState=true}var $this=$(this);var urlMaster=new UrlMaster;var inputs=$this.parent().find("select");$.each(inputs,function(key,val){var value=$(val).val();var param=$(val).attr("data-filter-query");if(value=="0"||value==""){urlMaster.removeParam(param)}else{urlMaster.addParam(param,value)}});var url=urlMaster.generateUrl();refreshResults(url)}).add($("select.js-filter-passive")).each(function(index,value){var $this=$(value);var param=$this.attr("data-filter-query");var queryVal=Phoenix.Request.get(param);if(queryVal){$this.find('option[value="'+decodeURIComponent(queryVal)+'"]').attr("selected","selected")}});$(".js-filter-special").on("click","thead a",function(event){event.preventDefault();event.stopPropagation();if(!paginationInitialized){window.history.pushState({name:"FilterSort",url:originalUrl},"",originalUrl);paginationInitialized=true;pushedState=true}var url=$(this).attr("href");refreshResultsWithOverlay(url)});$(".js-filter-text").each(function(i,e){var $this=$(e);var param=$this.attr("data-filter-query");var queryVal=Phoenix.Request.get(param);if(queryVal){$this.val(decodeURIComponent(queryVal))}});$(".js-filter-activate").click(function(){var $this=$(this);var filterNames=$this.attr("data-filters").split(",");var urlMaster=new UrlMaster;$.each(filterNames,function(i,e){var filter=$("[data-filter-query="+e.trim()+"]");var param=filter.attr("data-filter-query");var value=filter.val();if(value=="0"||value==""){urlMaster.removeParam(param)}else{urlMaster.addParam(param,value)}});var url=urlMaster.generateUrl();refreshResults(url)});$(".js-filter-clear-filters").click(function(){var $this=$(this);var filterNames=$this.attr("data-filters").split(",");var urlMaster=new UrlMaster;$.each(filterNames,function(i,e){var filter=$("[data-filter-query="+e.trim()+"]");var param=filter.attr("data-filter-query");urlMaster.removeParam(param);if(filter.hasClass("js-filter-text")){filter.val("")}else{filter.val(0)}});var url=urlMaster.generateUrl();refreshResults(url)});$(".js-sort").each(function(index,value){var $this=$(value);var sort=Phoenix.Request.get("sort");var direction=Phoenix.Request.get("direction");if(sort&&direction){$this.find('option[data-sort-param="'+sort+'"][data-sort-direction="'+direction+'"]').attr("selected","selected")}}).on("change",function(){checkHistoryInitialized(originalUrl);var $this=$(this);var $selectedElem=$this.children(":selected");var sortParam=$selectedElem.attr("data-sort-param");var directionParam=$selectedElem.attr("data-sort-direction");if(!sortParam||!directionParam){return}var url=$.param.querystring(location.pathname+location.search,"sort="+sortParam+"&direction="+directionParam);refreshResults(url)});$(document).on("click",".js-order-buttons a",function(event){checkHistoryInitialized(originalUrl);event.preventDefault();event.stopPropagation();var $this=$(this);var orderParam=$this.data("orderby");var directionParam=$this.data("direction");if(!orderParam||!directionParam){return}var url=$.param.querystring(location.pathname+location.search,"orderby="+orderParam+"&direction="+directionParam);refreshResults(url)});$(".js-filter").find(".filter-list__label").click(function(){$(this).closest(".filter-list__item").toggleClass("js-active")});function rand(min,max){return Math.floor(Math.random()*(1+max-min))+min}(function(){var jsonFilterSets={};var jsonFilterSetsCount=0;var filterUrlKey="filter-url";var filterCacheKey="filter-cache-key";var filterLoadingClass="is-loading-filter";var filterOnClass="on";var filterSelector=".js-filter-json";var filterOptionsSelector="option, .js-filter-option";var activeOptionSelector=".on, :selected";var checkJsonFilterPopstateHandlerInitialized=function(){var initialized=false;return function(){if(true===initialized){return}initialized=true;$window.on("popstate.JsonFilter",jsonFilterPopstateHandler)}}();var jsonFilterPopstateHandler=function(e){var state=(e.originalEvent||{}).state||{},filterSetKey,filterSet,filterState,filterValue,isSelectElement,$filter,$selected,$options;if(state.name!=="JsonFilter"){return}filterSetKey=state.filterSetKey;filterSet=jsonFilterSets[filterSetKey];filterState=state.filterState;filterValue=filterState.filterValue;$filter=filterSet.$filter;$options=filterSet.$options;isSelectElement=$filter.is("select");if(true===isSelectElement){$selected=$options.filter('[value="'+filterValue+'"]')}else{$selected=$options.filter("[data-filter-value="+filterValue+"]")}filterState.$selected=$selected;$.extend(filterSet,filterState);if(true===isSelectElement){$filter[0].selectedIndex=$selected[0].index}else{$options.filter(activeOptionSelector).removeClass(filterOnClass);$selected.addClass(filterOnClass)}getJsonFilterContent(filterSet)};var jsonFilterRequestErrorHandler=function(filterSet,textStatus){switch(textStatus){case"abort":break;case"timeout":break;default:break}};var jsonFilterRequestSuccessHandler=function(filterSet,data){var $filterResults=filterSet.$results,cacheKey=getJsonFilterCacheKey(filterSet),isFromCache=false,eventName,trackingParams;$filterResults.contents().detach();if(data&&data.$contents){isFromCache=true;$filterResults.append(data.$contents)}else{$filterResults.html(data.html)}$filterResults.data(filterCacheKey,cacheKey);if(!filterSet.noHistory&&filterSet.updateHistory){jsonFilterUpdateHistory(filterSet,getRequestUrl(filterSet,false))}if(filterSet.updateHistory&&($filterResults.hasClass("triggerPageLoadTracking")||$filterResults.data("triggerPageLoadEvent"))){if(data&&data.trackingParams){eventName="pageLoad_"+cacheKey;trackingParams=data.trackingParams}triggerPageLoadTracking(eventName,trackingParams)}if(false===isFromCache){setJsonFilterCache(filterSet)}};var resetjsonRequestHandlers=function(eventHandlers){return eventHandlers.slice(0,1)};var jsonFilterUpdateHistory=function(filterSet,requestUrl){var state;checkHistoryInitialized(originalUrl);state={name:"JsonFilter",filterSetKey:filterSet.key,filterState:{filterKey:filterSet.filterKey,filterValue:filterSet.filterValue,updateHistory:false}};window.history.pushState(state,"",requestUrl)};var getRequestUrl=function(filterSet,addAjaxSuffix){var $filter=filterSet.$filter,$selectedFilter=filterSet.$selected,requestUrl=$selectedFilter.data(filterUrlKey);if(!requestUrl){requestUrl=$filter.data(filterUrlKey)}if(!requestUrl){requestUrl=location.href}if(false!==addAjaxSuffix){requestUrl+=requestUrl.indexOf("?")<0?"?":"&";requestUrl+="ajax"}return requestUrl};var getBaseJsonFilterRequestSettings=function(filterSet){var $filterPod=filterSet.$pod,requestSettings=filterSet.requestSettings;if(requestSettings){return requestSettings}requestSettings={dataType:"json",beforeSend:function(){$filterPod.addClass(filterLoadingClass)},error:[function(jqXHR,textStatus){jsonFilterRequestErrorHandler(filterSet,textStatus)}],success:[function(data){jsonFilterRequestSuccessHandler(filterSet,data);$(document).trigger("ajaxContentLoaded")}]};requestSettings.complete=[function(){$filterPod.removeClass(filterLoadingClass);requestSettings.complete=resetjsonRequestHandlers(requestSettings.complete);requestSettings.error=resetjsonRequestHandlers(requestSettings.error);requestSettings.success=resetjsonRequestHandlers(requestSettings.success)}];filterSet.requestSettings=requestSettings;return requestSettings};var getJsonFilterRequestSettings=function(filterSet){var noFilterData=filterSet.noData,filterKey=filterSet.filterKey,filterValue=filterSet.filterValue,requestData,requestSettings=getBaseJsonFilterRequestSettings(filterSet);requestSettings.url=getRequestUrl(filterSet);if(!noFilterData&&filterKey&&filterValue){requestData={};requestData[filterKey]=filterValue;requestSettings.data=requestData}return requestSettings};var getJsonFilterCacheKey=function(filterSet){return filterSet.filterKey+"_"+filterSet.filterValue};var setJsonFilterCache=function(filterSet,responseData){var $filterResults=filterSet.$results,cache=filterSet.cache,cacheKey=$filterResults.data(filterCacheKey),cacheValue={},previouslyCached;if(!cacheKey){cacheKey=getJsonFilterCacheKey(filterSet);$filterResults.data(filterCacheKey,cacheKey)}previouslyCached=cache[cacheKey];if(responseData){delete responseData.html;cacheValue=responseData}cacheValue.$contents=$filterResults.contents();if(previouslyCached){cache[cacheKey]=$extend(previouslyCached,cacheValue)}else{cache[cacheKey]=cacheValue}return cache};var getFromJsonFilterCache=function(cache,cacheKey){return cache[cacheKey]};var isDifferentFromJsonFilterCache=function(filterSet){var $filterResults=filterSet.$results,$contents=$filterResults.contents(),cacheKey=$filterResults.data(filterCacheKey),cached=getFromJsonFilterCache(filterSet.cache,cacheKey),$cached=cached.$contents;if($cached&&$contents.is($cached)){return false}return true};var getJsonFilterContent=function(filterSet){var cacheKey=getJsonFilterCacheKey(filterSet),requestSettings,$filterRequest=filterSet.$request,cached=getFromJsonFilterCache(filterSet.cache,cacheKey)||{},$cached=cached.$contents;if($filterRequest){$filterRequest.abort();filterSet.$request=null}if($cached){jsonFilterRequestSuccessHandler(filterSet,cached)}else{requestSettings=getJsonFilterRequestSettings(filterSet);filterSet.$request=$.ajax(requestSettings)}};var initJsonFilterSet=function($filter){var $filterPod,$filterResults,$filterOptions,$filterOption,filterSet,filterSetKey,filterData,filterKey,filterValue,pageLoadData;$filterPod=$filter.closest(".js-filter-pod");if($filterPod&&$filterPod.length>0){$filterResults=$filterPod.find(".js-filter-results")}else{$filterPod=false}$filterOptions=$filter.find(filterOptionsSelector);if(!$filterPod||!($filterResults&&$filterResults.length>0)||!($filterOptions&&$filterOptions.length>0)){return false}filterData=$filter.data();$filterOption=$filterOptions.filter(activeOptionSelector);if(!$filterOption||$filterOption.length===0){$filterOption=$filterOptions.first()}filterKey=filterData.filterQuery;filterValue=$filterOption.val()||$filterOption.data("filter-value");filterSetKey=jsonFilterSetsCount+=1;filterSet={$filter:$filter,$options:$filterOptions,$pod:$filterPod,$results:$filterResults,$request:null,$selected:$filterOption,cache:{},key:filterSetKey,filterKey:filterKey,filterValue:filterValue,noData:!!filterData.filterNodata,noHistory:!!filterData.filterNohistory,updateHistory:false};if(!filterSet.noHistory){pageLoadData={pageTitle:$("title").text(),pageDescription:$('meta[name="description"]').attr("content")}}setJsonFilterCache(filterSet,pageLoadData);jsonFilterSets[filterSetKey]=filterSet;return filterSet};var initJsonFilter=function(){var $filter=$(this),$filterOptions,filterSet=initJsonFilterSet($filter);if(!filterSet){return}if(!filterSet.noHistory){checkJsonFilterPopstateHandlerInitialized()}$filterOptions=filterSet.$options;if($filter.is("select")){$filter.on("change",function(){var $option=$filterOptions.filter(activeOptionSelector);if(filterSet.$selected&&$option.is(filterSet.$selected)){return}if(isDifferentFromJsonFilterCache(filterSet)){setJsonFilterCache(filterSet)}filterSet.$selected=$option;filterSet.filterValue=$option.val();filterSet.updateHistory=true;getJsonFilterContent(filterSet)})}else{$filterOptions.on("click",function(event){var $option=$(this),$currentOption=$filterOptions.filter(activeOptionSelector);event.preventDefault();if($option.is($currentOption)){return}if(isDifferentFromJsonFilterCache(filterSet)){setJsonFilterCache(filterSet)}$currentOption.removeClass(filterOnClass);$option.addClass(filterOnClass);filterSet.$selected=$option;filterSet.filterValue=$option.data("filter-value");filterSet.updateHistory=true;getJsonFilterContent(filterSet)})}};var initJsonFilters=function(){var $jsonFilters=$(filterSelector);if($jsonFilters&&$jsonFilters.length>0){$jsonFilters.each(initJsonFilter)}};initJsonFilters()})();(function(){var $filters=$(".js-filter-load-page");if($filters&&$filters.length>0){$filters.each(function(){var $filter=$(this);$filter.on("change",function(){location.href=$(this.options[this.selectedIndex]).data("filterUrl")})})}})()});
(function($){"use strict";var stickyCallbacks={};var defaultOptions={offset:0,zIndex:100,noStop:false,bottom:false,unstickyOnAjax:true,stickyCondition:null,noStopOnBody:false,append:true};var stickyTops=[];$.sticky=function(className,options,onSticky,onUnSticky){var $stickyElement=$(className);$stickyElement.data("stickyEnabled",true);$stickyElement.trigger("stickyEnabled");$.destroySticky=function(className){var $stickyElement=$(className);$(window).off("scroll",stickyCallbacks[className].scroll);$(window).off("resize",stickyCallbacks[className].resize);stickyCallbacks[className]=null;$stickyElement.each(function(){var element=$(this);var positions=getPositions(element);var originalTop=parseInt(positions.originalTop,10);var arrIndex=$.inArray(originalTop,stickyTops);if(arrIndex>=0){stickyTops.splice(arrIndex,1)}unstopElement(element);unstickyElement(element);element.removeAttr("data-original-pos");element.removeAttr("data-original-width");element.data("sticky-stopped",false);element.data("stickied",false)});$stickyElement.data("stickyEnabled",false);$stickyElement.trigger("stickyDisabled")};options=$.extend({},defaultOptions,options);function checkScroll(){var elements=[];if(className instanceof jQuery){elements=className}else{elements=$(className)}if(elements.length<=0){return}elements.each(function(){var element=$(this);if(element.attr("data-sticky-disabled")==="true"){return}var elementHeight=element.outerHeight();var elementWidth=element.outerWidth();var windowHeight=$(window).height();if(elementHeight>=windowHeight||elementHeight===0||elementWidth===0){return}var positions=getPositions(element);var originalTop=parseInt(positions.originalTop,10);var originalLeft=positions.originalLeft;var originalWidth=positions.originalWidth;if($.inArray(originalTop,stickyTops)<0){stickyTops.push(originalTop);stickyTops.sort(function(a,b){return a-b})}if(!isStickied(element)&&$(window).scrollTop()>originalTop){if(options.stickyCondition!==null){if(!options.stickyCondition(element)){return}}stickyElement(element,originalLeft,originalWidth);if(!options.noStop){checkStop(element,originalTop)}}else if(isStickied(element)&&$(window).scrollTop()<=originalTop){checkStop(element,originalTop);unstickyElement(element)}if(!options.noStop&&isStickied(element)){checkStop(element,originalTop)}if(options.bottom!==false&&isStickied(element)){checkBottom(element,options.bottom)}})}function checkResize(){var elements=[];if(className instanceof jQuery){elements=className}else{elements=$(className)}elements.each(function(){var $this=$(this);$this.removeAttr("data-original-pos");$this.removeAttr("data-original-width");if($this.data("sticky-stopped")){unstopElement($this)}if($this.data("stickied")){unstickyElement($this)}$this.data("sticky-stopped",false);$this.data("stickied",false)});stickyTops=[]}$(window).on("scroll",checkScroll);$(window).resize(checkResize);stickyCallbacks[className]={scroll:checkScroll,resize:checkResize};function stickyElement(element,originalLeft,originalWidth){element.css("position","fixed").css("top",options.offset+"px").css("left",originalLeft+"px").css("width",originalWidth+"px").css("margin-top","0px").css("z-index",options.zIndex);if(onSticky){onSticky(element)}element.data("stickied",true);element.trigger("sticky");$(document).ajaxStop(function(){if(options.unstickyOnAjax){if(element.data("sticky-stopped")){unstopElement(element)}if(element.data("stickied")){unstickyElement(element)}}})}function unstickyElement(element){element.css("position","").css("top","").css("left","").css("width","").css("margin-top","").css("z-index","");if(onUnSticky){onUnSticky(element)}element.data("stickied",false);element.trigger("unsticky")}function checkStop(element,originalTop){var myIndex=$.inArray(originalTop,stickyTops);var subset=stickyTops.slice(myIndex+1);var nextTop=subset[0];if(nextTop!==undefined){var myBottom=element.outerHeight()+$(window).scrollTop();var stickyStopped=element.data("sticky-stopped");if(!stickyStopped&&myBottom>=nextTop){stopElement(element,nextTop)}else if(stickyStopped&&myBottom<nextTop){unstopElement(element)}}}function checkBottom(element,bottom){var bottomElement=getBottomElement(element,bottom);var bottomVal=bottomElement.offset().top+bottomElement.outerHeight();if(bottomVal>0){var myBottom=element.outerHeight()+$(window).scrollTop();var stickyStopped=element.data("sticky-stopped");if(!stickyStopped&&myBottom>=bottomVal){stopElement(element,bottomVal)}else if(stickyStopped&&myBottom<bottomVal){unstopElement(element)}}}function getBottomElement(element,bottom){var bottomElement=null;var stoppedParent=element.data("sticky-stopped-parent");if(bottom==="parent"){if(stoppedParent){bottomElement=stoppedParent}else{bottomElement=element.parent()}}else{if(bottom.ancestor!==undefined){if(stoppedParent){bottomElement=stoppedParent.parents(bottom.ancestor).first()}else{bottomElement=element.parents(bottom.ancestor).first()}}else{bottomElement=$(bottom)}}return bottomElement}function stopElement(element,nextTop){var height=element.outerHeight();element.css("position","absolute");element.css("top",nextTop-height+"px");element.data("sticky-stopped",true);if(!options.noStopOnBody){element.data("sticky-stopped-parent",element.parent());$("body").append(element)}}function unstopElement(element){element.css("position","fixed");element.css("top",options.offset+"px");element.data("sticky-stopped",false);var parent=element.data("sticky-stopped-parent");if(parent){if(options.append){parent.append(element)}else{parent.prepend(element)}}element.removeData("sticky-stopped-parent")}function isStickied(element){return element.data("stickied")||false}function getPositions(element){var originalPos=element.attr("data-original-pos");var originalWidth=element.attr("data-original-width");if(!originalPos){savePositions(element);originalPos=element.attr("data-original-pos");originalWidth=element.attr("data-original-width")}return{originalPos:originalPos,originalTop:originalPos.split(";")[0],originalLeft:originalPos.split(";")[1],originalWidth:originalWidth}}function savePositions(element){var marginLeft=Number(element.css("margin-left").replace("px",""));var leftOff=element.offset().left-marginLeft;var originalPos=element.offset().top+";"+leftOff;var originalWidth=element.outerWidth();element.attr("data-original-pos",originalPos);element.attr("data-original-width",originalWidth);$(document).ajaxStop(function(event){element.removeAttr("data-original-pos");element.removeAttr("data-original-width");$(document).unbind(event)})}}})(jQuery);$(window).load(function(){"use strict";$.sticky(".js-sticky-element",{offset:20,noStop:true});$.sticky(".mceEditor .toolbars",{bottom:"parent",noStopOnBody:true},function(element){fillParent(element)},function(element){drainParent(element)});$.sticky(".sticky-nav",{noStopOnBody:true},function(element){fillParent(element)},function(element){drainParent(element)});$.sticky(".sticky-li-row",{unstickyOnAjax:false,bottom:{ancestor:"div"},stickyCondition:function(element){var minRows=5;var parentTbody=element.parents("ul").first();var rows=parentTbody.find("li");var noStickyParent=element.parents("div.js-no-sticky");if(noStickyParent.length>0){return false}if(rows.length<minRows){return false}else{return true}},append:false},function(element){fillParent(element)},function(element){drainParent(element)});var fillParent=function(element,parentSelector){var parentElement=null;if(typeof parentSelector!==undefined){parentElement=element.parents(parentSelector).first()}else{parentElement=element.parent()}var oldPaddingTop=parseInt(parentElement.css("padding-top"),10);element.parent().css("padding-top",element.outerHeight()+oldPaddingTop+"px")};var drainParent=function(element,parentSelector){var parentElement=null;if(typeof parentSelector!==undefined){parentElement=element.parents(parentSelector).first()}else{parentElement=element.parent()}element.parent().css("padding-top","")}});
$(document).ready(function(){"use strict";var $stickyAsideElement=$(".js-sticky-aside").first(),$masthead=$("#masthead,.masthead").first(),hasSticky=!!$stickyAsideElement.length,hasMastheadElement=!!$masthead.length;if(!hasSticky||!hasMastheadElement){return}var $window=$(window),$site=$("#site"),$document=$(this),$primaryContent=$(".js-sticky-watch"),$secondaryContent=$(".js-sticky-hold"),$stickyPreviousSibling=$stickyAsideElement.prev(),$videoSticky=$(".js-video-sticky");if(!$primaryContent||$primaryContent.length===0||!$secondaryContent||$secondaryContent.length===0){return}var stickyClassName="stuck";var dockBottomClassName="bottom";var customResizeEvent="resizeRecirc";var windowStickyTopHandlersEnabled=false;var windowStickyPrevHandlersEnabled=false;var repositionHandlersEnabled=false;var stickyBtmEventNamespace=".recircBottom";var stickyBtmEvents="scroll.recircBottom resizeRecirc.recircBottom";var stickyTopEventNamespace=".recircTop";var stickyTopEvents="scroll.recircTop resizeRecirc.recircTop";var stickyPrevEventNamespace=".recircPrev";var stickyPrevEvents="scroll.recircPrev resizeRecirc.recircPrev";var stickyAdEventNamespace=".recircAdRender";var stickyAdEvents="ad_rendered.recircAdRender";var stickyWatcher=null;var prevSiblingWatcher=null;var hasRecircEventHandlersEnabled=function(){return windowStickyTopHandlersEnabled||windowStickyPrevHandlersEnabled||repositionHandlersEnabled};var setWindowTopHandlers=function(on){if(windowStickyTopHandlersEnabled===on){return}windowStickyTopHandlersEnabled=on;if(true===on){$window.on(stickyTopEvents,checkMasthead)}else{$window.off(stickyTopEventNamespace)}};var setRepositionHandlers=function(on){if(repositionHandlersEnabled===on){return}repositionHandlersEnabled=on;if(true===on){$window.on(stickyBtmEvents,checkStickyPosition);checkStickyPosition()}else{$window.off(stickyBtmEventNamespace)}};var setCollisionDetectionHandlers=function(on){if(!$stickyPreviousSibling||$stickyPreviousSibling.length<=0){return}if(windowStickyPrevHandlersEnabled===on){return}windowStickyPrevHandlersEnabled=on;if(true===on){$window.on(stickyPrevEvents,checkCollision);checkCollision()}else{$window.off(stickyPrevEventNamespace)}};var getIsStickied=function(){return $stickyAsideElement.hasClass(stickyClassName)};var getIsBottomDocked=function(){return $stickyAsideElement.hasClass(dockBottomClassName)};var getMastheadOffsets=function(){var currentOffset=null;return function(){var isFixed="fixed"===$masthead.css("position"),isAbsolute="absolute"===$masthead.css("position"),change=0,hasDirectionChange=false,newOffset,cssTop;if(isFixed||isAbsolute){cssTop=parseInt($masthead.css("top"),10);if(isNaN(cssTop)){cssTop=0}newOffset={top:cssTop+scrollMonitor.viewportTop}}else{newOffset=$masthead.offset()}newOffset.bottom=$masthead.outerHeight()+newOffset.top;if(currentOffset){change=currentOffset.top-newOffset.top;if(change>0&&currentOffset.change<=0||change<0&&currentOffset.change>=0){hasDirectionChange=true}}else{currentOffset=newOffset;change=0}newOffset.change=change;newOffset.hasDirectionChange=hasDirectionChange;currentOffset=newOffset;return newOffset}}();var getStickyOffset=function(){var offset=null,cssTop=0;return function(recalculate){if(null===offset||true===recalculate){if(true===getIsStickied()&&false===getIsBottomDocked()){cssTop=parseInt($stickyAsideElement.css("top"),10);if(true===isNaN(cssTop)){cssTop=0}}offset=$stickyAsideElement.offset();offset.cssTop=cssTop;offset.height=$stickyAsideElement.outerHeight()}return offset}}();var getContentOffset=function(){var offset;return function(recalculate){if(!offset||recalculate){offset=$site.offset()}offset.bottom=offset.top+$site.outerHeight();return offset}}();var getColumnOffsets=function(){var offsets=null,primary,secondary;return function(recalculate){if(null===offsets||true===recalculate){var newPrimary=$primaryContent.offset(),newSecondary=$secondaryContent.offset(),hasChange=true;newPrimary.height=$primaryContent.outerHeight();newSecondary.height=$secondaryContent.outerHeight();if(null!==offsets&&primary.top===newPrimary.top&&secondary.top===newSecondary.top&&primary.height===newPrimary.height&&secondary.height===newSecondary.height){offsets.hasChange=hasChange=false}else{primary=newPrimary;secondary=newSecondary;if(null===offsets){offsets={primary:primary,secondary:secondary,hasChange:hasChange}}else{offsets.primary=primary;offsets.secondary=secondary;offsets.hasChange=hasChange}}}return offsets}}();var getPreviousSiblingOffset=function(){var offset;return function(recalculate){if(!$stickyPreviousSibling||$stickyPreviousSibling.length<=0){return}if(undefined===offset||recalculate){var cachedDisplay=$stickyPreviousSibling.css("display"),cachedVisibility=$stickyPreviousSibling.css("visibility"),cachedStyle=$stickyPreviousSibling.attr("style"),isInvisible="none"===cachedDisplay||"hidden"===cachedVisibility;if(isInvisible){$stickyPreviousSibling.css({display:"block",visibility:"visible"})}offset=$stickyPreviousSibling.offset();offset.bottom=offset.top+$stickyPreviousSibling.outerHeight();if(isInvisible){$stickyPreviousSibling.css({display:"",visibility:""});$stickyPreviousSibling.attr("style",cachedStyle)}}return offset}}();var canSticky=function(){var offsets=getColumnOffsets();if(offsets.primary.top===offsets.secondary.top){return true}return false};var updateStickySize=function(sticky){if(sticky){$stickyAsideElement.css("width",$secondaryContent.width())}else{$stickyAsideElement.css("width","auto")}};var checkStickyPosition=function(event){var isResize=event&&event.type&&event.type.indexOf("resize")>=0||false,mastheadOffsets=getMastheadOffsets(),contentOffset=getContentOffset(isResize),contentBottom=contentOffset.bottom,columnOffsets=getColumnOffsets(),columnTop=columnOffsets.secondary.top,stickyOffset=getStickyOffset(isResize),stickyTop=scrollMonitor.viewportTop+stickyOffset.cssTop,stickyBottom=stickyTop+stickyOffset.height;if(isResize){updateStickySize(getIsStickied())}if(mastheadOffsets.change>0){if(stickyBottom<contentBottom){$stickyAsideElement.removeClass(dockBottomClassName)}if(columnTop>=stickyTop&&mastheadOffsets.bottom<columnTop){toggleSticky(false);$stickyAsideElement.removeClass(dockBottomClassName)}}else{if(stickyBottom>=contentBottom){$stickyAsideElement.addClass(dockBottomClassName)}else if(stickyBottom<contentBottom){$stickyAsideElement.removeClass(dockBottomClassName)}}};var recalculateWatcherLocation=function(){if(null===stickyWatcher){return}var isStickied=getIsStickied();toggleSticky(false);stickyWatcher.unlock();stickyWatcher.recalculateLocation();stickyWatcher.lock();if(isStickied){toggleSticky(true)}};var toggleSticky=function(sticky){updateStickySize(sticky);$stickyAsideElement.toggleClass(stickyClassName,sticky);setRepositionHandlers(sticky);setCollisionDetectionHandlers(sticky)};var checkMasthead=function(){var offsets=getMastheadOffsets(),scrollChange=offsets.change,stickyOffsetTop=stickyWatcher.top+stickyWatcher.offsets.top,isCovered=stickyOffsetTop<offsets.bottom,isStickied=getIsStickied(),isInBufferArea=stickyWatcher.isAboveViewport,isAboveViewport=stickyOffsetTop<=scrollMonitor.viewportTop;setWindowTopHandlers(!isAboveViewport&&isInBufferArea);if(0===scrollChange){toggleSticky(stickyWatcher.isAboveViewport)}else{if(isCovered&&!isStickied){toggleSticky(true)}else if(!isCovered&&isStickied){toggleSticky(false)}}checkCollision()};var checkCollision=function(){if($stickyPreviousSibling&&$stickyPreviousSibling.length>0&&!$stickyPreviousSibling.next().is($stickyAsideElement)){updateStickyPrevSibling()}if(!$stickyPreviousSibling||$stickyPreviousSibling.length<=0){return}var isStickied=getIsStickied(),sibOffset=getPreviousSiblingOffset(),sibBottom=sibOffset.bottom,stickyTop=$stickyAsideElement.offset().top,hasCollided=sibBottom>stickyTop;if(hasCollided&&isStickied){toggleSticky(false)}};var updateStickyPrevSibling=function(){destroyPrevSiblingWatcher();$stickyPreviousSibling=$stickyAsideElement.prev();if(!!$stickyPreviousSibling&&$stickyPreviousSibling.length>0){recalculateWatcherLocation();initPrevSiblingWatcher()}return $stickyPreviousSibling};var initPrevSiblingWatcher=function(){if(prevSiblingWatcher){return}if(!!$stickyPreviousSibling&&$stickyPreviousSibling.length>0){prevSiblingWatcher=scrollMonitor.create($stickyPreviousSibling);prevSiblingWatcher.stateChange(function(){checkCollision()})}else{$stickyPreviousSibling=null}};var destroyPrevSiblingWatcher=function(){if(!prevSiblingWatcher){return}if(!!$stickyPreviousSibling&&$stickyPreviousSibling.length>0){prevSiblingWatcher.destroy();prevSiblingWatcher=null}};var initWatcher=function(){if(null!==stickyWatcher||false===canSticky()){return}var watcherOffsets={top:$masthead.height()};stickyWatcher=scrollMonitor.create($stickyAsideElement,watcherOffsets);stickyWatcher.lock();initPrevSiblingWatcher();stickyWatcher.stateChange(function(){checkMasthead()});if(scrollMonitor.viewportTop>0){checkMasthead()}$document.on(stickyAdEvents,function(){getPreviousSiblingOffset(true);if(hasRecircEventHandlersEnabled()){$window.trigger(customResizeEvent)}})};var destroyWatcher=function(){if(null===stickyWatcher){return}$document.off(stickyAdEventNamespace);toggleSticky(false);setWindowTopHandlers(false);stickyWatcher.destroy();stickyWatcher=null;destroyPrevSiblingWatcher()};var initVideoStickyHandlers=function(){var handlerReference=null;var videoStickyHandler=function(){destroyWatcher()};var setVideoStickyHandler=function(on){if(on&&null===handlerReference){handlerReference=videoStickyHandler;$videoSticky.on("sticky.recircVideoSticky",handlerReference)}else if(!on&&null!==handlerReference){handlerReference=null;$videoSticky.off(".recircVideoSticky")}};return function(){if($videoSticky.data("stickyEnabled")){setVideoStickyHandler(true)}$videoSticky.on({stickyEnabled:function(){setVideoStickyHandler(true)},stickyDisabled:function(){setVideoStickyHandler(false);initWatcher()}})}}();var initSticky=function(){var firedWindowEvents={load:false,livefyreChange:false};var resizeRecircHandler=null;var allowStickyCheck=function(){var allowed=canSticky();if(true===allowed&&null===stickyWatcher){initWatcher()}else if(false===allowed&&null!==stickyWatcher){destroyWatcher();return false}return true};return function(e){getMastheadOffsets();firedWindowEvents[e.type]=true;if($primaryContent.height()>$secondaryContent.height()){if($videoSticky){initVideoStickyHandlers()}if(null===resizeRecircHandler){$window.on("resize.recirc",resizeRecircHandler=function(event){var columnOffsets=getColumnOffsets(true);if(null!==stickyWatcher&&false===firedWindowEvents.load){recalculateWatcherLocation()}if(allowStickyCheck()){if(null!==stickyWatcher&&columnOffsets.hasChange){recalculateWatcherLocation();checkMasthead();checkStickyPosition(event)}getPreviousSiblingOffset(true);if(hasRecircEventHandlersEnabled()){$window.trigger(customResizeEvent)}}else{destroyWatcher()}})}initWatcher();if("livefyreChange"===e.type){$window.trigger("resize")}}}}();$window.on("load livefyreChange",initSticky)});
(function(contextScope){"use strict";var supportsH264=false;if(!!Modernizr&&!!Modernizr.video&&!!Modernizr.video.h264){supportsH264=true}var $doc=$(document),$win=$(window);var clipStoppedKey="stopped";var parentSelectorKey="parent";var parentElementKey="parentElement";var videoClipKey="videoClip";var watcherKey="watcher";var winResize="resize.videoClip";var videoClips=[],$videoClips,preventPlay=false;var stopVideoClip=function(videoClip){var $videoClip=$(videoClip);if(!$videoClip.data(clipStoppedKey)){videoClip.pause();$videoClip.data(clipStoppedKey,true)}};var stopVideoClips=function(){$videoClips.each(function(){stopVideoClip(this)})};var killVideoClips=function(){preventPlay=true;stopVideoClips()};var playVideoClip=function(videoClip){if(true===preventPlay){return}var $videoClip=$(videoClip);if(!!$videoClip.data(clipStoppedKey)){videoClip.play();$videoClip.data(clipStoppedKey,false)}};var getNoVideoClipParent=function($videoClipStub){var $parent=$videoClipStub.data(parentElementKey),$reference,parentSelector;if(undefined===$parent){$reference=$videoClipStub.data(videoClipKey);if(!$reference){$reference=$videoClipStub}parentSelector=$videoClipStub.data(parentSelectorKey);if(!parentSelector){parentSelector="[data-no-video-clip-style]"}$parent=$reference.closest(parentSelector);if(0===$parent.length){$parent=null}$videoClipStub.data(parentElementKey,$parent)}return $parent};var toggleNoVideoClipStyles=function($videoClipStub,removeNoVideoClipStyles){var $parent=getNoVideoClipParent($videoClipStub),style;if(!!$parent){if(removeNoVideoClipStyles){$parent.removeAttr("style")}else{style=$parent.data("no-video-clip-style");if(!!style&&style!==$parent.attr("style")){$parent.attr("style",style)}}}};var checkDisplayChange=function($videoClip,$videoClipStub){var watcher=$videoClipStub.data(watcherKey);if("hidden"===$videoClip.css("visibility")){toggleNoVideoClipStyles($videoClipStub);stopVideoClip($videoClip[0])}else{toggleNoVideoClipStyles($videoClipStub,true);if(watcher.isInViewport){playVideoClip($videoClip[0])}}};var createVideoClip=function($videoClipStub){var videoClip,$videoClip,videoSrc=$videoClipStub.attr("content"),videoAttributes=$videoClipStub.data(),watcher;try{videoAttributes["src"]=videoSrc;$videoClip=$("<video/>",videoAttributes);$videoClipStub.replaceWith($videoClip);$videoClipStub.data(videoClipKey,$videoClip)}catch(e){$videoClip=undefined;toggleNoVideoClipStyles($videoClipStub)}if(!!$videoClip){videoClip=$videoClip[0];videoClips.push(videoClip);watcher=scrollMonitor.create(videoClip);watcher.enterViewport(function(){playVideoClip(videoClip)});watcher.exitViewport(function(){stopVideoClip(videoClip)});$videoClipStub.data(watcherKey,watcher);checkDisplayChange($videoClip,$videoClipStub);$win.on(winResize,function(){checkDisplayChange($videoClip,$videoClipStub)})}};var initVideoClip=function(){var $videoClipStub=$(this);if(true===supportsH264){createVideoClip($videoClipStub)}else{toggleNoVideoClipStyles($videoClipStub)}};var initVideoClips=function(){var $videoClipStubs=$("meta.js-video-clip");$videoClipStubs.each(initVideoClip);$videoClips=$(videoClips);$doc.on("video_play",killVideoClips)};$doc.ready(initVideoClips)})(this);
!function(){"use strict";var a,b=function(){var a=/\-([a-z])/g,b=function(a,b){return b.toUpperCase()};return function(c){return c.replace(a,b)}}(),c=function(a,c){var d,e,f,g,h,i;if(window.getComputedStyle?d=window.getComputedStyle(a,null).getPropertyValue(c):(e=b(c),d=a.currentStyle?a.currentStyle[e]:a.style[e]),"cursor"===c&&(!d||"auto"===d))for(f=a.tagName.toLowerCase(),g=["a"],h=0,i=g.length;i>h;h++)if(f===g[h])return"pointer";return d},d=function(a){if(p.prototype._singleton){a||(a=window.event);var b;this!==window?b=this:a.target?b=a.target:a.srcElement&&(b=a.srcElement),p.prototype._singleton.setCurrent(b)}},e=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)},f=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)},g=function(a,b){if(a.addClass)return a.addClass(b),a;if(b&&"string"==typeof b){var c=(b||"").split(/\s+/);if(1===a.nodeType)if(a.className){for(var d=" "+a.className+" ",e=a.className,f=0,g=c.length;g>f;f++)d.indexOf(" "+c[f]+" ")<0&&(e+=" "+c[f]);a.className=e.replace(/^\s+|\s+$/g,"")}else a.className=b}return a},h=function(a,b){if(a.removeClass)return a.removeClass(b),a;if(b&&"string"==typeof b||void 0===b){var c=(b||"").split(/\s+/);if(1===a.nodeType&&a.className)if(b){for(var d=(" "+a.className+" ").replace(/[\n\t]/g," "),e=0,f=c.length;f>e;e++)d=d.replace(" "+c[e]+" "," ");a.className=d.replace(/^\s+|\s+$/g,"")}else a.className=""}return a},i=function(){var a,b,c,d=1;return"function"==typeof document.body.getBoundingClientRect&&(a=document.body.getBoundingClientRect(),b=a.right-a.left,c=document.body.offsetWidth,d=Math.round(100*(b/c))/100),d},j=function(a){var b={left:0,top:0,width:0,height:0,zIndex:999999999},d=c(a,"z-index");if(d&&"auto"!==d&&(b.zIndex=parseInt(d,10)),a.getBoundingClientRect){var e,f,g,h=a.getBoundingClientRect();"pageXOffset"in window&&"pageYOffset"in window?(e=window.pageXOffset,f=window.pageYOffset):(g=i(),e=Math.round(document.documentElement.scrollLeft/g),f=Math.round(document.documentElement.scrollTop/g));var j=document.documentElement.clientLeft||0,k=document.documentElement.clientTop||0;b.left=h.left+e-j,b.top=h.top+f-k,b.width="width"in h?h.width:h.right-h.left,b.height="height"in h?h.height:h.bottom-h.top}return b},k=function(a,b){var c=!(b&&b.useNoCache===!1);return c?(-1===a.indexOf("?")?"?":"&")+"nocache="+(new Date).getTime():""},l=function(a){var b=[],c=[];return a.trustedOrigins&&("string"==typeof a.trustedOrigins?c.push(a.trustedOrigins):"object"==typeof a.trustedOrigins&&"length"in a.trustedOrigins&&(c=c.concat(a.trustedOrigins))),a.trustedDomains&&("string"==typeof a.trustedDomains?c.push(a.trustedDomains):"object"==typeof a.trustedDomains&&"length"in a.trustedDomains&&(c=c.concat(a.trustedDomains))),c.length&&b.push("trustedOrigins="+encodeURIComponent(c.join(","))),"string"==typeof a.amdModuleId&&a.amdModuleId&&b.push("amdModuleId="+encodeURIComponent(a.amdModuleId)),"string"==typeof a.cjsModuleId&&a.cjsModuleId&&b.push("cjsModuleId="+encodeURIComponent(a.cjsModuleId)),b.join("&")},m=function(a,b){if(b.indexOf)return b.indexOf(a);for(var c=0,d=b.length;d>c;c++)if(b[c]===a)return c;return-1},n=function(a){if("string"==typeof a)throw new TypeError("ZeroClipboard doesn't accept query strings.");return a.length?a:[a]},o=function(a,b,c,d,e){e?window.setTimeout(function(){a.call(b,c,d)},0):a.call(b,c,d)},p=function(a,b){if(a&&(p.prototype._singleton||this).glue(a),p.prototype._singleton)return p.prototype._singleton;p.prototype._singleton=this,this.options={};for(var c in s)this.options[c]=s[c];for(var d in b)this.options[d]=b[d];this.handlers={},p.detectFlashSupport()&&v()},q=[];p.prototype.setCurrent=function(b){a=b,this.reposition();var d=b.getAttribute("title");d&&this.setTitle(d);var e=this.options.forceHandCursor===!0||"pointer"===c(b,"cursor");return r.call(this,e),this},p.prototype.setText=function(a){return a&&""!==a&&(this.options.text=a,this.ready()&&this.flashBridge.setText(a)),this},p.prototype.setTitle=function(a){return a&&""!==a&&this.htmlBridge.setAttribute("title",a),this},p.prototype.setSize=function(a,b){return this.ready()&&this.flashBridge.setSize(a,b),this},p.prototype.setHandCursor=function(a){return a="boolean"==typeof a?a:!!a,r.call(this,a),this.options.forceHandCursor=a,this};var r=function(a){this.ready()&&this.flashBridge.setHandCursor(a)};p.version="1.2.1";var s={moviePath:"ZeroClipboard.swf",trustedOrigins:null,text:null,hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",allowScriptAccess:"sameDomain",useNoCache:!0,forceHandCursor:!1};p.setDefaults=function(a){for(var b in a)s[b]=a[b]},p.destroy=function(){p.prototype._singleton.unglue(q);var a=p.prototype._singleton.htmlBridge;a.parentNode.removeChild(a),delete p.prototype._singleton},p.detectFlashSupport=function(){var a=!1;if("function"==typeof ActiveXObject)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(a=!0)}catch(b){}return!a&&navigator.mimeTypes["application/x-shockwave-flash"]&&(a=!0),a};var t=null,u=null,v=function(){var a=p.prototype._singleton,b=document.getElementById("global-zeroclipboard-html-bridge");if(!b){var c={};for(var d in a.options)c[d]=a.options[d];c.amdModuleId=t,c.cjsModuleId=u;var e=l(c),f='      <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="global-zeroclipboard-flash-bridge" width="100%" height="100%">         <param name="movie" value="'+a.options.moviePath+k(a.options.moviePath,a.options)+'"/>         <param name="allowScriptAccess" value="'+a.options.allowScriptAccess+'"/>         <param name="scale" value="exactfit"/>         <param name="loop" value="false"/>         <param name="menu" value="false"/>         <param name="quality" value="best" />         <param name="bgcolor" value="#ffffff"/>         <param name="wmode" value="transparent"/>         <param name="flashvars" value="'+e+'"/>         <embed src="'+a.options.moviePath+k(a.options.moviePath,a.options)+'"           loop="false" menu="false"           quality="best" bgcolor="#ffffff"           width="100%" height="100%"           name="global-zeroclipboard-flash-bridge"           allowScriptAccess="always"           allowFullScreen="false"           type="application/x-shockwave-flash"           wmode="transparent"           pluginspage="http://www.macromedia.com/go/getflashplayer"           flashvars="'+e+'"           scale="exactfit">         </embed>       </object>';b=document.createElement("div"),b.id="global-zeroclipboard-html-bridge",b.setAttribute("class","global-zeroclipboard-container"),b.setAttribute("data-clipboard-ready",!1),b.style.position="absolute",b.style.left="-9999px",b.style.top="-9999px",b.style.width="15px",b.style.height="15px",b.style.zIndex="9999",b.innerHTML=f,document.body.appendChild(b)}a.htmlBridge=b,a.flashBridge=document["global-zeroclipboard-flash-bridge"]||b.children[0].lastElementChild};p.prototype.resetBridge=function(){return this.htmlBridge.style.left="-9999px",this.htmlBridge.style.top="-9999px",this.htmlBridge.removeAttribute("title"),this.htmlBridge.removeAttribute("data-clipboard-text"),h(a,this.options.activeClass),a=null,this.options.text=null,this},p.prototype.ready=function(){var a=this.htmlBridge.getAttribute("data-clipboard-ready");return"true"===a||a===!0},p.prototype.reposition=function(){if(!a)return!1;var b=j(a);return this.htmlBridge.style.top=b.top+"px",this.htmlBridge.style.left=b.left+"px",this.htmlBridge.style.width=b.width+"px",this.htmlBridge.style.height=b.height+"px",this.htmlBridge.style.zIndex=b.zIndex+1,this.setSize(b.width,b.height),this},p.dispatch=function(a,b){p.prototype._singleton.receiveEvent(a,b)},p.prototype.on=function(a,b){for(var c=a.toString().split(/\s/g),d=0;d<c.length;d++)a=c[d].toLowerCase().replace(/^on/,""),this.handlers[a]||(this.handlers[a]=b);return this.handlers.noflash&&!p.detectFlashSupport()&&this.receiveEvent("onNoFlash",null),this},p.prototype.addEventListener=p.prototype.on,p.prototype.off=function(a,b){for(var c=a.toString().split(/\s/g),d=0;d<c.length;d++){a=c[d].toLowerCase().replace(/^on/,"");for(var e in this.handlers)e===a&&this.handlers[e]===b&&delete this.handlers[e]}return this},p.prototype.removeEventListener=p.prototype.off,p.prototype.receiveEvent=function(b,c){b=b.toString().toLowerCase().replace(/^on/,"");var d=a,e=!0;switch(b){case"load":if(c&&parseFloat(c.flashVersion.replace(",",".").replace(/[^0-9\.]/gi,""))<10)return this.receiveEvent("onWrongFlash",{flashVersion:c.flashVersion}),void 0;this.htmlBridge.setAttribute("data-clipboard-ready",!0);break;case"mouseover":g(d,this.options.hoverClass);break;case"mouseout":h(d,this.options.hoverClass),this.resetBridge();break;case"mousedown":g(d,this.options.activeClass);break;case"mouseup":h(d,this.options.activeClass);break;case"datarequested":var f=d.getAttribute("data-clipboard-target"),i=f?document.getElementById(f):null;if(i){var j=i.value||i.textContent||i.innerText;j&&this.setText(j)}else{var k=d.getAttribute("data-clipboard-text");k&&this.setText(k)}e=!1;break;case"complete":this.options.text=null}if(this.handlers[b]){var l=this.handlers[b];"string"==typeof l&&"function"==typeof window[l]&&(l=window[l]),"function"==typeof l&&o(l,d,this,c,e)}},p.prototype.glue=function(a){a=n(a);for(var b=0;b<a.length;b++)-1==m(a[b],q)&&(q.push(a[b]),e(a[b],"mouseover",d));return this},p.prototype.unglue=function(a){a=n(a);for(var b=0;b<a.length;b++){f(a[b],"mouseover",d);var c=m(a[b],q);-1!=c&&q.splice(c,1)}return this},"function"==typeof define&&define.amd?define(["require","exports","module"],function(a,b,c){return t=c&&c.id||null,p}):"object"==typeof module&&module&&"object"==typeof module.exports&&module.exports?(u=module.id||null,module.exports=p):window.ZeroClipboard=p}();
(function(contextScope){"use strict";var clipboardSetSelector=".js-clipboard-set";var clipboardButtonSelector=".js-clipboard-btn";var clipboardTargetSelector=".js-clipboard-target";var clipboardCopiedClass="is-clipboard-copied";var clipboardTargetCount=0;var defaultClipboardCopiedDelay=2e3;var dataClipboardCopiedDelay="clipboard-copied-delay";var dataClipboardCopiedMsg="clipboard-copied-msg";var initClipboardSets=function(){var $clipboardSets=$(clipboardSetSelector);$clipboardSets.each(function(){var $set=$(this),$target=$set.find(clipboardTargetSelector).first(),$button=$set.find(clipboardButtonSelector).first(),targetId;if(0===$target.length||0===$button.length){return}targetId=$target.attr("id");if(!targetId){clipboardTargetCount+=1;targetId="js-clipboard-target-"+clipboardTargetCount;$target.attr("id",targetId)}$button.attr("data-clipboard-target",targetId)})};var onClipboardCompleteCallback=function(){var $clipboardButton=$(this),clipboardCopiedDelay=$clipboardButton.data(dataClipboardCopiedDelay)||defaultClipboardCopiedDelay,clipboardCopiedMsg=$clipboardButton.data(dataClipboardCopiedMsg),timeoutId=$clipboardButton.data("copiedTimeoutId");if(!!clipboardCopiedMsg){Phoenix.Ui.showSuccessMessage(clipboardCopiedMsg)}if(!!timeoutId){clearTimeout(timeoutId);$clipboardButton.data("copiedTimeoutId",false)}$clipboardButton.addClass(clipboardCopiedClass);timeoutId=setTimeout(function(){$clipboardButton.removeClass(clipboardCopiedClass);$clipboardButton.data("copiedTimeoutId",false)},clipboardCopiedDelay);$clipboardButton.data("copiedTimeoutId",timeoutId)};var initClipboard=function(){var $clipboardButtons=$(clipboardButtonSelector),ClipboardClient=contextScope.ZeroClipboard,clipboardSwf=$("meta#ZeroClipBoardSwf").attr("content"),hasClipboardClient="function"===typeof ClipboardClient,clipboard,windowLocation=window.location;if(!hasClipboardClient||!clipboardSwf||0===$clipboardButtons.length){if(0<$clipboardButtons.length){$clipboardButtons.remove()}return}initClipboardSets();ClipboardClient.setDefaults({allowScriptAccess:"always",moviePath:clipboardSwf,trustedOrigins:[windowLocation.protocol+"//"+windowLocation.host]});clipboard=new ClipboardClient($clipboardButtons);clipboard.on("complete",onClipboardCompleteCallback)};$(window).on("load",initClipboard)})(this);
(function(context,$){"use strict";var page=window.location.pathname;function highlightMenus(){var mainMenu=$("#nav-main");var subMenus=$(".js-highlightable-sub-nav");highlightTab(mainMenu,true,true);subMenus.each(function(index,value){highlightTab($(this),true)})}function highlightTab(menu,fuzzyMatch,noDefault){var tabs=menu.find("li");var tab=null;var first=tabs.first();if(!noDefault){tab=first}tabs.each(function(index,value){var current=$(this).children("a").attr("href");if(current=="#"){current=$(this).children("a").next().attr("href")}if(typeof current!=="undefined"&&(fuzzyMatch||current.length===page.length)&&page.indexOf(current)===0){tab=$(this)}else if(typeof current==="undefined"&&tab!==null&&page.length!==tab.children("a").attr("href").length&&page.length!==first.children("a").attr("href").length&&tab.children("a").attr("href").length==first.children("a").attr("href").length){$(this).find("dd").each(function(index,value){current=$(this).children("a").attr("href");if(typeof current!=="undefined"&&fuzzyMatch||current.length===page.length&&page.indexOf(current)===0){tab=$(this).closest("li")}})}});if(tab){tab.addClass("active")}}var handleHover=function(){var menus=$(".js-dropnav-active");if(typeof $.fn.menuAim==="undefined"){return false}$.each(menus,function(){var menu=$(this);if(menu.data("hover-init")){return}var direction="right";if(menu.attr("data-direction")){direction=menu.attr("data-direction")}menu.menuAim({activate:function(row){$(row).addClass("dropnav-menu__active")},deactivate:function(row){$(row).removeClass("dropnav-menu__active")},submenuDirection:direction});menu.data("hover-init",true)})};$(document).ready(function(){highlightMenus();handleHover()});$(document).ajaxComplete(function(){handleHover()})})(this,jQuery);
$(document).ready(function(){"use strict";var shareButtonFacebook=$(".js-share-button-facebook");var shareButtonTwitter=$(".js-share-button-twitter");var shareButtonReddit=$(".js-share-button-reddit");var facebookAPI="https://graph.facebook.com/fql?q=SELECT%20url,%20normalized_url,%20share_count,%20like_count,%20comment_count,%20total_count,commentsbox_count,%20comments_fbid,%20click_count%20FROM%20link_stat%20WHERE%20url=";var twitterAPI="http://urls.api.twitter.com/1/urls/count.json?url=";var shareCountSelector=".js-share-count";if(shareButtonTwitter.length>0){var shareUrl=shareButtonTwitter.attr("data-share-url");$.ajax({url:twitterAPI+shareUrl,dataType:"jsonp",success:function(data){if(!data){return}var count=data.count;shareButtonTwitter.find(shareCountSelector).text(count);shareButtonTwitter.find(shareCountSelector).parent().removeClass("hide")}})}if(shareButtonFacebook.length>0){var shareUrl=shareButtonFacebook.attr("data-share-url");$.get(facebookAPI+"'"+shareUrl+"'",function(data){if(!data){return}var count=data.data[0].total_count;shareButtonFacebook.find(shareCountSelector).text(count);shareButtonFacebook.find(shareCountSelector).parent().removeClass("hide")})}if(shareButtonReddit.length>0){var shareUrl=shareButtonFacebook.attr("data-share-url");var baseUrl="http://www.reddit.com/static";var redditIframe='<iframe src="http://www.reddit.com/static/button/button1.html?width=120&amp;url='+encodeURIComponent(shareUrl)+'" height="22" width="120" scrolling="no" frameborder="0"></iframe>';shareButtonReddit.html(redditIframe)}});
$(document).ready(function(){"use strict";var showLoader=$(".js-show-loader");var showLoaderShowsSelector=".js-show-loader-shows";var showLoaderVideo=showLoader.find(".js-show-loader-video");var showLoaderInfo=showLoader.find(".js-show-loader-info");var apiUrl="/api/show/{slug}/latest";showLoader.on("click",showLoaderShowsSelector+" li",function(event){event.preventDefault();var listItem=$(this);if(listItem.hasClass("is-today")){return false}listItem.siblings().removeClass("is-today");listItem.addClass("is-today");var day=listItem.attr("data-day");var slug=listItem.attr("data-slug");showLoaderVideo.fadeOut("slow");showLoaderInfo.children().fadeOut("slow",function(){AjaxApiRequest.makeGetApiRequest(apiUrl.replace("{slug}",slug),function(data){if(day!=="Today"){showLoaderInfo.find(".js-show-loader-last").removeClass("hide")}else{showLoaderInfo.find(".js-show-loader-last").addClass("hide")}showLoaderInfo.find(".js-show-loader-day").text(day+"'s");showLoaderInfo.find(".js-show-loader-title").text(data.title);showLoaderInfo.find(".js-show-loader-title").attr("href",data.url);showLoaderInfo.find(".js-show-loader-comments").text(data.commentCount).parent("a").attr("href",data.url);showLoaderVideo.find(".av-wrapper").css("background-image","");showLoaderVideo.find(".av-wrapper").html(data.html);showLoaderVideo.fadeIn("slow");showLoaderInfo.children().fadeIn("slow")})})});$(".js-show-loader-initial").on("click",function(){var iframe=$(this).attr("data-video-url");$(this).parent().css("background-image","");$(this).parent().html(iframe)})});
$(document).ready(function(){"use strict";var $el=$(".js-carousel"),hasCarousel=!!$el.length;if(!hasCarousel){return}var carouselEle=null;var bullets=$(".js-carousel-pos li");var device=$('meta[itemprop="deviceType"]').attr("content");var initCarousel=function(carousel){carouselEle=Swipe(carousel.get(0),{callback:function(pos){var i=bullets.length;while(i--){console.log(bullets.eq(i));if(bullets.eq(i).hasClass("on")){bullets.eq(i).removeClass("on")}}bullets.eq(pos).addClass("on")}});var pageLength=$(".carousel .item-list").attr("data-page-length");carousel.removeClass("loading");carousel.children().removeClass("hide");bullets.first().addClass("on");carousel.parents("section").first().on("click",".js-carousel-left",function(){carouselEle.prev()});carousel.parents("section").first().on("click",".js-carousel-right",function(){carouselEle.next()});$(".carousel .item-list__item").css("width",100/pageLength+"%");if(device!="phone"){$(".carousel-control").hover(function(){$(".js-carousel").toggleClass("carousel-hover")});$(".carousel .item-list__item").hover(function(){$(".carousel-control").toggleClass("carousel-item-hover")})}};$el.each(function(){initCarousel($(this))})});
(function(){"use strict";window.PhoenixUtils={getHtmlTemplate:function(name){var templateElement=$('script[type="text/template/'+name+'"]');if(!templateElement.length){return""}return templateElement.html().trim()},cloneObject:function(object){try{return JSON.parse(JSON.stringify(object))}catch(e){return null}},fromJson:function(json){try{return JSON.parse(json)}catch(e){return null}},toJson:function(object){try{return JSON.stringify(object)}catch(e){return null}},capitalizeString:function(str){return str.charAt(0).toUpperCase()+str.slice(1)},getBrowser:function(){if(typeof navigator.userAgent=="undefined"){return"unknown"}if(navigator.userAgent.search("Chrome")!=-1){return"chrome"}if(navigator.userAgent.search("Firefox")!=-1){return"firefox"}if(navigator.userAgent.search("Safari")!=-1){return"safari"}if(navigator.userAgent.search("MSIE")!=-1){return"ie"}return"unknown"},getIEVersion:function(){return parseFloat(navigator.appVersion.split("MSIE")[1])},getOS:function(){var appVersion=navigator.appVersion;if(appVersion.indexOf("Windows")!=-1){var winNTOffset=appVersion.indexOf("Windows NT");if(winNTOffset==-1){return"Windows9x"}var version=appVersion.substr(winNTOffset+11,3);if(version=="6.2"){return"Windows8"}if(version=="6.1"){return"Windows7"}if(version=="6.0"){return"WindowsVista"}if(version=="5.1"){return"WindowsXP"}if(version=="5.0"){return"Windows2K"}return"WindowsNT"}if(appVersion.indexOf("iPad")!=-1){return"iOS-iPad"}if(appVersion.indexOf("iPhone")!=-1){return"iOS-iPhone"}if(appVersion.indexOf("iPod")!=-1){return"iOS-iPod"}if(appVersion.indexOf("Android")!=-1){return"Android"}if(appVersion.indexOf("Mac")!=-1){return"MacOS"}if(appVersion.indexOf("X11")!=-1){return"UNIX"}if(appVersion.indexOf("Linux")!=-1){return"Linux"}return"Unknown"},eoo:null}})();
$(document).ready(function(){"use strict";var $scheduleVertical=$(".js-schedule--vertical"),hasScheduleVertical=!!$scheduleVertical.length;if(!hasScheduleVertical){return}var $window=$(window),$doc=$(document),scheduleTime=$(".js-schedule-time"),scheduleEvent=$(".js-schedule-event"),scheduleTabs=$(".js-schedule-tabs"),scheduleDay=$(".js-schedule-day"),scheduleCurrentTime=$(".js-current-time");var checkTimeSlots=function(){scheduleTime.each(function(){var timeData=$(this);scheduleEvent.each(function(){if(timeData.attr("data-attr-time")===$(this).attr("data-attr-time-start")){var timeDataPositionStart=timeData.position();$(this).css("top",timeDataPositionStart.top)}})})};var displayEvent=function(){scheduleTabs.find("li").each(function(i,data){$(this).on("click",function(e){var day=$(this).attr("data-attr-day"),dateOutput=$(".js-schedule-date"),tabs=$(this).siblings("li");if(tabs.hasClass("active")){tabs.removeClass("active");$(this).addClass("active")}if(dateOutput){var dateOutputDay=dateOutput.find("em");dateOutputDay.html($(this).attr("data-attr-date"))}toggleEventDisplay(day);e.preventDefault()});if($(this).hasClass("active")){toggleEventDisplay($(this).attr("data-attr-day"))}})};var toggleEventDisplay=function(el){var _this=el,eventDay=null;scheduleEvent.each(function(i,data){scheduleEvent.not($(this).addClass("hidden"));$(this).each(function(){if(_this===$(this).attr("data-attr-day")){if($(this).hasClass("hidden")){$(this).removeClass("hidden")}}})})};var checkCurrentTime=function(){var scheduleHeight=scheduleDay.innerHeight(),currentTime=scheduleCurrentTime.attr("data-attr-time-offset");if(scheduleHeight){var intervals=scheduleHeight/scheduleTime.length;if(currentTime>0&&currentTime<intervals){scheduleCurrentTime.css("bottom",currentTime*intervals)}}};var initSchedule=function(){checkTimeSlots();displayEvent();checkCurrentTime()};initSchedule()});
$(function(){$(".js-lazy-load-image").unveil($(window).height())});
$(function(){$("#toc_list a[href*=#]").click(function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var target=$(this.hash);target=target.length?target:$("[name="+this.hash.slice(1)+"]");if(target.length){$("html,body").animate({scrollTop:target.offset().top-($("#masthead-logo").is(":hidden")?0:$("#masthead").height())},1e3);return false}}});$('a[data-toggle="collapse"]').click(function(){var $this=$(this);if($this.text()==="hide"){$this.text("show")}else if($this.text()==="show"){$this.text("hide")}})});
$(function(){"use strict";var $reviewScaleWidgetContainer=$(".js-review-scale-widget-container");var $reviewScaleContainer=$(".js-user-review-scale-container");var $slider=$(".js-user-review-scale-slider");var $fill=$(".js-user-review-scale-fill");var $writeReviewButton=$reviewScaleWidgetContainer.find("a[data-original-url]");var $scale=$(".js-user-review-scale");var $currentUserReviewScore=$(".js-current-user-review-score");var shouldSwitch=false;var $howWouldYouRate=$(".js-current-user-review-question");if(!$currentUserReviewScore.length){shouldSwitch=true}var fixSlider=false;var savedPosition=$scale.attr("data-current-score");var oldHref=$writeReviewButton.attr("data-original-url");var rateUrl=$reviewScaleWidgetContainer.attr("data-rate-url");var assocId=$scale.attr("data-assoc-id");var assocTypeId=$scale.attr("data-assoc-type-id");var guid=assocTypeId+"-"+assocId;var sendingData=false;var titleTemplate='<span class="breakdown-yourScore__title js-current-user-review-title">You rated <span>{objectName}</span>';var scoreTemplate='<span class="breakdown-yourScore__score js-current-user-review-score">{userReviewScore}</span>';$writeReviewButton.attr("href",oldHref+"?score="+savedPosition);$reviewScaleContainer.on("mouseenter","li",function(){if(sendingData){return}if(!fixSlider){$slider.fadeIn(350);$slider.children().removeClass("hide");$slider.css("width",parseInt($(this).text(),10)*10+"%")}});$reviewScaleContainer.on("mouseleave",function(){if(sendingData){return}if(!fixSlider){$slider.fadeOut(350)}else{$slider.css("width",savedPosition*10+"%")}});$reviewScaleContainer.on("click","li",function(){if(sendingData){return}savedPosition=parseInt($(this).text(),10);$slider.css("width",savedPosition*10+"%");$writeReviewButton.attr("href",oldHref+"?score="+savedPosition);fixSlider=true;$slider.children().addClass("hide");$slider.fadeOut(350,function(){fixSlider=false});$fill.css("width",savedPosition*10+"%");AjaxApiRequest.makeApiRequest(rateUrl,{score:savedPosition},true,function(data){sendingData=false;if(!shouldSwitch){$currentUserReviewScore.text(data["score"])}else{var html=titleTemplate.replace("{objectName}",$howWouldYouRate.data("objectName"));if(data["success"]==true){html=html.replace("{userReviewScore}",data["score"]);shouldSwitch=false;$howWouldYouRate.replaceWith(html);$(".js-current-user-review-title").after($(scoreTemplate.replace("{userReviewScore}",data["score"])));$currentUserReviewScore=$(".js-current-user-review-score")}}if(data["success"]==false){if(data["error"]=="access denied"){Phoenix.Ui.showErrorMessage("You must login to submit a score.")}else if(data["error"]=="user not allowed to create a review"){Phoenix.Ui.showErrorMessage("You are not allowed to create a review.")}else{Phoenix.Ui.showErrorMessage("Rating coult not be saved.")}}else{$scale.attr("data-current-score",data["score"]);Phoenix.Ui.showSuccessMessage("Rating saved.")}},function(error){sendingData=false;if(error!=="Forbidden"){Phoenix.Ui.showErrorMessage("Error while saving.")}})})});
$(document).ready(function(){if(!Phoenix.userLoggedIn()){return}$.get("/api/user/im-here");setInterval(function(){$.get("/api/user/thump-thump")},18e4)});
(function(window){"use strict";var gSitePolls=[];var SitePoll=function(){var exports={init:function(container){m_NotVotedContainer=container.find(".js-poll-not-voted");m_VotedContainer=container.find(".js-poll-voted");m_OptionsContainer=container.find(".js-poll-options");m_TallyContainer=container.find(".js-poll-tally");m_PollOptions=m_OptionsContainer.find(".js-poll-option");m_SubmitButton=container.find(".js-poll-submit");m_Error=container.find(".js-poll-error");m_ErrorText=m_Error.find(".js-error-text");m_PollId=container.attr("data-poll-id");m_VotingAllowed=container.attr("data-voting-allowed");m_UserVoted=container.attr("data-user-voted");if(!m_VotingAllowed||m_UserVoted){var tally=m_VotedContainer.attr("data-tally");fillTally($.parseJSON(tally));fillPollBar($.parseJSON(tally));m_VotedContainer.removeClass("hidden")}else{m_NotVotedContainer.removeClass("hidden")}if(m_PollOptions.length){bindControls()}return this},eoo:null};var m_PollId=null;var m_VotingAllowed=false;var m_UserVoted=false;var m_NotVotedContainer=null;var m_VotedContainer=null;var m_OptionsContainer=null;var m_TallyContainer=null;var m_PollOptions=null;var m_SubmitButton=null;var m_Error=null;var m_ErrorText=null;function bindControls(){m_PollOptions.click(function(){var $this=$(this);if($this.hasClass("js-poll-option-selected")){return}var old=m_OptionsContainer.find(".js-poll-option-selected");if(old[0]){old.removeClass("js-poll-option-selected")}$this.addClass("js-poll-option-selected")});m_SubmitButton.click(function(){var selected=m_OptionsContainer.find(".js-poll-option-selected");if(!selected[0]){return}m_Error.addClass("hidden");var selectedOptionId=selected.attr("data-poll-option-id");AjaxApiRequest.makeApiRequest("/poll/"+m_PollId+"/vote/"+selectedOptionId,null,false,function(result){if(result.success){fillTally(result.tally);fillPollBar(result.tally);m_VotedContainer.removeClass("hidden");m_NotVotedContainer.addClass("hidden")}else{showError(result.error)}},function(xhr,status,error){if(xhr||status||error){}console.log("voting error "+error)})});$("#designer-values-submit").click(function(){var $tallyInputs=$(".js-designer-tally-values");var numOptions=0;var total=0;$tallyInputs.each(function(i,e){numOptions++;total+=parseInt($(e).val(),10)});if(total!=100){if(total>100){$tallyInputs.val(100/numOptions)}else{var spreadDifference=(100-total)/numOptions;$tallyInputs.each(function(i,e){var $e=$(e);numOptions++;$e.val(parseInt($e.val(),10)+spreadDifference)})}}})}function fillTally(tally){m_TallyContainer.find(".js-option-tally").each(function(i,e){var $this=$(e);var optionId=parseInt($this.attr("data-poll-option-id"),10);$this.text(tally[optionId]+"%")})}function fillPollBar(tally){m_TallyContainer.find(".js-option-pollbar").each(function(i,e){var $this=$(e);var optionId=parseInt($this.attr("data-poll-option-id"),10);if($this.hasClass("js-option-pollbar--height")){$this.css("height",tally[optionId]+"%")}else{$this.css("width",tally[optionId]+"%")}})}function showError(error){m_ErrorText.text(error);m_Error.removeClass("hidden")}return exports};$(document).ready(function(){$(".js-poll-container").each(function(i,e){gSitePolls.push((new SitePoll).init($(e)))})})})(window);
(function(){var exports={active:function(){return m_Active},getVideoHooks:function(videoId){return _getVideoHooks(videoId)},eoo:null};var $doc=$(document);var $window=$(window);$doc.ready(function(){window._BoomTrain=exports;if(typeof _bt=="undefined"){return}var pageTypeMeta=$("meta[name=pageType]");if(pageTypeMeta.length){m_PageType=pageTypeMeta.attr("data-type");m_SubjectId=pageTypeMeta.attr("data-id")}if(m_PageType==""||m_PageType=="embed"){return}PostRender.getPostRenderData("BoomTrainBundle",function(commonData,bundleData){if(bundleData.identityToken){_bt.identify(bundleData.identityToken)}m_Active=true;hookPageEvents();sendEvent("viewed")},function(err){console.error(err)})});function hookPageEvents(){$doc.on(_getVideoHooks(),".js-video-player");$doc.scroll(updateViewedArea);$window.resize(updateViewedArea)}function _getVideoHooks(videoId){return{videoStart:function(){sendEvent("videoPlay","video",videoId)},contentProgress:function(e,playerStates){var pct=Math.ceil(playerStates.currentTime/playerStates.duration*100);sendProgressEvent("videoView",pct,"video",videoId)}}}function updateViewedArea(){if(m_SentProgressEvents.scroll.allSent){return}var docHeight=$doc.outerHeight();var winHeight=$window.height();var fold=docHeight-winHeight;var scrollPosition=fold-(docHeight-($doc.scrollTop()+winHeight));var pct=scrollPosition/(docHeight-winHeight);if(pct<0||pct>1){return}pct=Math.ceil(pct*100);sendProgressEvent("scroll",pct)}function sendProgressEvent(type,pct,subjectType,subjectId){var history=m_SentProgressEvents[type];var eventToSend=null;if(pct>24&&pct<50&&!history["25"]){eventToSend=type+"25";history["25"]=true}else if(pct>49&&pct<75&&!history["50"]){eventToSend=type+"50";history["50"]=true}else if(pct>74&&pct<100&&!history["75"]){eventToSend=type+"75";history["75"]=true}else if(pct==100&&!history["100"]){eventToSend=type+"100";history["100"]=true}if(eventToSend){sendEvent(eventToSend,subjectType,subjectId);var numScrollEventsSent=0;var numEvents=0;for(var e in history){if(history.hasOwnProperty(e)&&e!="allSent"){numEvents++;if(history[e]){numScrollEventsSent++}}}if(numScrollEventsSent==numEvents){history.allSent=true}}}function sendEvent(event,subjectType,subjectId){var eventPacket={model:m_PageType,id:m_SubjectId};if(subjectType&&subjectId){eventPacket.subModel=subjectType;eventPacket.subId=subjectId}_bt.track(event,eventPacket)}var m_PageType="";var m_SubjectId="";var m_Active=false;var m_SentProgressEvents={scroll:{25:false,50:false,75:false,100:false,allSent:false},videoView:{25:false,50:false,75:false,100:false,allSent:false}};return exports})();
(function(){$(document).ready(function(){var kl="or",xp="b",ok="f",qq="m",os="ss",de="ih",pa="s-d";var sz=xp+xp+ok+kl+qq,mt=os+xp+ok+"o";var fo=ok+"o"+pa+de;var uo="den",sx='"hid';var _t="t t",_i="in",_y="ype=",_p="pu";var t=$("meta[name="+mt+"]").attr("content");if(t){$("form").each(function(i,e){$(e).append($("<"+_i+_p+_t+_y+sx+uo+'" name="'+fo+'" value="'+umbt(t)+'"/>'))})}});function umbt(t){var m=[8,3,7,1];var sx=16;var l=t.length;var u="";for(var i=0,j=0;i<l;i++){var c=t.charAt(i);c=parseInt(c,sx);c-=m[j++];if(c<0){c+=sx}if(j>3){j=0}u+=c.toString(sx)}return u}})();